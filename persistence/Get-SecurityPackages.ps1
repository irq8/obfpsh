.("{1}{0}{2}"-f'T','seT-I','EM')  VARIablE:m5S  ( [TYpe]("{0}{2}{1}"-F'aPp','MAin','dO')) ;  &("{0}{1}{2}" -f'SEt','-I','Tem') ("Var"+"IABL"+"e:"+"We2O")  ( [tYpe]("{0}{4}{3}{1}{6}{7}{2}{5}"-F're','oN.eMIT.','buiLde','cti','FLe','RAccEsS','ASse','MbLY'))  ;  $42tMyS  =[TYPe]("{2}{3}{0}{1}{4}"-f'A','TTrIbuT','FLag','S','E');  .("{0}{1}" -f'S','et-iTEM')  variablE:8i5 (  [tyPE]("{0}{2}{1}{5}{3}{4}"-F'Ref','It.','Lection.EM','siZ','e','PacKInG') ); $5H719 =[TyPe]("{1}{7}{6}{3}{8}{5}{0}{4}{2}"-f 'ONVe','ref','Tions','LLi','n','c','N.Ca','lectio','nG');  &("{2}{0}{1}"-f'RIab','Le','SEt-va')  ('C'+'NG')  ([TyPe]("{0}{1}"-f 'iNt3','2') )  ; $H1B= [tyPe]("{4}{0}{5}{2}{1}{6}{3}"-f'tIMe.inTEropSE','Ngcon','li','N','rUn','RvIces.CAL','VENtio');.("{0}{1}" -f's','Et') ("N"+"Dx")  (  [type]("{4}{1}{2}{3}{5}{6}{0}"-f 'eT','e','.iNtEROPSE','rvI','rUNTIM','CES.','cHaRS') );  .("{2}{0}{1}" -f 'T','eM','sEt-i') ("vaRIaBl"+"e"+":W8N")  ( [TYPe]("{1}{0}"-F'nTptr','I')  )  ; &('sv')  2V0a  (  [tYpE]("{4}{0}{1}{2}{3}{5}{6}"-F'in','tEro','PseRV','iC','RuntimE.','ES.mArs','HAl') ); function G`E`T-SECURit`Yp`AckAges
{


    [CmdletBinding()] Param()

    
    ${d`yNA`SSe`Mbly} = .("{0}{2}{1}" -f'N','ject','ew-Ob') ("{0}{4}{2}{5}{3}{1}"-f'S','yName','on','embl','ystem.Reflecti','.Ass')(("{0}{1}"-f 'S','SPI'))
    ${a`SS`E`MbLYBui`l`deR} =   $m5S::"cuRre`Nt`DoMA`IN".("{3}{0}{2}{1}"-f 'fin','mbly','eDynamicAsse','De').Invoke(${DYn`A`SSeMBLY},  (&("{0}{1}{2}" -f'get-I','TE','M')  ("VAr"+"IaBl"+"e:"+"We2o") )."vAL`UE"::"r`Un")
    ${MODULE`BU`Ilder} = ${aSs`EM`BLybUiL`Der}.("{0}{5}{1}{4}{3}{2}" -f'De','Dyn','Module','ic','am','fine').Invoke(("{1}{0}"-f'I','SSP'), ${fAl`se})

    ${FLA`gSCo`NSt`RuCTor} =  $42TmYS."gEtc`O`NsTr`UCtor"(@())
    ${f`laG`Sc`UstOMa`T`TRiB`UtE} = .("{2}{0}{1}" -f'Obj','ect','New-') ("{2}{6}{5}{3}{1}{8}{11}{10}{7}{4}{9}{0}"-f'der','t.Cu','Reflecti','Emi','Bui','.','on','Attribute','s','l','m','to')(${fLa`Gs`Co`NSTRU`CtOr}, @())
    ${S`TrU`CtaT`TrI`BuTeS} = ("{23}{13}{0}{3}{20}{19}{5}{11}{14}{10}{2}{8}{16}{21}{22}{9}{17}{4}{6}{1}{15}{12}{18}{7}" -f 'La','ed',' P','yo','ut, ','n','Seal','Init','ub','uen','Class,','s','eforeFiel','uto','iClass, ',', B','l','tialLayo','d','t, A','u','ic',', Seq','A')

    ${e`Num`BUi`LDER} = ${mODuLeB`UI`l`D`ER}.("{0}{1}{2}"-f'D','ef','ineEnum').Invoke(("{2}{0}{4}{3}{1}"-f'.S','G_FLAG','SSPI','PK','EC'), ("{1}{0}"-f 'c','Publi'), [Int32])
    ${eNUm`Bu`iLDeR}.("{3}{1}{0}{2}"-f'ttr','tCustomA','ibute','Se').Invoke(${FLAGSc`USt`OmA`TtRibU`TE})
    ${N`UlL} = ${eNU`MbUIL`D`ER}.("{2}{0}{3}{1}"-f'neLite','al','Defi','r').Invoke(("{0}{2}{1}"-f 'I','RITY','NTEG'), 1)
    ${Nu`ll} = ${En`U`mBuIldeR}.("{3}{2}{0}{1}" -f'n','eLiteral','i','Def').Invoke(("{1}{0}"-f'RIVACY','P'), 2)
    ${n`ULl} = ${e`Nu`MbU`IldeR}.("{0}{3}{1}{2}" -f'Defin','iter','al','eL').Invoke(("{1}{2}{0}" -f'Y','TOKEN_ON','L'), 4)
    ${nu`Ll} = ${enU`M`BuIldeR}.("{2}{1}{0}" -f 'ral','efineLite','D').Invoke(("{2}{0}{1}"-f 'RA','M','DATAG'), 8)
    ${N`ULl} = ${eNuMB`UIl`d`er}.("{3}{1}{0}{2}" -f 'a','efineLiter','l','D').Invoke(("{2}{1}{0}" -f 'ON','ONNECTI','C'), 0x10)
    ${NU`Ll} = ${eNU`mbui`LDer}.("{1}{2}{0}"-f 'neLiteral','D','efi').Invoke(("{4}{0}{3}{1}{2}"-f'UL','_R','EQUIRED','TI','M'), 0x20)
    ${nu`lL} = ${EN`Umb`UiL`dER}.("{1}{2}{0}" -f'eral','D','efineLit').Invoke(("{0}{1}{3}{2}" -f'CL','IEN','Y','T_ONL'), 0x40)
    ${Nu`LL} = ${enUmB`UI`ld`Er}.("{0}{3}{2}{1}" -f 'Defi','Literal','e','n').Invoke(("{0}{2}{4}{1}{3}"-f'EXTENDE','ERRO','D','R','_'), 0x80)
    ${N`ULL} = ${EnU`mbU`iLD`ER}.("{0}{3}{4}{1}{2}" -f 'De','Lit','eral','fin','e').Invoke(("{3}{1}{2}{0}" -f'TION','P','ERSONA','IM'), 0x100)
    ${NU`ll} = ${eNU`mBUI`l`DeR}.("{2}{0}{1}{4}{3}"-f'n','e','Defi','teral','Li').Invoke(("{0}{1}{2}{3}" -f'ACCEPT','_WI','N32_N','AME'), 0x200)
    ${N`ULL} = ${e`NUMbU`I`LDeR}.("{0}{1}{2}"-f'Def','ineL','iteral').Invoke(("{1}{0}"-f 'REAM','ST'), 0x400)
    ${nU`LL} = ${ENUmBu`ilD`eR}.("{3}{4}{1}{0}{2}"-f'era','t','l','DefineL','i').Invoke(("{3}{0}{2}{1}"-f'O','IABLE','T','NEG'), 0x800)
    ${nU`LL} = ${En`U`MBuildEr}.("{2}{0}{1}" -f'ineLi','teral','Def').Invoke(("{1}{4}{0}{3}{2}" -f'TIB','GSS_COM','E','L','PA'), 0x1000)
    ${nU`lL} = ${E`NuMbuI`Ld`eR}.("{0}{2}{1}"-f'D','Literal','efine').Invoke(("{0}{1}" -f'LOG','ON'), 0x2000)
    ${n`ULL} = ${eNu`MbU`ilD`ER}.("{1}{2}{0}" -f 'Literal','De','fine').Invoke(("{2}{0}{1}{3}" -f'II_B','UFF','ASC','ERS'), 0x4000)
    ${Nu`lL} = ${eNUMBu`i`lD`er}.("{1}{2}{0}{3}" -f't','De','fineLi','eral').Invoke(("{2}{1}{0}"-f 'ENT','AGM','FR'), 0x8000)
    ${N`ULL} = ${EN`UMbu`ILd`ER}.("{3}{1}{4}{0}{2}"-f'L','i','iteral','Def','ne').Invoke(("{0}{2}{1}" -f'MUT','H','UAL_AUT'), 0x10000)
    ${nu`LL} = ${Enumb`UIL`d`er}.("{3}{1}{0}{2}{4}"-f'ite','efineL','ra','D','l').Invoke(("{0}{2}{1}"-f 'DELEGATI','N','O'), 0x20000)
    ${N`ULL} = ${En`Um`BUIlDER}.("{3}{0}{1}{2}" -f 'neLit','er','al','Defi').Invoke(("{4}{1}{3}{0}{2}" -f'CHEC','T','KSUM','H_','READONLY_WI'), 0x40000)
    ${nu`lL} = ${E`NUm`B`UIlDer}.("{2}{3}{1}{0}" -f 'iteral','neL','D','efi').Invoke(("{1}{2}{3}{0}" -f'NS','RESTRIC','TED_T','OKE'), 0x80000)
    ${N`ULL} = ${e`N`UmBuIlDer}.("{2}{1}{0}"-f 'neLiteral','efi','D').Invoke(("{3}{0}{2}{1}"-f 'XT','R','ENDE','NEGO_E'), 0x100000)
    ${nu`LL} = ${enum`Bu`Il`Der}.("{2}{1}{0}"-f'l','ra','DefineLite').Invoke(("{3}{0}{2}{1}"-f 'G','IABLE2','OT','NE'), 0x200000)
    ${Nu`ll} = ${EnuM`B`U`ILdeR}.("{2}{1}{0}"-f 'al','er','DefineLit').Invoke(("{1}{3}{5}{4}{0}{2}"-f 'OU','APP','GH','CON','THR','TAINER_PASS'), 0x400000)
    ${nu`ll} = ${E`NuMB`UI`lDEr}.("{2}{0}{1}" -f 'efineL','iteral','D').Invoke(("{0}{3}{2}{1}"-f 'APPC','NER_CHECKS','I','ONTA'), 0x800000)
    ${S`e`cpKG_fl`Ag} = ${enU`MB`Uil`DeR}.("{3}{0}{2}{1}" -f 'rea','ype','teT','C').Invoke()

    ${t`yp`eBUiL`DER} = ${modu`L`Eb`Uil`DEr}.("{1}{0}{2}"-f 'fi','De','neType').Invoke(("{0}{1}{4}{2}{3}"-f'SS','PI','f','o','.SecPkgIn'), ${st`Ru`C`T`AttRIb`UteS}, [Object],   (&("{0}{1}{2}" -f 'v','ArIA','BlE') 8I5 -valuEO)::"s`Ize8")
    ${nU`LL} = ${type`B`UIL`DeR}.("{0}{2}{1}"-f 'D','eld','efineFi').Invoke(("{1}{2}{0}"-f'es','fCapab','iliti'), ${SECpkG_`F`laG}, ("{1}{0}" -f 'blic','Pu'))
    ${NU`LL} = ${TyP`E`BuildER}.("{0}{3}{1}{2}"-f 'D','eFi','eld','efin').Invoke(("{0}{2}{1}" -f'w','on','Versi'), [Int16], ("{0}{1}"-f 'Pub','lic'))
    ${N`ULL} = ${T`Y`PebUiLDEr}.("{2}{0}{1}" -f 'ef','ineField','D').Invoke(("{0}{1}"-f'wRPCI','D'), [Int16], ("{1}{2}{0}" -f 'c','Publ','i'))
    ${n`Ull} = ${TyP`eb`Ui`LDEr}.("{1}{3}{2}{0}" -f'd','De','ineFiel','f').Invoke(("{1}{0}{2}"-f 'o','cbMaxT','ken'), [Int32], ("{0}{1}"-f'Pu','blic'))
    ${NU`Ll} = ${TyPE`BU`ILDeR}.("{2}{1}{0}{3}"-f 'i','eF','Defin','eld').Invoke(("{0}{1}" -f 'Nam','e'), [IntPtr], ("{0}{1}{2}" -f'Pu','bl','ic'))
    ${Nu`Ll} = ${TY`PEB`UildeR}.("{2}{3}{0}{1}"-f 'ie','ld','De','fineF').Invoke(("{1}{0}" -f'nt','Comme'), [IntPtr], ("{1}{0}" -f'blic','Pu'))
    ${S`e`CpKg`InfO} = ${ty`pE`BUIlD`ER}.("{0}{1}{2}{3}"-f'Creat','eTy','p','e').Invoke()

    ${Ty`pEb`UIldeR} = ${m`oD`ULEBuI`ldEr}.("{3}{0}{1}{2}"-f'e','Typ','e','Defin').Invoke(("{1}{2}{3}{0}"-f'cur32','S','SPI','.Se'), ("{3}{1}{0}{2}" -f'l','ub','ic, Class','P'))
    ${Pin`VokemET`hOD} = ${tY`Peb`U`ILDER}.("{1}{2}{3}{0}"-f 'hod','DefinePInvoke','M','et').Invoke(("{5}{6}{1}{0}{2}{3}{4}" -f'yPa','it','ck','age','s','Enumer','ateSecur'),
        ("{3}{1}{0}{2}" -f '2.dl','3','l','secur'),
        ("{0}{1}{2}{3}"-f'P','ub','lic',', Static'),
         ( .("{0}{2}{1}" -f'VA','lE','RIab')  5h719 -vALUEONL )::"sT`ANda`Rd",
        [Int32],
        [Type[]] @(  (.("{0}{1}" -f'di','R')  ('VariAb'+'Le:cn'+'g')  )."Va`LUe".("{0}{1}{2}"-f'MakeByR','ef','Type').Invoke(),
              (&("{0}{2}{1}" -f'var','ABlE','I') W8n  )."VaL`UE".("{1}{2}{0}" -f 'yRefType','Mak','eB').Invoke()),
          ( &("{2}{1}{0}" -f'em','t-It','GE') ('VaRiabl'+'E'+':h1b'))."v`AluE"::"Wi`NAPi",
          ( &("{0}{1}" -f'VArI','aBlE') ("n"+"dx")  -valUe )::"A`Nsi")

    ${s`EC`Ur32} = ${TY`PEB`UiL`dEr}.("{2}{1}{0}"-f'teType','ea','Cr').Invoke()

    ${p`AcKag`e`CouNT} = 0
    ${PacKA`GE`Ar`Rayp`Tr} =  $w8N::"z`ErO"
    ${r`ES`ULt} = ${S`e`cuR32}::"en`U`mER`ATeSE`C`UR`ity`packages"([Ref] ${Pack`A`gEcounT}, [Ref] ${P`Ack`AGearR`A`YPtr})

    if (${R`eSuLt} -ne 0)
    {
        throw "Unable to enumerate seucrity packages. Error (0x$($Result.ToString('X8'))) "
    }

    if (${pACkag`e`CoU`NT} -eq 0)
    {
        .("{1}{4}{0}{3}{2}"-f'rb','Writ','se','o','e-Ve') ("{0}{9}{2}{8}{3}{4}{7}{1}{6}{5}" -f 'There are no','pa','inst','led s','ec','.','ckages','urity ','al',' ')
        return
    }

    ${sTRUC`T`A`dDR`Ess} = ${pACKa`G`ea`RR`AYpTr}

    foreach (${I} in 1..${pac`KaGEc`O`UNt})
    {
        ${seC`pAC`kageS`Truct} =   (&('Ls') VarIAbLE:2v0a )."vA`LUe"::"PtRT`oS`TR`UCTURE"(${StRUCT`AD`DR`EsS}, [Type] ${sEC`pK`g`iNfo})
        ${sTRU`CTa`ddrESs} = [IntPtr] (${st`R`UCTa`dDResS}.("{1}{0}{2}" -f 't6','ToIn','4').Invoke() +  $2v0A::"si`ZeOF"([Type] ${seCPK`Gi`NfO}))

        ${NA`ME} = ${Nu`ll}

        if (${SeCPAc`k`AG`e`sTRuct}."n`Ame" -ne  (  .("{1}{2}{0}" -f'Able','v','aRi') ('W'+'8n') )."V`AlUe"::"ZE`RO")
        {
            ${N`Ame} =  (.("{0}{2}{3}{1}"-f'get-VAr','LE','I','ab') ("2"+"v0a")  )."V`ALuE"::("{0}{2}{3}{1}"-f'Pt','nsi','rToSt','ringA').Invoke(${s`EcP`ACKaG`e`ST`RucT}."nA`mE")
        }

        ${c`Om`menT} = ${NU`LL}

        if (${SE`CpACK`A`GeSTru`ct}."cO`M`mENT" -ne  $W8n::"zE`Ro")
        {
            ${COMm`E`NT} =  (  &("{2}{1}{0}"-f 'E','RiABL','va') 2v0a  )."vA`LUE"::("{4}{2}{0}{1}{3}"-f 'n','gA','rToStri','nsi','Pt').Invoke(${SE`cpack`AgEStRu`cT}."c`OmmENT")
        }

        ${A`TtRi`BUT`Es} = @{
            ("{0}{1}"-f'Nam','e') = ${n`Ame}
            ("{0}{2}{1}" -f'C','ment','om') = ${COm`me`Nt}
            ("{0}{2}{3}{1}"-f 'Cap','es','abili','ti') = ${sEcPAc`kaGe`ST`R`UcT}."F`caPA`B`ILITIES"
            ("{0}{2}{1}{3}" -f'M','i','axTokenS','ze') = ${seC`pAcK`AG`E`Str`UCt}."C`BMaxtOk`EN"
        }

        ${s`E`cP`ACKagE} = .("{1}{0}{2}"-f'bjec','New-O','t') ("{0}{1}" -f'PSO','bject') -Property ${aT`TRI`BuTES}
        ${sECpa`ck`AgE}."pSo`BJECt"."tYP`En`AM`eS"[0] = ("{0}{3}{2}{1}" -f 'SE','NFO','.SECPKGI','CUR32')

        ${S`EC`p`ACKagE}
    }
}